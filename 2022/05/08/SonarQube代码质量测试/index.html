

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="rlin">
  <meta name="keywords" content="">
  <title>SonarQube代码质量测试 - rlin的运维笔记</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/blog/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/blog/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"rintime.gitee.io","root":"/blog/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>rlin的运维笔记</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="SonarQube代码质量测试">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-05-08 11:42" pubdate>
        2022年5月8日 中午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.7k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      138
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">SonarQube代码质量测试</h1>
            
            <div class="markdown-body">
              <h1 id="一、SonarQube-简介"><a href="#一、SonarQube-简介" class="headerlink" title="一、SonarQube 简介"></a>一、SonarQube 简介</h1><h2 id="1-1-SonarQube-简单介绍"><a href="#1-1-SonarQube-简单介绍" class="headerlink" title="1.1 SonarQube 简单介绍"></a>1.1 SonarQube 简单介绍</h2><p>SonarQube 是一个用于代码质量管理的开放平台，通过插件机制，SonarQube 可以集成不同的测试工具，代码分析工具，以及持续集成工具，例如 Hudson/Jenkins 等。</p>
<p>官方网站：<a target="_blank" rel="noopener" href="http://www.sonarqube.org/">http://www.sonarqube.org/</a></p>
<p>官方下载网站：<a target="_blank" rel="noopener" href="https://www.sonarqube.org/downloads/">https://www.sonarqube.org/downloads/</a></p>
<p>官方文档网站：<a target="_blank" rel="noopener" href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/">https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/</a></p>
<p>sonarqube的七个维度检测代码质量：</p>
<ol>
<li>复杂度分布：代码复杂度过高将难以理解</li>
<li>重复代码：程序中包含大量复制、粘贴的代码而导致代码臃肿，sonar 可以展示源码中重复严重的地方</li>
<li>单元测试统计：统计并展示单元测试覆盖率，开发或测试可以清楚测试代码的覆盖情况</li>
<li>代码规则检查：检查代码是否符合规范</li>
<li>注释率：若代码注释过少，特别是人员变动后，其他人接手比较难接手；若过多，又不利于阅读潜在的 Bug：检测潜在的 bug</li>
<li>结构与设计：找出循环，展示包与包、类与类之间的依赖、检查程序之间耦合度</li>
</ol>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube1.png" srcset="/blog/img/loading.gif"></p>
<h2 id="1-2-sonarqube-工具简介"><a href="#1-2-sonarqube-工具简介" class="headerlink" title="1.2 sonarqube 工具简介"></a>1.2 sonarqube 工具简介</h2><p><strong>sonarqube server</strong>：给sonarqube提供server服务。</p>
<p><strong>sonar scanner</strong>：提供扫描服务。该工具可以安装在任何一台服务器，不一定要安装在装有 sonarqube server 的服务器里。</p>
<p><strong>生产环境流使用sonar-scanner流程图</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube2.png" srcset="/blog/img/loading.gif"></p>
<h1 id="二、SonarQube-环境依赖"><a href="#二、SonarQube-环境依赖" class="headerlink" title="二、SonarQube 环境依赖"></a>二、SonarQube 环境依赖</h1><h2 id="2-1-硬件要求"><a href="#2-1-硬件要求" class="headerlink" title="2.1 硬件要求"></a>2.1 硬件要求</h2><table>
<thead>
<tr>
<th></th>
<th>6.7.7 LTS</th>
<th>7.9.6 LTS</th>
<th>8.9.7 LTS</th>
</tr>
</thead>
<tbody><tr>
<td>内存大小</td>
<td>2GB</td>
<td>2GB</td>
<td>2GB</td>
</tr>
<tr>
<td>硬盘大小</td>
<td>根据源码大小决定</td>
<td>根据源码大小决定</td>
<td>根据源码大小决定</td>
</tr>
<tr>
<td>硬盘读写性能</td>
<td>需要出色读写性能</td>
<td>需要出色读写性能</td>
<td>需要出色读写性能</td>
</tr>
<tr>
<td>是否支持32位</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
</tbody></table>
<h2 id="2-2-平台要求"><a href="#2-2-平台要求" class="headerlink" title="2.2 平台要求"></a>2.2 平台要求</h2><h3 id="2-2-1-Java"><a href="#2-2-1-Java" class="headerlink" title="2.2.1 Java"></a>2.2.1 Java</h3><h4 id="6-7-7-LTS"><a href="#6-7-7-LTS" class="headerlink" title="6.7.7 LTS"></a><strong>6.7.7 LTS</strong></h4><table>
<thead>
<tr>
<th></th>
<th>Server</th>
<th>Scan</th>
</tr>
</thead>
<tbody><tr>
<td>Oracle JRE 7</td>
<td>✘</td>
<td>✘</td>
</tr>
<tr>
<td>Oracle JRE 8</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td>Oracle JRE 9</td>
<td>✘</td>
<td>✘</td>
</tr>
<tr>
<td>Open JDK 7</td>
<td>✘</td>
<td>✘</td>
</tr>
<tr>
<td>Open JDK 8</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td>Open JDK 9</td>
<td>✘</td>
<td>✘</td>
</tr>
<tr>
<td>IBM JRE</td>
<td>✘</td>
<td>✘</td>
</tr>
<tr>
<td>GCJ</td>
<td>✘</td>
<td>✘</td>
</tr>
<tr>
<td>Orcale JRockit</td>
<td>✘</td>
<td>✘</td>
</tr>
</tbody></table>
<h4 id="7-9-6-LTS"><a href="#7-9-6-LTS" class="headerlink" title="7.9.6 LTS"></a><strong>7.9.6 LTS</strong></h4><table>
<thead>
<tr>
<th></th>
<th>Server</th>
<th>Scan</th>
</tr>
</thead>
<tbody><tr>
<td>Oracle JRE 11</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td>Oracle JRE 8</td>
<td>✘</td>
<td>✔</td>
</tr>
<tr>
<td>Open JDK 11</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td>Open JDK 8</td>
<td>✘</td>
<td>✔</td>
</tr>
</tbody></table>
<h4 id="8-9-7-LTS"><a href="#8-9-7-LTS" class="headerlink" title="8.9.7 LTS"></a><strong>8.9.7 LTS</strong></h4><table>
<thead>
<tr>
<th></th>
<th>Server</th>
<th>Scan</th>
</tr>
</thead>
<tbody><tr>
<td>Oracle JRE 11</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td>Oracle JRE 8</td>
<td>✘</td>
<td>✔</td>
</tr>
<tr>
<td>Open JDK 11</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td>Open JDK 8</td>
<td>✘</td>
<td>✔</td>
</tr>
</tbody></table>
<h3 id="2-2-2-数据库"><a href="#2-2-2-数据库" class="headerlink" title="2.2.2 数据库"></a>2.2.2 数据库</h3><h4 id="6-7-7-LTS-1"><a href="#6-7-7-LTS-1" class="headerlink" title="6.7.7 LTS"></a><strong>6.7.7 LTS</strong></h4><table>
<thead>
<tr>
<th>数据库</th>
<th>版本</th>
<th>是否支持</th>
</tr>
</thead>
<tbody><tr>
<td>Postgre SQL</td>
<td>8.x</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>9.x</td>
<td>✔</td>
</tr>
<tr>
<td>Microsoft SQL Server</td>
<td>2012 (MSSQL SERVER 11.0)</td>
<td>✘</td>
</tr>
<tr>
<td></td>
<td>2014 (MSSQL Server 12.0)with bundled Microsoft JDBC driver. Express Edition is supported</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>2016 (MSSQL Server 13.0) with bundled Microsoft JDBC driver. Express Edition is supported</td>
<td>✔</td>
</tr>
<tr>
<td>Oracle</td>
<td>10G</td>
<td>✘</td>
</tr>
<tr>
<td></td>
<td>11G with Oracle 11.2.x drivers</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>12C with Oracle 12.2.x drivers</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>XE Editions are supported</td>
<td>✔</td>
</tr>
<tr>
<td>MySQL</td>
<td>5.6</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>5.7</td>
<td>✔</td>
</tr>
</tbody></table>
<h4 id="7-9-6-LTS-1"><a href="#7-9-6-LTS-1" class="headerlink" title="7.9.6 LTS"></a><strong>7.9.6 LTS</strong></h4><table>
<thead>
<tr>
<th>数据库</th>
<th>版本</th>
<th>是否支持</th>
</tr>
</thead>
<tbody><tr>
<td>Postgre SQL</td>
<td>10</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>9.3-9.6</td>
<td>✔</td>
</tr>
<tr>
<td>Microsoft SQL Server</td>
<td>2017 (MSSQL Server 14.0) with bundled Microsoft JDBC driver. Express Edition is supported</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>2016 (MSSQL Server 13.0) with bundled Microsoft JDBC driver. Express Edition is supported</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>2014 (MSSQL Server 12.0) with bundled Microsoft JDBC driver. Express Edition is supported</td>
<td>✔</td>
</tr>
<tr>
<td>Oracle</td>
<td>19C</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>18C</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>12C</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>11G</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>XE Editions</td>
<td>✔</td>
</tr>
</tbody></table>
<h4 id="8-9-7-LTS-1"><a href="#8-9-7-LTS-1" class="headerlink" title="8.9.7 LTS"></a><strong>8.9.7 LTS</strong></h4><table>
<thead>
<tr>
<th>数据库</th>
<th>版本</th>
<th>是否支持</th>
</tr>
</thead>
<tbody><tr>
<td>Postgre SQL</td>
<td>13</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>12</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>11</td>
<td></td>
</tr>
<tr>
<td></td>
<td>10</td>
<td></td>
</tr>
<tr>
<td></td>
<td>9.6</td>
<td></td>
</tr>
<tr>
<td>Microsoft SQL Server</td>
<td>2019 (MSSQL Server 15.0) with bundled Microsoft JDBC driver. Express Edition is supported</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>2017 (MSSQL Server 14.0) with bundled Microsoft JDBC driver. Express Edition is supported</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>2016 (MSSQL Server 13.0) with bundled Microsoft JDBC driver. Express Edition is supported</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>2014 (MSSQL Server 12.0) with bundled Microsoft JDBC driver. Express Edition is supported</td>
<td></td>
</tr>
<tr>
<td>Oracle</td>
<td>19C</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>18C</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>12C</td>
<td>✔</td>
</tr>
<tr>
<td></td>
<td>XE Editions</td>
<td>✔</td>
</tr>
</tbody></table>
<h3 id="2-2-3-浏览器"><a href="#2-2-3-浏览器" class="headerlink" title="2.2.3 浏览器"></a>2.2.3 浏览器</h3><h4 id="6-7-7-LTS-2"><a href="#6-7-7-LTS-2" class="headerlink" title="6.7.7 LTS"></a><strong>6.7.7 LTS</strong></h4><table>
<thead>
<tr>
<th>浏览器</th>
<th>版本</th>
<th>是否支持</th>
</tr>
</thead>
<tbody><tr>
<td>Microsoft Internet Explorer</td>
<td>IE 9</td>
<td>✘</td>
</tr>
<tr>
<td></td>
<td>IE10</td>
<td>✘</td>
</tr>
<tr>
<td></td>
<td>IE11</td>
<td>✔</td>
</tr>
<tr>
<td>Microsoft Edge</td>
<td>Latest</td>
<td>✔</td>
</tr>
<tr>
<td>Mozilla Firefox</td>
<td>Latest</td>
<td>✔</td>
</tr>
<tr>
<td>Google Chrome</td>
<td>Latest</td>
<td>✔</td>
</tr>
<tr>
<td>Opera</td>
<td></td>
<td>Not tested</td>
</tr>
<tr>
<td>Safari</td>
<td>Latest</td>
<td>✔</td>
</tr>
</tbody></table>
<h4 id="7-9-6-LTS-2"><a href="#7-9-6-LTS-2" class="headerlink" title="7.9.6 LTS"></a><strong>7.9.6 LTS</strong></h4><table>
<thead>
<tr>
<th>浏览器</th>
<th>版本</th>
<th>是否支持</th>
</tr>
</thead>
<tbody><tr>
<td>Microsoft Internet Explorer</td>
<td>IE 11</td>
<td>✔</td>
</tr>
<tr>
<td>Microsoft Edge</td>
<td>Latest</td>
<td>✔</td>
</tr>
<tr>
<td>Mozilla Firefox</td>
<td>Latest</td>
<td>✔</td>
</tr>
<tr>
<td>Google Chrome</td>
<td>Latest</td>
<td>✔</td>
</tr>
<tr>
<td>Opera</td>
<td></td>
<td>Not tested</td>
</tr>
<tr>
<td>Safari</td>
<td>Latest</td>
<td>✔</td>
</tr>
</tbody></table>
<h4 id="8-9-7-LTS-2"><a href="#8-9-7-LTS-2" class="headerlink" title="8.9.7 LTS"></a><strong>8.9.7 LTS</strong></h4><table>
<thead>
<tr>
<th>浏览器</th>
<th>版本</th>
<th>是否支持</th>
</tr>
</thead>
<tbody><tr>
<td>Microsoft Internet Explorer</td>
<td>IE 11</td>
<td>✔</td>
</tr>
<tr>
<td>Microsoft Edge</td>
<td>Latest</td>
<td>✔</td>
</tr>
<tr>
<td>Mozilla Firefox</td>
<td>Latest</td>
<td>✔</td>
</tr>
<tr>
<td>Google Chrome</td>
<td>Latest</td>
<td>✔</td>
</tr>
<tr>
<td>Opera</td>
<td></td>
<td>Not tested</td>
</tr>
<tr>
<td>Safari</td>
<td>Latest</td>
<td>✔</td>
</tr>
</tbody></table>
<h2 id="2-3-Linux-系统运行要求"><a href="#2-3-Linux-系统运行要求" class="headerlink" title="2.3 Linux 系统运行要求"></a>2.3 Linux 系统运行要求</h2><h3 id="2-3-1-6-7-7-LTS-版本-Linux-系统运行要求"><a href="#2-3-1-6-7-7-LTS-版本-Linux-系统运行要求" class="headerlink" title="2.3.1 6.7.7 LTS 版本 Linux 系统运行要求"></a>2.3.1 6.7.7 LTS 版本 Linux 系统运行要求</h3><ul>
<li><strong>sonarqube 不得在 root 帐户下运行</strong></li>
<li><strong>vm.max_map_count</strong>大于或等于<strong>262144</strong></li>
<li><strong>fs.file-max</strong>大于或等于<strong>65536</strong></li>
<li>运行 SonarQube 的用户可以打开至少<strong>65536 个</strong>文件描述符</li>
<li>运行 SonarQube 的用户至少可以打开 2048 个线程，</li>
<li><strong>seccomp 已编译</strong> 到内核中</li>
</ul>
<h3 id="2-3-2-7-9-6-LTS-版本-Linux-系统运行要求"><a href="#2-3-2-7-9-6-LTS-版本-Linux-系统运行要求" class="headerlink" title="2.3.2 7.9.6 LTS 版本 Linux 系统运行要求"></a>2.3.2 7.9.6 LTS 版本 Linux 系统运行要求</h3><ul>
<li><strong>vm.max_map_count</strong>大于或等于 262144</li>
<li><strong>fs.file-max</strong>大于或等于 65536</li>
<li>运行 SonarQube 的用户可以打开至少 65536 个文件描述符</li>
<li>运行 SonarQube 的用户至少可以打开 4096 个线程</li>
</ul>
<h3 id="2-3-3-8-9-7-LTS-版本-Linux-系统运行要求"><a href="#2-3-3-8-9-7-LTS-版本-Linux-系统运行要求" class="headerlink" title="2.3.3 8.9.7 LTS 版本 Linux 系统运行要求"></a>2.3.3 8.9.7 LTS 版本 Linux 系统运行要求</h3><ul>
<li><strong>vm.max_map_count</strong>大于或等于 524288</li>
<li><strong>fs.file-max</strong>大于或等于 131072</li>
<li>运行 SonarQube 的用户可以打开至少 131072 个文件描述符</li>
<li>运行 SonarQube 的用户至少可以打开 8192 个线程</li>
</ul>
<h2 id="2-4-调整-Linux-系统参数"><a href="#2-4-调整-Linux-系统参数" class="headerlink" title="2.4 调整 Linux 系统参数"></a>2.4 调整 Linux 系统参数</h2><p><strong>一般来说使用CentOS7系统，<code>seccomp</code>已经编译到内核中。但在 Red Hat Linux 6 等发行版中，此功能已停用。</strong></p>
<h3 id="2-4-1调整内核参数"><a href="#2-4-1调整内核参数" class="headerlink" title="2.4.1调整内核参数"></a>2.4.1调整内核参数</h3><p><strong>以8.9.7 LTS 版本为例</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#临时性调整</span><br>sysctl -w vm.max_map_count=524288<br>sysctl -w fs.file-max=131072<br><br><span class="hljs-comment">#永久性调整</span><br>vim /etc/sysctl.conf<br>vm.max_map_count=524288<br>fs.file-max=131072<br><span class="hljs-comment">#使sysctl.conf文件生效</span><br>sysctl -p<br></code></pre></td></tr></table></figure>

<h3 id="2-4-2-调整-sonarqube-用户参数"><a href="#2-4-2-调整-sonarqube-用户参数" class="headerlink" title="2.4.2 调整 sonarqube 用户参数"></a>2.4.2 调整 sonarqube 用户参数</h3><p><strong>以8.9.7 LTS 版本为例</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#暂时性调整</span><br><span class="hljs-built_in">ulimit</span> -n 131072<br><span class="hljs-built_in">ulimit</span> -u 8192<br><br><span class="hljs-comment">#永久性调整，修改完成后退出用户重新登录生效</span><br>vim /etc/security/limits.conf<br>sonarqube   -   nofile   131072<br>sonarqube   -   nproc    8192<br></code></pre></td></tr></table></figure>

<h1 id="三、安装部署数据库"><a href="#三、安装部署数据库" class="headerlink" title="三、安装部署数据库"></a>三、安装部署数据库</h1><h2 id="3-1-安装部署PostgreSQL"><a href="#3-1-安装部署PostgreSQL" class="headerlink" title="3.1 安装部署PostgreSQL"></a>3.1 安装部署PostgreSQL</h2><p><strong>以部署 PostgreSQL 12 为例</strong></p>
<h3 id="3-1-1-安装-PostgreSQL"><a href="#3-1-1-安装-PostgreSQL" class="headerlink" title="3.1.1 安装 PostgreSQL"></a>3.1.1 安装 PostgreSQL</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装PostgreSQL仓库的repo文件</span><br>yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm<br><br><span class="hljs-comment">#安装PostgreSQL</span><br>yum install -y postgresql12-server<br><br><span class="hljs-comment">#初始化并启动postgresql</span><br><span class="hljs-comment">#注意：这一步可以在修改数据完数据存放位置后再执行</span><br>/usr/pgsql-12/bin/postgresql-12-setup initdb<br>systemctl <span class="hljs-built_in">enable</span> postgresql-12<br>systemctl start postgresql-12<br></code></pre></td></tr></table></figure>

<h3 id="3-1-2-修改数据存储位置"><a href="#3-1-2-修改数据存储位置" class="headerlink" title="3.1.2 修改数据存储位置"></a>3.1.2 修改数据存储位置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#添加存储目录</span><br>mkdir -p /mnt/datadisk0/data/postgresql12/data<br>chown -R postgres.postgres /mnt/datadisk0/data/postgresql12<br><br><span class="hljs-comment">#修改postgresql的systemd文件</span><br>vim /usr/lib/systemd/system/postgresql-12.service<br>......<br><span class="hljs-comment">#Environment=PGDATA=/var/lib/pgsql/12/data/</span><br>Environment=PGDATA=/mnt/datadisk0/data/postgresql12/data/<br>......<br></code></pre></td></tr></table></figure>

<h3 id="3-1-3-启动远程访问"><a href="#3-1-3-启动远程访问" class="headerlink" title="3.1.3 启动远程访问"></a>3.1.3 启动远程访问</h3><p>修改postgresql.conf文件，取消listen_addresses是注释，将’localhost‘改为‘*’</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#注意：这里postgresql.conf文件的路径时数据存储位置的路径</span><br>vim /mnt/datadisk0/data/postgresql12/data/postgresql.conf<br>......<br>listen_addresses = <span class="hljs-string">&#x27;*&#x27;</span>          <span class="hljs-comment"># what IP address(es) to listen on;</span><br>......<br></code></pre></td></tr></table></figure>

<p>编辑pg_hba.conf文件，添加远程联连接的地址</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#注意1：这里pg_hba.conf文件的路径时数据存储位置的路径</span><br><span class="hljs-comment">#注意2：找到有IPv4的那个注释添加地址，最后的连接方法为md5</span><br>vim /mnt/datadisk0/data/postgresql12/data/pg_hba.conf<br>......<br><span class="hljs-comment"># IPv4 local connections:</span><br>host    all             all             127.0.0.1/32            ident<br>host    all             all             0.0.0.0/0            md5<br>......<br></code></pre></td></tr></table></figure>

<h3 id="3-1-4-重启数据库"><a href="#3-1-4-重启数据库" class="headerlink" title="3.1.4 重启数据库"></a>3.1.4 重启数据库</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart postgresql-12<br></code></pre></td></tr></table></figure>

<h3 id="3-1-4-创建-SonarQube-使用的用户和数据库"><a href="#3-1-4-创建-SonarQube-使用的用户和数据库" class="headerlink" title="3.1.4 创建 SonarQube 使用的用户和数据库"></a>3.1.4 创建 SonarQube 使用的用户和数据库</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh">su - postgres<br><span class="hljs-comment">#登录数据库</span><br>psql -U postgres<br>psql (12.10)<br>Type <span class="hljs-string">&quot;help&quot;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>.<br><br><span class="hljs-comment">#创建数据库并进行授权普通用户访问：</span><br>postgres=<span class="hljs-comment"># CREATE DATABASE sonar; #创建数据库</span><br>CREATE DATABASE<br><br>postgres=<span class="hljs-comment"># CREATE USER sonar WITH ENCRYPTED PASSWORD &#x27;123456&#x27;; #创建用户</span><br>CREATE ROLE<br><br>postgres=<span class="hljs-comment"># GRANT ALL PRIVILEGES ON DATABASE sonar TO sonar; #授权用户</span><br>GRANT<br><br>postgres=<span class="hljs-comment"># ALTER DATABASE sonar OWNER TO sonar; #执行变更</span><br>ALTER DATABASE<br><br><span class="hljs-comment">#退出</span><br>postgres=<span class="hljs-comment"># \q</span><br><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>

<h2 id="3-2-安装部署MySQL"><a href="#3-2-安装部署MySQL" class="headerlink" title="3.2 安装部署MySQL"></a>3.2 安装部署MySQL</h2><h3 id="3-2-1-安装-MySQL-5-7"><a href="#3-2-1-安装-MySQL-5-7" class="headerlink" title="3.2.1 安装 MySQL 5.7"></a>3.2.1 安装 MySQL 5.7</h3><p>略</p>
<h3 id="3-2-2-创建表和用户"><a href="#3-2-2-创建表和用户" class="headerlink" title="3.2.2 创建表和用户"></a>3.2.2 创建表和用户</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#创建表和用户</span><br><span class="hljs-comment"># mysql -uroot -p123456</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 3<br>Server version: 5.7.34-log MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2021, Oracle and/or its affiliates.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; create database sonar default character <span class="hljs-built_in">set</span> utf8 collate utf8_general_ci;<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; GRANT ALL PRIVILEGES ON sonar.* TO <span class="hljs-string">&#x27;sonar&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;123456&#x27;</span>;<br>Query OK, 0 rows affected, 1 warning (0.01 sec)<br><br><span class="hljs-comment">#验证</span><br><span class="hljs-comment"># mysql -usonar -p123456</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 4<br>Server version: 5.7.34-log MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2021, Oracle and/or its affiliates.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| sonar              |<br>+--------------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br></code></pre></td></tr></table></figure>



<h1 id="四、安装部署-Java"><a href="#四、安装部署-Java" class="headerlink" title="四、安装部署 Java"></a>四、安装部署 Java</h1><h2 id="4-1-安装部署-Java11"><a href="#4-1-安装部署-Java11" class="headerlink" title="4.1 安装部署 Java11"></a>4.1 安装部署 Java11</h2><h3 id="4-1-1-安装部署-Open-JDK-11"><a href="#4-1-1-安装部署-Open-JDK-11" class="headerlink" title="4.1.1 安装部署 Open JDK 11"></a>4.1.1 安装部署 Open JDK 11</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y java-11-openjdk.x86_64<br><br>java -version<br>openjdk version <span class="hljs-string">&quot;11.0.14.1&quot;</span> 2022-02-08 LTS<br>OpenJDK Runtime Environment 18.9 (build 11.0.14.1+1-LTS)<br>OpenJDK 64-Bit Server VM 18.9 (build 11.0.14.1+1-LTS, mixed mode, sharing)<br></code></pre></td></tr></table></figure>

<h3 id="4-1-2-部署安装-Oracle-JRE-11"><a href="#4-1-2-部署安装-Oracle-JRE-11" class="headerlink" title="4.1.2 部署安装 Oracle JRE 11"></a>4.1.2 部署安装 Oracle JRE 11</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/src<br><br><span class="hljs-comment">#下载Oracle JRE 11</span><br>略<br><span class="hljs-comment">#安装Oracle JRE 11</span><br>tar xf jdk-11.0.15.1_linux-x64_bin.tar.gz  -C /usr/<span class="hljs-built_in">local</span>/<br>ln -sv /usr/<span class="hljs-built_in">local</span>/jdk-11.0.15.1 /usr/lib/jdk<br><span class="hljs-comment">#添加环境变量</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;export JAVA_HOME=/usr/local/jdk&#x27;</span> &gt;&gt; /etc/profile.d/java.sh<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar&#x27;</span> &gt;&gt; /etc/profile.d/java.sh <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;export PATH=$PATH:$JAVA_HOME/bin&#x27;</span> &gt;&gt; /etc/profile.d/java.sh<br><span class="hljs-comment">#使变量生效</span><br>. /etc/profile.d/java.sh<br><br>java -version<br>java version <span class="hljs-string">&quot;11.0.15.1&quot;</span> 2022-04-22 LTS<br>Java(TM) SE Runtime Environment 18.9 (build 11.0.15.1+2-LTS-10)<br>Java HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.15.1+2-LTS-10, mixed mode)<br></code></pre></td></tr></table></figure>

<h2 id="4-2-安装部署-Java-8"><a href="#4-2-安装部署-Java-8" class="headerlink" title="4.2 安装部署 Java 8"></a>4.2 安装部署 Java 8</h2><h3 id="4-2-1-安装部署-Open-JDK-8"><a href="#4-2-1-安装部署-Open-JDK-8" class="headerlink" title="4.2.1 安装部署 Open JDK 8"></a>4.2.1 安装部署 Open JDK 8</h3><p>略</p>
<h3 id="4-2-2-安装部署-Oracle-JRE-8"><a href="#4-2-2-安装部署-Oracle-JRE-8" class="headerlink" title="4.2.2 安装部署 Oracle JRE 8"></a>4.2.2 安装部署 Oracle JRE 8</h3><p>略</p>
<h1 id="五、二进制安装部署-SonarQube-Server-8-9-7"><a href="#五、二进制安装部署-SonarQube-Server-8-9-7" class="headerlink" title="五、二进制安装部署 SonarQube Server 8.9.7"></a>五、二进制安装部署 SonarQube Server 8.9.7</h1><h2 id="5-1-安装-SonarQube-Server"><a href="#5-1-安装-SonarQube-Server" class="headerlink" title="5.1 安装 SonarQube Server"></a>5.1 安装 SonarQube Server</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">useradd -r -m -c <span class="hljs-string">&quot;scan code&quot;</span> -s /bin/bash sonarqube<br><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/src<br><br><span class="hljs-comment">#下载SonarQube 8.9.7</span><br>wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-8.9.7.52159.zip<br><br><span class="hljs-comment">#安装SonarQube</span><br>unzip -q sonarqube-8.9.7.52159.zip  -d /usr/<span class="hljs-built_in">local</span>/<br>ln -s /usr/<span class="hljs-built_in">local</span>/sonarqube-8.9.7.52159 /usr/<span class="hljs-built_in">local</span>/sonarqube<br>chown -R sonarqube.sonarqube /usr/<span class="hljs-built_in">local</span>/sonarqube-8.9.7.52159 /usr/<span class="hljs-built_in">local</span>/sonarqube<br><br><span class="hljs-comment">#sonarqube帮助</span><br>./bin/linux-x86-64/sonar.sh --<span class="hljs-built_in">help</span><br>Usage: ./bin/linux-x86-64/sonar.sh &#123; console | start | stop | force-stop | restart | status | dump &#125;<br></code></pre></td></tr></table></figure>

<h2 id="5-2-修改-SonarQube-Server-配置"><a href="#5-2-修改-SonarQube-Server-配置" class="headerlink" title="5.2 修改 SonarQube Server 配置"></a>5.2 修改 SonarQube Server 配置</h2><p><strong>进入配置文件所在的目录</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos7 <span class="hljs-built_in">local</span>]<span class="hljs-comment"># su - sonarqube</span><br>[sonarqube@centos7 ~]$ <span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/sonarqube/conf<br></code></pre></td></tr></table></figure>

<h3 id="5-2-1-设置对数据库的访问"><a href="#5-2-1-设置对数据库的访问" class="headerlink" title="5.2.1 设置对数据库的访问"></a>5.2.1 设置对数据库的访问</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[sonarqube@centos7 conf]$ vim sonar.properties<br><span class="hljs-comment">#找到这几行，取消注释并修改</span><br>sonar.jdbc.username=sonar<br>sonar.jdbc.password=123456<br>sonar.jdbc.url=jdbc:postgresql://10.0.0.101/sonar <span class="hljs-comment">#输入本机IP</span><br></code></pre></td></tr></table></figure>

<h3 id="5-2-2-配置-Elasticsearch-存储路径"><a href="#5-2-2-配置-Elasticsearch-存储路径" class="headerlink" title="5.2.2 配置 Elasticsearch 存储路径"></a>5.2.2 配置 Elasticsearch 存储路径</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos7 ~]<span class="hljs-comment"># mkdir -p /mnt/datadisk0/data/sonarqube/elastic/&#123;data,tmp&#125;</span><br>[root@centos7 ~]<span class="hljs-comment"># chown -R sonarqube.sonarqube /mnt/datadisk0/data/sonarqube</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br><span class="hljs-comment">#找到这几行，取消注释并修改</span><br>sonar.path.data=/mnt/datadisk0/data/sonarqube/elastic/data<br>sonar.path.temp=/mnt/datadisk0/data/sonarqube/elastic/tmp<br></code></pre></td></tr></table></figure>

<h3 id="5-2-3-配置启动的-web-服务器"><a href="#5-2-3-配置启动的-web-服务器" class="headerlink" title="5.2.3 配置启动的 web 服务器"></a>5.2.3 配置启动的 web 服务器</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[sonarqube@centos7 conf]$ vim sonar.properties<br>sonar.web.host=0.0.0.0<br>sonar.web.port=9000<br>sonar.web.context=/sonarqube<br></code></pre></td></tr></table></figure>

<h3 id="5-2-4-配置日志级别"><a href="#5-2-4-配置日志级别" class="headerlink" title="5.2.4 配置日志级别"></a>5.2.4 配置日志级别</h3><p>sonaqube级别有五种</p>
<ul>
<li>ERROR</li>
<li>WARN</li>
<li>INFO</li>
<li>DEBUG</li>
<li>TRACE</li>
</ul>
<p>sonarqube有五种日志</p>
<ul>
<li>global：统一设置一下四种设备的日志级别</li>
<li>app：app日志（main日志）</li>
<li>web：web server日志</li>
<li>ce：compute engine日志</li>
<li>es：elasticsearch日志</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#设置global日志</span><br><span class="hljs-comment">#不推荐：因为app日志必须设定为 INFO 级别的日志，不然会报错</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br>sonar.log.level=INFO<br><br><span class="hljs-comment">#分别设置日志</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br></code></pre></td></tr></table></figure>

<p><strong>app日志设置为其他级别的报错日志</strong></p>
<p>从以下的报错日志可以看出因为 app 日志设置了 INFO 以为的级别，导致“127.0.0.1:9001”连接失败了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs sh">2022.05.09 07:49:15 DEBUG app[][o.a.h.i.n.c.MainClientExec] [exchange: 1] start execution<br>2022.05.09 07:49:15 DEBUG app[][o.a.h.c.p.RequestAddCookies] CookieSpec selected: default<br>2022.05.09 07:49:15 DEBUG app[][o.a.h.c.p.RequestAuthCache] Re-using cached <span class="hljs-string">&#x27;basic&#x27;</span> auth scheme <span class="hljs-keyword">for</span> http://127.0.0.1:9001<br>2022.05.09 07:49:15 DEBUG app[][o.a.h.c.p.RequestAuthCache] No credentials <span class="hljs-keyword">for</span> preemptive authentication<br>2022.05.09 07:49:15 DEBUG app[][o.a.h.i.n.c.InternalHttpAsyncClient] [exchange: 1] Request connection <span class="hljs-keyword">for</span> &#123;&#125;-&gt;http://127.0.0.1:9001<br>2022.05.09 07:49:15 DEBUG app[][o.a.h.i.n.c.PoolingNHttpClientConnectionManager] Connection request: [route: &#123;&#125;-&gt;http://127.0.0.1:9001][total kept alive: 0; route allocated: 0 of 10; total allocated: 0 of 30]<br>2022.05.09 07:49:15 DEBUG app[][o.a.h.i.n.c.PoolingNHttpClientConnectionManager] Connection request failed<br>java.net.ConnectException: Connection refused<br>        at java.base/sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)<br>        at java.base/sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:779)<br>        at org.apache.http.impl.nio.reactor.DefaultConnectingIOReactor.processEvent(DefaultConnectingIOReactor.java:174)<br>        at org.apache.http.impl.nio.reactor.DefaultConnectingIOReactor.processEvents(DefaultConnectingIOReactor.java:148)<br>        at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor.execute(AbstractMultiworkerIOReactor.java:351)<br>        at org.apache.http.impl.nio.conn.PoolingNHttpClientConnectionManager.execute(PoolingNHttpClientConnectionManager.java:221)<br>        at org.apache.http.impl.nio.client.CloseableHttpAsyncClientBase<span class="hljs-variable">$1</span>.run(CloseableHttpAsyncClientBase.java:64)<br>        at java.base/java.lang.Thread.run(Thread.java:834)<br>2022.05.09 07:49:15 DEBUG app[][o.a.h.i.n.c.InternalHttpAsyncClient] [exchange: 1] connection request failed<br>2022.05.09 07:49:15 DEBUG app[][o.e.c.RestClient] request [GET http://127.0.0.1:9001/] failed<br>java.net.ConnectException: Connection refused<br>        at java.base/sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)<br>        at java.base/sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:779)<br>        at org.apache.http.impl.nio.reactor.DefaultConnectingIOReactor.processEvent(DefaultConnectingIOReactor.java:174)<br>        at org.apache.http.impl.nio.reactor.DefaultConnectingIOReactor.processEvents(DefaultConnectingIOReactor.java:148)<br>        at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor.execute(AbstractMultiworkerIOReactor.java:351)<br>        at org.apache.http.impl.nio.conn.PoolingNHttpClientConnectionManager.execute(PoolingNHttpClientConnectionManager.java:221)<br>        at org.apache.http.impl.nio.client.CloseableHttpAsyncClientBase<span class="hljs-variable">$1</span>.run(CloseableHttpAsyncClientBase.java:64)<br>        at java.base/java.lang.Thread.run(Thread.java:834)<br>2022.05.09 07:49:15 DEBUG app[][o.e.c.RestClient] added [[host=http://127.0.0.1:9001]] to blacklist<br>2022.05.09 07:49:16 DEBUG app[][o.a.h.i.n.c.MainClientExec] [exchange: 2] start execution<br>2022.05.09 07:49:16 DEBUG app[][o.a.h.c.p.RequestAddCookies] CookieSpec selected: default<br>2022.05.09 07:49:16 DEBUG app[][o.a.h.c.p.RequestAuthCache] Re-using cached <span class="hljs-string">&#x27;basic&#x27;</span> auth scheme <span class="hljs-keyword">for</span> http://127.0.0.1:9001<br>2022.05.09 07:49:16 DEBUG app[][o.a.h.c.p.RequestAuthCache] No credentials <span class="hljs-keyword">for</span> preemptive authentication<br>2022.05.09 07:49:16 DEBUG app[][o.a.h.i.n.c.InternalHttpAsyncClient] [exchange: 2] Request connection <span class="hljs-keyword">for</span> &#123;&#125;-&gt;http://127.0.0.1:9001<br>2022.05.09 07:49:16 DEBUG app[][o.a.h.i.n.c.PoolingNHttpClientConnectionManager] Connection request: [route: &#123;&#125;-&gt;http://127.0.0.1:9001][total kept alive: 0; route allocated: 0 of 10; total allocated: 0 of 30]<br>2022.05.09 07:49:16 DEBUG app[][o.a.h.i.n.c.PoolingNHttpClientConnectionManager] Connection request failed<br>java.net.ConnectException: Connection refused<br>        at java.base/sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)<br>        at java.base/sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:779)<br>        at org.apache.http.impl.nio.reactor.DefaultConnectingIOReactor.processEvent(DefaultConnectingIOReactor.java:174)<br>        at org.apache.http.impl.nio.reactor.DefaultConnectingIOReactor.processEvents(DefaultConnectingIOReactor.java:148)<br>        at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor.execute(AbstractMultiworkerIOReactor.java:351)<br>        at org.apache.http.impl.nio.conn.PoolingNHttpClientConnectionManager.execute(PoolingNHttpClientConnectionManager.java:221)<br>        at org.apache.http.impl.nio.client.CloseableHttpAsyncClientBase<span class="hljs-variable">$1</span>.run(CloseableHttpAsyncClientBase.java:64)<br>        at java.base/java.lang.Thread.run(Thread.java:834)<br>2022.05.09 07:49:16 DEBUG app[][o.a.h.i.n.c.InternalHttpAsyncClient] [exchange: 2] connection request failed<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hzcm1984/article/details/123332017">https://blog.csdn.net/hzcm1984/article/details/123332017</a></p>
<h3 id="5-2-5-配置日志存放位置"><a href="#5-2-5-配置日志存放位置" class="headerlink" title="5.2.5 配置日志存放位置"></a>5.2.5 配置日志存放位置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@81-71-35-205 sonarqube]<span class="hljs-comment"># mkdir -p /mnt/datadisk0/data/sonarqube/logs</span><br>[root@81-71-35-205 sonarqube]<span class="hljs-comment"># chown -R sonarqube.sonarqube /mnt/datadisk0/data/sonarqube/</span><br><br><span class="hljs-comment">#修改配置文件</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br><span class="hljs-comment">#sonar.path.logs=logs</span><br>sonar.path.logs=/mnt/datadisk0/data/sonarqube/logs<br></code></pre></td></tr></table></figure>

<h3 id="5-2-6-配置使用的-Java-版本"><a href="#5-2-6-配置使用的-Java-版本" class="headerlink" title="5.2.6 配置使用的 Java 版本"></a>5.2.6 配置使用的 Java 版本</h3><p>如果服务器上安装了多个 Java 版本，您可能需要明确定义使用的 Java 版本。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[sonarqube@centos7 conf]$ vim wrapper.conf<br><span class="hljs-comment">#wrapper.java.command=java</span><br>wrapper.java.command=/usr/<span class="hljs-built_in">local</span>/jdk11/bin/java <span class="hljs-comment">#路径为对应版本的Java路径</span><br></code></pre></td></tr></table></figure>

<h3 id="5-2-7-配置-systemd-文件"><a href="#5-2-7-配置-systemd-文件" class="headerlink" title="5.2.7 配置 systemd 文件"></a>5.2.7 配置 systemd 文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">vim</span> <span class="hljs-string">/usr/lib/systemd/system/sonarqube.service</span><br>[<span class="hljs-string">Unit</span>]<br><span class="hljs-string">Description=SonarQube</span> <span class="hljs-string">service</span><br><span class="hljs-string">After=syslog.target</span> <span class="hljs-string">network.target</span><br><br>[<span class="hljs-string">Service</span>]<br><span class="hljs-string">Type=simple</span><br><span class="hljs-string">User=sonarqube</span><br><span class="hljs-string">Group=sonarqube</span><br><span class="hljs-string">PermissionsStartOnly=true</span><br><span class="hljs-comment">#注意nohup，java 和sonar.jar的路径。最大内存和最小内存根据需要修改</span><br><span class="hljs-string">ExecStart=/bin/nohup</span> <span class="hljs-string">/usr/local/jdk/bin/java</span> <span class="hljs-string">-Xms32m</span> <span class="hljs-string">-Xmx32m</span> <span class="hljs-string">-Djava.net.preferIPv4Stack=true</span> <span class="hljs-string">-jar</span> <span class="hljs-string">/usr/local/sonarqube/lib/sonar-application-8.9.7.52159.jar</span><br><span class="hljs-string">StandardOutput=syslog</span><br><span class="hljs-string">LimitNOFILE=131072</span><br><span class="hljs-string">LimitNPROC=8192</span><br><span class="hljs-string">TimeoutStartSec=5</span><br><span class="hljs-string">Restart=always</span><br><span class="hljs-string">SuccessExitStatus=143</span><br><br>[<span class="hljs-string">Install</span>]<br><span class="hljs-string">WantedBy=multi-user.target</span><br><br><span class="hljs-string">systemctl</span> <span class="hljs-string">daemon-reload</span><br><span class="hljs-string">systemctl</span> <span class="hljs-string">enable</span> <span class="hljs-string">sonarqube</span><br><span class="hljs-string">systemctl</span> <span class="hljs-string">start</span> <span class="hljs-string">sonarqube</span><br></code></pre></td></tr></table></figure>



<h1 id="六、安装部署-SonarQube-Server-7-9-6"><a href="#六、安装部署-SonarQube-Server-7-9-6" class="headerlink" title="六、安装部署 SonarQube Server 7.9.6"></a>六、安装部署 SonarQube Server 7.9.6</h1><h2 id="6-1-安装-SonarQube-Server"><a href="#6-1-安装-SonarQube-Server" class="headerlink" title="6.1 安装 SonarQube Server"></a>6.1 安装 SonarQube Server</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#创建用户</span><br>useradd -r -m -c <span class="hljs-string">&quot;scan code&quot;</span> -s /bin/bash sonarqube<br><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/src<br><br><span class="hljs-comment">#下载SonarQube 6.7.7</span><br>wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-7.9.6.zip<br><br><span class="hljs-comment">#安装SonarQube</span><br>unzip -q sonarqube-7.9.6.zip -d /usr/<span class="hljs-built_in">local</span>/<br>ln -sv /usr/<span class="hljs-built_in">local</span>/sonarqube-7.9.6 /usr/<span class="hljs-built_in">local</span>/sonarqube<br>chown -R sonarqube.sonarqube /usr/<span class="hljs-built_in">local</span>/sonarqube-7.9.6 /usr/<span class="hljs-built_in">local</span>/sonarqube<br></code></pre></td></tr></table></figure>

<h2 id="6-2-修改-SonarQube-Server-配置"><a href="#6-2-修改-SonarQube-Server-配置" class="headerlink" title="6.2 修改 SonarQube Server 配置"></a>6.2 修改 SonarQube Server 配置</h2><p><strong>进入配置文件所在的目录</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos7 <span class="hljs-built_in">local</span>]<span class="hljs-comment"># su - sonarqube</span><br>[sonarqube@centos7 ~]$ <span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/sonarqube/conf<br></code></pre></td></tr></table></figure>

<h3 id="6-2-1-设置对数据库的访问"><a href="#6-2-1-设置对数据库的访问" class="headerlink" title="6.2.1 设置对数据库的访问"></a>6.2.1 设置对数据库的访问</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[sonarqube@centos7 conf]$ vim sonar.properties<br><span class="hljs-comment">#找到这几行，取消注释并修改</span><br>sonar.jdbc.username=sonar<br>sonar.jdbc.password=123456<br>sonar.jdbc.url=jdbc:postgresql://10.0.0.101/sonar <span class="hljs-comment">#输入本机IP</span><br></code></pre></td></tr></table></figure>

<h3 id="6-2-2-配置-Elasticsearch-存储路径"><a href="#6-2-2-配置-Elasticsearch-存储路径" class="headerlink" title="6.2.2 配置 Elasticsearch 存储路径"></a>6.2.2 配置 Elasticsearch 存储路径</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos7 ~]<span class="hljs-comment"># mkdir -p /mnt/datadisk0/data/sonarqube/elastic/&#123;data,tmp&#125;</span><br>[root@centos7 ~]<span class="hljs-comment"># chown -R sonarqube.sonarqube /mnt/datadisk0/data/sonarqube</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br><span class="hljs-comment">#找到这几行，取消注释并修改</span><br>sonar.path.data=/mnt/datadisk0/data/sonarqube/elastic/data<br>sonar.path.temp=/mnt/datadisk0/data/sonarqube/elastic/tmp<br></code></pre></td></tr></table></figure>

<h3 id="6-2-3-配置启动的-web-服务器"><a href="#6-2-3-配置启动的-web-服务器" class="headerlink" title="6.2.3 配置启动的 web 服务器"></a>6.2.3 配置启动的 web 服务器</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[sonarqube@centos7 conf]$ vim sonar.properties<br>sonar.web.host=0.0.0.0<br>sonar.web.port=9000<br>sonar.web.context=/sonarqube<br></code></pre></td></tr></table></figure>

<h3 id="6-2-4-配置日志级别"><a href="#6-2-4-配置日志级别" class="headerlink" title="6.2.4 配置日志级别"></a>6.2.4 配置日志级别</h3><p>sonaqube级别有五种</p>
<ul>
<li>ERROR</li>
<li>WARN</li>
<li>INFO</li>
<li>DEBUG</li>
<li>TRACE</li>
</ul>
<p>sonarqube有五种日志</p>
<ul>
<li>global：统一设置一下四种设备的日志级别</li>
<li>app：app日志（main日志）</li>
<li>web：web server日志</li>
<li>ce：compute engine日志</li>
<li>es：elasticsearch日志</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#设置global日志</span><br><span class="hljs-comment">#不推荐：因为app日志必须设定为 INFO 级别的日志，不然会报错</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br>sonar.log.level=INFO<br><br><span class="hljs-comment">#分别设置日志</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br></code></pre></td></tr></table></figure>

<h3 id="6-2-5-配置日志存放位置"><a href="#6-2-5-配置日志存放位置" class="headerlink" title="6.2.5 配置日志存放位置"></a>6.2.5 配置日志存放位置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@81-71-35-205 sonarqube]<span class="hljs-comment"># mkdir -p /mnt/datadisk0/data/sonarqube/logs</span><br>[root@81-71-35-205 sonarqube]<span class="hljs-comment"># chown -R sonarqube.sonarqube /mnt/datadisk0/data/sonarqube/</span><br><br><span class="hljs-comment">#修改配置文件</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br><span class="hljs-comment">#sonar.path.logs=logs</span><br>sonar.path.logs=/mnt/datadisk0/data/sonarqube/logs<br></code></pre></td></tr></table></figure>

<h3 id="6-2-6-配置使用的-Java-版本"><a href="#6-2-6-配置使用的-Java-版本" class="headerlink" title="6.2.6 配置使用的 Java 版本"></a>6.2.6 配置使用的 Java 版本</h3><p>如果服务器上安装了多个 Java 版本，您可能需要明确定义使用的 Java 版本。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[sonarqube@centos7 conf]$ vim wrapper.conf<br><span class="hljs-comment">#wrapper.java.command=java</span><br>wrapper.java.command=/usr/<span class="hljs-built_in">local</span>/jdk11/bin/java <span class="hljs-comment">#路径为对应版本的Java路径</span><br></code></pre></td></tr></table></figure>

<h3 id="6-2-7-配置-systemd-文件"><a href="#6-2-7-配置-systemd-文件" class="headerlink" title="6.2.7 配置 systemd 文件"></a>6.2.7 配置 systemd 文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">vim</span> <span class="hljs-string">/usr/lib/systemd/system/sonarqube.service</span><br>[<span class="hljs-string">Unit</span>]<br><span class="hljs-string">Description=SonarQube</span> <span class="hljs-string">service</span><br><span class="hljs-string">After=syslog.target</span> <span class="hljs-string">network.target</span><br><br>[<span class="hljs-string">Service</span>]<br><span class="hljs-string">Type=simple</span><br><span class="hljs-string">User=sonarqube</span><br><span class="hljs-string">Group=sonarqube</span><br><span class="hljs-string">PermissionsStartOnly=true</span><br><span class="hljs-comment">#注意nohup，java 和sonar.jar的路径。最大内存和最小内存根据需要修改</span><br><span class="hljs-string">ExecStart=/bin/nohup</span> <span class="hljs-string">/usr/bin/java</span> <span class="hljs-string">-Xms2048m</span> <span class="hljs-string">-Xmx2048m</span> <span class="hljs-string">-Djava.net.preferIPv4Stack=true</span> <span class="hljs-string">-jar</span> <span class="hljs-string">/usr/local/sonarqube/lib/sonar-application-7.9.6.jar</span><br><span class="hljs-string">StandardOutput=syslog</span><br><span class="hljs-string">LimitNOFILE=131072</span><br><span class="hljs-string">LimitNPROC=8192</span><br><span class="hljs-string">TimeoutStartSec=5</span><br><span class="hljs-string">Restart=always</span><br><span class="hljs-string">SuccessExitStatus=143</span><br><br>[<span class="hljs-string">Install</span>]<br><span class="hljs-string">WantedBy=multi-user.target</span><br><br><span class="hljs-string">systemctl</span> <span class="hljs-string">daemon-reload</span><br><span class="hljs-string">systemctl</span> <span class="hljs-string">enable</span> <span class="hljs-string">sonarqube</span><br><span class="hljs-string">systemctl</span> <span class="hljs-string">start</span> <span class="hljs-string">sonarqube</span><br></code></pre></td></tr></table></figure>



<h1 id="七、安装部署-SonarQube-Server-6-7-7"><a href="#七、安装部署-SonarQube-Server-6-7-7" class="headerlink" title="七、安装部署 SonarQube Server 6.7.7"></a>七、安装部署 SonarQube Server 6.7.7</h1><h2 id="7-1-安装-SonarQube-Server"><a href="#7-1-安装-SonarQube-Server" class="headerlink" title="7.1 安装 SonarQube Server"></a>7.1 安装 SonarQube Server</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#创建用户</span><br>useradd -r -m -c <span class="hljs-string">&quot;scan code&quot;</span> -s /bin/bash sonarqube<br><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/src<br><br><span class="hljs-comment">#下载SonarQube 6.7.7</span><br>wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-6.7.7.zip<br><br><span class="hljs-comment">#安装SonarQube</span><br>unzip -q sonarqube-6.7.7.zip -d /usr/<span class="hljs-built_in">local</span>/<br>ln -sv /usr/<span class="hljs-built_in">local</span>/sonarqube-6.7.7 /usr/<span class="hljs-built_in">local</span>/sonarqube<br>chown -R sonarqube.sonarqube /usr/<span class="hljs-built_in">local</span>/sonarqube /usr/<span class="hljs-built_in">local</span>/sonarqube-6.7.7/<br></code></pre></td></tr></table></figure>

<h2 id="7-2-修改-SonarQube-Server-配置"><a href="#7-2-修改-SonarQube-Server-配置" class="headerlink" title="7.2 修改 SonarQube Server 配置"></a>7.2 修改 SonarQube Server 配置</h2><p><strong>进入配置文件所在的目录</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos7 <span class="hljs-built_in">local</span>]<span class="hljs-comment"># su - sonarqube</span><br>[sonarqube@centos7 ~]$ <span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/sonarqube/conf<br></code></pre></td></tr></table></figure>

<h3 id="7-2-1-设置对数据库的访问"><a href="#7-2-1-设置对数据库的访问" class="headerlink" title="7.2.1 设置对数据库的访问"></a>7.2.1 设置对数据库的访问</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[sonarqube@centos7 conf]$ vim sonar.properties<br><span class="hljs-comment">#找到这几行，取消注释并修改</span><br>sonar.jdbc.username=sonar<br>sonar.jdbc.password=123456<br>sonar.jdbc.url=jdbc:mysql://127.0.0.1:3306/sonar?useUnicode=<span class="hljs-literal">true</span>&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=<span class="hljs-literal">true</span>&amp;useConfigs=maxPerformance&amp;useSSL=<span class="hljs-literal">false</span> <span class="hljs-comment">#输入本机IP</span><br></code></pre></td></tr></table></figure>

<h3 id="7-2-2-配置-Elasticsearch-存储路径"><a href="#7-2-2-配置-Elasticsearch-存储路径" class="headerlink" title="7.2.2 配置 Elasticsearch 存储路径"></a>7.2.2 配置 Elasticsearch 存储路径</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos7 ~]<span class="hljs-comment"># mkdir -p /mnt/datadisk0/data/sonarqube/elastic/&#123;data,tmp&#125;</span><br>[root@centos7 ~]<span class="hljs-comment"># chown -R sonarqube.sonarqube /mnt/datadisk0/data/sonarqube</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br><span class="hljs-comment">#找到这几行，取消注释并修改</span><br>sonar.path.data=/mnt/datadisk0/data/sonarqube/elastic/data<br>sonar.path.temp=/mnt/datadisk0/data/sonarqube/elastic/tmp<br></code></pre></td></tr></table></figure>

<h3 id="7-2-3-配置启动的-web-服务器"><a href="#7-2-3-配置启动的-web-服务器" class="headerlink" title="7.2.3 配置启动的 web 服务器"></a>7.2.3 配置启动的 web 服务器</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[sonarqube@centos7 conf]$ vim sonar.properties<br>sonar.web.host=0.0.0.0<br>sonar.web.port=9000<br>sonar.web.context=/sonarqube<br></code></pre></td></tr></table></figure>

<h3 id="7-2-4-配置日志级别"><a href="#7-2-4-配置日志级别" class="headerlink" title="7.2.4 配置日志级别"></a>7.2.4 配置日志级别</h3><p>sonaqube级别有五种</p>
<ul>
<li>ERROR</li>
<li>WARN</li>
<li>INFO</li>
<li>DEBUG</li>
<li>TRACE</li>
</ul>
<p>sonarqube有五种日志</p>
<ul>
<li>global：统一设置一下四种设备的日志级别</li>
<li>app：app日志（main日志）</li>
<li>web：web server日志</li>
<li>ce：compute engine日志</li>
<li>es：elasticsearch日志</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#设置global日志</span><br><span class="hljs-comment">#不推荐：因为app日志必须设定为 INFO 级别的日志，不然会报错</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br>sonar.log.level=INFO<br><br><span class="hljs-comment">#分别设置日志</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br></code></pre></td></tr></table></figure>

<h3 id="7-2-5-配置日志存放位置"><a href="#7-2-5-配置日志存放位置" class="headerlink" title="7.2.5 配置日志存放位置"></a>7.2.5 配置日志存放位置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@81-71-35-205 sonarqube]<span class="hljs-comment"># mkdir -p /mnt/datadisk0/data/sonarqube/logs</span><br>[root@81-71-35-205 sonarqube]<span class="hljs-comment"># chown -R sonarqube.sonarqube /mnt/datadisk0/data/sonarqube/</span><br><br><span class="hljs-comment">#修改配置文件</span><br>[sonarqube@centos7 conf]$ vim sonar.properties<br><span class="hljs-comment">#sonar.path.logs=logs</span><br>sonar.path.logs=/mnt/datadisk0/data/sonarqube/logs<br></code></pre></td></tr></table></figure>

<h3 id="7-2-6-配置使用的-Java-版本"><a href="#7-2-6-配置使用的-Java-版本" class="headerlink" title="7.2.6 配置使用的 Java 版本"></a>7.2.6 配置使用的 Java 版本</h3><p>如果服务器上安装了多个 Java 版本，您可能需要明确定义使用的 Java 版本。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[sonarqube@centos7 conf]$ vim wrapper.conf<br><span class="hljs-comment">#wrapper.java.command=java</span><br>wrapper.java.command=/usr/<span class="hljs-built_in">local</span>/jdk11/bin/java <span class="hljs-comment">#路径为对应版本的Java路径</span><br></code></pre></td></tr></table></figure>

<h3 id="7-2-7-配置-systemd-文件"><a href="#7-2-7-配置-systemd-文件" class="headerlink" title="7.2.7 配置 systemd 文件"></a>7.2.7 配置 systemd 文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">vim</span> <span class="hljs-string">/usr/lib/systemd/system/sonarqube.service</span><br>[<span class="hljs-string">Unit</span>]<br><span class="hljs-string">Description=SonarQube</span> <span class="hljs-string">service</span><br><span class="hljs-string">After=syslog.target</span> <span class="hljs-string">network.target</span><br><br>[<span class="hljs-string">Service</span>]<br><span class="hljs-string">Type=simple</span><br><span class="hljs-string">User=sonarqube</span><br><span class="hljs-string">Group=sonarqube</span><br><span class="hljs-string">PermissionsStartOnly=true</span><br><span class="hljs-comment">#注意nohup，java 和sonar.jar的路径。最大内存和最小内存根据需要修改</span><br><span class="hljs-string">ExecStart=/bin/nohup</span> <span class="hljs-string">/usr/bin/java</span> <span class="hljs-string">-Xms2048m</span> <span class="hljs-string">-Xmx2048m</span> <span class="hljs-string">-Djava.net.preferIPv4Stack=true</span> <span class="hljs-string">-jar</span> <span class="hljs-string">/usr/local/sonarqube/lib/sonar-application-6.7.7.jar</span><br><span class="hljs-string">StandardOutput=syslog</span><br><span class="hljs-string">LimitNOFILE=131072</span><br><span class="hljs-string">LimitNPROC=8192</span><br><span class="hljs-string">TimeoutStartSec=5</span><br><span class="hljs-string">Restart=always</span><br><span class="hljs-string">SuccessExitStatus=143</span><br><br>[<span class="hljs-string">Install</span>]<br><span class="hljs-string">WantedBy=multi-user.target</span><br><br><span class="hljs-string">systemctl</span> <span class="hljs-string">daemon-reload</span><br><span class="hljs-string">systemctl</span> <span class="hljs-string">enable</span> <span class="hljs-string">sonarqube</span><br><span class="hljs-string">systemctl</span> <span class="hljs-string">start</span> <span class="hljs-string">sonarqube</span><br></code></pre></td></tr></table></figure>

<h1 id="八、-docker-部署-SonarQube-Server"><a href="#八、-docker-部署-SonarQube-Server" class="headerlink" title="八、 docker 部署 SonarQube Server"></a>八、 docker 部署 SonarQube Server</h1><p>略</p>
<h1 id="九、-kubernetes-部署-SonarQube-Server"><a href="#九、-kubernetes-部署-SonarQube-Server" class="headerlink" title="九、 kubernetes 部署 SonarQube Server"></a>九、 kubernetes 部署 SonarQube Server</h1><p>略</p>
<h1 id="十、启动-SonarQube-Server"><a href="#十、启动-SonarQube-Server" class="headerlink" title="十、启动 SonarQube Server"></a>十、启动 SonarQube Server</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#没有配置 sonarqbue.service 文件</span><br>su - sonarqube<br>bash /usr/<span class="hljs-built_in">local</span>/sonarqube/bin/linux-x86-64/sonar.sh start<br><br><span class="hljs-comment">#有配置 sonarqube.service 文件</span><br>systemctl start sonarqube<br></code></pre></td></tr></table></figure>

<h1 id="十一、登陆-SonarQube-Server"><a href="#十一、登陆-SonarQube-Server" class="headerlink" title="十一、登陆 SonarQube Server"></a>十一、登陆 SonarQube Server</h1><p>没有修改 sonarqube 的 web 配置请访问：ip:9000</p>
<p>账号：admin</p>
<p>密码：admin</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube3.png" srcset="/blog/img/loading.gif"></p>
<p><strong>第一次登陆会提示修改密码</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube4.png" srcset="/blog/img/loading.gif" alt="4"></p>
<h1 id="十二、安装插件"><a href="#十二、安装插件" class="headerlink" title="十二、安装插件"></a>十二、安装插件</h1><p><strong>安装 sonarqbue 的插件都在网页或者离线安装</strong></p>
<h2 id="12-1-安装中文插件"><a href="#12-1-安装中文插件" class="headerlink" title="12.1 安装中文插件"></a>12.1 安装中文插件</h2><h3 id="12-1-1-在网页安装中文插件"><a href="#12-1-1-在网页安装中文插件" class="headerlink" title="12.1.1 在网页安装中文插件"></a>12.1.1 在网页安装中文插件</h3><p>点击“Administration”-&gt;点击“Marketplace”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube5.png" srcset="/blog/img/loading.gif" alt="5"></p>
<p><strong>注意：在进入Marketplace页面后，会有一个叫”Inkstallation of plugins“的提示，必须点击”I understrand the risk“。不然不能安装插件</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube6.png" srcset="/blog/img/loading.gif" alt="6"></p>
<p>在搜索框输入“chinese”-&gt;点击“Install”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube7.png" srcset="/blog/img/loading.gif" alt="7"></p>
<p>安装完成后会提示重启服务，插件那一行的安装按钮会变成“Install Pending”</p>
<p>点击“Restart Server”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube8.png" srcset="/blog/img/loading.gif" alt="8"></p>
<p>点击“Restart”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube9.png" srcset="/blog/img/loading.gif" alt="9"></p>
<p><strong>效果展示</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube10.png" srcset="/blog/img/loading.gif" alt="10"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube11.png" srcset="/blog/img/loading.gif" alt="11"></p>
<p><font color=red><strong>注意：会有安装失败的情况。安装失败就使用下面的离线安装。</strong></font></p>
<h3 id="12-1-2-离线安装插件"><a href="#12-1-2-离线安装插件" class="headerlink" title="12.1.2 离线安装插件"></a>12.1.2 离线安装插件</h3><p>点击“Administration”-&gt;点击“Marketplace”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube12.png" srcset="/blog/img/loading.gif" alt="12"></p>
<p>在搜索框输入“chinese”，点击红色框主的那个按钮会进入插件的 GitHub 页面</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube13.png" srcset="/blog/img/loading.gif" alt="13"></p>
<p>在右边的 Releases 里点击蓝色字的”+ 35 releases“（不知道以后会显示多少 releases，但是往这里点就行了）</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube14.png" srcset="/blog/img/loading.gif" alt="14"></p>
<p>往下拉，找到对应版本的插件-&gt;点击”Assets“-&gt;下载jar包到”sonarqubehome/extensions/plugins 文件夹里“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube15.png" srcset="/blog/img/loading.gif" alt="15"></p>
<p>重启 sonarqube，留意日志输出是否启动成功，最后登陆 web 网页即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart sonarqube<br></code></pre></td></tr></table></figure>

<h2 id="12-2-安装开发语言插件"><a href="#12-2-安装开发语言插件" class="headerlink" title="12.2 安装开发语言插件"></a>12.2 安装开发语言插件</h2><p><strong>这里以 shell 为例</strong></p>
<p>搜索框内输入”shell“-&gt;在下方的”ShellCheck Analyzer“的插件里点击”安装“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube16.png" srcset="/blog/img/loading.gif" alt="16"></p>
<p>安装完成后同样也需要重启服务</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube17.png" srcset="/blog/img/loading.gif" alt="17"></p>
<h1 id="十三、配置权限"><a href="#十三、配置权限" class="headerlink" title="十三、配置权限"></a>十三、配置权限</h1><h2 id="13-1-用户"><a href="#13-1-用户" class="headerlink" title="13.1 用户"></a>13.1 用户</h2><h3 id="13-1-1-创建用户"><a href="#13-1-1-创建用户" class="headerlink" title="13.1.1 创建用户"></a>13.1.1 创建用户</h3><p>点击”配置“-&gt;点击”权限“-&gt;点击”用户“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube18.png" srcset="/blog/img/loading.gif" alt="18"></p>
<p>点击”创建用户“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube19.png" srcset="/blog/img/loading.gif" alt="19"></p>
<p>输入标记星号的字段-&gt;点击”创建“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube20.png" srcset="/blog/img/loading.gif" alt="20"></p>
<p><strong>登陆用户</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube21.png" srcset="/blog/img/loading.gif" alt="21"></p>
<h3 id="13-1-2-普通用户自己创建令牌"><a href="#13-1-2-普通用户自己创建令牌" class="headerlink" title="13.1.2 普通用户自己创建令牌"></a>13.1.2 普通用户自己创建令牌</h3><p>登陆普通用户后</p>
<p>点击右上方的头像-&gt;点击”我的账号“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube22.png" srcset="/blog/img/loading.gif" alt="22"></p>
<p>点击”安全“-&gt;输入令牌名称-&gt;点击”生成“</p>
<p><strong>生成的令牌可以给 sonarqube server 传输数据</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube23.png" srcset="/blog/img/loading.gif" alt="23"></p>
<h3 id="13-1-3-使用admin账号给普通用户创建令牌"><a href="#13-1-3-使用admin账号给普通用户创建令牌" class="headerlink" title="13.1.3 使用admin账号给普通用户创建令牌"></a>13.1.3 使用admin账号给普通用户创建令牌</h3><h1 id="十四、安装部署-SonarScaner"><a href="#十四、安装部署-SonarScaner" class="headerlink" title="十四、安装部署 SonarScaner"></a>十四、安装部署 SonarScaner</h1><p>sonarqube 通过调用扫描器 sonar-scanner 进行代码质量分析，即扫描器的具体工作就是扫描代码。</p>
<h2 id="14-1-Linux-部署-SonarScanner"><a href="#14-1-Linux-部署-SonarScanner" class="headerlink" title="14.1 Linux 部署 SonarScanner"></a>14.1 Linux 部署 SonarScanner</h2><h3 id="14-1-1-安装-SonarScanner"><a href="#14-1-1-安装-SonarScanner" class="headerlink" title="14.1.1 安装 SonarScanner"></a>14.1.1 安装 SonarScanner</h3><p>sonarscaner下载地址：<a target="_blank" rel="noopener" href="https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.7.0.2747-linux.zip">https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.7.0.2747-linux.zip</a></p>
<p>建议可以到sonarqube的官方文档获取下载地址</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/src<br><span class="hljs-comment">#手动下载 sonarscaner（真的下不到）并解压</span><br>unzip -q sonar-scanner-cli-4.7.0.2747-linux.zip -d /usr/<span class="hljs-built_in">local</span>/<br><br><span class="hljs-comment">#创建软连接</span><br>ln -s /usr/<span class="hljs-built_in">local</span>/sonar-scanner-4.7.0.2747-linux /usr/<span class="hljs-built_in">local</span>/sonar-scanner<br></code></pre></td></tr></table></figure>

<h3 id="14-1-2-修改-SonarScanner-配置文件"><a href="#14-1-2-修改-SonarScanner-配置文件" class="headerlink" title="14.1.2 修改 SonarScanner 配置文件"></a>14.1.2 修改 SonarScanner 配置文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /usr/<span class="hljs-built_in">local</span>/sonar-scanner/conf/sonar-scanner.properties<br><span class="hljs-comment">#添加以下两行</span><br>sonar.host.url=http://10.0.0.101:9000<br></code></pre></td></tr></table></figure>

<h3 id="14-1-3-设置环境变量"><a href="#14-1-3-设置环境变量" class="headerlink" title="14.1.3 设置环境变量"></a>14.1.3 设置环境变量</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;export PATH=$PATH:/usr/local/sonar-scanner/bin&#x27;</span> &gt;&gt; /etc/profile.d/sonarscaner.sh<br></code></pre></td></tr></table></figure>



<h1 id="十五、扫描代码"><a href="#十五、扫描代码" class="headerlink" title="十五、扫描代码"></a>十五、扫描代码</h1><p><strong>这里扫描的都是官方提供的代码</strong></p>
<p>扫描代码的方法有两种：</p>
<ol>
<li>命令扫描</li>
<li>配置文件扫描</li>
</ol>
<h2 id="15-1-准备扫描代码"><a href="#15-1-准备扫描代码" class="headerlink" title="15.1 准备扫描代码"></a>15.1 准备扫描代码</h2><p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/SonarSource/sonar-scanning-examples/archive/master.zip">https://github.com/SonarSource/sonar-scanning-examples/archive/master.zip</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">mkdir <span class="hljs-built_in">test</span><br><span class="hljs-built_in">cd</span> <span class="hljs-built_in">test</span><br><span class="hljs-comment">#手动下载测试用代码并解压</span><br>unzip -q sonar-scanning-examples-master.zip并解压<br><span class="hljs-built_in">cd</span> sonar-scanning-examples-master/sonarqube-scanner/src<br></code></pre></td></tr></table></figure>

<h2 id="15-2-命令扫描"><a href="#15-2-命令扫描" class="headerlink" title="15.2 命令扫描"></a>15.2 命令扫描</h2><h3 id="15-2-1-创建项目"><a href="#15-2-1-创建项目" class="headerlink" title="15.2.1 创建项目"></a>15.2.1 创建项目</h3><p>进入 sonarqube 主页，点击创建项目</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube24.png" srcset="/blog/img/loading.gif" alt="24"></p>
<p>点击”手工“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube25.png" srcset="/blog/img/loading.gif" alt="25"></p>
<p>输入”项目表示“和”显示名“-&gt;点击”设置“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube26.png" srcset="/blog/img/loading.gif" alt="26"></p>
<p>输入令牌-&gt;点击”创建“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube27.png" srcset="/blog/img/loading.gif" alt="27"></p>
<p>点击”继续“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube28.png" srcset="/blog/img/loading.gif" alt="28"></p>
<p>点击”其他“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube29.png" srcset="/blog/img/loading.gif" alt="29"></p>
<p>点击”Linux“-&gt;复制下面的命令到php项目的根目录中执行</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube30.png" srcset="/blog/img/loading.gif" alt="30"></p>
<h3 id="15-2-2-扫描代码"><a href="#15-2-2-扫描代码" class="headerlink" title="15.2.2 扫描代码"></a>15.2.2 扫描代码</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">sonar-scanner \<br>-Dsonar.projectKey=php-test \<br>-Dsonar.sources=. \<br>-Dsonar.host.url=http://10.0.0.101:9000 \<br>-Dsonar.login=86b43341cbcef86c757a0f6c56edea4e08104344<br></code></pre></td></tr></table></figure>

<h3 id="15-2-3-扫描结果"><a href="#15-2-3-扫描结果" class="headerlink" title="15.2.3 扫描结果"></a>15.2.3 扫描结果</h3><p><strong>Linux的结果</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube31.png" srcset="/blog/img/loading.gif" alt="31"></p>
<p><strong>web的结果</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube32.png" srcset="/blog/img/loading.gif" alt="32"></p>
<h2 id="15-3-配置文件扫描"><a href="#15-3-配置文件扫描" class="headerlink" title="15.3 配置文件扫描"></a>15.3 配置文件扫描</h2><h3 id="15-3-1-创建令牌"><a href="#15-3-1-创建令牌" class="headerlink" title="15.3.1 创建令牌"></a>15.3.1 创建令牌</h3><p>点击web界面右上方的用户-&gt;点击”我的账号“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube33.png" srcset="/blog/img/loading.gif" alt="33"></p>
<p>点击”安全“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube34.png" srcset="/blog/img/loading.gif" alt="34"></p>
<p>输入令牌名称-&gt;点击”生成“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube35.png" srcset="/blog/img/loading.gif" alt="35"></p>
<p>点击”复制“，复制令牌</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube36.png" srcset="/blog/img/loading.gif" alt="36"></p>
<h3 id="15-3-2-添加-sonar-project-properties-文件"><a href="#15-3-2-添加-sonar-project-properties-文件" class="headerlink" title="15.3.2 添加 sonar-project.properties 文件"></a>15.3.2 添加 sonar-project.properties 文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#进入python项目</span><br><span class="hljs-built_in">cd</span> python<br><br><span class="hljs-comment">#添加 vim sonar-project.properties 文件</span><br>vim sonar-project.properties<br><span class="hljs-comment"># must be unique in a given SonarQube instance</span><br>sonar.projectKey=org.sonarqube:python-simple-sq-scanner<br><br><span class="hljs-comment"># --- optional properties ---</span><br><br><span class="hljs-comment"># defaults to project key</span><br>sonar.projectName=Python :: Simple Project :: SonarQube Scanner<br><span class="hljs-comment"># defaults to &#x27;not provided&#x27;</span><br>sonar.projectVersion=1.0<br><br><span class="hljs-comment"># Path is relative to the sonar-project.properties file. Defaults to .</span><br>sonar.sources=.<br><br><span class="hljs-comment"># Encoding of the source code. Default is default system encoding</span><br>sonar.sourceEncoding=UTF-8<br><br><span class="hljs-comment">#java项目就得加这个</span><br>sonar.java.binaries=.<br><br><span class="hljs-comment">#token</span><br>sonar.login=3e489bebffa0a95ad0c5cf3f1d892c1bc063dfb0<br></code></pre></td></tr></table></figure>

<h3 id="15-3-3-执行扫描命令"><a href="#15-3-3-执行扫描命令" class="headerlink" title="15.3.3 执行扫描命令"></a>15.3.3 执行扫描命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#配置文件没有添加token执行这行命令</span><br>sonar-scanner -Dsonar.login=myAuthenticationToken <br><span class="hljs-comment">#myAuthenticationToken为刚刚生成的令牌</span><br><br><span class="hljs-comment">#配置源文件有添加token执行这行命令</span><br>sonar-scanner<br></code></pre></td></tr></table></figure>

<h3 id="15-3-4-查看结果"><a href="#15-3-4-查看结果" class="headerlink" title="15.3.4 查看结果"></a>15.3.4 查看结果</h3><p><strong>Linux结果</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube37.png" srcset="/blog/img/loading.gif" alt="37"></p>
<p><strong>web界面结果</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube38.png" srcset="/blog/img/loading.gif" alt="38"></p>
<h1 id="十六、在-Jenkins-执行代码扫描"><a href="#十六、在-Jenkins-执行代码扫描" class="headerlink" title="十六、在 Jenkins 执行代码扫描"></a>十六、在 Jenkins 执行代码扫描</h1><h2 id="16-1-通过-Jenkins-插件实现代码扫描"><a href="#16-1-通过-Jenkins-插件实现代码扫描" class="headerlink" title="16.1 通过 Jenkins 插件实现代码扫描"></a>16.1 通过 Jenkins 插件实现代码扫描</h2><h3 id="16-1-1-Jenkins-安装-SonarScanner插件"><a href="#16-1-1-Jenkins-安装-SonarScanner插件" class="headerlink" title="16.1.1 Jenkins 安装 SonarScanner插件"></a>16.1.1 Jenkins 安装 SonarScanner插件</h3><p>搜索”sonar“-&gt;选择”SonarQube Scanner“-&gt;点击”直接安装“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube39.png" srcset="/blog/img/loading.gif" alt="39"></p>
<h3 id="16-1-2-在sonarqube创建令牌"><a href="#16-1-2-在sonarqube创建令牌" class="headerlink" title="16.1.2 在sonarqube创建令牌"></a>16.1.2 在sonarqube创建令牌</h3><p>登陆普通用户（这里为了代码扫描专门新建了一个用户）</p>
<p>查看给普通用户创建令牌那一节</p>
<h3 id="16-1-2-在-Jenkins-里添加-SonarQube-Server"><a href="#16-1-2-在-Jenkins-里添加-SonarQube-Server" class="headerlink" title="16.1.2 在 Jenkins 里添加 SonarQube Server"></a>16.1.2 在 Jenkins 里添加 SonarQube Server</h3><p>点击“系统管理”-&gt;点击“系统配置”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube40.png" srcset="/blog/img/loading.gif" alt="40"></p>
<p>找到“SonarQube servers”</p>
<p>点击“Add SonarQube”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube41.png" srcset="/blog/img/loading.gif" alt="41"></p>
<p>输入“Name”和“Server URL”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/devopts/devpots-150.png" srcset="/blog/img/loading.gif"></p>
<p>点击”添加“-&gt;点击”Jenkins“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube42.png" srcset="/blog/img/loading.gif" alt="42"></p>
<p><strong>类型</strong>选择”Secret text“-&gt;<strong>Scret</strong>输入”令牌“-&gt;点击”添加“-&gt;点击“保存”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube43.png" srcset="/blog/img/loading.gif" alt="43"></p>
<h3 id="16-1-3-在-Jenkins-里添加-Sonar-scanner-扫描器"><a href="#16-1-3-在-Jenkins-里添加-Sonar-scanner-扫描器" class="headerlink" title="16.1.3 在 Jenkins 里添加 Sonar scanner 扫描器"></a>16.1.3 在 Jenkins 里添加 Sonar scanner 扫描器</h3><p>点击“”系统管理“-&gt;点击”全局工具配置“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube45.png" srcset="/blog/img/loading.gif" alt="45"></p>
<p>找到”SonarQube Scanner”</p>
<p>点击“新增 SonarQube Scanner”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube46.png" srcset="/blog/img/loading.gif" alt="46"></p>
<p>输入“Name”</p>
<p><strong>注意：根据是否有安装 sonarqube scanner 来勾选“自动安装</strong></p>
<p><strong>没有安装 sonarqube scanner，在输入名称后点击保存</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube47.png" srcset="/blog/img/loading.gif" alt="47"></p>
<p><strong>有安装 sonarqube scanner，取消勾选”自动安装“-&gt;输入”sonarqube scanner的安装目录“-&gt;点击”保存“</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube48.png" srcset="/blog/img/loading.gif" alt="48"></p>
<h3 id="16-1-4-在项目中配置扫描"><a href="#16-1-4-在项目中配置扫描" class="headerlink" title="16.1.4 在项目中配置扫描"></a>16.1.4 在项目中配置扫描</h3><p>进入一个项目</p>
<p>在”Pre Steps“</p>
<p>点击”Add pre-build step“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube49.png" srcset="/blog/img/loading.gif" alt="49"></p>
<p>选择”Execute SonarQube Scanner“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube50.png" srcset="/blog/img/loading.gif" alt="50"></p>
<p>在官方文档里把<strong>sonar-project.properties</strong>的配置文件内容复制到<strong>Analysis properties</strong>里，然后进行修改。其他的内容可以根据情况填写</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube51.png" srcset="/blog/img/loading.gif" alt="51"></p>
<p><strong>Analysis properties 内容</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># must be unique in a given SonarQube instance</span><br><span class="hljs-attr">sonar.projectKey</span>=<span class="hljs-variable">$&#123;JOB_NAME&#125;</span><br><br><span class="hljs-comment"># --- optional properties ---</span><br><br><span class="hljs-comment"># defaults to project key</span><br><span class="hljs-comment">#sonar.projectName=My project</span><br><span class="hljs-comment"># defaults to &#x27;not provided&#x27;</span><br><span class="hljs-attr">sonar.projectVersion</span>=<span class="hljs-variable">$&#123;BUILD_VERSION&#125;</span><br> <br><span class="hljs-comment"># Path is relative to the sonar-project.properties file. Defaults to .</span><br><span class="hljs-comment">#sonar.sources=./</span><br> <br><span class="hljs-comment"># Encoding of the source code. Default is default system encoding</span><br><span class="hljs-comment">#sonar.sourceEncoding=UTF-8</span><br><br><span class="hljs-attr">sonar.language</span>=java<br><span class="hljs-attr">sonar.java.binaries</span>=./<br></code></pre></td></tr></table></figure>

<p><strong>Execute SonarQube Scanner 各项解析</strong></p>
<p>Task to run: 输入 scan，即分析代码；<br>JDK :选择 SonarQube Scanner 使用的 JDK（注意这里必须是 JDK 不能是 JRE）；<br>Path to project properties : 这里可以指定一个sonar-project.properties 文件，如果不指定的话会使用项目默认的 properties文件；<br>Analysis properties: 这里需要输入一些配置参数用来传递给 SonarQube，这里的参数优先级高于sonar-project.properties文件里面的参数，所以可以在这里来配置所有的参数以替代sonar-project.properties文件，下面列出了一些参数，sonar.language指定了要分析的开发语言（特定的开发语言对应了特定的规则），sonar.sources定义了需要分析的源代码位置（示例中的.所指示的是当前 Jenkins项目的目录），sonar.java.binaries 定义了需要分析代码的编译后文件位置；<br>Additional arguments 输入框中可以输入一些附加的参数，示例中的-X 意思是进入SonarQube Scanner的Debug 模式，这样会输出更多的日志信息；<br>JVM Options 可以输入在执行 SonarQube Scanner是需要的JVM参数。</p>
<h2 id="16-2-通过手工的方式进行代码扫描"><a href="#16-2-通过手工的方式进行代码扫描" class="headerlink" title="16.2 通过手工的方式进行代码扫描"></a>16.2 通过手工的方式进行代码扫描</h2><p>在项目的根目录里编写一个<strong>sonar-project.properties</strong>文件</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube52.png" srcset="/blog/img/loading.gif" alt="52"></p>
<p>进入Jenkins项目里-&gt;点击上方的”Pre Steps“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube53.png" srcset="/blog/img/loading.gif" alt="53"></p>
<p>点击”Add pre-build step“-&gt;点击”执行 shell“</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube54.png" srcset="/blog/img/loading.gif" alt="54"></p>
<p>输入执行扫描在命令-&gt;点击“保存”-&gt;点击“立即构建”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube55.png" srcset="/blog/img/loading.gif" alt="55"></p>
<h1 id="十七、扫描报错和处理合集"><a href="#十七、扫描报错和处理合集" class="headerlink" title="十七、扫描报错和处理合集"></a>十七、扫描报错和处理合集</h1><p>报错一：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs sh">ERROR: Error when running: <span class="hljs-string">&#x27;node -v&#x27;</span>. Is Node.js available during analysis?<br>org.sonarsource.nodejs.NodeCommandException: Error when running: <span class="hljs-string">&#x27;node -v&#x27;</span>. Is Node.js available during analysis?<br>	at org.sonarsource.nodejs.NodeCommand.start(NodeCommand.java:81)<br>	at org.sonarsource.nodejs.NodeCommandBuilderImpl.getVersion(NodeCommandBuilderImpl.java:181)<br>	at org.sonarsource.nodejs.NodeCommandBuilderImpl.checkNodeCompatibility(NodeCommandBuilderImpl.java:159)<br>	at org.sonarsource.nodejs.NodeCommandBuilderImpl.build(NodeCommandBuilderImpl.java:134)<br>	at org.sonar.plugins.javascript.eslint.EslintBridgeServerImpl.initNodeCommand(EslintBridgeServerImpl.java:174)<br>	at org.sonar.plugins.javascript.eslint.EslintBridgeServerImpl.startServer(EslintBridgeServerImpl.java:119)<br>	at org.sonar.plugins.javascript.eslint.EslintBridgeServerImpl.startServerLazily(EslintBridgeServerImpl.java:191)<br>	at org.sonar.plugins.javascript.eslint.AbstractEslintSensor.startBridge(AbstractEslintSensor.java:150)<br>	at org.sonar.plugins.javascript.eslint.AbstractEslintSensor.execute(AbstractEslintSensor.java:124)<br>	at org.sonar.plugins.javascript.eslint.JavaScriptEslintBasedSensor.execute(JavaScriptEslintBasedSensor.java:52)<br>	at org.sonar.scanner.sensor.AbstractSensorWrapper.analyse(AbstractSensorWrapper.java:48)<br>	at org.sonar.scanner.sensor.ModuleSensorsExecutor.execute(ModuleSensorsExecutor.java:85)<br>	at org.sonar.scanner.sensor.ModuleSensorsExecutor.lambda$execute<span class="hljs-variable">$1</span>(ModuleSensorsExecutor.java:59)<br>	at org.sonar.scanner.sensor.ModuleSensorsExecutor.withModuleStrategy(ModuleSensorsExecutor.java:77)<br>	at org.sonar.scanner.sensor.ModuleSensorsExecutor.execute(ModuleSensorsExecutor.java:59)<br>	at org.sonar.scanner.scan.ModuleScanContainer.doAfterStart(ModuleScanContainer.java:82)<br>	at org.sonar.core.platform.ComponentContainer.startComponents(ComponentContainer.java:137)<br>	at org.sonar.core.platform.ComponentContainer.execute(ComponentContainer.java:123)<br>	at org.sonar.scanner.scan.ProjectScanContainer.scan(ProjectScanContainer.java:392)<br>	at org.sonar.scanner.scan.ProjectScanContainer.scanRecursively(ProjectScanContainer.java:388)<br>	at org.sonar.scanner.scan.ProjectScanContainer.doAfterStart(ProjectScanContainer.java:357)<br>	at org.sonar.core.platform.ComponentContainer.startComponents(ComponentContainer.java:137)<br>	at org.sonar.core.platform.ComponentContainer.execute(ComponentContainer.java:123)<br>	at org.sonar.scanner.bootstrap.GlobalContainer.doAfterStart(GlobalContainer.java:150)<br>	at org.sonar.core.platform.ComponentContainer.startComponents(ComponentContainer.java:137)<br>	at org.sonar.core.platform.ComponentContainer.execute(ComponentContainer.java:123)<br>	at org.sonar.batch.bootstrapper.Batch.doExecute(Batch.java:72)<br>	at org.sonar.batch.bootstrapper.Batch.execute(Batch.java:66)<br>	at org.sonarsource.scanner.api.internal.batch.BatchIsolatedLauncher.execute(BatchIsolatedLauncher.java:46)<br>	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)<br>	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)<br>	at java.base/java.lang.reflect.Method.invoke(Unknown Source)<br>	at org.sonarsource.scanner.api.internal.IsolatedLauncherProxy.invoke(IsolatedLauncherProxy.java:60)<br>	at com.sun.proxy.<span class="hljs-variable">$Proxy0</span>.execute(Unknown Source)<br>	at org.sonarsource.scanner.api.EmbeddedScanner.doExecute(EmbeddedScanner.java:189)<br>	at org.sonarsource.scanner.api.EmbeddedScanner.execute(EmbeddedScanner.java:138)<br>	at org.sonarsource.scanner.cli.Main.execute(Main.java:112)<br>	at org.sonarsource.scanner.cli.Main.execute(Main.java:75)<br>	at org.sonarsource.scanner.cli.Main.main(Main.java:61)<br>Caused by: java.io.IOException: Cannot run program <span class="hljs-string">&quot;node&quot;</span>: error=2, No such file or directory<br>	at java.base/java.lang.ProcessBuilder.start(Unknown Source)<br>	at java.base/java.lang.ProcessBuilder.start(Unknown Source)<br>	at org.sonarsource.nodejs.NodeCommand<span class="hljs-variable">$ProcessWrapperImpl</span>.start(NodeCommand.java:162)<br>	at org.sonarsource.nodejs.NodeCommand.start(NodeCommand.java:77)<br>	... 39 common frames omitted<br>Caused by: java.io.IOException: error=2, No such file or directory<br>	at java.base/java.lang.ProcessImpl.forkAndExec(Native Method)<br>	at java.base/java.lang.ProcessImpl.&lt;init&gt;(Unknown Source)<br>	at java.base/java.lang.ProcessImpl.start(Unknown Source)<br>	... 43 common frames omitted<br></code></pre></td></tr></table></figure>







<h1 id="十八、查看结果"><a href="#十八、查看结果" class="headerlink" title="十八、查看结果"></a>十八、查看结果</h1><h2 id="18-1-使用-Jenkins-的SonarQube插件"><a href="#18-1-使用-Jenkins-的SonarQube插件" class="headerlink" title="18.1 使用 Jenkins 的SonarQube插件"></a>18.1 使用 Jenkins 的SonarQube插件</h2><p>进入Jenkins的项目页面</p>
<p>点击构建历史的右上角的小图标或者点击右方的”SonarQube“字体的跳转连接</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/devopts/devpots-154.png" srcset="/blog/img/loading.gif" alt="56"></p>
<p>注意：如果需要登陆就使用账号密码登陆</p>
<p><strong>进入sonarqube 页面</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube57.png" srcset="/blog/img/loading.gif" alt="57"></p>
<h2 id="18-2-使用手工方式进行代码扫描"><a href="#18-2-使用手工方式进行代码扫描" class="headerlink" title="18.2 使用手工方式进行代码扫描"></a>18.2 使用手工方式进行代码扫描</h2><p>直接进入 sonarqube 的web界面去查看</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube58.png" srcset="/blog/img/loading.gif" alt="58"></p>
<h1 id="sonarqube扫描总结"><a href="#sonarqube扫描总结" class="headerlink" title="sonarqube扫描总结"></a>sonarqube扫描总结</h1><ol>
<li>提供web显示的服务器安装sonarquber server</li>
<li>需要进行代码扫描的服务器安装sonarqube scanner</li>
<li>Jenkins的一些软件使用插件对代码进行扫描或添加<strong>sonar-project.properties</strong>配置文件然后执行命令扫描（可以通过脚本进行扫描）</li>
</ol>
<h1 id="十九、SonarQube-集成钉钉机器人报告"><a href="#十九、SonarQube-集成钉钉机器人报告" class="headerlink" title="十九、SonarQube 集成钉钉机器人报告"></a>十九、SonarQube 集成钉钉机器人报告</h1><h2 id="19-1-使用-shell-脚本的方式"><a href="#19-1-使用-shell-脚本的方式" class="headerlink" title="19.1 使用 shell 脚本的方式"></a>19.1 使用 shell 脚本的方式</h2><p>实现的方式：</p>
<p>通过使用 sonarqube 的 Web 接口获取某项目的一些信息，然后使用钉钉机器人进行报告。</p>
<p>进入web接口：</p>
<p>登陆sonarqube-&gt;点击网页下方的“Web接口”</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube59.png" srcset="/blog/img/loading.gif" alt="59"></p>
<h3 id="19-1-1-通过-jq-命令来过滤数据"><a href="#19-1-1-通过-jq-命令来过滤数据" class="headerlink" title="19.1.1 通过 jq 命令来过滤数据"></a>19.1.1 通过 jq 命令来过滤数据</h3><p><strong>过滤数据后会将数据发送到钉钉</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#/bin/bash</span><br><span class="hljs-comment">#SonarQube钉钉通知脚本</span><br>Sonar_project_name=<span class="hljs-variable">$1</span><br>Sonar_usertoken=467cc665a9ef0a734dc2c165b9ad4eebf57c21e6<br>Sonar_url=http://81.71.35.205:9000<br>Phone_numbers=<span class="hljs-string">&quot;18218292802&quot;</span>,<span class="hljs-string">&quot;18913293902&quot;</span><br><br><span class="hljs-comment"># 调用查询异常状态接口函数，该接口是在SonarQube平台直接爬的</span><br><span class="hljs-function"><span class="hljs-title">func_issues</span></span>() &#123;<br>  curl -sH <span class="hljs-string">&quot;Content-Length:0&quot;</span> -u <span class="hljs-variable">$Sonar_usertoken</span>: <span class="hljs-string">&quot;<span class="hljs-variable">$Sonar_url</span>/api/issues/search?resolved=false&amp;facets=severities,types&amp;componentKeys=<span class="hljs-variable">$Sonar_project_name</span>&quot;</span><br>&#125;<br><br><span class="hljs-comment"># 类型</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;0..2&#125;<br><span class="hljs-keyword">do</span><br>  item=`func_issues <span class="hljs-variable">$1</span> | jq <span class="hljs-string">&#x27;.facets[1].values[&#x27;</span><span class="hljs-variable">$&#123;i&#125;</span><span class="hljs-string">&#x27;].val&#x27;</span>`<br><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;item&#125;</span> = <span class="hljs-string">&#x27;&quot;BUG&quot;&#x27;</span> ]<br>  <span class="hljs-keyword">then</span><br>    BUG=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;BUG：`func_issues <span class="hljs-variable">$1</span> | jq &#x27;.facets[1].values[&#x27;<span class="hljs-variable">$&#123;i&#125;</span>&#x27;].count&#x27;`个&quot;</span>)<br>    N_BUG=`func_issues <span class="hljs-variable">$1</span> | jq <span class="hljs-string">&#x27;.facets[1].values[&#x27;</span><span class="hljs-variable">$&#123;i&#125;</span><span class="hljs-string">&#x27;].count&#x27;</span>`<br>  <span class="hljs-keyword">fi</span><br><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;item&#125;</span> = <span class="hljs-string">&#x27;&quot;VULNERABILITY&quot;&#x27;</span> ]<br>  <span class="hljs-keyword">then</span><br>    VULNERABILITY=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;漏洞：`func_issues <span class="hljs-variable">$1</span> | jq &#x27;.facets[1].values[&#x27;<span class="hljs-variable">$&#123;i&#125;</span>&#x27;].count&#x27;`个&quot;</span>)<br>    N_VULNERABILITY=`func_issues <span class="hljs-variable">$1</span> | jq <span class="hljs-string">&#x27;.facets[1].values[&#x27;</span><span class="hljs-variable">$&#123;i&#125;</span><span class="hljs-string">&#x27;].count&#x27;</span>`<br>  <span class="hljs-keyword">fi</span><br><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;item&#125;</span> = <span class="hljs-string">&#x27;&quot;CODE_SMELL&quot;&#x27;</span> ]<br>  <span class="hljs-keyword">then</span><br>    CODE_SMELL=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;异味：`func_issues <span class="hljs-variable">$1</span> | jq &#x27;.facets[1].values[&#x27;<span class="hljs-variable">$&#123;i&#125;</span>&#x27;].count&#x27;`个&quot;</span>)<br>  <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># 严重程度</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;0..4&#125;<br><span class="hljs-keyword">do</span><br>  b=`func_issues <span class="hljs-variable">$1</span> | jq <span class="hljs-string">&#x27;.facets[0].values[&#x27;</span><span class="hljs-variable">$&#123;i&#125;</span><span class="hljs-string">&#x27;].val&#x27;</span>`<br><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;b&#125;</span> = <span class="hljs-string">&#x27;&quot;MINOR&quot;&#x27;</span> ]<br>  <span class="hljs-keyword">then</span><br>     MINOR=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;次要：`func_issues <span class="hljs-variable">$1</span> | jq &#x27;.facets[0].values[&#x27;<span class="hljs-variable">$&#123;i&#125;</span>&#x27;].count&#x27;`个&quot;</span>)<br>  <span class="hljs-keyword">fi</span><br><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;b&#125;</span> = <span class="hljs-string">&#x27;&quot;MAJOR&quot;&#x27;</span> ]<br>  <span class="hljs-keyword">then</span><br>     MAJOR=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;主要：`func_issues <span class="hljs-variable">$1</span> | jq &#x27;.facets[0].values[&#x27;<span class="hljs-variable">$&#123;i&#125;</span>&#x27;].count&#x27;`个&quot;</span>)<br>  <span class="hljs-keyword">fi</span><br><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;b&#125;</span> = <span class="hljs-string">&#x27;&quot;CRITICAL&quot;&#x27;</span> ]<br>  <span class="hljs-keyword">then</span><br>    CRITICAL=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;严重：`func_issues <span class="hljs-variable">$1</span> | jq &#x27;.facets[0].values[&#x27;<span class="hljs-variable">$&#123;i&#125;</span>&#x27;].count&#x27;`个&quot;</span>)<br>  <span class="hljs-keyword">fi</span><br><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;b&#125;</span> = <span class="hljs-string">&#x27;&quot;INFO&quot;&#x27;</span> ]<br>  <span class="hljs-keyword">then</span><br>    INFO=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;提示：`func_issues <span class="hljs-variable">$1</span> | jq &#x27;.facets[0].values[&#x27;<span class="hljs-variable">$&#123;i&#125;</span>&#x27;].count&#x27;`个&quot;</span>)<br>  <span class="hljs-keyword">fi</span><br><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$&#123;b&#125;</span> = <span class="hljs-string">&#x27;&quot;BLOCKER&quot;&#x27;</span> ]<br>  <span class="hljs-keyword">then</span><br>  BLOCKER=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;阻断：`func_issues <span class="hljs-variable">$1</span> | jq &#x27;.facets[0].values[&#x27;<span class="hljs-variable">$&#123;i&#125;</span>&#x27;].count&#x27;`个&quot;</span>)<br>  <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br><br>Quality_Gate_Status=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;质量阈状态：`curl -sH &quot;</span>Content-Length:0<span class="hljs-string">&quot; -u <span class="hljs-variable">$Sonar_usertoken</span>: &quot;</span><span class="hljs-variable">$Sonar_url</span>/api/measures/component?component=<span class="hljs-variable">$Sonar_project_name</span>&amp;metricKeys=alert_status<span class="hljs-string">&quot; | jq &#x27;.component.measures[0].value&#x27; | tr -d &#x27;&quot;</span><span class="hljs-string">&#x27;`&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">#echo $&#123;BUG&#125;，$&#123;VULNERABILITY&#125;，$&#123;CODE_SMELL&#125; &quot;&#123;&quot; $&#123;BLOCKER&#125;，$&#123;CRITICAL&#125;，$&#123;MAJOR&#125;，$&#123;MINOR&#125;，$&#123;INFO&#125; &quot;&#125;&quot;</span><br><span class="hljs-string">func_alarmdingding()&#123;</span><br><span class="hljs-string">  apiurl=&quot;https://oapi.dingtalk.com/robot/send?access_token=7302724f06fa3ca008601c8aae8f05d4af66b9d07d2fb58734633611707b5ee9&quot;</span><br><span class="hljs-string">  </span><br><span class="hljs-string">  /bin/curl $&#123;apiurl&#125; \</span><br><span class="hljs-string">    -X POST -H &quot;Content-Type: application/json&quot; \</span><br><span class="hljs-string">    -d &#x27;</span>&#123;<br>  <span class="hljs-string">&quot;at&quot;</span>: &#123; <span class="hljs-string">&quot;atMobiles&quot;</span>: [ <span class="hljs-string">&#x27;$&#123;Phone_numbers&#125;&#x27;</span> ], <span class="hljs-string">&quot;isAtAll&quot;</span>: <span class="hljs-literal">false</span> &#125;,<br>    <span class="hljs-string">&quot;msgtype&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>    <span class="hljs-string">&quot;text&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;消息提示\n&#x27;<span class="hljs-variable">$&#123;Sonar_project_name&#125;</span>&#x27; 检测结果：\n&#x27;<span class="hljs-variable">$&#123;Quality_Gate_Status&#125;</span>&#x27;，&#x27;<span class="hljs-variable">$&#123;BUG&#125;</span>&#x27;，&#x27;<span class="hljs-variable">$&#123;VULNERABILITY&#125;</span>&#x27;，&#x27;<span class="hljs-variable">$&#123;CODE_SMELL&#125;</span>&#x27; \n&#x27;<span class="hljs-variable">$&#123;BLOCKER&#125;</span>&#x27;，&#x27;<span class="hljs-variable">$&#123;CRITICAL&#125;</span>&#x27;，&#x27;<span class="hljs-variable">$&#123;MAJOR&#125;</span>&#x27;，&#x27;<span class="hljs-variable">$&#123;MINOR&#125;</span>&#x27;,&#x27;<span class="hljs-variable">$&#123;INFO&#125;</span>&#x27;&quot;</span><br>    &#125;<br>  &#125;<span class="hljs-string">&#x27;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">func_alarmdingding</span><br></code></pre></td></tr></table></figure>

<p><strong>钉钉提示</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/sonarqube/sonarqube60.png" srcset="/blog/img/loading.gif"></p>
<h3 id="19-1-2-不使用-jq-命令来过滤数据"><a href="#19-1-2-不使用-jq-命令来过滤数据" class="headerlink" title="19.1.2 不使用 jq 命令来过滤数据"></a>19.1.2 不使用 jq 命令来过滤数据</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#SonarQube钉钉通知脚本</span><br>Sonar_project_name=<span class="hljs-variable">$1</span><br>Sonar_usertoken=cea880f64bf6613115da3156a0afda3419df6957<br>Sonar_url=http://10.0.0.7:9000<br><br>Total=`curl -sH <span class="hljs-string">&quot;Content-Length:0&quot;</span> -u <span class="hljs-variable">$Sonar_usertoken</span>: <span class="hljs-string">&quot;<span class="hljs-variable">$Sonar_url</span>/api/issues/search?resolved=false&amp;facets=severities,types&amp;componentKeys=<span class="hljs-variable">$Sonar_project_name</span>&quot;</span> | tr <span class="hljs-string">&#x27;,&#x27;</span> <span class="hljs-string">&#x27;\n&#x27;</span> | tr -d <span class="hljs-string">&#x27;&#123;&#x27;</span>,<span class="hljs-string">&#x27;&#125;&#x27;</span>,<span class="hljs-string">&#x27;[&#x27;</span>,<span class="hljs-string">&#x27;]&#x27;</span>,<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&#x27;values&#x27;</span> | grep cont: | wc -l`<br>Type=(次要 主要 严重 提示 阻断 BUG 异味 漏洞)<br><span class="hljs-built_in">declare</span> -a Result<br><br><span class="hljs-function"><span class="hljs-title">func_issues</span></span>() &#123;<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `seq 1 <span class="hljs-variable">$Total</span>`<br><span class="hljs-keyword">do</span><br>  Result[$((i-<span class="hljs-number">1</span>))]=` curl -sH <span class="hljs-string">&quot;Content-Length:0&quot;</span> -u <span class="hljs-variable">$Sonar_usertoken</span>: <span class="hljs-string">&quot;<span class="hljs-variable">$Sonar_url</span>/api/issues/search?resolved=false&amp;facets=severities,types&amp;componentKeys=<span class="hljs-variable">$Sonar_project_name</span>&quot;</span> | tr <span class="hljs-string">&#x27;,&#x27;</span> <span class="hljs-string">&#x27;\n&#x27;</span> | tr -d <span class="hljs-string">&#x27;&#123;&#x27;</span>,<span class="hljs-string">&#x27;&#125;&#x27;</span>,<span class="hljs-string">&#x27;[&#x27;</span>,<span class="hljs-string">&#x27;]&#x27;</span>,<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&#x27;values&#x27;</span> | grep cont: | tr -d <span class="hljs-string">&#x27;count:&#x27;</span> | sed -n <span class="hljs-string">&quot;<span class="hljs-variable">$i</span> p&quot;</span>`<br><span class="hljs-keyword">done</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">func_measures</span></span>() &#123;<br>  Result=`curl -sH <span class="hljs-string">&quot;Content-Length:0&quot;</span> -u <span class="hljs-variable">$Sonar_usertoken</span>: <span class="hljs-string">&quot;<span class="hljs-variable">$Sonar_url</span>/api/measures/component?component=<span class="hljs-variable">$Sonar_project_name</span>&amp;metricKeys=alert_status&quot;</span> | tr <span class="hljs-string">&#x27;,&#x27;</span> <span class="hljs-string">&#x27;\n&#x27;</span> | grep value | tr -d <span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&#x27;]&#x27;</span>,<span class="hljs-string">&#x27;&#125;&#x27;</span> | cut -d <span class="hljs-string">&#x27;:&#x27;</span> -f2`<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;质量阈状态：<span class="hljs-variable">$Result</span>&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">func_summary</span></span>() &#123;<br>func_issues<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `seq 0 $((<span class="hljs-variable">$Total</span> -<span class="hljs-number">1</span>))`<br><span class="hljs-keyword">do</span><br>  summary[<span class="hljs-variable">$i</span>]=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;Type[$i]&#125;</span>: <span class="hljs-variable">$&#123;Result[$i]&#125;</span> 个,&quot;</span><br><span class="hljs-keyword">done</span><br>func_measures<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;summary[@]&#125;</span><br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-title">func_alarmdingding</span></span>()&#123;<br>  apiurl=<span class="hljs-string">&quot;https://oapi.dingtalk.com/robot/send?access_token=54e6bcd49d7a3c2ae1d7d975257f7bf48b581899e0267db2564ffdeb32fb2948&quot;</span><br>  /bin/curl <span class="hljs-variable">$&#123;apiurl&#125;</span> \<br>    -X POST -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> \<br>    -d <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">    &quot;msgtype&quot;: &quot;text&quot;,</span><br><span class="hljs-string">    &quot;text&quot;: &#123;</span><br><span class="hljs-string">        &quot;content&quot;: &quot;消息提示：\n&#x27;</span><span class="hljs-variable">$&#123;Sonar_project_name&#125;</span><span class="hljs-string">&#x27; 检测结果：\n&#x27;</span><span class="hljs-string">&quot;`func_summary`&quot;</span><span class="hljs-string">&#x27;&quot;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  &#125;&#x27;</span><br>&#125;<br><br>func_alarmdingding<br></code></pre></td></tr></table></figure>



<p>参考文档：</p>
<p><a target="_blank" rel="noopener" href="https://docs.sonarqube.org/8.9/user-guide/metric-definitions/">https://docs.sonarqube.org/8.9/user-guide/metric-definitions/</a></p>
<p>参考博客：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mykiya/p/10967504.html">https://www.cnblogs.com/mykiya/p/10967504.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/leiziv5/p/10075913.html">https://www.cnblogs.com/leiziv5/p/10075913.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43958699/article/details/115255399?spm=1001.2101.3001.6650.15&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-15-115255399-blog-103496546.pc_relevant_antiscanv2&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-15-115255399-blog-103496546.pc_relevant_antiscanv2&amp;utm_relevant_index=16">https://blog.csdn.net/qq_43958699/article/details/115255399?spm=1001.2101.3001.6650.15&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-15-115255399-blog-103496546.pc_relevant_antiscanv2&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-15-115255399-blog-103496546.pc_relevant_antiscanv2&amp;utm_relevant_index=16</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/SonarQube/">SonarQube</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2022/05/14/Ubuntu1804%E5%AE%89%E8%A3%85gitlab-ce/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Ubuntu1804安装gitlab-ce</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2022/05/07/CentOS7%E4%BD%BF%E7%94%A8yum%E5%AE%89%E8%A3%85PostgreSQL/">
                        <span class="hidden-mobile">CentOS7使用yum安装PostgreSQL</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/blog/js/debouncer.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/blog/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/blog/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/blog/js/boot.js" ></script>



</body>
</html>
