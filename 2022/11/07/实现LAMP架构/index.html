

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="rlin">
  <meta name="keywords" content="">
  <title>实现LAMP架构 - rlin的运维笔记</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/blog/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/blog/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"rintime.gitee.io","root":"/blog/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>rlin的运维笔记</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="实现LAMP架构">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-11-07 16:48" pubdate>
        2022年11月7日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      15.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      241
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">实现LAMP架构</h1>
            
            <div class="markdown-body">
              <h1 id="一、LAMP介绍"><a href="#一、LAMP介绍" class="headerlink" title="一、LAMP介绍"></a>一、LAMP介绍</h1><h2 id="1-1-动态资源与语言"><a href="#1-1-动态资源与语言" class="headerlink" title="1.1 动态资源与语言"></a>1.1 动态资源与语言</h2><h3 id="1-1-1-WEB资源类型"><a href="#1-1-1-WEB资源类型" class="headerlink" title="1.1.1 WEB资源类型"></a>1.1.1 WEB资源类型</h3><ul>
<li>静态资源：原始形式与响应内容一致，在客户端浏览器执行</li>
<li>动态资源：原始形式通常为程序文件，需要在服务器端执行之后，将执行结果返回给客户端</li>
</ul>
<p>注意：静态和动态的区别，不在于网页是否能动态变化，而在于服务端的页面文件和客户端得到页面文件是否一致</p>
<p>范例：静态资源</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript">#客户端主机现在的时间:<br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="javascript"><span class="xml"><span class="hljs-built_in">document</span>.write(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());</span></span><br><span class="javascript"><span class="xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<h3 id="1-1-2-WEB-相关语言"><a href="#1-1-2-WEB-相关语言" class="headerlink" title="1.1.2 WEB 相关语言"></a>1.1.2 WEB 相关语言</h3><p>客户端技术： html，javascript，css</p>
<p>服务器端技术：java, Go, php，python，javascript（Node.js），jsp，asp，Perl，Ruby, Shell</p>
<h2 id="1-2-LAMP架构"><a href="#1-2-LAMP架构" class="headerlink" title="1.2 LAMP架构"></a>1.2 LAMP架构</h2><p>LAM(M)P：</p>
<ul>
<li>L：linux</li>
<li>A：apache (httpd)</li>
<li>M：mysql, mariadb</li>
<li>P：php, perl, python</li>
</ul>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<h2 id="1-3-CGI和fastcgi"><a href="#1-3-CGI和fastcgi" class="headerlink" title="1.3 CGI和fastcgi"></a>1.3 CGI和fastcgi</h2><p>CGI：Common Gateway Interface 公共网关接口。</p>
<p>CGI 在2000年或更早的时候用得比较多，以前web服务器一般只处理静态的请求，如果碰到一个动态请求怎么办呢？web服务器会根据这次请求的内容，然后会 fork 一个新进程来运行外部的 C 程序或者bash,perl脚本等，这个进程会把处理完的数据返回给web服务器，最后web服务器把内容发送给用户，刚才fork的进程也随之退出。 如果下次用户还请求改动态脚本，那么web服务器又再次fork一个新进程，周而复始的进行。</p>
<p>CGI 可以让一个客户端，从网页浏览器通过http服务器向执行在网络服务器上的程序传输数据；CGI描述了客户端和服务器程序之间传输的一种标准。</p>
<p><strong>请求流程：</strong></p>
<p>Client – (http协议) –&gt; httpd – (cgi协议) –&gt; application server (program file) – (mysql协议) –&gt; mysql</p>
<p>范例：httpd 利用CGI运行shell脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/httpd/conf/httpd.conf</span><br>...省略...<br>&lt;directory /data/script&gt;<br>require all granted<br>&lt;/directory&gt;<br>&lt;IfModule alias_module&gt;<br>...省略...<br><span class="hljs-comment">#ScriptAlias /cgi-bin/ &quot;/var/www/cgi-bin/&quot;</span><br>ScriptAlias /sh/ <span class="hljs-string">&quot;/data/script/&quot;</span><br>&lt;/IfModule&gt;<br>&lt;directory /data/script&gt;<br>require all granted<br>&lt;/directory&gt;<br>...省略...<br>&lt;Directory <span class="hljs-string">&quot;/data/script&quot;</span>&gt;<br>    AllowOverride None<br>    Options None<br>    Require all granted<br>&lt;/Directory&gt;<br><br><span class="hljs-comment"># mkdir /data/script</span><br><br><span class="hljs-comment"># vim /data/script/cgi.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;Content-type: text/plain\n&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello world!&quot;</span><br><br><span class="hljs-comment"># chmod +x /data/script/cgi.sh</span><br><br><span class="hljs-comment"># systemctl restart httpd</span><br><br><span class="hljs-comment"># curl http://10.0.0.17/sh/cgi.sh</span><br>hello world!<br></code></pre></td></tr></table></figure>

<h3 id="1-3-2-fastcgi"><a href="#1-3-2-fastcgi" class="headerlink" title="1.3.2 fastcgi"></a>1.3.2 fastcgi</h3><p>fastcgi的方式是，web服务器收到一个请求时，不会重新fork一个进程（因为这个进程在web服务器启动时就开启了，而且不会退出），web服务器直接把内容传递给这个进程（进程间通信，但fastcgi使用<br>了别的方式，tcp方式通信），这个进程收到请求后进行处理，把结果返回给web服务器，最后自己接着等待下一个请求的到来，而不是退出。</p>
<p><strong>请求流程：</strong></p>
<p>Client – (http协议) –&gt; httpd – (fastcgi协议) –&gt; fastcgi服务器 – (mysql协议) –&gt; mysql</p>
<h3 id="1-3-3-CGI和fastcgi-比较"><a href="#1-3-3-CGI和fastcgi-比较" class="headerlink" title="1.3.3 CGI和fastcgi 比较"></a>1.3.3 CGI和fastcgi 比较</h3><p>CGI: 兼职, 一次性的过河拆桥式的服务</p>
<p>FASTCGI: 专职,全周期的持续式的服务</p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>在web服务器方面</th>
<th>在对数据进行处理的进程方面</th>
</tr>
</thead>
<tbody><tr>
<td>cgi</td>
<td>fork一个新的进程进行处理</td>
<td>读取参数，处理数据，然后就结束生命期</td>
</tr>
<tr>
<td>fastcgi</td>
<td>用tcp方式跟远程机子上的进程或本地进程建立连接</td>
<td>要开启tcp端口，进入循环，等待数据的到来，处理数据</td>
</tr>
</tbody></table>
<h2 id="1-4-PHP"><a href="#1-4-PHP" class="headerlink" title="1.4 PHP"></a>1.4 PHP</h2><h3 id="1-4-1-PHP简介"><a href="#1-4-1-PHP简介" class="headerlink" title="1.4.1 PHP简介"></a>1.4.1 PHP简介</h3><p>PHP官网：<a target="_blank" rel="noopener" href="http://www.php.net/">http://www.php.net/</a></p>
<p>PHP(Hypertext Preprocessor 超文本预处理器)是通用服务器端脚本编程语言，主要用于web开发实现动态web页面，也是最早实现将脚本嵌入HTML源码文档中的服务器端脚本语言之一。同时，php还提供<br>了一个命令行接口，因此，其也可以在大多数系统上作为一个独立的shell来使用Rasmus Lerdorf于1994年开始开发PHP，最初是一组被Rasmus Lerdorf称作“Personal Home PageTool” 的Perl脚本， 可以用于显示作者的简历并记录用户对其网站的访问。后来，Rasmus Lerdorf使用C语言将这些Perl脚本重写为CGI程序，还为其增加了运行Web forms的能力以及与数据库交互的特性，并将其重命名为“Personal Home Page/Forms Interpreter”或“PHP/FI”。此时，PHP/FI已经可以用于开发简单的动态web程序了，这即PHP1.0。1995年6月，Rasmus Lerdorf把它的PHP发布于<code>comp.infosystems.www.authoring.cgi</code>Usenet讨论组，从此PHP开始走进人们的视野。1997年，其2.0版本发布</p>
<p>1997年，两名以色列程序员Zeev Suraski和Andi Gutmans重写的PHP的分析器(parser)成为PHP发展到3.0的基础，而且从此将PHP重命名为PHP: Hypertext Preprocessor。此后，这两名程序员开始重写整个PHP核心，并于1999年发布了Zend Engine 1.0，这也意味着PHP 4.0的诞生。2004年7月，ZendEngine 2.0发布，由此也将PHP带入了PHP 5时代。PHP5包含了许多重要的新特性，如增强的面向对象编程的支持、支持PDO(PHP Data Objects)扩展机制以及一系列对PHP性能的改进</p>
<p>Zend Engine是开源的、PHP脚本语言的解释器，它最早是由以色列理工学院(Technion)的学生Andi Gut mans和Zeev Suraski所开发，Zend也正是此二人名字的合称。后来两人联合创立了Zend Technologies公司</p>
<p>Zend Engine 1.0于1999年随PHP 4发布，由C语言开发且经过高度优化，并能够做为PHP的后端模块使用。Zend Engine为PHP提供了内存和资源管理的功能以及其它的一些标准服务，其高性能、可靠性和可扩展性在促进PHP成为一种流行的语言方面发挥了重要作用</p>
<p>Zend Engine的出现将PHP代码的处理过程分成了两个阶段：首先是分析PHP代码并将其转换为称作Zend opcode的二进制格式opcode(类似Java的字节码)，并将其存储于内存中；第二阶段是使用Zend Engine去执行这些转换后的Opcode</p>
<p>php各种版本官方支持时间：</p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\lamp\lamp1.png" srcset="/blog/img/loading.gif"></p>
<h3 id="1-4-2-PHP-的-Opcode-语言"><a href="#1-4-2-PHP-的-Opcode-语言" class="headerlink" title="1.4.2 PHP 的 Opcode 语言"></a>1.4.2 PHP 的 Opcode 语言</h3><p>Opcode是一种PHP脚本编译后的中间语言，类似于Java的ByteCode,或者.NET的MSL</p>
<p>PHP的语言引擎Zend执行PHP脚本代码一般会经过如下4个步骤</p>
<p>1、Scanning 词法分析,将PHP代码转换为语言片段(Tokens)</p>
<p>2、Parsing 语义分析,将Tokens转换成简单而有意义的表达式</p>
<p>3、Compilation 将表达式编译成Opcode</p>
<p>4、Execution 顺次执行Opcode，每次一条，从而实现PHP脚本的功能</p>
<p>即：扫描–&gt;分析–&gt;编译–&gt;执行</p>
<h3 id="1-4-3-PHP-配置"><a href="#1-4-3-PHP-配置" class="headerlink" title="1.4.3 PHP 配置"></a>1.4.3 PHP 配置</h3><p>php 的配置文件：<code>/etc/php.ini</code>, <code>/etc/php.d/*.ini</code></p>
<p>配置文件在php解释器启动时被读取</p>
<p>对配置文件的修改生效方法</p>
<ul>
<li>Modules：重启httpd服务</li>
<li>FastCGI：重启php-fpm服务</li>
</ul>
<p><strong>/etc/php.ini配置文件格式：</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html">[foo]：Section Header<br>directive = value<br></code></pre></td></tr></table></figure>

<p>注释符：</p>
<ul>
<li>以#开头，纯粹的注释信息</li>
<li>以 ; 开头，用于注释可启用的directive</li>
</ul>
<p>提示：较新的版本中，已经完全使用 “ ; ” 进行注释</p>
<p><strong>php.ini 配置参考文档：</strong></p>
<p>php.ini的核心配置选项文档： <a target="_blank" rel="noopener" href="http://php.net/manual/zh/ini.core.php">http://php.net/manual/zh/ini.core.php</a></p>
<p>php.ini配置选项列表：<a target="_blank" rel="noopener" href="http://php.net/manual/zh/ini.list.php">http://php.net/manual/zh/ini.list.php</a></p>
<p><strong>php常见设置：</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">expose_php</span> = <span class="hljs-literal">On</span>  <span class="hljs-comment">#响应报文显示首部字段x-powered-by: PHP/x.y.z，暴露php版本，建议为off</span><br><span class="hljs-attr">max_execution_time</span>= <span class="hljs-number">30</span> <span class="hljs-comment">#最长执行时间30s</span><br><span class="hljs-attr">memory_limit</span>=<span class="hljs-number">128</span>M <span class="hljs-comment">#生产不够，可调大</span><br><span class="hljs-attr">display_errors</span>=<span class="hljs-literal">off</span>  <span class="hljs-comment">#调试使用，不要打开，否则可能暴露重要信息</span><br><span class="hljs-attr">display_startup_errors</span>=<span class="hljs-literal">off</span>  <span class="hljs-comment">#建议关闭</span><br><span class="hljs-attr">post_max_size</span>=<span class="hljs-number">8</span>M  <span class="hljs-comment">#最大上传数据大小，生产可能调大，比下面项大</span><br><span class="hljs-attr">upload_max_filesize</span> =<span class="hljs-number">2</span>M  <span class="hljs-comment">#最大上传文件，生产可能要调大</span><br><span class="hljs-attr">max_file_uploads</span> = <span class="hljs-number">20</span> <span class="hljs-comment">#同时上传最多文件数</span><br><span class="hljs-attr">date.timezone</span> =Asia/Shanghai  <span class="hljs-comment">#指定时区</span><br><span class="hljs-attr">short_open_tag</span>=<span class="hljs-literal">on</span> <span class="hljs-comment">#开启短标签,如: &lt;? phpinfo();?&gt;</span><br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum -y install httpd php</span><br><span class="hljs-comment"># systemctl start httpd</span><br><span class="hljs-comment"># vim /var/www/html/test.php</span><br>&lt;?php<br>phpinfo();<br>?&gt;<br><br><span class="hljs-comment"># vim /var/www/html/session.php</span><br>&lt;?php<br>session_start();<br><span class="hljs-built_in">echo</span> session_id();<br>?&gt;<br><br><span class="hljs-comment"># curl -I 10.0.0.17/test.php</span><br>HTTP/1.1 200 OK<br>Date: Mon, 07 Nov 2022 09:45:07 GMT<br>Server: Apache/2.4.6 (CentOS) PHP/5.4.16 <span class="hljs-comment">#暴露PHP版本</span><br>X-Powered-By: PHP/5.4.16<br>Content-Type: text/html; charset=UTF-8<br><br><span class="hljs-comment"># vim /etc/php.ini</span><br>expose_php = Off<br><br><span class="hljs-comment"># systemctl restart httpd</span><br><br><span class="hljs-comment"># curl -I 10.0.0.17/test.php</span><br>HTTP/1.1 200 OK<br>Date: Mon, 07 Nov 2022 09:51:18 GMT<br>Server: Apache/2.4.6 (CentOS)<br>Content-Type: text/html; charset=UTF-8<br><br><span class="hljs-comment">#生成会话信息</span><br><span class="hljs-comment"># curl http://10.0.0.17/session.php</span><br>ekbshg7fr75e7tlihjdlfii5a3<br><br><span class="hljs-comment">#查看生成的会话文件</span><br><span class="hljs-comment"># ll -d /var/lib/php/session</span><br>drwxrwx--- 2 root apache 84 Nov  7 17:51 /var/lib/php/session<br><span class="hljs-comment"># ll /var/lib/php/session</span><br>total 0<br>-rw------- 1 apache apache 0 Nov  7 17:51 sess_9ru4c3ne5q90bclj4c6ac1hn46<br>-rw------- 1 apache apache 0 Nov  7 17:51 sess_ekbshg7fr75e7tlihjdlfii5a3<br></code></pre></td></tr></table></figure>

<h3 id="1-4-4-PHP-语言格式"><a href="#1-4-4-PHP-语言格式" class="headerlink" title="1.4.4 PHP 语言格式"></a>1.4.4 PHP 语言格式</h3><p>php语言有两种使用格式：</p>
<p><strong>格式 1</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h1&gt;Hello world!&lt;/h1&gt;&quot;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>格式 2</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><br>    &lt;?php echo &quot;Hello world!&quot; ?&gt;<br><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-4-5-PHP-测试代码"><a href="#1-4-5-PHP-测试代码" class="headerlink" title="1.4.5 PHP 测试代码"></a>1.4.5 PHP 测试代码</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /var/www/html/phpinfo.php</span><br>&lt;?php<br><span class="hljs-built_in">echo</span> date(<span class="hljs-string">&quot;Y/m/d H:i:s&quot;</span>);<br>phpinfo();<br>?&gt;<br><br><span class="hljs-comment"># curl 127.0.0.1/phpinfo.php</span><br><br><span class="hljs-comment"># vim ./phpinfo.php</span><br><span class="hljs-comment">#!/bin/php</span><br>&lt;?php<br>phpinfo();<br>?&gt;<br><span class="hljs-comment"># chmod +x ./phpinfo.php</span><br><span class="hljs-comment"># ./phpinfo.php</span><br></code></pre></td></tr></table></figure>

<h2 id="1-5-LAMP实现方式"><a href="#1-5-LAMP实现方式" class="headerlink" title="1.5 LAMP实现方式"></a>1.5 LAMP实现方式</h2><p>httpd 接收用户的web请求；静态资源则直接响应；动态资源为php脚本，对此类资源的请求将交由php来运行</p>
<p><strong>httpd与php结合的方式</strong></p>
<ul>
<li>modules ：将php编译成为httpd的模块libphp5.so，只有prefork 模式才支持</li>
<li>FastCGI</li>
</ul>
<p><strong>LAMP架构实现</strong></p>
<ul>
<li><p>静态资源：</p>
<p>Client – http –&gt; httpd</p>
</li>
<li><p>动态资源：</p>
<p>Client – http –&gt; httpd –&gt; libphp5.so () – mysql –&gt; MySQL server</p>
<p>Client – http –&gt; httpd –&gt;fastcgi– mysql –&gt; MySQL server</p>
</li>
</ul>
<h1 id="二、实现LAMP"><a href="#二、实现LAMP" class="headerlink" title="二、实现LAMP"></a>二、实现LAMP</h1><h2 id="2-1-利用rpm包实现LAMP安装部署"><a href="#2-1-利用rpm包实现LAMP安装部署" class="headerlink" title="2.1 利用rpm包实现LAMP安装部署"></a>2.1 利用rpm包实现LAMP安装部署</h2><p>CentOS 8</p>
<p>Module 模块方式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">dnf install httpd mariadb-server php php-mysqlnd<br></code></pre></td></tr></table></figure>

<p>FastCGI 方式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">dnf install httpd mariadb-server php-fpm php-mysqlnd<br></code></pre></td></tr></table></figure>

<p>CentOS 7</p>
<p>Module 模块方式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">yum install httpd mariadb-server php php-mysql<br></code></pre></td></tr></table></figure>

<p>FastCGI 方式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">yum install httpd php-fpm php-mysql mariadb-server<br></code></pre></td></tr></table></figure>

<p>CentOS 6：</p>
<p>Module 模块方式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">yum install httpd, php, php-mysql, mysql-server<br></code></pre></td></tr></table></figure>

<p>FastCGI方式：默认不支持</p>
<p>注意：基于module实现，httpd 需要 使用prefork模型</p>
<h2 id="2-2-PHP连接MySQL的方式"><a href="#2-2-PHP连接MySQL的方式" class="headerlink" title="2.2 PHP连接MySQL的方式"></a>2.2 PHP连接MySQL的方式</h2><h3 id="2-2-1-使用mysql扩展连接数据库"><a href="#2-2-1-使用mysql扩展连接数据库" class="headerlink" title="2.2.1 使用mysql扩展连接数据库"></a>2.2.1 使用mysql扩展连接数据库</h3><p>使用mysql扩展模块<code>mysql.so</code>连接数据，此方式已经在php 7 版后淘汰</p>
<p>范例：php使用mysql扩展连接数据库的测试代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$conn</span> = mysql_connect(<span class="hljs-string">&#x27;localhost&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$conn</span>)<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;OK&quot;</span>;<br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Failure&quot;</span>;<br><span class="hljs-comment">#echo mysql_error();</span><br>mysql_close();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># curl http://10.0.0.17/test.php</span><br>OK<br></code></pre></td></tr></table></figure>

<h3 id="2-2-2-使用mysqli扩展连接数据库"><a href="#2-2-2-使用mysqli扩展连接数据库" class="headerlink" title="2.2.2 使用mysqli扩展连接数据库"></a>2.2.2 使用mysqli扩展连接数据库</h3><p>使用mysqli扩展模块<code>mysqli.so</code>连接数据，此方式只能连接MySQL数据库，不支持其它数据库</p>
<p>范例：php使用mysqli扩展连接数据库的测试代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$mysqli</span>=<span class="hljs-keyword">new</span> mysqli(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br><span class="hljs-keyword">if</span>(mysqli_connect_errno())&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Failure&quot;</span>;<br>    <span class="hljs-variable">$mysqli</span>=<span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;OK&quot;</span>;<br><span class="hljs-variable">$mysqli</span>-&gt;close();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># curl http://10.0.0.17/test.php</span><br>OK<br></code></pre></td></tr></table></figure>

<h3 id="2-2-3-使用PDO-PHP-Data-Object-扩展连接数据库"><a href="#2-2-3-使用PDO-PHP-Data-Object-扩展连接数据库" class="headerlink" title="2.2.3 使用PDO(PHP Data Object)扩展连接数据库"></a>2.2.3 使用PDO(PHP Data Object)扩展连接数据库</h3><p>使用PDO扩展模块<code>pdo_mysql.so</code>连接数据库，此方式可以支持连接MySQL，Oracle等多种数据库</p>
<p>范例：php使用pdo扩展连接数据库的测试代码1</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$dsn</span>=<span class="hljs-string">&#x27;mysql:host=localhost;port=3306;dbname=mysql&#x27;</span>;<br><span class="hljs-variable">$username</span>=<span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$passwd</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$dbh</span>=<span class="hljs-keyword">new</span> PDO(<span class="hljs-variable">$dsn</span>,<span class="hljs-variable">$username</span>,<span class="hljs-variable">$passwd</span>);<br>var_dump(<span class="hljs-variable">$dbh</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>范例：php使用pdo扩展连接数据库的测试代码2</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-variable">$user</span>=<span class="hljs-string">&#x27;root&#x27;</span>;<br>        <span class="hljs-variable">$pass</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br>        <span class="hljs-variable">$dbh</span> = <span class="hljs-keyword">new</span> PDO(<span class="hljs-string">&#x27;mysql:host=localhost;port=3306;dbname=mysql&#x27;</span>, <span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span>);<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$dbh</span>-&gt;query(<span class="hljs-string">&#x27;SELECT user,host from user&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>) &#123;<br>            print_r(<span class="hljs-variable">$row</span>);<br>        &#125;<br>        <span class="hljs-variable">$dbh</span> = <span class="hljs-literal">null</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (PDOException <span class="hljs-variable">$e</span>) &#123;<br>        <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;Error!: &quot;</span> . <span class="hljs-variable">$e</span>-&gt;getMessage() . <span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># curl http://10.0.0.17/test.php</span><br>Array<br>(<br>    [user] =&gt; chan<br>    [0] =&gt; chan<br>    [host] =&gt; %<br>    [1] =&gt; %<br>)<br>Array<br>(<br>    [user] =&gt; rlin<br>    [0] =&gt; rlin<br>    [host] =&gt; %<br>    [1] =&gt; %<br>)<br>Array<br>(<br>    [user] =&gt; root<br>    [0] =&gt; root<br>    [host] =&gt; 127.0.0.1<br>    [1] =&gt; 127.0.0.1<br>)<br>Array<br>(<br>    [user] =&gt; root<br>    [0] =&gt; root<br>    [host] =&gt; ::1<br>    [1] =&gt; ::1<br>)<br>Array<br>(<br>    [user] =&gt; <br>    [0] =&gt; <br>    [host] =&gt; centos7.9<br>    [1] =&gt; centos7.9<br>)<br>Array<br>(<br>    [user] =&gt; root<br>    [0] =&gt; root<br>    [host] =&gt; centos7.9<br>    [1] =&gt; centos7.9<br>)<br>Array<br>(<br>    [user] =&gt; <br>    [0] =&gt; <br>    [host] =&gt; localhost<br>    [1] =&gt; localhost<br>)<br>Array<br>(<br>    [user] =&gt; root<br>    [0] =&gt; root<br>    [host] =&gt; localhost<br>    [1] =&gt; localhost<br>)<br></code></pre></td></tr></table></figure>

<h2 id="2-3-实现LAMP实战案例"><a href="#2-3-实现LAMP实战案例" class="headerlink" title="2.3 实现LAMP实战案例"></a>2.3 实现LAMP实战案例</h2><p>范例：CentOS 8 默认使用factcgi模式，可以按下面步骤修改为httpd的模块方式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># dnf -y install httpd php php-mysqlnd  mariadb-server</span><br><br><span class="hljs-comment">#修改为prefork模式支持httpd 模块方式</span><br><span class="hljs-comment"># vim /etc/httpd/conf.modules.d/00-mpm.conf</span><br>LoadModule mpm_prefork_module modules/mod_mpm_prefork.so  <br><span class="hljs-comment">#LoadModule mpm_worker_module modules/mod_mpm_worker.so</span><br><span class="hljs-comment">#LoadModule mpm_event_module modules/mod_mpm_event.so</span><br><br><span class="hljs-comment">#CentOS 8的php 默认是factcgi模式 ，修改为httpd模块方式，此步非必须，是可选做</span><br><span class="hljs-comment">#vim /etc/httpd/conf.d/php.conf</span><br><span class="hljs-comment">#&lt;IfModule !mod_php5.c&gt;</span><br><span class="hljs-comment"># &lt;IfModule !mod_php7.c&gt;</span><br><span class="hljs-comment">#  # Enable http authorization headers</span><br><span class="hljs-comment">#  SetEnvIfNoCase ^Authorization$ &quot;(.+)&quot; HTTP_AUTHORIZATION=$1</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#  &lt;FilesMatch \.(php|phar)$&gt;</span><br><span class="hljs-comment">#    SetHandler &quot;proxy:unix:/run/php-fpm/www.sock|fcgi://localhost&quot;</span><br><span class="hljs-comment">#  &lt;/FilesMatch&gt;</span><br><span class="hljs-comment"># &lt;/IfModule&gt;</span><br><span class="hljs-comment">#&lt;/IfModule&gt;</span><br><br><span class="hljs-comment"># vim /var/www/html/lamp.php</span><br>&lt;?php<br>try &#123;<br><span class="hljs-variable">$user</span>=<span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$pass</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$dbh</span> = new PDO(<span class="hljs-string">&#x27;mysql:host=localhost;dbname=mysql&#x27;</span>, <span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span>);<br>foreach(<span class="hljs-variable">$dbh</span>-&gt;query(<span class="hljs-string">&#x27;SELECT user,host from user&#x27;</span>) as <span class="hljs-variable">$row</span>) &#123;<br>print_r(<span class="hljs-variable">$row</span>);<br>&#125;<br><span class="hljs-variable">$dbh</span> = null;<br>&#125; catch (PDOException <span class="hljs-variable">$e</span>) &#123;<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Error!: &quot;</span> . <span class="hljs-variable">$e</span>-&gt;getMessage() . <span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br>die();<br>&#125;<br>phpinfo();<br>?&gt;<br><br><span class="hljs-comment"># systemctl start httpd mariadb</span><br></code></pre></td></tr></table></figure>

<p>范例：CentOS 7 默认使用httpd的模块方式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum install -y httpd mariadb-server php php-mysql</span><br><br><span class="hljs-comment">#修改为prefork模式支持httpd 模块方式</span><br><span class="hljs-comment"># vim /etc/httpd/conf.modules.d/00-mpm.conf</span><br>LoadModule mpm_prefork_module modules/mod_mpm_prefork.so  <br><span class="hljs-comment">#LoadModule mpm_worker_module modules/mod_mpm_worker.so</span><br><span class="hljs-comment">#LoadModule mpm_event_module modules/mod_mpm_event.so</span><br><br><span class="hljs-comment"># vim /var/www/html/lamp.php</span><br>&lt;?php<br>try &#123;<br><span class="hljs-variable">$user</span>=<span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$pass</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$dbh</span> = new PDO(<span class="hljs-string">&#x27;mysql:host=localhost;dbname=mysql&#x27;</span>, <span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span>);<br>foreach(<span class="hljs-variable">$dbh</span>-&gt;query(<span class="hljs-string">&#x27;SELECT user,host from user&#x27;</span>) as <span class="hljs-variable">$row</span>) &#123;<br>print_r(<span class="hljs-variable">$row</span>);<br>&#125;<br><span class="hljs-variable">$dbh</span> = null;<br>&#125; catch (PDOException <span class="hljs-variable">$e</span>) &#123;<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Error!: &quot;</span> . <span class="hljs-variable">$e</span>-&gt;getMessage() . <span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br>die();<br>&#125;<br>phpinfo();<br>?&gt;<br><br><span class="hljs-comment"># systemctl start httpd mariadb</span><br></code></pre></td></tr></table></figure>

<p>打开chrome浏览器，访问 <a target="_blank" rel="noopener" href="http://httpd服务器ip/lamp.php">http://httpd服务器IP/lamp.php</a> 可以看到如下页面，说明LAMP 搭建成功</p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\lamp\lamp2.png" srcset="/blog/img/loading.gif"></p>
<h1 id="三、常见LAMP应用实现"><a href="#三、常见LAMP应用实现" class="headerlink" title="三、常见LAMP应用实现"></a>三、常见LAMP应用实现</h1><h2 id="3-1-常见LAMP应用介绍"><a href="#3-1-常见LAMP应用介绍" class="headerlink" title="3.1 常见LAMP应用介绍"></a>3.1 常见LAMP应用介绍</h2><ul>
<li>PhpMyAdmin是一个以PHP为基础，以Web-Base方式架构在网站主机上的MySQL的数据库管理工具，让管理者可用Web接口管理MySQL数据库，官网：<a target="_blank" rel="noopener" href="https://www.phpmyadmin.net/">https://www.phpmyadmin.net/</a></li>
<li>WordPress是一种使用PHP语言开发的博客平台，用户可以在支持PHP和MySQL数据库的服务器上架设属于自己的网站。也可把 WordPress当作一个内容管理系统（CMS）来使用，官网：<a target="_blank" rel="noopener" href="https://cn.wordpress.org/">https://cn.wordpress.org/</a></li>
<li>PHPWind是2003年发布了PHPWind的前身版本ofstar，并发展成为包含BBS、CMS、博客、SNS等一系列程序的通用型建站软件, 于2008年加入阿里巴巴集团，官网：<a target="_blank" rel="noopener" href="https://www.phpwind.net/">https://www.phpwind.net/</a></li>
<li>Crossday Discuz! Board（简称 Discuz!）是一套通用的社区论坛软件系统。自2001年6月面世以来，是覆盖率最大的论坛软件系统之一。2010年8月23日与腾讯达成收购协议，官网：<a target="_blank" rel="noopener" href="https://www.discuz.net/">https://www.discuz.net/</a></li>
<li>PowerDNS 是一个跨平台的开源DNS服务组件，它是高性能的域名服务器，除了支持普通的BIND配置文件，PowerDNS还可从MySQL,Oracle,PostgreSQL等的数据库读取数据。PowerDNS安装了Poweradmin(基于php实现)，能实现Web管理DNS记录，非常方便</li>
<li>ECShop是一款B2C独立网店系统，适合企业及个人快速构建个性化网上商店。系统是基于PHP语言及MYSQL数据库构架开发的跨平台开源程序。2006年6月，ECShop推出第一个版本1.0</li>
</ul>
<h2 id="3-2-实现-phpMyadmin应用部署"><a href="#3-2-实现-phpMyadmin应用部署" class="headerlink" title="3.2 实现 phpMyadmin应用部署"></a>3.2 实现 phpMyadmin应用部署</h2><p>范例：CentOS 8 部署 phpMyAdmin-5.0.1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum -y install httpd mariadb-server php php-mysqlnd php-json php-xml</span><br><span class="hljs-comment"># systemctl start httpd mariadb</span><br><span class="hljs-comment"># mysql_secure_installation</span><br><span class="hljs-comment"># unzip phpMyAdmin-5.0.1-all-languages.zip</span><br><span class="hljs-comment"># mv phpMyAdmin-5.0.1-all-languages /var/www/html/pma</span><br><span class="hljs-comment">#如果出错，可以查看日志</span><br><span class="hljs-comment"># tail /var/log/php-fpm/www-error.log</span><br><span class="hljs-comment">#浏览器访问http://LAMP服务器IP/pma/</span><br></code></pre></td></tr></table></figure>

<p>范例：CentOS 7 利用清华Yum源安装php 7.4 部署 phpMyAdmin-5.0.2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum -y install https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm</span><br><span class="hljs-comment"># yum -y install httpd php74-php php74-php-mbstring php74-php-mysqlnd mariadb-server unzip</span><br><span class="hljs-comment"># systemctl enable --now httpd mariadb</span><br><span class="hljs-comment"># mysqladmin password 123456</span><br><span class="hljs-comment"># wget --no-check-certificate https://files.phpmyadmin.net/phpMyAdmin/5.0.2/phpMyAdmin-5.0.2-all-languages.zip</span><br><span class="hljs-comment"># unzip phpMyAdmin-5.0.2-all-languages.zip</span><br><span class="hljs-comment"># mv phpMyAdmin-5.0.2-all-languages/ /var/www/html/pma</span><br><span class="hljs-comment">#浏览器访问http://LAMP服务器IP/pma/</span><br></code></pre></td></tr></table></figure>

<p>范例：CentOS 7 利用清华Yum源安装php 7.2 部署 phpMyAdmin-5.0.1</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum -y install https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm</span><br><span class="hljs-comment"># yum -y install httpd php72-php php72-php-mbstring php72-php-mysqlnd mariadb-server</span><br><span class="hljs-comment"># systemctl enable --now httpd mariadb</span><br><span class="hljs-comment"># wget https://files.phpmyadmin.net/phpMyAdmin/5.0.1/phpMyAdmin-5.0.1-all-languages.zip</span><br><span class="hljs-comment"># yum install unzip -y unzip phpMyAdmin-5.0.1-all-languages.zip</span><br><span class="hljs-comment"># cd phpMyAdmin-5.0.1-all-languages/</span><br><span class="hljs-comment"># mv phpMyAdmin-5.0.1-all-languages /var/www/html/pma</span><br><br><span class="hljs-comment">#设置mysql的root密码，phpMyadmin不允许空密码登录</span><br><span class="hljs-comment">#mysqladmin password 123456</span><br><br><span class="hljs-comment">#浏览器访问http://LAMP服务器IP/pma/</span><br></code></pre></td></tr></table></figure>

<p>范例：CentOS 7 利用RPM包部署phpMyadmin4.4</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum -y install httpd mariadb-server php php-mysql</span><br><span class="hljs-comment"># systemctl start mariadb</span><br><span class="hljs-comment"># mysql_secure_installation</span><br><br><span class="hljs-comment">#下载：https://www.phpmyadmin.net/downloads/</span><br><span class="hljs-comment"># unzip phpMyAdmin-4.4.15.10-all-languages.zip</span><br><span class="hljs-comment"># mv phpMyAdmin-4.4.15.10-all-languages /var/www/html/phpmyadmin</span><br><span class="hljs-comment"># cd /var/www/html/phpmyadmin/</span><br><span class="hljs-comment"># cp config.sample.inc.php config.inc.php</span><br><br><span class="hljs-comment">#如果mysql 服务器和phpmyadmin不在同一台主机，还需要修改以下设置</span><br><span class="hljs-comment"># vim config.inc.php</span><br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;host&#x27;</span>] = <span class="hljs-string">&#x27;mysqlserverIP&#x27;</span>;<br><span class="hljs-comment"># yum -y install php-mbstring</span><br><span class="hljs-comment"># systemctl start httpd</span><br><br><span class="hljs-comment">#浏览器访问:http://LAMP服务器IP/phpmyadmin,输入root及口令即可登录</span><br></code></pre></td></tr></table></figure>

<h2 id="3-3-实现-wordpress-应用部署"><a href="#3-3-实现-wordpress-应用部署" class="headerlink" title="3.3 实现 wordpress 应用部署"></a>3.3 实现 wordpress 应用部署</h2><p>WordPress系统要求：<a target="_blank" rel="noopener" href="https://cn.wordpress.org/about/requirements/">https://cn.wordpress.org/about/requirements/</a></p>
<h3 id="3-3-1范例：CentOS-8-利用RPM包部署-wordpress"><a href="#3-3-1范例：CentOS-8-利用RPM包部署-wordpress" class="headerlink" title="3.3.1范例：CentOS 8 利用RPM包部署 wordpress"></a>3.3.1范例：CentOS 8 利用RPM包部署 wordpress</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># dnf -y install httpd php php-json php-mysqlnd mariadb-server</span><br><span class="hljs-comment"># systemctl enable --now httpd mariadb</span><br><span class="hljs-comment"># mysqladmin password 123456</span><br><span class="hljs-comment"># mysql -uroot -p123456</span><br>MariaDB [(none)]&gt; create database wordpress;<br>MariaDB [(none)]&gt; grant all on wordpress.* to wordpress@<span class="hljs-string">&#x27;localhost&#x27;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>;<br><span class="hljs-comment"># wget https://cn.wordpress.org/latest-zh_CN.zip</span><br><span class="hljs-comment"># tar xvf wordpress-5.4.2-zh_CN.tar.gz</span><br><span class="hljs-comment"># mv wordpress/* /var/www/html/</span><br><span class="hljs-comment"># chown -R apache.apache /var/www/html/</span><br><br><span class="hljs-comment">#浏览器访问</span><br>http://LAMP服务器<br><br><span class="hljs-comment">#如果连接数据库失败,可以用127.0.0.1代替localhost</span><br></code></pre></td></tr></table></figure>

<h3 id="3-3-2-范例：CentOS-7-利用RPM包部署-wordpress最新版"><a href="#3-3-2-范例：CentOS-7-利用RPM包部署-wordpress最新版" class="headerlink" title="3.3.2 范例：CentOS 7 利用RPM包部署 wordpress最新版"></a>3.3.2 范例：CentOS 7 利用RPM包部署 wordpress最新版</h3><p>环境：MySQL 5.7 PHP7.4</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装php7的源</span><br><span class="hljs-comment"># yum -y install https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm</span><br><span class="hljs-comment">#安装MySQL的源</span><br><span class="hljs-comment"># yum install -y https://dev.mysql.com/get/mysql80-community-release-el7-7.noarch.rpm</span><br><span class="hljs-comment"># vim /etc/yum.repos.d/mysql-community.repo</span><br>[mysql57-community]<br>name=MySQL 5.7 Community Server<br>baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/7/<span class="hljs-variable">$basearch</span><br>enabled=1 <span class="hljs-comment">#修改为1</span><br>gpgcheck=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql-2022<br>       file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql<br><br>[mysql80-community]<br>name=MySQL 8.0 Community Server<br>baseurl=http://repo.mysql.com/yum/mysql-8.0-community/el/7/<span class="hljs-variable">$basearch</span><br>enabled=0 <span class="hljs-comment">#修改为0</span><br>gpgcheck=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql-2022<br>       file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql<br>......<br><br><span class="hljs-comment">#安装php，mysql</span><br><span class="hljs-comment"># yum install -y httpd php74-php php74-php-mysqlnd mysql-community-server unzip</span><br><span class="hljs-comment"># systemctl enable --now httpd mysqld</span><br><span class="hljs-comment"># mysqladmin -uroot -p&quot;`sed -En &#x27;/temporary password/s/.*: (.*)/\1/p&#x27; /var/log/mysqld.log`&quot; password &quot;Admin123456@&quot;</span><br><br><span class="hljs-comment">#下载WordPress</span><br><span class="hljs-comment"># wget https://cn.wordpress.org/latest-zh_CN.zip</span><br><span class="hljs-comment"># unzip latest-zh_CN.zip</span><br><span class="hljs-comment"># mv wordpress/* /var/www/html/</span><br><span class="hljs-comment"># chown -R apache.apache /var/www/html/</span><br><br><span class="hljs-comment">#数据库创建用户</span><br><span class="hljs-comment"># mysql -uroot -pAdmin123456@</span><br>mysql&gt; create database wordpress;<br>Query OK, 1 row affected (0.00 sec)<br>mysql&gt; grant all on wordpress.* to wordpress@<span class="hljs-string">&#x27;localhost&#x27;</span> identified by <span class="hljs-string">&#x27;Admin123456@&#x27;</span>;<br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br><span class="hljs-comment">#浏览器访问</span><br>http://LAMP服务器<br><span class="hljs-comment">#如果连接数据库失败,可以用127.0.0.1代替localhost</span><br></code></pre></td></tr></table></figure>

<h3 id="3-3-3-范例：CentOS-7-利用RPM包部署-wordpress特定版本"><a href="#3-3-3-范例：CentOS-7-利用RPM包部署-wordpress特定版本" class="headerlink" title="3.3.3 范例：CentOS 7 利用RPM包部署 wordpress特定版本"></a>3.3.3 范例：CentOS 7 利用RPM包部署 wordpress特定版本</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 安装httpd、MySQL和PHP</span><br><span class="hljs-comment"># yum -y install httpd mariadb-server php php-mysql</span><br><span class="hljs-comment"># systemctl enable --now httpd mariadb</span><br><br><span class="hljs-comment">#创建数据库和用户</span><br><span class="hljs-comment"># mysqladmin password 123456</span><br><span class="hljs-comment"># mysql -uroot -p123456</span><br>MariaDB [(none)]&gt; create database wordpress;<br>MariaDB [(none)]&gt; grant all on wordpress.* to wordpress@<span class="hljs-string">&#x27;localhost&#x27;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br><span class="hljs-comment">#下载WordPress</span><br><span class="hljs-comment"># wget https://cn.wordpress.org/wordpress-5.1.1-zh_CN.tar.gz</span><br><span class="hljs-comment"># tar xf wordpress-5.1.1-zh_CN.tar.gz </span><br><span class="hljs-comment"># mv wordpress/* /var/www/html/</span><br><span class="hljs-comment"># chown -R apache.apache /var/www/html/</span><br><br><span class="hljs-comment">#浏览器访问</span><br>http://LAMP服务器<br><span class="hljs-comment">#如果连接数据库失败,可以用127.0.0.1代替localhost</span><br></code></pre></td></tr></table></figure>

<p><strong>安全加固</strong></p>
<p><strong>用浏览器访问<a target="_blank" rel="noopener" href="https://api.wordpress.org/secret-key/1.1/salt/%EF%BC%8C%E6%9B%BF%E4%BB%A3%E4%B8%8B%E9%9D%A2wp-config.php%E5%86%85%E5%AE%B9">https://api.wordpress.org/secret-key/1.1/salt/，替代下面wp-config.php内容</a></strong></p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\lamp\lamp3.png" srcset="/blog/img/loading.gif"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># grep -A 10 since /var/www/html/wp-config.php</span><br>* @since 2.6.0<br> */<br>define( <span class="hljs-string">&#x27;AUTH_KEY&#x27;</span>,         <span class="hljs-string">&#x27;X)/3y/J7*;BaH5LmXN~&amp;y`In*c_!WkE]SU*`bg@(]dX&gt;7_o^lnT4and$6Uaih&amp;&amp;8&#x27;</span> );<br>define( <span class="hljs-string">&#x27;SECURE_AUTH_KEY&#x27;</span>,  <span class="hljs-string">&#x27;&amp;E[UR)Qy&amp;lT3r!3(U8b 5rv&amp;]a1[j^W.EBxD!dIdma= ,i5.#JIM: m.jxbvuSD8&#x27;</span> );<br>define( <span class="hljs-string">&#x27;LOGGED_IN_KEY&#x27;</span>,    <span class="hljs-string">&#x27;7Xr&#125;-`bIvLYr%&#125; 8k8~Gc[L58gkofT7&lt;Ww&amp;IwZQP+c_4r~!SXca#1+?n#`kUq&#125;^z&#x27;</span> );<br>define( <span class="hljs-string">&#x27;NONCE_KEY&#x27;</span>,        <span class="hljs-string">&#x27;&amp;-(0T&amp;=&gt;[(!._E&#123;]%kbb3QdCKi5K2#9A)Lp,X1xf7?--/K~m1*GYnq_;|JeC2^f4&#x27;</span> );<br>define( <span class="hljs-string">&#x27;AUTH_SALT&#x27;</span>,        <span class="hljs-string">&#x27;|&#123;`58aQ%eKw~&gt;GA,BE=McSX[)QX:Lm]g;-uHy&amp;Bm&amp;h8&#125;1W26VN#zpv9H u]8]li&amp;&#x27;</span> );<br>define( <span class="hljs-string">&#x27;SECURE_AUTH_SALT&#x27;</span>, <span class="hljs-string">&#x27;ccN9e&#123;J?fvjMtq1(T&gt;%NZdCe&amp;9Phrxq+l+|)&#123;I-ma&#123;!n!e$&#125;-$s:u&#123;?/c!nEmwKv&#x27;</span> );<br>define( <span class="hljs-string">&#x27;LOGGED_IN_SALT&#x27;</span>,   <span class="hljs-string">&#x27;[:)c&amp;PwYMtJ?TX)x|&amp;&amp;A4bxEEA+a902W?b0=Oah0BgSdK6&gt;TK^zbGLPF~S 89`#o&#x27;</span> );<br>define( <span class="hljs-string">&#x27;NONCE_SALT&#x27;</span>,       <span class="hljs-string">&#x27;,!u&lt;3WjgJ/)@:7Y`AB&lt;NNLlyhOI^kp;mTl0w73$F`S6+xur&gt;H4ogt?9Xp[:a.]gM&#x27;</span> );<br></code></pre></td></tr></table></figure>

<h2 id="3-4-实现-Discuz！应用部署"><a href="#3-4-实现-Discuz！应用部署" class="headerlink" title="3.4 实现 Discuz！应用部署"></a>3.4 实现 Discuz！应用部署</h2><p>官网：<a target="_blank" rel="noopener" href="http://www.discuz.net/">http://www.discuz.net</a></p>
<p>范例：CentOS 8 利用RPM包部署Discuz！</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># dnf -y install httpd php php-xml php-mysqlnd mariadb-server</span><br><span class="hljs-comment"># unzip Discuz_X3.4_SC_UTF8【20191201】.zip</span><br><span class="hljs-comment"># mv upload/ /var/www/html/forum</span><br><span class="hljs-comment"># chown -R apache.apache /var/www/html/forum</span><br><span class="hljs-comment"># mysql</span><br>MariaDB [ultrax]&gt; create database ultrax;<br>MariaDB [ultrax]&gt; grant all on ultrax.* to ultrax@<span class="hljs-string">&#x27;localhost&#x27;</span> identified by <span class="hljs-string">&#x27;magedu&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>范例：CentOS 7 利用RPM包部署Discuz！</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装httpd、php和MySQL</span><br><span class="hljs-comment"># yum install -y httpd php php-mysqlnd mariadb-server unzip</span><br><span class="hljs-comment"># systemctl enable --now httpd mariadb</span><br><br><span class="hljs-comment">#数据库创建用户和数据库</span><br><span class="hljs-comment"># mysqladmin password 123456</span><br>MariaDB [(none)]&gt; create database discuz;<br>MariaDB [(none)]&gt; grant all on discuz.* to discuz@<span class="hljs-string">&#x27;localhost&#x27;</span> identified by <span class="hljs-string">&quot;123456&quot;</span>;<br><br><span class="hljs-comment">#下载源码：</span><br><span class="hljs-comment"># wget http://download.comsenz.com/DiscuzX/3.3/Discuz_X3.3_SC_UTF8.zip</span><br><span class="hljs-comment"># mkdir /var/www/html/forum</span><br><span class="hljs-comment"># unzip Discuz_X3.3_SC_UTF8.zip -d /var/www/html/forum</span><br><span class="hljs-comment"># setfacl -R -m u:apache:rwx /var/www/html/forum</span><br><br><span class="hljs-comment">#浏览器访问：http://LAMP服务器/forum/upload</span><br></code></pre></td></tr></table></figure>

<h2 id="3-5-实现-PowerDNS-应用部署"><a href="#3-5-实现-PowerDNS-应用部署" class="headerlink" title="3.5 实现 PowerDNS 应用部署"></a>3.5 实现 PowerDNS 应用部署</h2><p>PowerDNS 是一个跨平台的开源DNS服务组件，PowerDNS为DNS数据提供纯文本文件或第三方数据库（如MySQL，PostgreSQL，Microsoft SQL Server，Oracle或Sybase）中存储的数据。PowerDNS同时有Windows和Linux/Unix的版本。 PowerDNS在Windows下可以使用 Access的mdb文件记录DNS信<br>息，而在Linux/Unix下则常使用MySQL来记录DNS信息。</p>
<p>Poweradmin 是为 PowerDNS 服务器的提供基于PHP语言实现的 Web 界面的DNS 管理工具。此工具支持 PowerDNS 的主要功能。</p>
<p>PowerDNS官网：<a target="_blank" rel="noopener" href="https://www.powerdns.com/">https://www.powerdns.com/</a></p>
<p>PowerDNS文档：<a target="_blank" rel="noopener" href="https://doc.powerdns.com/">https://doc.powerdns.com/</a></p>
<p>Poweradmin官网：<a target="_blank" rel="noopener" href="http://www.poweradmin.org/">http://www.poweradmin.org/</a></p>
<h3 id="3-5-1-范例：CentOS-8-利用RPM包部署PowerDNS-目前20200311，不支持powerdns，缺少相关php包"><a href="#3-5-1-范例：CentOS-8-利用RPM包部署PowerDNS-目前20200311，不支持powerdns，缺少相关php包" class="headerlink" title="3.5.1 范例：CentOS 8 利用RPM包部署PowerDNS(目前20200311，不支持powerdns，缺少相关php包)"></a>3.5.1 范例：CentOS 8 利用RPM包部署PowerDNS(目前20200311，不支持powerdns，缺少相关php包)</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum install -y pdns pdns-backend-mysql mariadb-server </span><br><span class="hljs-comment"># systemctl start mariadb</span><br><span class="hljs-comment"># mysql &lt; pdns.sql</span><br><span class="hljs-comment"># vim /etc/pdns/pdns.conf</span><br>launch=gmysql<br>gmysql-host=localhost<br>gmysql-port=3306<br>gmysql-dbname=powerdns<br>gmysql-user=powerdns<br>gmysql-password=magedu <br><br><span class="hljs-comment"># grep -Ev &quot;^#|^$&quot; /etc/pdns/pdns.conf</span><br>launch=gmysql  <span class="hljs-comment">#修改此行</span><br>gmysql-host=localhost  <span class="hljs-comment">#以下行是增加</span><br>gmysql-port=3306<br>gmysql-dbname=powerdns<br>gmysql-user=powerdns<br>gmysql-password=magedu<br>setgid=pdns  <span class="hljs-comment">#以下两行不变</span><br>setuid=pdns<br><br><span class="hljs-comment"># systemctl enable --now pdns</span><br><span class="hljs-comment"># ss -ntlpu |grep pdns_server</span><br>udp  UNCONN  0     0         0.0.0.0:53       0.0.0.0:*  users:((<span class="hljs-string">&quot;pdns_server&quot;</span>,pid=3073,fd=9))     <br>udp  UNCONN  0     0          [::]:53        [::]:*  users:((<span class="hljs-string">&quot;pdns_server&quot;</span>,pid=3073,fd=10))    <br>tcp  LISTEN  0     128        0.0.0.0:53       0.0.0.0:*  users:((<span class="hljs-string">&quot;pdns_server&quot;</span>,pid=3073,fd=11))    <br>tcp  LISTEN  0     128         [::]:53        [::]:*  users:((<span class="hljs-string">&quot;pdns_server&quot;</span>,pid=3073,fd=12))                    <br><span class="hljs-comment"># yum -y install httpd php php-devel php-gd php-ldap php-mysqlnd php-odbc php-pear php-xml php-xmlrpc php-mhash gettext</span><br><span class="hljs-comment"># systemctl restart httpd</span><br></code></pre></td></tr></table></figure>

<h3 id="3-5-2-范例：CentOS-7-利用RPM包部署PowerDNS"><a href="#3-5-2-范例：CentOS-7-利用RPM包部署PowerDNS" class="headerlink" title="3.5.2 范例：CentOS 7 利用RPM包部署PowerDNS"></a>3.5.2 范例：CentOS 7 利用RPM包部署PowerDNS</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装pdns、MySQL、PHP和httpd</span><br><span class="hljs-comment"># yum install -y pdns pdns-backend-mysql mariadb-server httpd php php-devel php-gd php-mcrypt php-imap php-ldap php-mysql php-odbc php-pear php-xml php-xmlrpc php-mbstring php-mhash gettext</span><br><br><span class="hljs-comment"># rpm -ql pdns</span><br>/etc/pdns<br>/etc/pdns/pdns.conf<br>/usr/bin/pdns_control<br>/usr/bin/pdns_zone2ldap<br>/usr/bin/pdnsutil<br>/usr/bin/zone2json<br>/usr/bin/zone2sql<br>/usr/lib/systemd/system/pdns.service<br>/usr/lib/systemd/system/pdns@.service<br>/usr/lib64/pdns<br>/usr/lib64/pdns/libbindbackend.so<br>/usr/sbin/pdns_server<br>/usr/share/doc/pdns-4.1.14<br>/usr/share/doc/pdns-4.1.14/README<br>/usr/share/licenses/pdns-4.1.14<br>/usr/share/licenses/pdns-4.1.14/COPYING<br>/usr/share/man/man1/pdns_control.1.gz<br>/usr/share/man/man1/pdns_server.1.gz<br>/usr/share/man/man1/pdns_zone2ldap.1.gz<br>/usr/share/man/man1/pdnsutil.1.gz<br>/usr/share/man/man1/zone2json.1.gz<br>/usr/share/man/man1/zone2sql.1.gz<br><br><span class="hljs-comment"># systemctl enable --now mariadb httpd</span><br><br><span class="hljs-comment"># 准备mariadb中的数据库，表和用户</span><br><span class="hljs-comment"># mysql</span><br>MariaDB [(none)]&gt; CREATE DATABASE powerdns;<br>MariaDB [(none)]&gt; GRANT ALL ON powerdns.* TO <span class="hljs-string">&#x27;powerdns&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br><span class="hljs-comment">#创建powerdns数据库中的表，参看下面文档实现</span><br><span class="hljs-comment"># https://doc.powerdns.com/md/authoritative/backend-generic-mysql/</span><br>use powerdns;<br>CREATE TABLE domains (<br>  id                    INT AUTO_INCREMENT,<br>  name                  VARCHAR(255) NOT NULL,<br>  master                VARCHAR(128) DEFAULT NULL,<br>  last_check            INT DEFAULT NULL,<br>  <span class="hljs-built_in">type</span>                  VARCHAR(6) NOT NULL,<br>  notified_serial       INT DEFAULT NULL,<br>  account               VARCHAR(40) DEFAULT NULL,<br>  PRIMARY KEY (id)<br>) Engine=InnoDB;<br><br>CREATE UNIQUE INDEX name_index ON domains(name);<br><br>CREATE TABLE records (<br>  id                    BIGINT AUTO_INCREMENT,<br>  domain_id             INT DEFAULT NULL,<br>  name                  VARCHAR(255) DEFAULT NULL,<br>  <span class="hljs-built_in">type</span>                  VARCHAR(10) DEFAULT NULL,<br>  content               VARCHAR(64000) DEFAULT NULL,<br>  ttl                   INT DEFAULT NULL,<br>  prio                  INT DEFAULT NULL,<br>  change_date           INT DEFAULT NULL,<br>  disabled              TINYINT(1) DEFAULT 0,<br>  ordername             VARCHAR(255) BINARY DEFAULT NULL,<br>  auth                  TINYINT(1) DEFAULT 1,<br>  PRIMARY KEY (id)<br>) Engine=InnoDB;<br><br>CREATE INDEX nametype_index ON records(name,<span class="hljs-built_in">type</span>);<br>CREATE INDEX domain_id ON records(domain_id);<br>CREATE INDEX recordorder ON records (domain_id, ordername);<br><br>CREATE TABLE supermasters (<br>  ip                    VARCHAR(64) NOT NULL,<br>  nameserver            VARCHAR(255) NOT NULL,<br>  account               VARCHAR(40) NOT NULL,<br>  PRIMARY KEY (ip, nameserver)<br>) Engine=InnoDB;<br><br>CREATE TABLE comments (<br>  id                    INT AUTO_INCREMENT,<br>  domain_id             INT NOT NULL,<br>  name                  VARCHAR(255) NOT NULL,<br>  <span class="hljs-built_in">type</span>                  VARCHAR(10) NOT NULL,<br>  modified_at           INT NOT NULL,<br>  account               VARCHAR(40) NOT NULL,<br>  comment               VARCHAR(64000) NOT NULL,<br>  PRIMARY KEY (id)<br>) Engine=InnoDB;<br><br>CREATE INDEX comments_domain_id_idx ON comments (domain_id);<br>CREATE INDEX comments_name_type_idx ON comments (name, <span class="hljs-built_in">type</span>);<br>CREATE INDEX comments_order_idx ON comments (domain_id, modified_at);<br><br>CREATE TABLE domainmetadata (<br>  id                    INT AUTO_INCREMENT,<br>  domain_id             INT NOT NULL,<br>  kind                  VARCHAR(32),<br>  content               TEXT,<br>  PRIMARY KEY (id)<br>) Engine=InnoDB;<br><br>CREATE INDEX domainmetadata_idx ON domainmetadata (domain_id, kind);<br><br>CREATE TABLE cryptokeys (<br>  id                    INT AUTO_INCREMENT,<br>  domain_id             INT NOT NULL,<br>  flags                 INT NOT NULL,<br>  active                BOOL,<br>  content               TEXT,<br>  PRIMARY KEY(id)<br>) Engine=InnoDB;<br><br>CREATE INDEX domainidindex ON cryptokeys(domain_id);<br><br>CREATE TABLE tsigkeys (<br>  id                    INT AUTO_INCREMENT,<br>  name                  VARCHAR(255),<br>  algorithm             VARCHAR(50),<br>  secret                VARCHAR(255),<br>  PRIMARY KEY (id)<br>) Engine=InnoDB;<br><br>CREATE UNIQUE INDEX namealgoindex ON tsigkeys(name, algorithm);<br><br><span class="hljs-comment">#配置PowerDNS使用mariadb作为后台数据存储</span><br><span class="hljs-comment">#vim /etc/pdns/pdns.conf，查找到包含launch= 的行，修改并添加下面的内容</span><br>launch=gmysql  <span class="hljs-comment">#修改此行</span><br>gmysql-host=localhost <span class="hljs-comment">#以下行是增加的</span><br>gmysql-port=3306<br>gmysql-dbname=powerdns<br>gmysql-user=powerdns<br>gmysql-password=123456<br><br><span class="hljs-comment"># grep -Ev &quot;^#|^$&quot; /etc/pdns/pdns.conf</span><br>launch=gmysql<br>gmysql-host=localhost<br>gmysql-port=3306<br>gmysql-dbname=powerdns<br>gmysql-user=powerdns<br>gmysql-password=123456<br>setgid=pdns<br>setuid=pdns<br><br><span class="hljs-comment">#启动服务</span><br><span class="hljs-comment"># systemctl enable --now pdns</span><br><span class="hljs-comment"># ss -ntlu</span><br>Netid  State      Recv-Q Send-Q           Local Address:Port                          Peer Address:Port              <br>udp    UNCONN     0      0                            *:53                                       *:*                  <br>udp    UNCONN     0      0                         [::]:53                                    [::]:*                  <br>tcp    LISTEN     0      50                           *:3306                                     *:*                  <br>tcp    LISTEN     0      128                          *:53                                       *:*                  <br>tcp    LISTEN     0      128                          *:22                                       *:*                  <br>tcp    LISTEN     0      128                       [::]:80                                    [::]:*                  <br>tcp    LISTEN     0      128                       [::]:53                                    [::]:*                  <br>tcp    LISTEN     0      128                       [::]:22                                    [::]:*<br><br><span class="hljs-comment">#下载poweradmin程序，并解压缩到相应目录</span><br><span class="hljs-comment"># wget http://downloads.sourceforge.net/project/poweradmin/poweradmin-2.1.7.tgz</span><br><span class="hljs-comment"># tar xvf poweradmin-2.1.7.tgz -C /var/www/html</span><br><span class="hljs-comment"># cd /var/www/html</span><br><span class="hljs-comment"># mv poweradmin-2.1.7 poweradmin</span><br></code></pre></td></tr></table></figure>

<p>访问下面地址，启动PowerAdmin的网页安装向导：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://powerdns服务器IP/poweradmin/install/<br></code></pre></td></tr></table></figure>

<p><img src="C:\Users\kinci\Desktop\blog-picture\lamp\lamp4.png" srcset="/blog/img/loading.gif"></p>
<hr>
<p><img src="C:\Users\kinci\Desktop\blog-picture\lamp\lamp5.png" srcset="/blog/img/loading.gif"></p>
<p>提供先前配置的数据库详情，同时为网站的超级管理员admin用户设置密码为<code>123456</code></p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\lamp\lamp6.png" srcset="/blog/img/loading.gif"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">为Poweradmin创建一个受限用户<br><span class="hljs-comment">#说明：</span><br>Username：PowerAdmin用户名<br>Password：上述用户的密码<br>Hostmaster：当创建SOA记录指定默认主机管理员<br>Primary nameserver：主域名服务器<br>Secondary namesever:辅域名服务器<br></code></pre></td></tr></table></figure>

<p><img src="C:\Users\kinci\Desktop\blog-picture\lamp\lamp7.png" srcset="/blog/img/loading.gif"></p>
<p>按照下面页面说明，在数据库中创建用户并授权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">GRANT SELECT, INSERT, UPDATE, DELETE<br>ON powerdns.*<br>TO &#x27;poweradmin&#x27;@&#x27;localhost&#x27;<br>IDENTIFIED BY &#x27;123456&#x27;;<br></code></pre></td></tr></table></figure>

<p>按下面页面说明，创建config.in.php文件内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /var/www/html/poweradmin/inc/config.inc.php<br>&lt;?php<br><br><span class="hljs-variable">$db_host</span>		= <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$db_user</span>		= <span class="hljs-string">&#x27;poweradmin&#x27;</span>;<br><span class="hljs-variable">$db_pass</span>		= <span class="hljs-string">&#x27;123456&#x27;</span>;<br><span class="hljs-variable">$db_name</span>		= <span class="hljs-string">&#x27;powerdns&#x27;</span>;<br><span class="hljs-variable">$db_type</span>		= <span class="hljs-string">&#x27;mysql&#x27;</span>;<br><span class="hljs-variable">$db_layer</span>		= <span class="hljs-string">&#x27;PDO&#x27;</span>;<br><br><span class="hljs-variable">$session_key</span>		= <span class="hljs-string">&#x27;e~^R1Q7H0L%+=qRye0pb~%XWJR0Eos9r&amp;4&#125;F^&amp;cfsfe~vf&#x27;</span>;<br><br><span class="hljs-variable">$iface_lang</span>		= <span class="hljs-string">&#x27;en_EN&#x27;</span>;<br><br><span class="hljs-variable">$dns_hostmaster</span>		= <span class="hljs-string">&#x27;powerdnsserver&#x27;</span>;<br><span class="hljs-variable">$dns_ns1</span>		= <span class="hljs-string">&#x27;10.0.0.17&#x27;</span>;<br><span class="hljs-variable">$dns_ns2</span>		= <span class="hljs-string">&#x27;10.0.0.17&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>安装完毕后</p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\lamp\lamp8.png" srcset="/blog/img/loading.gif"></p>
<p>删除install目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rm -rf /var/www/html/poweradmin/install/<br></code></pre></td></tr></table></figure>

<p>登录 <code>http://powerdns服务器IP/poweradmin/</code><br>username：admin<br>password：123456 参看第step 3</p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\lamp\lamp9.png" srcset="/blog/img/loading.gif"></p>
<p>登录后</p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\lamp\lamp10.png" srcset="/blog/img/loading.gif"></p>
<h1 id="四、php的加速器"><a href="#四、php的加速器" class="headerlink" title="四、php的加速器"></a>四、php的加速器</h1><p>php的加速器：基于PHP的特殊扩展机制如opcode缓存扩展也可以将opcode缓存于php的共享内存中，<br>从而可以让同一段代码的后续重复执行时跳过编译阶段以提高性能。这些加速器并非真正提高了opcode<br>的运行速度，而仅是通过分析opcode后并将它们重新排列以达到快速执行的目的</p>
<h2 id="4-1-常见的php加速器"><a href="#4-1-常见的php加速器" class="headerlink" title="4.1 常见的php加速器"></a>4.1 常见的php加速器</h2><ul>
<li><p>APC (Alternative PHP Cache)<br>遵循PHP License的开源框架，PHP opcode缓存加速器，目前的版本不适用于PHP 5.4<br>项目地址：<a target="_blank" rel="noopener" href="http://pecl.php.net/package/APC">http://pecl.php.net/package/APC</a></p>
</li>
<li><p>eAccelerator<br>源于Turck MMCache，早期的版本包含了一个PHP encoder和PHP loader，目前encoder已经不<br>在支持。项目地址 ：<a target="_blank" rel="noopener" href="http://eaccelerator.net/">http://eaccelerator.net/</a></p>
</li>
<li><p>XCache<br>快速而且稳定的PHP opcode缓存，经过严格测试且被大量用于生产环境。项目地址：<a target="_blank" rel="noopener" href="http://xcache.lighttpd.net/,%E6%94%B6%E5%BD%95EPEL%E6%BA%90">http://xcache.lighttpd.net/,收录EPEL源</a></p>
</li>
<li><p>Zend Optimizer和Zend Guard Loader<br>Zend Optimizer并非一个opcode加速器，它是由Zend Technologies为PHP5.2及以前的版本提供的一个免费、闭源的PHP扩展，其能够运行由Zend Guard生成的加密的PHP代码或模糊代码。 而Zend Guard Loader则是专为PHP5.3提供的类似于Zend Optimizer功能的扩展。项目地址<a target="_blank" rel="noopener" href="http://www.zend.com/en/products/guard/runtime-decoders">http://www.zend.com/en/products/guard/runtime-decoders</a></p>
</li>
<li><p>NuSphere PhpExpress<br>NuSphere的一款开源PHP加速器，它支持装载通过NuSphere PHP Encoder编码的PHP程序文件，并能够实现对常规PHP文件的执行加速。项目地址，<a target="_blank" rel="noopener" href="http://www.nusphere.com/products/phpexpress.htm">http://www.nusphere.com/products/phpexpress.htm</a></p>
</li>
<li><p>OPcache<br>OPcache 通过将 PHP 脚本预编译的字节码存储到共享内存中来提升 PHP 的性能， 存储预编译字节码的好处就是 省去了每次加载和解析 PHP 脚本的开销。PHP 5.5.0 及后续版本中已经绑定了OPcache 扩展。 对于 PHP 5.2，5.3 和 5.4 版本可以使用 » PECL 扩展中的 OPcache 库。<br>需要注意: 如果开启opcache,并使用软链接,会导致更新php的源代码但不更新中间码的缓存,导致更新失败,需要重新启动服务php-fpm<br>官网说明: <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/intro.opcache.php">https://www.php.net/manual/zh/intro.opcache.php</a></p>
</li>
</ul>
<h2 id="4-2-实现-xcache-加速-php-5-X"><a href="#4-2-实现-xcache-加速-php-5-X" class="headerlink" title="4.2 实现 xcache 加速 php 5.X"></a>4.2 实现 xcache 加速 php 5.X</h2><p>编译php-xcache加速访问，支持php 5.6版以下</p>
<p>官网：<a target="_blank" rel="noopener" href="http://xcache.lighttpd.net/wiki/ReleaseArchive">http://xcache.lighttpd.net/wiki/ReleaseArchive</a></p>
<p>案例：CentOS 7上安装清华源的php56，并编译安装 xcache加速</p>
<p><strong>安装httpd、php5.6和MySQL</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum install -y https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm</span><br><span class="hljs-comment"># yum install -y php56-php php56-php-mysqlnd mariadb-server</span><br><span class="hljs-comment"># systemctl enable --now httpd mariadb</span><br>Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.<br>Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service to /usr/lib/systemd/system/mariadb.service.<br></code></pre></td></tr></table></figure>

<p><strong>MySQL创建用户和数据库</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> mysql</span><br>MariaDB [(none)]&gt; create database wordpress;<br>Query OK, 1 row affected (0.00 sec)<br><br>MariaDB [(none)]&gt; grant all on wordpress.* to wordpress@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;<br>Query OK, 0 rows affected (0.00 sec)<br></code></pre></td></tr></table></figure>

<p><strong>部署wordpress</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> wget https://cn.wordpress.org/wordpress-5.3.2-zh_CN.tar.gz</span><br><span class="hljs-meta">#</span><span class="bash"> tar xvf wordpress-5.3.2-zh_CN.tar.gz -C /var/www/html</span><br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">cd</span> /var/www/html</span><br><span class="hljs-meta">#</span><span class="bash"> chown -R apache.apache wordpress/</span><br></code></pre></td></tr></table></figure>

<p><strong>测试httpd</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ab -c 10 -n 100 http://10.0.0.17/wordpress/</span><br>......<br>Requests per second:    322.19 [<span class="hljs-comment">#/sec] (mean)</span><br>......<br></code></pre></td></tr></table></figure>

<p><strong>安装编译xcache</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> yum -y install gcc php56-php-devel</span><br><span class="hljs-meta">#</span><span class="bash">下载并解压缩xcache-3.2.0.tar.bz2</span><br><span class="hljs-meta">#</span><span class="bash"> wget https://github.com/lighttpd/xcache/archive/refs/tags/3.2.0.tar.gz</span><br><span class="hljs-meta">#</span><span class="bash"> tar xf 3.2.0.tar.gz</span><br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">cd</span> xcache-3.2.0/</span><br><span class="hljs-meta">#</span><span class="bash">生成编译环境</span><br><span class="hljs-meta">#</span><span class="bash"> /opt/remi/php56/root/usr/bin/phpize</span><br>Configuring for:<br>PHP Api Version:         20131106<br>Zend Module Api No:      20131226<br>Zend Extension Api No:   220131226<br><span class="hljs-meta">#</span><span class="bash"> ./configure --enable-xcache --with-php-config=/opt/remi/php56/root/usr/bin/php-config</span><br><span class="hljs-meta">#</span><span class="bash"> make -j `lscpu | grep <span class="hljs-string">&quot;CPU(s):&quot;</span> | tr -s <span class="hljs-string">&#x27; &#x27;</span> | cut -d <span class="hljs-string">&#x27;:&#x27;</span> -f2 | head -n1` &amp;&amp; make install</span><br>...省略...<br>Installing shared extensions:   /opt/remi/php56/root/usr/lib64/php/modules/<br><span class="hljs-meta">#</span><span class="bash"> cat xcache.ini &gt;&gt; /opt/remi/php56/root/etc/php.ini</span><br><span class="hljs-meta">#</span><span class="bash">安装base源中执行即可cp xcache.ini /etc/php.d/</span><br><span class="hljs-meta">#</span><span class="bash"> systemctl restart httpd.service</span><br></code></pre></td></tr></table></figure>

<p><strong>再次测试</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment"># ab -c 10 -n 100 http://10.0.0.17/wordpress/</span><br>Requests per second:    2306.96 [<span class="hljs-comment">#/sec] (mean)</span><br></code></pre></td></tr></table></figure>

<h2 id="4-3-实现-opcache-加速-php-7-X"><a href="#4-3-实现-opcache-加速-php-7-X" class="headerlink" title="4.3 实现 opcache 加速 php 7.X"></a>4.3 实现 opcache 加速 php 7.X</h2><h3 id="4-3-1-范例：CentOS-8-实现-opache-加速"><a href="#4-3-1-范例：CentOS-8-实现-opache-加速" class="headerlink" title="4.3.1 范例：CentOS 8 实现 opache 加速"></a>4.3.1 范例：CentOS 8 实现 opache 加速</h3><p><strong>安装httpd、MySQL和PHP</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># dnf -y install httpd php php-mysqlnd mariadb-server php-opcache php-json</span><br><br><span class="hljs-comment"># rpm -ql php-opcache</span><br>/etc/php.d/10-opcache.ini<br>/etc/php.d/opcache-default.blacklist<br>/usr/lib/.build-id<br>/usr/lib/.build-id/71<br>/usr/lib/.build-id/71/55ebb00f7ebcab9d708c1d5c7b7e634cce259c<br>/usr/lib64/php/modules/opcache.so<br><br><span class="hljs-comment"># grep opcache /etc/php.d/10-opcache.ini</span><br>zend_extension=opcache<br>opcache.enable=1<br>...省略...<br></code></pre></td></tr></table></figure>

<p><strong>修改配置文件，禁用opchache</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#加速前,默认启用,先禁用加速</span><br><span class="hljs-comment"># vim /etc/php.d/10-opcache.ini</span><br>opcache.enable=0<br><span class="hljs-comment"># systemctl restart php-fpm</span><br></code></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ab -c 10 -n 100 http://10.0.0.8/wordpress/</span><br>......<br>Requests per second:   4.31 [<span class="hljs-comment">#/sec] (mean)</span><br>......<br></code></pre></td></tr></table></figure>

<p><strong>启用加速</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/php.d/10-opcache.ini</span><br>opcache.enable=1<br><span class="hljs-comment"># systemctl restart php-fpm</span><br></code></pre></td></tr></table></figure>

<p><strong>再次测试</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ab -c 10 -n 100 http://10.0.0.8/wordpress/</span><br>......<br>Requests per second:   19.76 [<span class="hljs-comment">#/sec] (mean)</span><br>......<br></code></pre></td></tr></table></figure>

<h3 id="4-3-2-范例：CentOS-7-实现-opache-加速"><a href="#4-3-2-范例：CentOS-7-实现-opache-加速" class="headerlink" title="4.3.2 范例：CentOS 7 实现 opache 加速"></a>4.3.2 范例：CentOS 7 实现 opache 加速</h3><p><strong>php环境使用php74</strong></p>
<p><strong>安装httpd、php7.4和MySQL</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">安装php7的源</span><br><span class="hljs-meta">#</span><span class="bash"> yum -y install https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm</span><br><span class="hljs-meta">#</span><span class="bash">安装MySQL的源</span><br><span class="hljs-meta">#</span><span class="bash"> yum install -y https://dev.mysql.com/get/mysql80-community-release-el7-7.noarch.rpm</span><br><span class="hljs-meta">#</span><span class="bash"> vim /etc/yum.repos.d/mysql-community.repo</span><br>[mysql57-community]<br>name=MySQL 5.7 Community Server<br>baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch<br>enabled=1 #修改为1<br>gpgcheck=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql-2022<br>       file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql<br><br>[mysql80-community]<br>name=MySQL 8.0 Community Server<br>baseurl=http://repo.mysql.com/yum/mysql-8.0-community/el/7/$basearch<br>enabled=0 #修改为0<br>gpgcheck=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql-2022<br>       file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql<br>......<br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> yum -y install httpd php74-php php74-php-mysqlnd mysql-community-server unzip php74-php-opcache php74-php-json</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> grep opcache /etc/opt/remi/php74/php.d/10-opcache.ini</span><br>zend_extension=opcache<br>opcache.enable=1<br>...省略...<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> systemctl <span class="hljs-built_in">enable</span> --now httpd mysqld</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 数据库添加管理员密码</span><br><span class="hljs-meta">#</span><span class="bash"> mysqladmin -uroot -p<span class="hljs-string">&quot;`sed -En &#x27;/temporary password/s/.*: (.*)/\1/p&#x27; /var/log/mysqld.log`&quot;</span> password <span class="hljs-string">&quot;Admin123456@&quot;</span></span><br></code></pre></td></tr></table></figure>

<p><strong>MySQL创建用户和数据库</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> mysql -uroot -pAdmin123456@</span><br><span class="hljs-meta">mysql&gt;</span><span class="bash"> create database wordpress;</span><br>Query OK, 1 row affected (0.00 sec)<br><span class="hljs-meta"></span><br><span class="hljs-meta">mysql&gt;</span><span class="bash"> grant all on wordpress.* to wordpress@<span class="hljs-string">&#x27;localhost&#x27;</span> identified by <span class="hljs-string">&#x27;Admin123456@&#x27;</span>;</span><br>Query OK, 0 rows affected (0.00 sec)<br></code></pre></td></tr></table></figure>

<p><strong>部署wordpress</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># wget https://cn.wordpress.org/latest-zh_CN.zip</span><br><span class="hljs-comment"># unzip latest-zh_CN.zip</span><br><span class="hljs-comment"># mv wordpress /var/www/html/</span><br><span class="hljs-comment"># chown -R apache.apache /var/www/html/</span><br></code></pre></td></tr></table></figure>

<p><strong>修改配置文件，禁用opchache</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> vim /etc/opt/remi/php74/php.d/10-opcache.ini</span><br>opcache.enable=0<br><span class="hljs-meta">#</span><span class="bash"> systemctl restart httpd</span><br></code></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ab -c 10 -n 100 http://10.0.0.17/wordpress/</span><br>......<br>Requests per second:    9.67 [<span class="hljs-comment">#/sec] (mean)</span><br>......<br></code></pre></td></tr></table></figure>

<p><strong>修改配置文件，启用opchache</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/opt/remi/php74/php.d/10-opcache.ini</span><br>opcache.enable=1<br><span class="hljs-comment"># systemctl restart httpd</span><br></code></pre></td></tr></table></figure>

<p><strong>再次测试</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ab -c 10 -n 100 http://10.0.0.17/wordpress/</span><br>......<br>Requests per second:    30.11 [<span class="hljs-comment">#/sec] (mean)</span><br>......<br></code></pre></td></tr></table></figure>



<h1 id="五、php-fpm-模式实现LAMP"><a href="#五、php-fpm-模式实现LAMP" class="headerlink" title="五、php-fpm 模式实现LAMP"></a>五、php-fpm 模式实现LAMP</h1><h2 id="5-1-实现php-fpm-PHP-FastCGI-Process-Manager-模式"><a href="#5-1-实现php-fpm-PHP-FastCGI-Process-Manager-模式" class="headerlink" title="5.1 实现php-fpm(PHP FastCGI Process Manager)模式"></a>5.1 实现php-fpm(PHP FastCGI Process Manager)模式</h2><p>对于php请求，httpd可以用模块和fastcgi两种方式实现动态程序的支持。</p>
<p>fastcgi模式：php处理请求，不再由http服务器自身进行管理，http服务器把http协议转化为factcgi协议，通过socket发送给fastcgi专用进程处理php程序。</p>
<p>从稳定性上看,fastcgi是以独立的进程池运行来程序，如果单独一个进程死掉,系统可以很轻易的丢弃,然后重新分配新的进程来运行。从安全性上看,fastcgi和http的server完全独立, fastcgi怎么down也不会把server搞垮。</p>
<p>从性能上看,fastcgi把动态逻辑的处理从http server中分离出来,大负荷的IO处理还是留给宿主server，这样httpd server可以一心一意作IO,对于一个普通的动态网页来说,逻辑处理可能只有一小部分,大量的图片等静态IO处理完全不需要逻辑程序的参与。从扩展性上讲,fastcgi是一个中立的技术标准,完全可以支持任何语言写的处理程序，如php,java,python等。而php-fpm就是用来支持php的fastcgi服务器。</p>
<p>php-fpm 需要 <code>mod_proxy_fcgi</code> 模块的支持。</p>
<p>官方文档:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://httpd.apache.org/docs/2.4/mod/mod_proxy_fcgi.html<br></code></pre></td></tr></table></figure>

<p><strong>各种OS版本对fastcgi的支持</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">CentOS 8: 默认使用fpm模式<br>httpd-2.4：默认rpm包支持fcgi模块<br>php包默认使用fpm模式<br>php-fpm包：专用于将php运行于fpm模式<br> <br>CentOS 7：<br>httpd-2.4：默认rpm包支持fcgi模块<br>php-fpm包：专用于将php运行于fpm模式<br><br>CentOS 6：<br>PHP-5.3.2之前：默认不支持fpm机制；需要自行打补丁并编译安装<br>httpd-2.2：默认不支持fcgi协议，需要自行编译此模块<br>解决方案：编译安装httpd-2.4, php-5.3.3+<br></code></pre></td></tr></table></figure>

<h2 id="5-2-安装php-fpm"><a href="#5-2-安装php-fpm" class="headerlink" title="5.2 安装php-fpm"></a>5.2 安装php-fpm</h2><h3 id="5-2-1-CentOS-8-安装-php-fpm"><a href="#5-2-1-CentOS-8-安装-php-fpm" class="headerlink" title="5.2.1 CentOS 8 安装 php-fpm"></a>5.2.1 CentOS 8 安装 php-fpm</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># dnf -y install php-fpm</span><br><span class="hljs-comment">#或者</span><br><span class="hljs-comment"># dnf -y install php</span><br></code></pre></td></tr></table></figure>

<h3 id="5-2-2-CentOS-7-BASE源安装php-fpm"><a href="#5-2-2-CentOS-7-BASE源安装php-fpm" class="headerlink" title="5.2.2 CentOS 7 BASE源安装php-fpm"></a>5.2.2 CentOS 7 BASE源安装php-fpm</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> yum install -y php-fpm</span><br></code></pre></td></tr></table></figure>

<h3 id="5-2-3-CentOS-7-清华大学yum源安装较新版的PHP-FPM（依赖EPEL源）"><a href="#5-2-3-CentOS-7-清华大学yum源安装较新版的PHP-FPM（依赖EPEL源）" class="headerlink" title="5.2.3 CentOS 7 清华大学yum源安装较新版的PHP-FPM（依赖EPEL源）"></a>5.2.3 CentOS 7 清华大学yum源安装较新版的PHP-FPM（依赖EPEL源）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#配置yum源</span><br><span class="hljs-comment"># yum install -y https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm</span><br><br><span class="hljs-comment">#安装php-fpm5.6版</span><br><span class="hljs-comment"># yum install -y php56-php-fpm php56-php-mysql</span><br><br><span class="hljs-comment">#安装php-fpm7.4版  </span><br><span class="hljs-comment"># yum install -y php74-php-fpm php74-php-mysqlnd php74-php-opcache php74-php-json</span><br></code></pre></td></tr></table></figure>

<h2 id="5-3-配置-php-fpm"><a href="#5-3-配置-php-fpm" class="headerlink" title="5.3 配置 php-fpm"></a>5.3 配置 php-fpm</h2><p>查看php-fpm所对应的配置文件</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs http"># rpm -ql php-fpm<br>/usr/lib/systemd/system/php-fpm.service<br>/etc/logrotate.d/php-fpm<br>/etc/php-fpm.conf<br>/etc/php-fpm.d<br>/etc/php-fpm.d/www.conf<br>/etc/sysconfig/php-fpm<br>/run/php-fpm<br></code></pre></td></tr></table></figure>

<p><strong>php-fpm 主要配置文件：</strong></p>
<ul>
<li>/etc/php-fpm.conf</li>
<li>/etc/php-fpm.d/*.conf</li>
</ul>
<p><strong>官方文档：</strong><br><a target="_blank" rel="noopener" href="http://php.net/manual/zh/install.fpm.configuration.php">http://php.net/manual/zh/install.fpm.configuration.php</a></p>
<p><strong>PHP-FPM常见配置</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">daemonize = no  #是否将程序运行在后台<br>listen = 127.0.0.1:9000 #FPM 监听地址<br>listen = /var/run/php.sock #UDF模式使用,指定生成的unix socket文件的路径<br>    #注意:Unix Domain Socket (UDS) support added in httpd-2.4.7<br>    #http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypass<br>listen.owner = apache  #UDF模式使用,指定生成的unix socket文件的所有者<br>listen.group = apache  #UDF模式使用,指定生成的unix socket文件的所属组<br>listen.mode= 0666   #UDF模式使用，,指定生成的unix socket文件的权限<br>listen.acl_users = apache,nginx #指定用户访问unix socket文件，listen.owner 和 listen.group将无效<br>listen.backlog = -1 #等待队列的长度 -1表示无限制<br>listen.allowed_clients = 127.0.0.1 #仅允许哪些WEB主机访问<br>pm = dynamic|static  #static 固定数量的子进程，dynamic子进程数据以动态模式管理<br>pm.max_childen=500 #静态方式下开启的php-fpm进程数量，在动态方式下限定php-fpm的最大进程数<br>pm.start_servers=100 #动态模式下初始进程数，必须大于等于pm.min_spare_servers和小于等于pm.max_children的值<br>pm.min_spare_servers=100 #最小空闲进程数<br>pm.max_spare_servers=200 #最大空闲进程数<br>pm.max_requests = 500000 #进程累计请求回收值，会重新生成进程<br>pm.status_path = /pm_status #状态访问URL<br>ping.path = /ping #ping访问活动地址<br>ping.response = pong #ping返回值<br>php_value[session.save_handler] = files       #以文件存放session,也可以支持redis等<br>php_value[session.save_path] = /var/lib/php/session  #设置session存放位置<br>access.log log/access.log   #访问日志<br>access.format  &quot;%R - %u %t \&quot;%m %r\&quot; %s&quot;    #访问日志格式<br>error_log  log/php-fpm.log      #错误日志<br>request_slowlog_timeout mixed  #当一个请求该设置的超时时间后，就会将对应的 PHP 调用堆栈信息完整写入到慢日志中。设置为 &#x27;0&#x27; 表示 &#x27;Off&#x27;。可用单位：s（秒），m（分），h（小时）或者d（天）。默认单位：s（秒）。默认值：0（关闭）<br>slowlog log/php-fpm.log.slow  #慢请求的记录日志<br></code></pre></td></tr></table></figure>

<p><strong>session目录</strong></p>
<p>确保运行php-fpm进程的用户对session目录有读写权限。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># mkdir /var/lib/php/session</span><br><span class="hljs-comment"># chown apache.apache /var/lib/php/session</span><br></code></pre></td></tr></table></figure>

<p><strong>启动PHP-FPM</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># systemctl start php-fpm</span><br></code></pre></td></tr></table></figure>

<p><strong>启用php-fpm的访问日志</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/php-fpm.d/www.conf</span><br>access.log = /var/<span class="hljs-built_in">log</span>/php-fpm/access.log<br><span class="hljs-comment"># systemctl restart php-fpm</span><br></code></pre></td></tr></table></figure>

<p><strong>范例：php-fpm配置生产案例</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">cat  /etc/php-fpm.d/www.conf<br>[www]<br>listen = 127.0.0.1:9000  <span class="hljs-comment">#监听地址及IP</span><br>listen.allowed_clients = 127.0.0.1 <span class="hljs-comment">#允许客户端从哪个源IP地址访问，要允许所有行首加 ;注释即可</span><br>user = apache <span class="hljs-comment">#php-fpm启动的用户和组，会涉及到后期文件的权限问题</span><br>group = apache<br>pm = dynamic <span class="hljs-comment">#动态模式进程管理</span><br>pm.max_children = 500 <span class="hljs-comment">#静态方式下开启的php-fpm进程数量，在动态方式下限定php-fpm的最大进程数</span><br>pm.start_servers = 100 <span class="hljs-comment">#动态模式下初始进程数，必须大于等于pm.min_spare_servers和小于等于pm.max_children的值。</span><br>pm.min_spare_servers = 100 <span class="hljs-comment">#最小空闲进程数</span><br>pm.max_spare_servers = 200 <span class="hljs-comment">#最大空闲进程数</span><br>pm.max_requests = 500000 <span class="hljs-comment">#进程累计请求回收值，会重启</span><br>pm.status_path = /fpm_status <span class="hljs-comment">#状态访问URL</span><br>ping.path = /ping <span class="hljs-comment">#ping访问动地址</span><br>ping.response = ping-pong <span class="hljs-comment">#ping返回值</span><br>slowlog = /var/<span class="hljs-built_in">log</span>/php-fpm/www-slow.log <span class="hljs-comment">#慢日志路径</span><br>php_admin_value[error_log] = /var/<span class="hljs-built_in">log</span>/php-fpm/www-error.log <span class="hljs-comment">#错误日志</span><br>php_admin_flag[log_errors] = on<br>php_value[session.save_handler] = files <span class="hljs-comment">#phpsession保存方式及路径</span><br>php_value[session.save_path] = /var/lib/php/session <span class="hljs-comment">#使用file保存session的文件路径</span><br></code></pre></td></tr></table></figure>

<h2 id="5-4-配置httpd-支持-fastcgi"><a href="#5-4-配置httpd-支持-fastcgi" class="headerlink" title="5.4 配置httpd 支持 fastcgi"></a>5.4 配置httpd 支持 fastcgi</h2><p>注意：在HTTPD服务器上必须启用proxy_fcgi_module模块，才能充当php-fpm客户端</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># dnf -y install httpd php-fpm</span><br><span class="hljs-comment"># httpd -M |grep fcgi</span><br>AH00558: httpd: Could not reliably determine the server<span class="hljs-string">&#x27;s fully qualified domain</span><br><span class="hljs-string">name, using centos8.localdomain. Set the &#x27;</span>ServerName<span class="hljs-string">&#x27; directive globally to</span><br><span class="hljs-string">suppress this message</span><br><span class="hljs-string">proxy_fcgi_module (shared)</span><br><span class="hljs-string"></span><br><span class="hljs-string"># cat /etc/httpd/conf.modules.d/00-proxy.conf</span><br><span class="hljs-string"># This file configures all the proxy modules:</span><br><span class="hljs-string">LoadModule proxy_module modules/mod_proxy.so</span><br><span class="hljs-string">LoadModule lbmethod_bybusyness_module modules/mod_lbmethod_bybusyness.so</span><br><span class="hljs-string">LoadModule lbmethod_byrequests_module modules/mod_lbmethod_byrequests.so</span><br><span class="hljs-string">LoadModule lbmethod_bytraffic_module modules/mod_lbmethod_bytraffic.so</span><br><span class="hljs-string">LoadModule lbmethod_heartbeat_module modules/mod_lbmethod_heartbeat.so</span><br><span class="hljs-string">LoadModule proxy_ajp_module modules/mod_proxy_ajp.so</span><br><span class="hljs-string">LoadModule proxy_balancer_module modules/mod_proxy_balancer.so</span><br><span class="hljs-string">LoadModule proxy_connect_module modules/mod_proxy_connect.so</span><br><span class="hljs-string">LoadModule proxy_express_module modules/mod_proxy_express.so</span><br><span class="hljs-string">LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so</span><br><span class="hljs-string">LoadModule proxy_fdpass_module modules/mod_proxy_fdpass.so</span><br><span class="hljs-string">LoadModule proxy_ftp_module modules/mod_proxy_ftp.so</span><br><span class="hljs-string">LoadModule proxy_http_module modules/mod_proxy_http.so</span><br><span class="hljs-string">LoadModule proxy_hcheck_module modules/mod_proxy_hcheck.so</span><br><span class="hljs-string">LoadModule proxy_scgi_module modules/mod_proxy_scgi.so</span><br><span class="hljs-string">LoadModule proxy_uwsgi_module modules/mod_proxy_uwsgi.so</span><br><span class="hljs-string">LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so</span><br></code></pre></td></tr></table></figure>

<p>创建httpd的配置文件 /etc/httpd/conf.d/fcgi.conf ，内容如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#centos8默认支持fastcgi模块,安装php-fpm包时,会自动生成/etc/httpd/conf.d/php.conf文件实现支持UDS</span><br><span class="hljs-comment">#如果想实现支持端口的fastcgi,可以创建/etc/httpd/conf.d/fcgi.conf,注意: 需要删除上面的php.conf文件</span><br>DirectoryIndex index.php<br>ProxyRequests Off<br>ProxyPassMatch ^/(.*\.php)$ fcgi://php-fpm服务器IP:9000/var/www/html/<span class="hljs-variable">$1</span><br>ProxyPassMatch ^/(fpm_status|ping) fcgi://127.0.0.1:9000<br><span class="hljs-comment">#以上开启FCGI反向代理,“^/”此处的”/“相对于后面的/var/www/html而言，后面的$1是指前面的/(.*.php)</span><br><br><span class="hljs-comment">#如果php-fpm和httpd在同一台主机，也可以用 UDS（unix domain socket）方式</span><br><span class="hljs-comment">#参看：http://httpd.apache.org/docs/2.4/mod/mod_proxy_fcgi.html</span><br>ProxyPassMatch ^/(.*\.php)$<br>unix:/var/run/php.sock|fcgi://localhost/apps/httpd/htdocs/<span class="hljs-variable">$1</span><br></code></pre></td></tr></table></figure>

<h3 id="5-4-1-实战案例：虚拟主机配置支持FCGI"><a href="#5-4-1-实战案例：虚拟主机配置支持FCGI" class="headerlink" title="5.4.1 实战案例：虚拟主机配置支持FCGI"></a>5.4.1 实战案例：虚拟主机配置支持FCGI</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/httpd/conf.d/vhosts.conf</span><br>DirectoryIndex index.php<br>&lt;VirtualHost *:80&gt;<br>ServerName www.rlin.com<br>DocumentRoot /data/html/vhosts<br>ProxyRequests Off<br>ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/data/html/vhosts/<span class="hljs-variable">$1</span><br>ProxyPassMatch ^/(fpm_status|ping) fcgi://127.0.0.1:9000<br>&lt;Directory <span class="hljs-string">&quot;/data/html/vhosts&quot;</span>&gt;<br>Options None<br>AllowOverride None<br>Require all granted<br>&lt;/Directory&gt;<br>&lt;/VirtualHost&gt;<br></code></pre></td></tr></table></figure>

<h3 id="5-4-2-实战案例：CentOS-7-利用yum-Base源安装基于PHP-FPM模式的LAMP"><a href="#5-4-2-实战案例：CentOS-7-利用yum-Base源安装基于PHP-FPM模式的LAMP" class="headerlink" title="5.4.2 实战案例：CentOS 7 利用yum Base源安装基于PHP-FPM模式的LAMP"></a>5.4.2 实战案例：CentOS 7 利用yum Base源安装基于PHP-FPM模式的LAMP</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装httpd和php-fpm包</span><br><span class="hljs-comment"># yum install -y httpd php-fpm</span><br><br><span class="hljs-comment">#查看Httpd mod_fcgi模块是否加载</span><br><span class="hljs-comment"># httpd -M | grep fcgi</span><br>proxy_fcgi_module (shared)<br><br><span class="hljs-comment">#添加FCGI的配置文件</span><br><span class="hljs-comment"># vim /etc/httpd/conf.d/fcgi.conf</span><br>DirectoryIndex index.php<br>ProxyRequests off //是否开启正向代理<br>ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/var/www/html/<span class="hljs-variable">$1</span> <br>ProxyPassMatch ^/(fpm_status|ping) fcgi://127.0.0.1:9000<br><br><span class="hljs-comment"># systemctl enable --now httpd php-fpm</span><br></code></pre></td></tr></table></figure>

<h3 id="5-4-3-实战案例：CentOS-7-利用清华yum源实现PHP-FPM的UDS模式"><a href="#5-4-3-实战案例：CentOS-7-利用清华yum源实现PHP-FPM的UDS模式" class="headerlink" title="5.4.3 实战案例：CentOS 7 利用清华yum源实现PHP-FPM的UDS模式"></a>5.4.3 实战案例：CentOS 7 利用清华yum源实现PHP-FPM的UDS模式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> yum install -y https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm</span><br><span class="hljs-meta">#</span><span class="bash"> yum install -y httpd php74-php-fpm</span> <br><span class="hljs-meta">#</span><span class="bash"> vim /etc/opt/remi/php74/php-fpm.d/www.conf</span><br>listen = /var/run/php.sock<br>listen.owner = apache<br>listen.group = apache<br>listen.mode = 0660<br>pm.status_path = /fpm_status<br>ping.path = /ping<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> vim /etc/httpd/conf.d/fcgi.conf</span><br>DirectoryIndex index.php<br>ProxyRequests Off<br><span class="hljs-meta">#</span><span class="bash">ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/data/html/<span class="hljs-variable">$1</span></span><br><span class="hljs-meta">#</span><span class="bash">ProxyPassMatch ^/(fpm_status|ping)fcgi://127.0.0.1:9000</span><br>ProxyPassMatch ^/(.*\.php)$ unix:/var/run/php.sock|fcgi://localhost/var/www/html/$1<br>ProxyPassMatch ^/(fpm_status|ping) unix:/var/run/php.sock|fcgi://localhost <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> systemctl <span class="hljs-built_in">enable</span> --now httpd php74-php-fpm.service</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">测试</span><br><span class="hljs-meta">#</span><span class="bash"> curl http://127.0.0.1/ping</span><br>pong<br><span class="hljs-meta">#</span><span class="bash"> curl http://127.0.0.1/fpm_status</span><br>pool:                 www<br>process manager:      dynamic<br>start time:           09/Nov/2022:16:00:59 +0800<br>start since:          81<br>accepted conn:        2<br>listen queue:         0<br>max listen queue:     0<br>listen queue len:     0<br>idle processes:       4<br>active processes:     1<br>total processes:      5<br>max active processes: 1<br>max children reached: 0<br>slow requests:        0<br></code></pre></td></tr></table></figure>

<h3 id="5-4-4-实战案例：CentOS-8上实现基于UDS的PHP-FPM状态页"><a href="#5-4-4-实战案例：CentOS-8上实现基于UDS的PHP-FPM状态页" class="headerlink" title="5.4.4 实战案例：CentOS 8上实现基于UDS的PHP-FPM状态页"></a>5.4.4 实战案例：CentOS 8上实现基于UDS的PHP-FPM状态页</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#CentOS8默认为UDS模式</span><br><span class="hljs-comment"># dnf -y install httpd php-fpm</span><br><br><span class="hljs-comment"># vim /etc/php-fpm.d/www.conf</span><br>pm.status_path = /fpm_status<br>ping.path = /ping <br><br><span class="hljs-comment"># vim /etc/httpd/conf.d/php.conf</span><br><span class="hljs-comment">#增加#######之间内容</span><br>&lt;IfModule !mod_php5.c&gt;<br>&lt;IfModule !mod_php7.c&gt;<br>  <span class="hljs-comment"># Enable http authorization headers</span><br> SetEnvIfNoCase ^Authorization$ <span class="hljs-string">&quot;(.+)&quot;</span> HTTP_AUTHORIZATION=<span class="hljs-variable">$1</span><br> &lt;FilesMatch \.(php|phar)$&gt;<br>   SetHandler <span class="hljs-string">&quot;proxy:unix:/run/php-fpm/www.sock|fcgi://localhost&quot;</span><br> &lt;/FilesMatch&gt;<br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">####</span><br> &lt;Locationmatch /(fpm_status|ping) &gt;<br>   SetHandler <span class="hljs-string">&quot;proxy:unix:/run/php-fpm/www.sock|fcgi://localhost&quot;</span><br> &lt;/locationmatch&gt;<br><span class="hljs-comment">################################################################################</span><br><span class="hljs-comment">####</span><br>&lt;/IfModule&gt;<br>&lt;/IfModule&gt;<br></code></pre></td></tr></table></figure>

<h3 id="5-4-5-实战案例：CentOS-8上实现基于9000端口的PHP-FPM"><a href="#5-4-5-实战案例：CentOS-8上实现基于9000端口的PHP-FPM" class="headerlink" title="5.4.5 实战案例：CentOS 8上实现基于9000端口的PHP-FPM"></a>5.4.5 实战案例：CentOS 8上实现基于9000端口的PHP-FPM</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#CentOS8默认为UDS模式,修改为基于端口模式</span><br><span class="hljs-comment"># dnf -y install httpd php-fpm</span><br><br><span class="hljs-comment">#删除系统自带的php.conf文件</span><br><span class="hljs-comment"># mv /etc/httpd/conf.d/php.conf /etc/httpd/conf.d/php.conf.bak</span><br><br><span class="hljs-comment">#创建httpd支持php-fpm的配置文件</span><br><span class="hljs-comment"># vim /etc/httpd/conf.d/fcgi.conf</span><br>DirectoryIndex index.php<br>ProxyRequests Off<br>ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/var/www/html/<span class="hljs-variable">$1</span><br>ProxyPassMatch ^/(fpm_status|ping) fcgi://127.0.0.1:9000<br><br><span class="hljs-comment">#修改php-fpm的配置文件</span><br><span class="hljs-comment"># vim /etc/php-fpm.d/www.conf</span><br>;listen = /run/php-fpm/www.sock<br>listen = 9000<br>pm.status_path = /fpm_status<br>ping.path = /ping<br><br><span class="hljs-comment"># systemctl restart httpd php-fpm</span><br></code></pre></td></tr></table></figure>

<h2 id="5-5-综合实战案例"><a href="#5-5-综合实战案例" class="headerlink" title="5.5 综合实战案例"></a>5.5 综合实战案例</h2><h3 id="5-5-1-目标"><a href="#5-5-1-目标" class="headerlink" title="5.5.1 目标"></a>5.5.1 目标</h3><p>CentOS 7 利用清华 yum 源，安装php7.4+wordpress（最新版）+opcache+event模式</p>
<h3 id="5-5-2-环境准备"><a href="#5-5-2-环境准备" class="headerlink" title="5.5.2 环境准备"></a>5.5.2 环境准备</h3><table>
<thead>
<tr>
<th>服务器地址</th>
<th>安装的软件</th>
</tr>
</thead>
<tbody><tr>
<td>10.0.0.7</td>
<td>MySQL</td>
</tr>
<tr>
<td>10.0.0.17</td>
<td>apache php-fpm</td>
</tr>
</tbody></table>
<h3 id="5-5-3-步骤"><a href="#5-5-3-步骤" class="headerlink" title="5.5.3 步骤"></a>5.5.3 步骤</h3><h4 id="5-5-3-1-10-0-0-7-安装MySQL"><a href="#5-5-3-1-10-0-0-7-安装MySQL" class="headerlink" title="5.5.3.1 10.0.0.7 安装MySQL"></a>5.5.3.1 10.0.0.7 安装MySQL</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装MySQL的源</span><br><span class="hljs-comment"># yum install -y https://dev.mysql.com/get/mysql80-community-release-el7-7.noarch.rpm</span><br><span class="hljs-comment"># vim /etc/yum.repos.d/mysql-community.repo</span><br>[mysql57-community]<br>name=MySQL 5.7 Community Server<br>baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/7/<span class="hljs-variable">$basearch</span><br>enabled=1 <span class="hljs-comment">#修改为1</span><br>gpgcheck=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql-2022<br>       file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql<br><br>[mysql80-community]<br>name=MySQL 8.0 Community Server<br>baseurl=http://repo.mysql.com/yum/mysql-8.0-community/el/7/<span class="hljs-variable">$basearch</span><br>enabled=0 <span class="hljs-comment">#修改为0</span><br>gpgcheck=1<br>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql-2022<br>       file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql<br>......<br><span class="hljs-comment"># yum install -y mysql-community-server</span><br><span class="hljs-comment"># systemctl enable --now mysqld</span><br><span class="hljs-comment"># 数据库添加管理员密码</span><br><span class="hljs-comment"># mysqladmin -uroot -p&quot;`sed -En &#x27;/temporary password/s/.*: (.*)/\1/p&#x27; /var/log/mysqld.log`&quot; password &quot;Admin123456@&quot;</span><br></code></pre></td></tr></table></figure>

<h4 id="5-5-3-2-10-0-0-17-安装PHP和安装httpd"><a href="#5-5-3-2-10-0-0-17-安装PHP和安装httpd" class="headerlink" title="5.5.3.2 10.0.0.17 安装PHP和安装httpd"></a>5.5.3.2 10.0.0.17 安装PHP和安装httpd</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装php7的源</span><br><span class="hljs-comment"># yum -y install https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm</span><br><span class="hljs-comment"># yum install -y php74-php-fpm php74-php-mysqlnd php74-php-opcache httpd unzip</span><br></code></pre></td></tr></table></figure>

<h4 id="5-5-3-3-10-0-0-17-配置php为UDS模式"><a href="#5-5-3-3-10-0-0-17-配置php为UDS模式" class="headerlink" title="5.5.3.3 10.0.0.17 配置php为UDS模式"></a>5.5.3.3 10.0.0.17 配置php为UDS模式</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/opt/remi/php74/php-fpm.d/www.conf</span><br>listen=/var/run/php.sock<br>listen.owner = apache<br>listen.group = apache<br>listen.mode = 0660 <br></code></pre></td></tr></table></figure>

<h4 id="5-5-3-4-10-0-0-17-配置httpd-支持-php-的fastcgi模式"><a href="#5-5-3-4-10-0-0-17-配置httpd-支持-php-的fastcgi模式" class="headerlink" title="5.5.3.4 10.0.0.17 配置httpd 支持 php 的fastcgi模式"></a>5.5.3.4 10.0.0.17 配置httpd 支持 php 的fastcgi模式</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/httpd/conf.d/test.conf</span><br>DirectoryIndex index.php<br>ProxyRequests Off<br>ProxyPassMatch ^/(.*\.php)$ unix:/var/run/php.sock|fcgi://localhost/var/www/html/<span class="hljs-variable">$1</span><br></code></pre></td></tr></table></figure>

<h4 id="5-5-3-5-10-0-0-17-启动httpd和php-fpm"><a href="#5-5-3-5-10-0-0-17-启动httpd和php-fpm" class="headerlink" title="5.5.3.5 10.0.0.17 启动httpd和php-fpm"></a>5.5.3.5 10.0.0.17 启动httpd和php-fpm</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># systemctl enable --now httpd php74-php-fpm.service</span><br></code></pre></td></tr></table></figure>

<h4 id="5-5-3-5-10-0-0-17-准备wordpress程序文件"><a href="#5-5-3-5-10-0-0-17-准备wordpress程序文件" class="headerlink" title="5.5.3.5 10.0.0.17 准备wordpress程序文件"></a>5.5.3.5 10.0.0.17 准备wordpress程序文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># wget https://cn.wordpress.org/latest-zh_CN.zip</span><br><span class="hljs-comment"># unzip latest-zh_CN.zip</span><br><span class="hljs-comment"># mv wordpress /var/www/html/</span><br><span class="hljs-comment"># chown -R apache.apache /var/www/html/</span><br></code></pre></td></tr></table></figure>

<h4 id="5-5-3-5-10-0-0-7-MySQL创建用户和数据库"><a href="#5-5-3-5-10-0-0-7-MySQL创建用户和数据库" class="headerlink" title="5.5.3.5 10.0.0.7 MySQL创建用户和数据库"></a>5.5.3.5 10.0.0.7 MySQL创建用户和数据库</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># mysql -uroot -pAdmin123456@</span><br>mysql&gt; create database wordpress;<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; grant all on wordpress.* to wordpress@<span class="hljs-string">&#x27;%&#x27;</span> identified by <span class="hljs-string">&#x27;Admin123456@&#x27;</span>;<br>Query OK, 0 rows affected (0.00 sec)<br></code></pre></td></tr></table></figure>

<h4 id="5-5-3-6-浏览器安装wordpress"><a href="#5-5-3-6-浏览器安装wordpress" class="headerlink" title="5.5.3.6 浏览器安装wordpress"></a>5.5.3.6 浏览器安装wordpress</h4><p><strong>打开浏览器访问 <a target="_blank" rel="noopener" href="http://httpd服务器ip/wordpress%EF%BC%8C%E8%BF%9B%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E5%AE%89%E8%A3%85">http://httpd服务器IP/wordpress，进行初始化和安装</a></strong></p>
<h1 id="六、编译安装php"><a href="#六、编译安装php" class="headerlink" title="六、编译安装php"></a>六、编译安装php</h1><h2 id="6-1-编译安装-httpd-模块方式的php5-6"><a href="#6-1-编译安装-httpd-模块方式的php5-6" class="headerlink" title="6.1 编译安装 httpd 模块方式的php5.6"></a>6.1 编译安装 httpd 模块方式的php5.6</h2><p><strong>注意：旧版本PHP编译安装要求：<a target="_blank" rel="noopener" href="https://www.php.net/git.php#bison">https://www.php.net/git.php#bison</a></strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装相关包，依赖epel源</span><br><span class="hljs-comment">#注意：如果PHP源码包里有configure就不用安装“automake”，“autoconf和libtool”</span><br><span class="hljs-comment"># yum install -y gcc make libxml2-devel bzip2-devel libmcrypt-devel</span><br><br><span class="hljs-comment">#编译安装php</span><br><span class="hljs-comment"># tar xvf php-5.6.30.tar.bz2</span><br><span class="hljs-comment"># cd php-5.6.30</span><br><span class="hljs-comment"># ./configure --prefix=/apps/php \</span><br>--with-mysql=/usr/<span class="hljs-built_in">local</span>/mysql \<br>--with-openssl \<br>--with-mysqli=/usr/<span class="hljs-built_in">local</span>/mysql/bin/mysql_config \<br>--enable-mbstring \<br>--with-png-dir \<br>--with-jpeg-dir \<br>--with-freetype-dir \<br>--with-zlib \<br>--with-libxml-dir=/usr \<br>--enable-xml \<br>--enable-sockets \<br>--with-apxs2=/app/httpd24/bin/apxs \<br>--with-mcrypt \<br>--with-config-file-path=/etc \<br>--with-config-file-scan-dir=/etc/php.d \<br>--with-bz2<br><br><span class="hljs-comment"># make -j 4 &amp;&amp; make install</span><br><br><span class="hljs-comment">#准备php的配置文件</span><br><span class="hljs-comment"># cd php-5.6.30</span><br><span class="hljs-comment"># cp php.ini-production /etc/php.ini</span><br><br><span class="hljs-comment">#修改httpd配置文件支持php</span><br><span class="hljs-comment"># vim /etc/httpd24/conf/httpd.conf</span><br><span class="hljs-comment">#下面加二行</span><br>AddType application/x-httpd-php .php<br>AddType application/x-httpd-php-source .phps<br><br><span class="hljs-comment">#定位至DirectoryIndex index.html， 修改为</span><br>DirectoryIndex index.php index.html<br><br><span class="hljs-comment"># apachectl restart</span><br></code></pre></td></tr></table></figure>

<h2 id="6-2-编译安装-httpd-模块方式的-php-7-3"><a href="#6-2-编译安装-httpd-模块方式的-php-7-3" class="headerlink" title="6.2 编译安装 httpd 模块方式的 php 7.3"></a>6.2 编译安装 httpd 模块方式的 php 7.3</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装相关包, 依赖epel源</span><br><span class="hljs-comment"># yum install gcc make libxml2-devel bzip2-devel libmcrypt-devel</span><br><br><span class="hljs-comment">#编译安装php 7.3</span><br><span class="hljs-comment"># tar xvf php-7.3.10.tar.xz</span><br><span class="hljs-comment"># cd php-7.3.10/</span><br><span class="hljs-comment"># ./configure \</span><br>--prefix=/apps/php \<br>--enable-mysqlnd \<br>--with-mysqli=mysqlnd \<br>--with-openssl \<br>--with-pdo-mysql=mysqlnd \<br>--enable-mbstring \<br>--with-freetype-dir \<br>--with-jpeg-dir \<br>--with-png-dir \<br>--with-zlib \<br>--with-libxml-dir=/usr \<br>--enable-xml \<br>--enable-sockets \<br>--with-apxs2=/app/httpd24/bin/apxs \<br>--with-config-file-path=/etc \<br>--with-config-file-scan-dir=/etc/php.d \<br>--enable-maintainer-zts \ <br>--disable-fileinfo<br><br><span class="hljs-comment">#说明：</span><br><span class="hljs-comment">#--enable-maintainer-zts 仅针对mpm为event和worker的情况,编译成zts模块,如果是prefork则不需要</span><br><span class="hljs-comment">#php-7.0 以上版本使用--enable-mysqlnd --with-mysqli=mysqlnd ，原--with-mysql不再支持</span><br><br><span class="hljs-comment"># make -j 4 &amp;&amp; make install</span><br><br><span class="hljs-comment"># cp php.ini-production /etc/php.ini</span><br><br><span class="hljs-comment"># vim /etc/httpd24/httpd.conf</span><br><span class="hljs-comment">#在文件尾部加两行</span><br>AddType application/x-httpd-php .php<br>AddType application/x-httpd-php-source .phps<br><span class="hljs-comment">#修改下面行</span><br>&lt;IfModule dir_module&gt;<br> DirectoryIndex index.php index.html<br>&lt;/IfModule&gt;<br></code></pre></td></tr></table></figure>

<h2 id="6-3-编译安装-fastcgi-方式的php-7-4"><a href="#6-3-编译安装-fastcgi-方式的php-7-4" class="headerlink" title="6.3 编译安装 fastcgi 方式的php 7.4"></a>6.3 编译安装 fastcgi 方式的php 7.4</h2><h3 id="6-3-1-安装依赖"><a href="#6-3-1-安装依赖" class="headerlink" title="6.3.1 安装依赖"></a>6.3.1 安装依赖</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum -y install gcc openssl-devel libxml2-devel bzip2-devel libmcrypt-devel sqlite-devel oniguruma-devel</span><br></code></pre></td></tr></table></figure>

<h3 id="6-3-2-下载PHP7-4源码并安装"><a href="#6-3-2-下载PHP7-4源码并安装" class="headerlink" title="6.3.2 下载PHP7.4源码并安装"></a>6.3.2 下载PHP7.4源码并安装</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># wget http://cn2.php.net/distributions/php-7.4.3.tar.xz</span><br><span class="hljs-comment"># tar xvf php-7.4.3.tar.xz</span><br><span class="hljs-comment"># cd php-7.4.3/</span><br><span class="hljs-comment"># ./configure \</span><br>--prefix=/apps/php74 \<br>--enable-mysqlnd \<br>--with-mysqli=mysqlnd \<br>--with-pdo-mysql=mysqlnd \<br>--with-openssl \<br>--with-zlib \<br>--with-config-file-path=/etc \<br>--with-config-file-scan-dir=/etc/php.d \<br>--enable-mbstring \<br>--enable-xml \<br>--enable-sockets \<br>--enable-fpm \<br>--enable-maintainer-zts \<br>--disable-fileinfo<br><br><span class="hljs-comment"># make -j `lscpu | grep &quot;CPU(s):&quot; | tr -d &#x27; &#x27; | cut -d &#x27;:&#x27; -f2 | head -n1` &amp;&amp; make install</span><br></code></pre></td></tr></table></figure>

<h3 id="6-3-2-准备PHP配置文件"><a href="#6-3-2-准备PHP配置文件" class="headerlink" title="6.3.2 准备PHP配置文件"></a>6.3.2 准备PHP配置文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># cp php-7.4.3/php.ini-production /etc/php.ini</span><br><span class="hljs-comment"># cp /apps/php74/etc/php-fpm.conf.default /apps/php74/etc/php-fpm.conf</span><br><span class="hljs-comment"># cp /apps/php74/etc/php-fpm.d/www.conf.default /apps/php74/etc/php-fpm.d/www.conf</span><br></code></pre></td></tr></table></figure>

<h3 id="6-3-2-准备php-fpm启动脚本或service-unit文件"><a href="#6-3-2-准备php-fpm启动脚本或service-unit文件" class="headerlink" title="6.3.2 准备php-fpm启动脚本或service unit文件"></a>6.3.2 准备php-fpm启动脚本或service unit文件</h3><p><strong>php-fpm启动脚本</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># cp php-7.4.3/sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</span><br><span class="hljs-comment"># chmod +x /etc/init.d/php-fpm</span><br><span class="hljs-comment"># chkconfig --add php-fpm</span><br><span class="hljs-comment"># chkconfig php-fpm on</span><br><span class="hljs-comment"># service php-fpm start</span><br></code></pre></td></tr></table></figure>

<p><strong>service unit文件</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># cp php-7.4.3/sapi/fpm/php-fpm.service /usr/lib/systemd/system/</span><br><span class="hljs-comment"># systemctl daemon-reload</span><br><span class="hljs-comment"># systemctl enable --now php-fpm</span><br></code></pre></td></tr></table></figure>

<h3 id="6-3-3-配置httpd支持php-fpm"><a href="#6-3-3-配置httpd支持php-fpm" class="headerlink" title="6.3.3 配置httpd支持php-fpm"></a>6.3.3 配置httpd支持php-fpm</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装httpd</span><br><span class="hljs-comment"># yum install -y httpd</span><br><span class="hljs-comment">#配置httpd支持php-fpm</span><br><span class="hljs-comment"># vim /etc/httpd/conf/httpd.conf</span><br><span class="hljs-comment">#取消下面两行的注释，使用yum的装的并没有注释以下配置</span><br>LoadModule proxy_module modules/mod_proxy.so<br>LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so<br><span class="hljs-comment">#修改下面行</span><br>&lt;IfModule dir_module&gt;<br> DirectoryIndex index.php index.html<br>&lt;/IfModule&gt;<br><span class="hljs-comment">#加下面四行</span><br>AddType application/x-httpd-php .php<br>AddType application/x-httpd-php-source .phps<br>ProxyRequests Off<br>ProxyPassMatch ^/(.*.php) fcgi://127.0.0.1:9000/var/www/html/<span class="hljs-variable">$1</span><br></code></pre></td></tr></table></figure>

<h3 id="6-3-4-支持opcache加速"><a href="#6-3-4-支持opcache加速" class="headerlink" title="6.3.4 支持opcache加速"></a>6.3.4 支持opcache加速</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/php.ini</span><br>[opcache]<br>zend_extension=opcache.so<br>opcache.enable=1 <span class="hljs-comment">#取消注释</span><br></code></pre></td></tr></table></figure>

<h2 id="6-4-编译安装-fastcgi-方式的php-7-3"><a href="#6-4-编译安装-fastcgi-方式的php-7-3" class="headerlink" title="6.4 编译安装 fastcgi 方式的php 7.3"></a>6.4 编译安装 fastcgi 方式的php 7.3</h2><h3 id="6-4-1-安装相关包，依赖EPEL源"><a href="#6-4-1-安装相关包，依赖EPEL源" class="headerlink" title="6.4.1 安装相关包，依赖EPEL源"></a>6.4.1 安装相关包，依赖EPEL源</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum install -y gcc make libxml2-devel bzip2-devel libmcrypt-devel</span><br></code></pre></td></tr></table></figure>

<h3 id="6-4-2-下载并安装PHP"><a href="#6-4-2-下载并安装PHP" class="headerlink" title="6.4.2 下载并安装PHP"></a>6.4.2 下载并安装PHP</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># wget http://cn2.php.net/distributions/php-7.3.10.tar.bz2</span><br><span class="hljs-comment"># tar xvf php-7.3.10.tar.bz2</span><br><span class="hljs-comment"># cd php-7.3.10/</span><br><span class="hljs-comment"># ./configure --prefix=/apps/php \</span><br>--enable-mysqlnd \<br>--with-mysqli=mysqlnd \<br>--with-pdo-mysql=mysqlnd \<br>--with-openssl \<br>--with-freetype-dir \<br>--with-jpeg-dir \<br>--with-png-dir \<br>--with-zlib \<br>--with-libxml-dir=/usr \<br>--with-config-file-path=/etc \<br>--with-config-file-scan-dir=/etc/php.d \<br>--enable-mbstring \<br>--enable-xml \<br>--enable-sockets \<br>--enable-fpm \<br>--enable-maintainer-zts \<br>--disable-fileinfo<br><br><span class="hljs-comment"># make -j `lscpu | grep &quot;CPU(s):&quot; | tr -d &#x27; &#x27; | cut -d &#x27;:&#x27; -f2 | head -n1` &amp;&amp; make install</span><br></code></pre></td></tr></table></figure>

<h3 id="6-4-3-准备php的配置文件"><a href="#6-4-3-准备php的配置文件" class="headerlink" title="6.4.3 准备php的配置文件"></a>6.4.3 准备php的配置文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># cd php-7.3.10/</span><br><span class="hljs-comment"># cp php.ini-production /etc/php.ini</span><br><span class="hljs-comment"># cd /apps/php/etc</span><br><span class="hljs-comment"># cp php-fpm.conf.default php-fpm.conf</span><br><span class="hljs-comment"># cp php-fpm.d/www.conf.default php-fpm.d/www.conf</span><br></code></pre></td></tr></table></figure>

<h3 id="6-4-4-准备php-fpm启动脚本或service-unit文件"><a href="#6-4-4-准备php-fpm启动脚本或service-unit文件" class="headerlink" title="6.4.4 准备php-fpm启动脚本或service unit文件"></a>6.4.4 准备php-fpm启动脚本或service unit文件</h3><h4 id="6-4-4-1-php-fpm启动脚本"><a href="#6-4-4-1-php-fpm启动脚本" class="headerlink" title="6.4.4.1 php-fpm启动脚本"></a>6.4.4.1 php-fpm启动脚本</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</span><br><span class="hljs-comment"># chmod +x /etc/init.d/php-fpm</span><br><span class="hljs-comment"># chkconfig --add php-fpm</span><br><span class="hljs-comment"># chkconfig php-fpm on</span><br><span class="hljs-comment"># service php-fpm start</span><br></code></pre></td></tr></table></figure>

<h4 id="6-4-4-2-service-unit文件"><a href="#6-4-4-2-service-unit文件" class="headerlink" title="6.4.4.2 service unit文件"></a>6.4.4.2 service unit文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># cp sapi/fpm/php-fpm.service /usr/lib/systemd/system/</span><br><span class="hljs-comment"># systemctl daemon-reload</span><br><span class="hljs-comment"># systemctl enable --enable php-fpm</span><br></code></pre></td></tr></table></figure>

<h3 id="6-4-5-配置httpd支持php-fpm"><a href="#6-4-5-配置httpd支持php-fpm" class="headerlink" title="6.4.5 配置httpd支持php-fpm"></a>6.4.5 配置httpd支持php-fpm</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum install -y httpd</span><br><span class="hljs-comment"># vim /etc/httpd/conf/httpd.conf</span><br><span class="hljs-comment">#取消下面两行的注释</span><br>LoadModule proxy_module modules/mod_proxy.so<br>LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so<br><span class="hljs-comment">#修改下面行</span><br>&lt;IfModule dir_module&gt;<br> DirectoryIndex index.php index.html<br>&lt;/IfModule&gt;<br><span class="hljs-comment">#加下面四行</span><br>AddType application/x-httpd-php .php<br>AddType application/x-httpd-php-source .phps<br>ProxyRequests Off<br>ProxyPassMatch ^/(.*.php) fcgi://127.0.0.1:9000/var/www/html/<span class="hljs-variable">$1</span><br></code></pre></td></tr></table></figure>

<h3 id="6-4-6-支持opcache加速"><a href="#6-4-6-支持opcache加速" class="headerlink" title="6.4.6 支持opcache加速"></a>6.4.6 支持opcache加速</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/php.ini</span><br>[opcache]<br>zend_extension=opcache.so                           <br>opcache.enable=1<br></code></pre></td></tr></table></figure>



<h1 id="七、实战案例"><a href="#七、实战案例" class="headerlink" title="七、实战案例"></a>七、实战案例</h1><h2 id="7-1-实战案例1-编译安装基于HTTPD模块的LAMP架构应用"><a href="#7-1-实战案例1-编译安装基于HTTPD模块的LAMP架构应用" class="headerlink" title="7.1 实战案例1: 编译安装基于HTTPD模块的LAMP架构应用"></a>7.1 实战案例1: 编译安装基于HTTPD模块的LAMP架构应用</h2><h3 id="7-1-1-环境设计"><a href="#7-1-1-环境设计" class="headerlink" title="7.1.1 环境设计"></a>7.1.1 环境设计</h3><p><strong>所有软件都二进制安装</strong></p>
<table>
<thead>
<tr>
<th>服务器地址</th>
<th>安装软件</th>
</tr>
</thead>
<tbody><tr>
<td>10.0.0.7</td>
<td>mariabd</td>
</tr>
<tr>
<td>10.0.0.17</td>
<td>httpd、php</td>
</tr>
</tbody></table>
<h3 id="7-1-2-实现步骤"><a href="#7-1-2-实现步骤" class="headerlink" title="7.1.2 实现步骤"></a>7.1.2 实现步骤</h3><h4 id="7-1-2-1-二进制安装-mariadb"><a href="#7-1-2-1-二进制安装-mariadb" class="headerlink" title="7.1.2.1 二进制安装 mariadb"></a>7.1.2.1 二进制安装 mariadb</h4><h5 id="7-1-2-1-1-创建MySQL用户"><a href="#7-1-2-1-1-创建MySQL用户" class="headerlink" title="7.1.2.1.1 创建MySQL用户"></a>7.1.2.1.1 创建MySQL用户</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">useradd -r -s /sbin/nologin mysql<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-1-2-下载部署mariadb"><a href="#7-1-2-1-2-下载部署mariadb" class="headerlink" title="7.1.2.1.2 下载部署mariadb"></a>7.1.2.1.2 下载部署mariadb</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget --no-check-certificate https://archive.mariadb.org//mariadb-10.2.27/bintar-linux-x86_64/mariadb-10.2.27-linux-x86_64.tar.gz<br>tar xvf mariadb-10.2.27-linux-x86_64.tar.gz -C /usr/<span class="hljs-built_in">local</span><br>ln -sv /usr/<span class="hljs-built_in">local</span>/mariadb-10.2.27-linux-x86_64 /usr/<span class="hljs-built_in">local</span>/mysql<br><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/mysql<br>chown -R root.root ./*<br>mkdir /data/mysql -p<br>chown -R mysql.mysql /data/mysql<br>mkdir /etc/mysql<br>cp support-files/my-huge.cnf /etc/mysql/my.cnf<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-1-3-修改mariadb配置文件"><a href="#7-1-2-1-3-修改mariadb配置文件" class="headerlink" title="7.1.2.1.3 修改mariadb配置文件"></a>7.1.2.1.3 修改mariadb配置文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/mysql/my.cnf<br>[mysqld]<br><span class="hljs-comment">#加下面行</span><br>datadir =/data/mysql<br>skip_name_resolve = ON<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-1-4-添加环境环境变量"><a href="#7-1-2-1-4-添加环境环境变量" class="headerlink" title="7.1.2.1.4 添加环境环境变量"></a>7.1.2.1.4 添加环境环境变量</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/profile.d/lamp.sh<br>PATH=/usr/<span class="hljs-built_in">local</span>/mysql/bin/:<span class="hljs-variable">$PATH</span><br>. /etc/profile.d/lamp.sh<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-1-5-初始化mariadb"><a href="#7-1-2-1-5-初始化mariadb" class="headerlink" title="7.1.2.1.5 初始化mariadb"></a>7.1.2.1.5 初始化mariadb</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/mysql/<br>.scripts/mysql_install_db --user=mysql --datadir=/data/mysql<br>cp support-files/mysql.server /etc/rc.d/init.d/mysqld<br>chkconfig --add mysqld<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-1-6-启动mariadb"><a href="#7-1-2-1-6-启动mariadb" class="headerlink" title="7.1.2.1.6 启动mariadb"></a>7.1.2.1.6 启动mariadb</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">service mysqld start<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-1-7-为wordpress应用准备数据库和用户"><a href="#7-1-2-1-7-为wordpress应用准备数据库和用户" class="headerlink" title="7.1.2.1.7 为wordpress应用准备数据库和用户"></a>7.1.2.1.7 为wordpress应用准备数据库和用户</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql<br>mysql&gt; create database wordpress;<br>mysql&gt; grant all on wordpress.* to wpuser@<span class="hljs-string">&#x27;%&#x27;</span> identified by <span class="hljs-string">&quot;123456&quot;</span>;<br></code></pre></td></tr></table></figure>

<h4 id="7-1-2-2-编译安装httpd-2-4"><a href="#7-1-2-2-编译安装httpd-2-4" class="headerlink" title="7.1.2.2 编译安装httpd-2.4"></a>7.1.2.2 编译安装httpd-2.4</h4><h5 id="7-1-2-2-1-创建用户"><a href="#7-1-2-2-1-创建用户" class="headerlink" title="7.1.2.2.1 创建用户"></a>7.1.2.2.1 创建用户</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">useradd -r -s /sbin/nologin apache<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-2-2-安装依赖"><a href="#7-1-2-2-2-安装依赖" class="headerlink" title="7.1.2.2.2 安装依赖"></a>7.1.2.2.2 安装依赖</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y gcc pcre-devel openssl-devel expat-devel lbzip2<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-2-3-下载httpd包及其依赖包"><a href="#7-1-2-2-3-下载httpd包及其依赖包" class="headerlink" title="7.1.2.2.3 下载httpd包及其依赖包"></a>7.1.2.2.3 下载httpd包及其依赖包</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget --no-check-certificate https://dlcdn.apache.org//apr/apr-1.7.0.tar.bz2<br>wget --no-check-certificate https://dlcdn.apache.org//apr/apr-util-1.6.1.tar.bz2<br>wget --no-check-certificate http://archive.apache.org/dist/httpd/httpd-2.4.41.tar.bz2<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-2-4-编译安装httpd"><a href="#7-1-2-2-4-编译安装httpd" class="headerlink" title="7.1.2.2.4 编译安装httpd"></a>7.1.2.2.4 编译安装httpd</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar xvf apr-1.7.0.tar.bz2 <br>tar xvf apr-util-1.6.1.tar.bz2<br>tar xf httpd-2.4.41.tar.bz2<br>mv apr-1.7.0 httpd-2.4.41/srclib/apr<br>mv apr-util-1.6.1 httpd-2.4.41/srclib/apr-util<br><span class="hljs-built_in">cd</span> httpd-2.4.41/<br><br>./configure --prefix=/apps/httpd \<br>--enable-so \<br>--enable-ssl \<br>--enable-cgi \<br>--enable-rewrite \<br>--with-zlib \<br>--with-pcre \<br>--enable-modules=most \<br>--enable-mpms-shared=all \<br>--with-mpm=prefork \<br>--with-included-apr<br><br>make -j `lscpu | grep <span class="hljs-string">&quot;CPU(s):&quot;</span> | tr -d <span class="hljs-string">&#x27; &#x27;</span> | cut -d <span class="hljs-string">&#x27;:&#x27;</span> -f2 | head -n1` &amp;&amp; make install<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-2-5-添加环境变量"><a href="#7-1-2-2-5-添加环境变量" class="headerlink" title="7.1.2.2.5 添加环境变量"></a>7.1.2.2.5 添加环境变量</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/profile.d/lamp.sh<br>PATH=/apps/httpd/bin/:<span class="hljs-variable">$PATH</span><br>. /etc/profile.d/lamp.sh<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-2-6-修改配置文件"><a href="#7-1-2-2-6-修改配置文件" class="headerlink" title="7.1.2.2.6 修改配置文件"></a>7.1.2.2.6 修改配置文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /apps/httpd/conf/httpd.conf<br><span class="hljs-comment">#修改下面两行</span><br>User apache<br>Group apach<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-2-7-启动httpd"><a href="#7-1-2-2-7-启动httpd" class="headerlink" title="7.1.2.2.7 启动httpd"></a>7.1.2.2.7 启动httpd</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">apachectl start<br></code></pre></td></tr></table></figure>

<h4 id="7-1-2-3-编译安装httpd模块方式-php-7-3"><a href="#7-1-2-3-编译安装httpd模块方式-php-7-3" class="headerlink" title="7.1.2.3 编译安装httpd模块方式 php-7.3"></a>7.1.2.3 编译安装httpd模块方式 php-7.3</h4><h5 id="7-1-2-3-1-安装编译依赖"><a href="#7-1-2-3-1-安装编译依赖" class="headerlink" title="7.1.2.3.1 安装编译依赖"></a>7.1.2.3.1 安装编译依赖</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y gcc libxml2-devel bzip2-devel libmcrypt-devel<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-3-2-下载并安装PHP"><a href="#7-1-2-3-2-下载并安装PHP" class="headerlink" title="7.1.2.3.2 下载并安装PHP"></a>7.1.2.3.2 下载并安装PHP</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget http://cn2.php.net/distributions/php-7.3.10.tar.xz<br><br>tar xvf php-7.3.10.tar.xz<br><span class="hljs-built_in">cd</span> php-7.3.10/<br><br>./configure \<br>--prefix=/apps/php \<br>--enable-mysqlnd \<br>--with-mysqli=mysqlnd \<br>--with-pdo-mysql=mysqlnd \<br>--with-openssl \<br>--with-freetype-dir \<br>--with-jpeg-dir \<br>--with-png-dir \<br>--with-zlib \<br>--with-libxml-dir=/usr \<br>--with-config-file-path=/etc \<br>--with-config-file-scan-dir=/etc/php.d \<br>--enable-mbstring \<br>--enable-xml \<br>--enable-sockets \<br>--enable-maintainer-zts \<br>--disable-fileinfo \<br>--with-apxs2=/apps/httpd/bin/apxs<br><br>make -j `lscpu | grep <span class="hljs-string">&quot;CPU(s):&quot;</span> | tr -d <span class="hljs-string">&#x27; &#x27;</span> | cut -d <span class="hljs-string">&#x27;:&#x27;</span> -f2 | head -n1` &amp;&amp; make install<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-3-3-添加PHP配置文件"><a href="#7-1-2-3-3-添加PHP配置文件" class="headerlink" title="7.1.2.3.3 添加PHP配置文件"></a>7.1.2.3.3 添加PHP配置文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">cp php.ini-production /etc/php.ini<br></code></pre></td></tr></table></figure>

<h4 id="7-1-2-4-编辑-apache-配置文件支持-php"><a href="#7-1-2-4-编辑-apache-配置文件支持-php" class="headerlink" title="7.1.2.4 编辑 apache 配置文件支持 php"></a>7.1.2.4 编辑 apache 配置文件支持 php</h4><h5 id="7-1-2-4-1-修改-apache-配置文件"><a href="#7-1-2-4-1-修改-apache-配置文件" class="headerlink" title="7.1.2.4.1 修改 apache 配置文件"></a>7.1.2.4.1 修改 apache 配置文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /apps/httpd/conf/httpd.conf<br><span class="hljs-comment">#下面加二行</span><br>AddType application/x-httpd-php .php<br>AddType application/x-httpd-php-source .phps<br><br><span class="hljs-comment">#定位至DirectoryIndex index.html， 修改为</span><br>DirectoryIndex index.php index.html<br></code></pre></td></tr></table></figure>

<h5 id="7-1-2-4-2-重启apache"><a href="#7-1-2-4-2-重启apache" class="headerlink" title="7.1.2.4.2 重启apache"></a>7.1.2.4.2 重启apache</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">apachectl restart<br></code></pre></td></tr></table></figure>

<h4 id="7-1-2-5-部署-wordpress"><a href="#7-1-2-5-部署-wordpress" class="headerlink" title="7.1.2.5  部署 wordpress"></a>7.1.2.5  部署 wordpress</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://cn.wordpress.org/latest-zh_CN.zip<br>unzip latest-zh_CN.zip<br>mv wordpress /apps/httpd/htdocs/<br>chown -R apache.apache /apps/httpd/htdocs/<br></code></pre></td></tr></table></figure>

<h4 id="7-1-2-6-浏览器安装wordpress"><a href="#7-1-2-6-浏览器安装wordpress" class="headerlink" title="7.1.2.6 浏览器安装wordpress"></a>7.1.2.6 浏览器安装wordpress</h4><p>浏览器访问</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://LAMP服务器/wordpress<br></code></pre></td></tr></table></figure>

<h2 id="7-2-实战案例2-编译安装基于-FASTCGI-模式LAMP架构多虚拟主机WEB应用"><a href="#7-2-实战案例2-编译安装基于-FASTCGI-模式LAMP架构多虚拟主机WEB应用" class="headerlink" title="7.2 实战案例2: 编译安装基于 FASTCGI 模式LAMP架构多虚拟主机WEB应用"></a>7.2 实战案例2: 编译安装基于 FASTCGI 模式LAMP架构多虚拟主机WEB应用</h2><h3 id="7-2-1-目标"><a href="#7-2-1-目标" class="headerlink" title="7.2.1 目标"></a>7.2.1 目标</h3><p>实现CentOS 7 编译安装基于 fastcgi 模式的多虚拟主机的wordpress和discuz的LAMP架构</p>
<h3 id="7-2-2-环境"><a href="#7-2-2-环境" class="headerlink" title="7.2.2 环境"></a>7.2.2 环境</h3><table>
<thead>
<tr>
<th>服务器地址</th>
<th>安装软件</th>
</tr>
</thead>
<tbody><tr>
<td>10.0.0.7</td>
<td>httpd、PHP</td>
</tr>
<tr>
<td>10.0.0.17</td>
<td>MySQL</td>
</tr>
</tbody></table>
<h3 id="7-2-3-实现步骤"><a href="#7-2-3-实现步骤" class="headerlink" title="7.2.3 实现步骤"></a>7.2.3 实现步骤</h3><h4 id="7-2-3-1-部署MySQL"><a href="#7-2-3-1-部署MySQL" class="headerlink" title="7.2.3.1 部署MySQL"></a>7.2.3.1 部署MySQL</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br></code></pre></td></tr></table></figure>

<h4 id="7-2-3-2-编译晚装httpd-2-4"><a href="#7-2-3-2-编译晚装httpd-2-4" class="headerlink" title="7.2.3.2 编译晚装httpd 2.4"></a>7.2.3.2 编译晚装httpd 2.4</h4><h5 id="7-2-3-2-1-安装依赖"><a href="#7-2-3-2-1-安装依赖" class="headerlink" title="7.2.3.2.1 安装依赖"></a>7.2.3.2.1 安装依赖</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install gcc pcre-devel openssl-devel expat-devel lbzip2<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-2-2-下载httpd源码包"><a href="#7-2-3-2-2-下载httpd源码包" class="headerlink" title="7.2.3.2.2 下载httpd源码包"></a>7.2.3.2.2 下载httpd源码包</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget --no-check-certificate https://dlcdn.apache.org//apr/apr-1.7.0.tar.bz2<br>wget --no-check-certificate https://dlcdn.apache.org//apr/apr-util-1.6.1.tar.bz2<br>wget --no-check-certificate http://archive.apache.org/dist/httpd/httpd-2.4.43.tar.gz<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-2-3-编译安装httpd"><a href="#7-2-3-2-3-编译安装httpd" class="headerlink" title="7.2.3.2.3 编译安装httpd"></a>7.2.3.2.3 编译安装httpd</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar xvf apr-1.7.0.tar.bz2 <br>tar xvf apr-util-1.6.1.tar.bz2<br>tar xf httpd-2.4.43.tar.gz<br>mv apr-1.7.0 httpd-2.4.43/srclib/apr<br>mv apr-util-1.6.1 httpd-2.4.43/srclib/apr-util<br><span class="hljs-built_in">cd</span> httpd-2.4.43/<br>./configure \<br>--prefix=/apps/httpd \<br>--enable-so \<br>--enable-ssl \<br>--enable-cgi \<br>--enable-rewrite \<br>--with-zlib \<br>--with-pcre \<br>--with-included-apr \<br>--enable-modules=most \<br>--enable-mpms-shared=all \<br>--with-mpm=event<br>make -j `lscpu | grep <span class="hljs-string">&quot;CPU(s):&quot;</span> | tr -d <span class="hljs-string">&#x27; &#x27;</span> | cut -d <span class="hljs-string">&#x27;:&#x27;</span> -f2 | head -n1` &amp;&amp; make install<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-2-4-设置环境变量"><a href="#7-2-3-2-4-设置环境变量" class="headerlink" title="7.2.3.2.4 设置环境变量"></a>7.2.3.2.4 设置环境变量</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/profile.d/lamp.sh<br>PATH=/apps/httpd/bin:<span class="hljs-variable">$PATH</span><br><br>. /etc/profile.d/lamp.sh<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-2-5-创建和配置用户和组"><a href="#7-2-3-2-5-创建和配置用户和组" class="headerlink" title="7.2.3.2.5 创建和配置用户和组"></a>7.2.3.2.5 创建和配置用户和组</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">useradd -s /sbin/nologin -r -u 88 apache<br>vim /apps/httpd/conf/httpd.conf<br>User apache<br>Group apache<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-2-6-修改为event模式-编译时已指定，此项不再需修改-可选项"><a href="#7-2-3-2-6-修改为event模式-编译时已指定，此项不再需修改-可选项" class="headerlink" title="7.2.3.2.6 修改为event模式,编译时已指定，此项不再需修改(可选项)"></a>7.2.3.2.6 修改为event模式,编译时已指定，此项不再需修改(可选项)</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /apps/httpd/conf/httpd.conf<br>LoadModule mpm_event_module modules/mod_mpm_event.so<br><span class="hljs-comment">#LoadModule mpm_prefork_module modules/mod_mpm_prefork.so</span><br><span class="hljs-comment">#LoadModule mpm_worker_module modules/mod_mpm_worker.so</span><br><br>httpd -M |grep mpm<br>mpm_event_module (shared)<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-2-7-添加service-unit文件"><a href="#7-2-3-2-7-添加service-unit文件" class="headerlink" title="7.2.3.2.7 添加service unit文件"></a>7.2.3.2.7 添加service unit文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /usr/lib/systemd/system/httpd.service<br>[Unit]<br>Description=The Apache HTTP Server<br>After=network.target remote-fs.target nss-lookup.target<br>Documentation=man:httpd(8)<br>Documentation=man:apachectl(8)<br>[Service]<br>Type=forking<br><span class="hljs-comment">#EnvironmentFile=/etc/sysconfig/httpd</span><br>ExecStart=/apps/httpd/bin/apachectl start<br><span class="hljs-comment">#ExecStart=/apps/httpd/bin/httpd $OPTIONS -k start</span><br>ExecReload=/apps/httpd/bin/apachectl graceful<br><span class="hljs-comment">#ExecReload=/apps/httpd/bin/httpd $OPTIONS -k graceful</span><br>ExecStop=/apps/httpd/bin/apachectl stop<br>KillSignal=SIGCONT<br>PrivateTmp=<span class="hljs-literal">true</span><br>[Install]<br>WantedBy=multi-user.target<br><br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> --now httpd<br></code></pre></td></tr></table></figure>

<h4 id="7-2-3-3-编译安装-fastcgi-方式的-PHP7-4"><a href="#7-2-3-3-编译安装-fastcgi-方式的-PHP7-4" class="headerlink" title="7.2.3.3 编译安装 fastcgi 方式的 PHP7.4"></a>7.2.3.3 编译安装 fastcgi 方式的 PHP7.4</h4><h5 id="7-2-3-3-1-安装依赖"><a href="#7-2-3-3-1-安装依赖" class="headerlink" title="7.2.3.3.1 安装依赖"></a>7.2.3.3.1 安装依赖</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装相关包,依赖EPEL源</span><br><span class="hljs-comment">#php 7.4 相关包</span><br>yum -y install gcc libxml2-devel bzip2-devel libmcrypt-devel sqlite-devel oniguruma-devel<br><span class="hljs-comment">#php 7.3 相关包</span><br>yum -y install gcc libxml2-devel bzip2-devel libmcrypt-devel<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-3-2-下载并安装PHP7-4"><a href="#7-2-3-3-2-下载并安装PHP7-4" class="headerlink" title="7.2.3.3.2 下载并安装PHP7.4"></a>7.2.3.3.2 下载并安装PHP7.4</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#php7.4 编译</span><br>wget http://cn2.php.net/distributions/php-7.4.7.tar.xz<br>tar xvf php-7.4.7.tar.xz<br><span class="hljs-built_in">cd</span> php-7.4.7/<br>./configure \<br>--prefix=/apps/php \<br>--enable-mysqlnd \<br>--with-mysqli=mysqlnd \<br>--with-pdo-mysql=mysqlnd \<br>--with-openssl \<br>--with-zlib \<br>--with-config-file-path=/etc \<br>--with-config-file-scan-dir=/etc/php.d \<br>--enable-mbstring \<br>--enable-xml \<br>--enable-sockets \<br>--enable-fpm \<br>--enable-maintainer-zts \<br>--disable-fileinfo<br><br><span class="hljs-comment">#编译安装php 7.3</span><br>wget http://cn2.php.net/distributions/php-7.3.10.tar.bz2<br>tar xvf php-7.3.10.tar.bz2<br><span class="hljs-built_in">cd</span> php-7.3.10<br>./configure --prefix=/apps/php \<br>--enable-mysqlnd \<br>--with-mysqli=mysqlnd \<br>--with-pdo-mysql=mysqlnd \<br>--with-openssl \<br>--with-freetype-dir \<br>--with-jpeg-dir \<br>--with-png-dir \<br>--with-zlib \<br>--with-libxml-dir=/usr \<br>--with-config-file-path=/etc \<br>--with-config-file-scan-dir=/etc/php.d \<br>--enable-mbstring \<br>--enable-xml \<br>--enable-sockets \<br>--enable-fpm \<br>--enable-maintainer-zts \<br>--disable-fileinfo<br><br>make -j `lscpu | grep <span class="hljs-string">&quot;CPU(s):&quot;</span> | tr -d <span class="hljs-string">&#x27; &#x27;</span> | cut -d <span class="hljs-string">&#x27;:&#x27;</span> -f2 | head -n1` &amp;&amp; make install<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-3-3-设置环境变量"><a href="#7-2-3-3-3-设置环境变量" class="headerlink" title="7.2.3.3.3 设置环境变量"></a>7.2.3.3.3 设置环境变量</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#php7.4</span><br>vim /etc/profile.d/lamp.sh<br>PATH=/apps/php/bin:/apps/httpd/bin:<span class="hljs-variable">$PATH</span><br><br>. /etc/profile.d/lamp.sh<br><br><span class="hljs-comment">#php7.3</span><br>vim /etc/profile.d/lamp.sh<br>PATH=/apps/php/bin:/apps/httpd/bin:<span class="hljs-variable">$PATH</span><br><br>. /etc/profile.d/lamp.sh<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-3-4-准备php配置文件和启动文件"><a href="#7-2-3-3-4-准备php配置文件和启动文件" class="headerlink" title="7.2.3.3.4 准备php配置文件和启动文件"></a>7.2.3.3.4 准备php配置文件和启动文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">cp php.ini-production /etc/php.ini<br>cp sapi/fpm/php-fpm.service /usr/lib/systemd/system/<br><span class="hljs-built_in">cd</span> /apps/php/etc<br>cp php-fpm.conf.default php-fpm.conf<br><span class="hljs-built_in">cd</span> php-fpm.d/<br>cp www.conf.default www.conf<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-3-5-修改www-conf配置文件"><a href="#7-2-3-3-5-修改www-conf配置文件" class="headerlink" title="7.2.3.3.5 修改www.conf配置文件"></a>7.2.3.3.5 修改<a target="_blank" rel="noopener" href="http://www.conf配置文件/">www.conf配置文件</a></h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /apps/php/etc/php-fpm.d/www.conf<br>user apache<br>group apache<br><span class="hljs-comment">#支持status和ping页面</span><br>pm.status_path = /fpm_status<br>ping.path = /ping <br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-3-6-支持opcache加速"><a href="#7-2-3-3-6-支持opcache加速" class="headerlink" title="7.2.3.3.6 支持opcache加速"></a>7.2.3.3.6 支持opcache加速</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/php.ini<br>......<br>[opcache]<br>; Determines <span class="hljs-keyword">if</span> Zend OPCache is enabled<br>opcache.enable=1<br>zend_extension=opcache.so<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-3-7-启动php-fpm"><a href="#7-2-3-3-7-启动php-fpm" class="headerlink" title="7.2.3.3.7 启动php-fpm"></a>7.2.3.3.7 启动php-fpm</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> --now php-fpm.service<br></code></pre></td></tr></table></figure>

<h4 id="7-2-3-4-修改配置-httpd-支持-php-fpm"><a href="#7-2-3-4-修改配置-httpd-支持-php-fpm" class="headerlink" title="7.2.3.4 修改配置 httpd 支持 php-fpm"></a>7.2.3.4 修改配置 httpd 支持 php-fpm</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /apps/httpd/conf/httpd.conf<br><span class="hljs-comment">#取消下面两行的注释</span><br>LoadModule proxy_module modules/mod_proxy.so<br>LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so<br><span class="hljs-comment">#修改下面行</span><br>&lt;IfModule dir_module&gt;<br>DirectoryIndex index.php index.html<br>&lt;/IfModule&gt;<br><span class="hljs-comment">#加下面三行</span><br>AddType application/x-httpd-php .php<br><span class="hljs-comment">#AddType application/x-httpd-php-source .phps</span><br>ProxyRequests Off<br><br></code></pre></td></tr></table></figure>

<h4 id="7-2-3-5-添加虚拟机"><a href="#7-2-3-5-添加虚拟机" class="headerlink" title="7.2.3.5 添加虚拟机"></a>7.2.3.5 添加虚拟机</h4><h5 id="7-2-3-5-1-创建文件夹"><a href="#7-2-3-5-1-创建文件夹" class="headerlink" title="7.2.3.5.1 创建文件夹"></a>7.2.3.5.1 创建文件夹</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#网页文件</span><br>mkdir /data<br><span class="hljs-comment">#配置文件</span><br>mkdir /apps/httpd/conf.d<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-5-2-添加第一个虚拟机"><a href="#7-2-3-5-2-添加第一个虚拟机" class="headerlink" title="7.2.3.5.2 添加第一个虚拟机"></a>7.2.3.5.2 添加第一个虚拟机</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /apps/httpd/conf.d/blog.conf<br>&lt;virtualhost *:80&gt;<br>servername blog.rlin.com<br>documentroot /data/wordpress<br>&lt;directory /data/wordpress&gt;<br>require all granted<br>&lt;/directory&gt;<br>ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/data/wordpress/<span class="hljs-variable">$1</span><br><span class="hljs-comment">#实现status和ping页面</span><br>ProxyPassMatch ^/(fpm_status|ping)$ fcgi://127.0.0.1:9000/<span class="hljs-variable">$1</span><br>CustomLog <span class="hljs-string">&quot;logs/access_wordpress_log&quot;</span> common<br>ErrorLog <span class="hljs-string">&quot;logs/error_wordpress_log&quot;</span><br>&lt;/virtualhost&gt;<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-5-2-添加第二个虚拟机"><a href="#7-2-3-5-2-添加第二个虚拟机" class="headerlink" title="7.2.3.5.2 添加第二个虚拟机"></a>7.2.3.5.2 添加第二个虚拟机</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /apps/httpd/conf.d/fourm<br>&lt;virtualhost *:80&gt;<br>servername forum.rlin.com<br>documentroot /data/discuz<br>&lt;directory /data/discuz/&gt;<br>require all granted<br>&lt;/directory&gt;<br>ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/data/discuz/<span class="hljs-variable">$1</span><br>CustomLog <span class="hljs-string">&quot;logs/access_discuz_log&quot;</span> common<br>ErrorLog <span class="hljs-string">&quot;logs/error_discuz_log&quot;</span><br>&lt;/virtualhost&gt;<br></code></pre></td></tr></table></figure>

<h4 id="7-2-3-5-准备wordpress和discuz-相关文件"><a href="#7-2-3-5-准备wordpress和discuz-相关文件" class="headerlink" title="7.2.3.5 准备wordpress和discuz! 相关文件"></a>7.2.3.5 准备wordpress和discuz! 相关文件</h4><h5 id="7-2-3-5-1-准备wordress程序文件"><a href="#7-2-3-5-1-准备wordress程序文件" class="headerlink" title="7.2.3.5.1 准备wordress程序文件"></a>7.2.3.5.1 准备wordress程序文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://cn.wordpress.org/wordpress-5.4.2-zh_CN.tar.gz<br>tar xvf wordpress-5.4.2-zh_CN.tar.gz<br>mv wordpress/ /data<br>setfacl -R -m u:apache:rwx /data/wordpress/<br><span class="hljs-comment">#或者chown -R apache.apache /data/wordpress/</span><br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-5-2-准备discus程序文件"><a href="#7-2-3-5-2-准备discus程序文件" class="headerlink" title="7.2.3.5.2 准备discus程序文件"></a>7.2.3.5.2 准备discus程序文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">wget https://gitee.com/Discuz/DiscuzX/releases/download/v3.4-20220811/Discuz_X3.4_SC_UTF8_20220811.zip<br>unzip Discuz_X3.4_SC_UTF8_20220811.zip<br>mv upload/ /data/discuz<br>setfacl -R -m u:apache:rwx /data/discuz/<br><span class="hljs-comment">#或者chown -R apache.apache /data/discuz/</span><br></code></pre></td></tr></table></figure>

<h4 id="7-2-3-5-重启httpd"><a href="#7-2-3-5-重启httpd" class="headerlink" title="7.2.3.5 重启httpd"></a>7.2.3.5 重启httpd</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">httpd -t<br>systemctl restart httpd<br></code></pre></td></tr></table></figure>

<h4 id="7-2-3-6-测试访问"><a href="#7-2-3-6-测试访问" class="headerlink" title="7.2.3.6 测试访问"></a>7.2.3.6 测试访问</h4><p><strong>hosts文件添加解析</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/hosts<br>10.0.0.7 blog.rlin.com forum.rlin.com<br></code></pre></td></tr></table></figure>

<p>打开浏览器访问 <a target="_blank" rel="noopener" href="http://blog.rlin.com/">http://blog.rlin.com</a> 和<a target="_blank" rel="noopener" href="http://forum.rlin.com/">http://forum.rlin.com</a> 分别进行初始化和安装</p>
<h4 id="7-2-3-6-修改成UDS模式"><a href="#7-2-3-6-修改成UDS模式" class="headerlink" title="7.2.3.6 修改成UDS模式"></a>7.2.3.6 修改成UDS模式</h4><h5 id="7-2-3-6-1-修改PHP配置文件"><a href="#7-2-3-6-1-修改PHP配置文件" class="headerlink" title="7.2.3.6.1 修改PHP配置文件"></a>7.2.3.6.1 修改PHP配置文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /apps/php/etc/php-fpm.d/www.conf<br>;listen = 127.0.0.1:9000<br>listen = /run/php-fpm.sock<br>listen.owner = apache<br>listen.group = apache <br><br>listen.mode = 0660<br>systemctl restart php-fpm<br><br>ll /run/php-fpm.sock<br>srw-rw---- 1 apache apache 0 Dec 14 11:11 /run/php-fpm.sock<br><br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-6-2-修改第一个虚拟主机的配置文件"><a href="#7-2-3-6-2-修改第一个虚拟主机的配置文件" class="headerlink" title="7.2.3.6.2 修改第一个虚拟主机的配置文件"></a>7.2.3.6.2 修改第一个虚拟主机的配置文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /apps/httpd/conf.d/blog.conf<br>&lt;virtualhost *:80&gt;<br>servername blog.rlin.com<br>documentroot /data/wordpress<br>&lt;directory /data/wordpress&gt;<br>require all granted<br>&lt;/directory&gt;<br><span class="hljs-comment">#ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/data/wordpress/$1</span><br>ProxyPassMatch ^/(.*\.php)$ <span class="hljs-string">&quot;unix:/run/php-</span><br><span class="hljs-string">fpm.sock|fcgi://localhost/data/wordpress/&quot;</span><br><span class="hljs-comment">#ProxyPassMatch ^/(fpm_status|ping)$ fcgi://127.0.0.1:9000/$1</span><br>ProxyPassMatch ^/(fpm_status|ping)$ <span class="hljs-string">&quot;unix:/run/php-fpm.sock|fcgi://localhost/&quot;</span> <br>CustomLog <span class="hljs-string">&quot;logs/access_wordpress_log&quot;</span> common<br>ErrorLog <span class="hljs-string">&quot;logs/error_wordpress_log&quot;</span><br>&lt;/virtualhost&gt;<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-6-3-修改第二个虚拟主机的配置文件"><a href="#7-2-3-6-3-修改第二个虚拟主机的配置文件" class="headerlink" title="7.2.3.6.3 修改第二个虚拟主机的配置文件"></a>7.2.3.6.3 修改第二个虚拟主机的配置文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /apps/httpd/conf.d/fourm.conf<br>&lt;virtualhost *:80&gt;<br>servername forum.rlin.com<br>documentroot /data/discuz<br>&lt;directory /data/discuz&gt;<br>require all granted<br>&lt;/directory&gt;<br><span class="hljs-comment">#ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/data/discuz/$1</span><br>ProxyPassMatch ^/(.*\.php)$ <span class="hljs-string">&quot;unix:/run/php-</span><br><span class="hljs-string">fpm.sock|fcgi://localhost/data/discuz/&quot;</span><br><span class="hljs-comment">#ProxyPassMatch ^/(fpm_status|ping)$ fcgi://127.0.0.1:9000/$1</span><br>ProxyPassMatch ^/(fpm_status|ping)$ <span class="hljs-string">&quot;unix:/run/php-fpm.sock|fcgi://localhost/&quot;</span> <br>CustomLog <span class="hljs-string">&quot;logs/access_discuz_log&quot;</span> common<br>ErrorLog <span class="hljs-string">&quot;logs/error_discuz_log&quot;</span><br>&lt;/virtualhost&gt;<br></code></pre></td></tr></table></figure>

<h5 id="7-2-3-6-4-重启httpd"><a href="#7-2-3-6-4-重启httpd" class="headerlink" title="7.2.3.6.4 重启httpd"></a>7.2.3.6.4 重启httpd</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart httpd<br></code></pre></td></tr></table></figure>



<h1 id="八、练习"><a href="#八、练习" class="headerlink" title="八、练习"></a>八、练习</h1><h2 id="8-1-实现lamp基于module方式"><a href="#8-1-实现lamp基于module方式" class="headerlink" title="8.1 实现lamp基于module方式"></a>8.1 实现lamp基于module方式</h2><h3 id="8-1-1-要求"><a href="#8-1-1-要求" class="headerlink" title="8.1.1 要求"></a>8.1.1 要求</h3><p>(1) 三者分离于两台主机<br>(2) 一个虚拟主机提供phpMyAdmin；另一个虚拟主机提供wordpress<br>(3) 为phpMyAdmin提供https虚拟主机</p>
<h3 id="8-1-2-环境规划"><a href="#8-1-2-环境规划" class="headerlink" title="8.1.2 环境规划"></a>8.1.2 环境规划</h3><p><strong>注意：docker和kubernetes部署不用不用按照相应的主机地址，只需要符合要求即可</strong></p>
<table>
<thead>
<tr>
<th>主机地址</th>
<th>安装的软件</th>
</tr>
</thead>
<tbody><tr>
<td>10.0.0.7</td>
<td>MySQL5.7</td>
</tr>
<tr>
<td>10.0.0.17</td>
<td>httpd2.4、PHP7.4</td>
</tr>
</tbody></table>
<h3 id="8-1-3-部署方式"><a href="#8-1-3-部署方式" class="headerlink" title="8.1.3 部署方式"></a>8.1.3 部署方式</h3><h4 id="8-1-3-1-交互式包管理工具部署"><a href="#8-1-3-1-交互式包管理工具部署" class="headerlink" title="8.1.3.1 交互式包管理工具部署"></a>8.1.3.1 交互式包管理工具部署</h4><h4 id="8-1-3-2-shell脚本部署"><a href="#8-1-3-2-shell脚本部署" class="headerlink" title="8.1.3.2 shell脚本部署"></a>8.1.3.2 shell脚本部署</h4><h4 id="8-1-3-3-ansible部署"><a href="#8-1-3-3-ansible部署" class="headerlink" title="8.1.3.3 ansible部署"></a>8.1.3.3 ansible部署</h4><p>略</p>
<h4 id="8-1-3-4-docker部署"><a href="#8-1-3-4-docker部署" class="headerlink" title="8.1.3.4 docker部署"></a>8.1.3.4 docker部署</h4><p>略</p>
<h4 id="8-1-3-5-kubernetes部署"><a href="#8-1-3-5-kubernetes部署" class="headerlink" title="8.1.3.5 kubernetes部署"></a>8.1.3.5 kubernetes部署</h4><p>略</p>
<h2 id="8-2-LAMP-基于php-fpm模式"><a href="#8-2-LAMP-基于php-fpm模式" class="headerlink" title="8.2 LAMP 基于php-fpm模式"></a>8.2 LAMP 基于php-fpm模式</h2><h3 id="8-2-1-要求"><a href="#8-2-1-要求" class="headerlink" title="8.2.1 要求"></a>8.2.1 要求</h3><p>(1) 三者分离于三台主机<br>(2) 一个虚拟主机提供phpMyAdmin；另一个虚拟主机提供wordpress</p>
<h3 id="8-2-2-环境规划"><a href="#8-2-2-环境规划" class="headerlink" title="8.2.2 环境规划"></a>8.2.2 环境规划</h3><p><strong>注意：docker和kubernetes部署不用不用按照相应的主机地址，只需要符合要求即可</strong></p>
<table>
<thead>
<tr>
<th>主机地址</th>
<th>安装软件</th>
</tr>
</thead>
<tbody><tr>
<td>10.0.0.7</td>
<td>MySQL5.7</td>
</tr>
<tr>
<td>10.0.0.17</td>
<td>httpd2.4</td>
</tr>
<tr>
<td>10.0.0.27</td>
<td>PHP7.4</td>
</tr>
</tbody></table>
<h3 id="8-2-3-部署方式"><a href="#8-2-3-部署方式" class="headerlink" title="8.2.3 部署方式"></a>8.2.3 部署方式</h3><h4 id="8-2-3-1-交互式包管理工具部署"><a href="#8-2-3-1-交互式包管理工具部署" class="headerlink" title="8.2.3.1 交互式包管理工具部署"></a>8.2.3.1 交互式包管理工具部署</h4><h4 id="8-2-3-2-shell脚本部署"><a href="#8-2-3-2-shell脚本部署" class="headerlink" title="8.2.3.2 shell脚本部署"></a>8.2.3.2 shell脚本部署</h4><h4 id="8-2-3-3-ansible部署"><a href="#8-2-3-3-ansible部署" class="headerlink" title="8.2.3.3 ansible部署"></a>8.2.3.3 ansible部署</h4><p>略</p>
<h4 id="8-2-3-4-docker部署"><a href="#8-2-3-4-docker部署" class="headerlink" title="8.2.3.4 docker部署"></a>8.2.3.4 docker部署</h4><p>略</p>
<h4 id="8-1-3-5-kubernetes部署-1"><a href="#8-1-3-5-kubernetes部署-1" class="headerlink" title="8.1.3.5 kubernetes部署"></a>8.1.3.5 kubernetes部署</h4><p>略</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/apache-lamp/">apache lamp</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2022/10/26/HTTPP%E5%8D%8F%E8%AE%AE%E5%92%8CWEB%E6%9C%8D%E5%8A%A1%E5%99%A8APACHE/">
                        <span class="hidden-mobile">HTTPP协议和WEB服务器APACHE</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/blog/js/debouncer.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/blog/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/blog/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/blog/js/boot.js" ></script>



</body>
</html>
