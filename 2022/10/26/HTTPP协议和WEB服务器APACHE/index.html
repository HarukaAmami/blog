

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="rlin">
  <meta name="keywords" content="">
  <title>HTTPP协议和WEB服务器APACHE - rlin的运维笔记</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/blog/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/blog/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"rintime.gitee.io","root":"/blog/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>rlin的运维笔记</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="HTTPP协议和WEB服务器APACHE">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-10-26 15:52" pubdate>
        2022年10月26日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      35.8k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      508
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">HTTPP协议和WEB服务器APACHE</h1>
            
            <div class="markdown-body">
              <h1 id="HTTPP协议和WEB服务器APACHE"><a href="#HTTPP协议和WEB服务器APACHE" class="headerlink" title="HTTPP协议和WEB服务器APACHE"></a>HTTPP协议和WEB服务器APACHE</h1><h1 id="一、Internet和HTTP协议"><a href="#一、Internet和HTTP协议" class="headerlink" title="一、Internet和HTTP协议"></a>一、Internet和HTTP协议</h1><h2 id="1-1Internet-因特网"><a href="#1-1Internet-因特网" class="headerlink" title="1.1Internet 因特网"></a>1.1Internet 因特网</h2><blockquote>
<p>因特网是”Internet”的中文译名，它起源于美国的五角大楼，它的前身是美国国防部高级研究计划局（ARPA）主持研制的ARPAnet。20世纪50年代末，正处于冷战时期。当时美国军方为了自己的计算机网络在受到袭击时,即使部分网络被摧毁，其余部分仍能保持通信联系，便由美国国防部的高级研究计划<br>局（ARPA）建设了一个军用网，叫做”阿帕网”（ARPAnet）。阿帕网于1969年正式启用，当时仅连接了4台计算机，供科学家们进行计算机联网实验用，这就是因特网的前身。</p>
<p>到70年代，ARPAnet已经有了好几十个计算机网络，但是每个网络只能在网络内部的计算机之间互联通信，不同计算机网络之间仍然不能互通。为此， ARPA又设立了新的研究项目，支持学术界和工业界进行有关的研究，研究的主要内容就是想用一种新的方法将不同的计算机局域网互联，形成”互联网”。研<br>究人员称之为”internetwork”，简称”Internet”。</p>
<p>在研究实现互联的过程中，计算机软件起了主要的作用。1974年，出现了连接分组网络的协议，其中就包括了TCP/IP协议。TCP/IP有一个非常重要的特点，就是开放性，即TCP/IP的规范和Internet的技术都是公开的。目的就是使任何厂家生产的计算机都能相互通信，使Internet成为一个开放的系统，这正是后来Internet得到飞速发展的重要原因。ARPA在1982年接受了TCP/IP，选定Internet为主要的计算机通信系统，并把其它的军用计算机网络都转换到TCP/IP。1983年，ARPAnet分成两部分：一部分军用，称为MILNET；另一部分仍称ARPAnet，供民用。</p>
<p>1986年，美国国家科学基金组织（NSF）将分布在美国各地的5个为科研教育服务的超级计算机中心互联，并支持地区网络，形成SNSFnet。1988 年，SNSFnet替代ARPAnet成为Internet的主干网。NSFnet主干网利用了在ARPAnet中已证明是非常成功的TCP/IP技术，准许各大学、政府或私人科研机构的网络加入。1989年，ARPAnet解散，Internet从军用转向民用。</p>
<p>Internet的发展引起了商家的极大兴趣。1992年，美国IBM、MCI、MERIT三家公司联合组建了一个高级网络服务公司（SNS），建立了一个新的网络，叫做SNSnet，成为Internet的另一个主干网。它与SNSFnet不同，NSFnet是由国家出资建立的，而SNSnet则是SNS 公司所有，从而使Internet开始走向商业化。</p>
<p>1995年4月30日，SNSFnet正式宣布停止运作。而此时Internet的骨干网已经覆盖了全球91个国家，主机已超过400万台。而在当前，因特网仍以惊人的速度向前发展。</p>
<p>在90年代，超文本标识语言（HTML），即一个可以获得因特网的图像信息的超文本因特网协议被采用，使每一个人可以产生自己的图像页面（网址），然后成为一个巨大的虚拟超文本网络的组成部分。这个增强型的因特网又被非正式地称为万维网，与此同时产生了数量庞大的新用户群。于是，许多人用”因特网” 一词指这个网络的物理结构，包括连接所有事物的客户机、服务器和网络；而用”万维网”一词指利用这个网络可以访问的所有网站和信息。</p>
</blockquote>
<h2 id="1-2-Internet和中国"><a href="#1-2-Internet和中国" class="headerlink" title="1.2 Internet和中国"></a>1.2 Internet和中国</h2><p>北京时间1987年9月14日，钱天白建立起一个网络节点，通过电话拨号连接到国际互联网，向他的德国朋友发出来自中国的第一封电子邮件：Across the Great Wall we can reach every corner in theworld，自此，中国与国际计算机网络开始连接在一起。</p>
<blockquote>
<p>1990年10月，钱天白教授代表中国正式在国际互联网络信息中心的前身DDN-NIC注册登记了我国的顶级域名CN，并且从此开通了使用中国顶级域名CN的国际电子邮件服务。由于当时中国尚未正式连入Internet，所以委托德国卡尔斯鲁厄大学运行CN域名服务器。</p>
<p>1993年3月2日， 中国科学院高能物理研究所租用AT&amp;T公司的国际卫星信道接入美国斯坦福线性加速器中心（SLAC）的64K专线正式开通,专线开通后，美国政府以Internet上有许多科技信息和其它各种资源，不能让社会主义国家接入为由，只允许这条专线进入美国能源网而不能连接到其它地方。尽管如<br>此，这条专线仍是我国部分连入Internet的第一根专线。</p>
<p>1994年4月20日，中国通过一条64k的国际专线全功能接入国际互联网，成为国际互联网大家庭中的第77个成员，正式开启了互联网时代。随后，中科院高能物理研究所推出第一个WWW网站和第一套网页。</p>
<p>1994年5月21日， 在钱天白教授和德国卡尔斯鲁厄大学的协助下，中国科学院计算机网络信息中心完成了中国国家顶级域名(CN)服务器的设置，改变了中国CN顶级域名服务器一直放在国外的历史。</p>
<p>1995年5月17日， 第27个世界电信日，邮电部正式宣布，向国内社会开放计算机互联网接入服务。</p>
<p>1995年5月，北京的中关村南大街上出现了一块巨大的广告牌，”中国离信息高速公路还有多远？向北1500米。”那个位置就是一家叫”瀛海威”的网络科教馆，瀛海威正是information highway的音译，作为中国第一个互联网接入服务商，瀛海威几乎就是当时互联网的代名词。</p>
<p>1996年1月，中国互联网全国骨干网建成并正式开通，开始提供服务。</p>
<p>1995年4月，马云凑了两万块钱，成立杭州海博网络公司，专门给企业做主页。</p>
<p>1997年5月，丁磊创立网易。</p>
<p>1998年2月， 张朝阳创立搜狐。</p>
<p>1998年6月18日，刘强东在中关村创办京东公司，代理销售光磁产品。</p>
<p>1998年11月，马化腾和张志东成立深圳市腾讯计算机系统有限公司，OICQ开通。</p>
<p>1998年12月， 新浪网成立，关键人物：王志东。</p>
<p>1999年5月18日，中国第一家电子商务企业8848.com成立，创始人王峻涛也曾被誉为”中国电子商务教父”。2000年底，调查显示接近70%的人说上网买东西首选 8848。</p>
<p>2000年1月，李彦宏创建了百度。</p>
<p>2003年5月，阿里巴巴集团在创立淘宝网。</p>
<p>2004年1月，京东多媒体网正式开通，启用域名<a target="_blank" rel="noopener" href="http://www.jdlaser.com./">www.jdlaser.com。</a></p>
<p>2010年4月，雷军创办小米。</p>
<p>2011年1月21日，腾讯公司推出微信 (WeChat)。</p>
<p>2012年3月，今日头条由张一鸣于创建。</p>
<p>2012年7月10日，北京小桔科技有限公司成立，滴滴司机端3个月后北京上线。</p>
</blockquote>
<p><strong>中国互联网连接世界</strong></p>
<blockquote>
<p>1885年台湾建省，首任巡抚刘铭传派人与福州船政联系，使用船政电报学堂毕业生为技术人员，于1887年铺设成功台湾淡水至福州川石海底电缆，全长117海里。这是我国自行设计安装的第一条海底电缆。此电缆毁于第二次世界大战我国于1989年开始投入到全球海底光缆的投资与建设中来，并于1993年实现了首条国际海底光缆的登陆（中日之间C-J海底光缆系统）；随后在1997年，我国参与建设的全球海底光缆系统（FLAG）建成并投入运营，这也是第一条在我国登陆的洲际海底光缆中国连接世界目前共有8条光缆，四个登陆站允许入境，目前我国的登陆站设立在三个城市的四个地区，分别是山东青岛登陆站（隶属中国联通）、上海崇明登陆站（隶属中国电信）、上海南汇登陆站（隶属中国联通）和广东汕头登陆站（隶属中国电信）。</p>
</blockquote>
<h2 id="1-3-跨网络的主机间通讯"><a href="#1-3-跨网络的主机间通讯" class="headerlink" title="1.3 跨网络的主机间通讯"></a>1.3 跨网络的主机间通讯</h2><h3 id="1-3-1-Socket套接字"><a href="#1-3-1-Socket套接字" class="headerlink" title="1.3.1 Socket套接字"></a>1.3.1 Socket套接字</h3><p>" srcset="/blog/img/loading.gif<img src=""></p>
<p>套接字Socket是进程间通信IPC的一种实现，允许位于不同主机（或同一主机）上不同进程之间进行通信<br>和数据交换，SocketAPI出现于1983年 BSD 4.2实现</p>
<p>在建立通信连接的每一端，进程间的传输要有两个标志：IP地址和端口号，合称为套接字地址 socket<br>address</p>
<p>客户机套接字地址定义了一个唯一的客户进程</p>
<p>服务器套接字地址定义了一个唯一的服务器进程</p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<h3 id="1-3-2-Socket-API"><a href="#1-3-2-Socket-API" class="headerlink" title="1.3.2 Socket API"></a>1.3.2 Socket API</h3><p>封装了内核中所提供的socket通信相关的系统调用</p>
<p>Socket Domain：根据其所使用的地址</p>
<ul>
<li><p>AF_INET：Address Family，IPv4</p>
</li>
<li><p>AF_INET6：IPv6</p>
</li>
<li><p>AF_UNIX：同一主机上不同进程之间通信时使用</p>
</li>
</ul>
<p>Socket Type：根据使用的传输层协议</p>
<ul>
<li>SOCK_STREAM：流，tcp套接字，可靠地传递、面向连接</li>
<li>SOCK_DGRAM：数据报，udp套接字，不可靠地传递、无连接</li>
<li>SOCK_RAW: 裸套接字,无须tcp或udp,APP直接通过IP包通信</li>
</ul>
<h3 id="1-3-3-客户-服务器程序的套接字函数"><a href="#1-3-3-客户-服务器程序的套接字函数" class="headerlink" title="1.3.3 客户/服务器程序的套接字函数"></a>1.3.3 客户/服务器程序的套接字函数</h3><p>" srcset="/blog/img/loading.gif<img src=""></p>
<h3 id="1-3-4-套接字相关的系统调用："><a href="#1-3-4-套接字相关的系统调用：" class="headerlink" title="1.3.4 套接字相关的系统调用："></a>1.3.4 套接字相关的系统调用：</h3><ul>
<li>socket() 创建一个套接字</li>
<li>bind() 绑定IP和端口</li>
<li>listen() 监听</li>
<li>accept() 接收请求</li>
<li>connect() 请求连接建立</li>
<li>write() 发送</li>
<li>read() 接收</li>
<li>close() 关闭连接</li>
</ul>
<h3 id="1-3-5-范例：在-Linux-体验套接字功能"><a href="#1-3-5-范例：在-Linux-体验套接字功能" class="headerlink" title="1.3.5 范例：在 Linux 体验套接字功能"></a>1.3.5 范例：在 Linux 体验套接字功能</h3><p><strong>服务端和客户端地址</strong></p>
<table>
<thead>
<tr>
<th>服务端地址</th>
<th>客户端地址</th>
</tr>
</thead>
<tbody><tr>
<td>10.0.0.7</td>
<td>10.0.0.17</td>
</tr>
</tbody></table>
<h4 id="1-3-5-1-客户端与服务端安装nc"><a href="#1-3-5-1-客户端与服务端安装nc" class="headerlink" title="1.3.5.1 客户端与服务端安装nc"></a>1.3.5.1 客户端与服务端安装nc</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum install -y nc</span><br></code></pre></td></tr></table></figure>

<h4 id="1-3-5-2-利用nc实现服务端"><a href="#1-3-5-2-利用nc实现服务端" class="headerlink" title="1.3.5.2 利用nc实现服务端"></a>1.3.5.2 利用nc实现服务端</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># nc -l 9527</span><br><br><span class="hljs-comment">#查看nc的监听</span><br><span class="hljs-comment"># ss -tnlp</span><br>State   Recv-Q Send-Q     Local Address:Port                   Peer Address:Port              <br>LISTEN  0      128                    *:22                                *:*                   users:((<span class="hljs-string">&quot;sshd&quot;</span>,pid=874,fd=3))<br>LISTEN  0      10                     *:9527                              *:*                   users:((<span class="hljs-string">&quot;nc&quot;</span>,pid=1495,fd=4))<br>LISTEN  0      128                 [::]:22                             [::]:*                   users:((<span class="hljs-string">&quot;sshd&quot;</span>,pid=874,fd=4))<br>LISTEN  0      10                  [::]:9527                           [::]:*                   users:((<span class="hljs-string">&quot;nc&quot;</span>,pid=1495,fd=3))<br></code></pre></td></tr></table></figure>

<h4 id="1-3-5-3-通过nc连接客户端"><a href="#1-3-5-3-通过nc连接客户端" class="headerlink" title="1.3.5.3 通过nc连接客户端"></a>1.3.5.3 通过nc连接客户端</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># nc 10.0.0.7 9527</span><br></code></pre></td></tr></table></figure>

<h4 id="1-3-5-4-相互通信"><a href="#1-3-5-4-相互通信" class="headerlink" title="1.3.5.4 相互通信"></a>1.3.5.4 相互通信</h4><p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache1.png" srcset="/blog/img/loading.gif" alt="与服务端通信"></p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache2.png" srcset="/blog/img/loading.gif" alt="与客户端通信"></p>
<h3 id="1-3-6-范例：Socket-相关系统应用"><a href="#1-3-6-范例：Socket-相关系统应用" class="headerlink" title="1.3.6 范例：Socket 相关系统应用"></a>1.3.6 范例：Socket 相关系统应用</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum install -y man-panges</span><br><span class="hljs-comment"># man 2 socket</span><br><span class="hljs-comment"># man 2 bind</span><br><span class="hljs-comment"># man 2 listen</span><br><span class="hljs-comment"># man 2 accept</span><br><span class="hljs-comment"># man 2 read</span><br><span class="hljs-comment"># man 2 write</span><br><span class="hljs-comment"># man 2 connect</span><br><span class="hljs-comment"># man 2 close</span><br></code></pre></td></tr></table></figure>

<h3 id="1-3-7-范例：通过-Python-3-6-实现-Socket-通信"><a href="#1-3-7-范例：通过-Python-3-6-实现-Socket-通信" class="headerlink" title="1.3.7 范例：通过 Python 3.6 实现 Socket 通信"></a>1.3.7 范例：通过 Python 3.6 实现 Socket 通信</h3><p><strong>服务端和客户端地址</strong></p>
<table>
<thead>
<tr>
<th>服务端地址</th>
<th>客户端地址</th>
</tr>
</thead>
<tbody><tr>
<td>10.0.0.7</td>
<td>10.0.0.17</td>
</tr>
</tbody></table>
<h4 id="1-3-7-1-服务端和客户端安装-python-3-6"><a href="#1-3-7-1-服务端和客户端安装-python-3-6" class="headerlink" title="1.3.7.1 服务端和客户端安装 python 3.6"></a>1.3.7.1 服务端和客户端安装 python 3.6</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum install -y python3</span><br></code></pre></td></tr></table></figure>

<h4 id="1-3-7-2-服务端运行-python-脚本"><a href="#1-3-7-2-服务端运行-python-脚本" class="headerlink" title="1.3.7.2 服务端运行 python 脚本"></a>1.3.7.2 服务端运行 python 脚本</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># vim tcp-server.py</span><br><span class="hljs-comment">#!/usr/bin/python3</span><br><span class="hljs-keyword">import</span> socket <br>HOST=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span> <br>PORT=<span class="hljs-number">9527</span><br>BUFFER=<span class="hljs-number">4096</span> <br>sock=socket.socket(socket.AF_INET,socket.SOCK_STREAM) <br>sock.bind((HOST,PORT)) <br>sock.listen(<span class="hljs-number">3</span>) <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;tcpServer listen at: %s:%s\n\r&#x27;</span> %(HOST,PORT)) <br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>: <br> client_sock,client_addr=sock.accept() <br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;%s:%s connect&#x27;</span> %client_addr) <br> <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>: <br>  recv=client_sock.recv(BUFFER) <br>  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> recv: <br>   client_sock.close() <br>   <span class="hljs-keyword">break</span> <br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[Client %s:%s said]:%s&#x27;</span> %<br>(client_addr[<span class="hljs-number">0</span>],client_addr[<span class="hljs-number">1</span>],recv.decode())) <br>  client_sock.send(<span class="hljs-string">b&#x27;tcpServer has received your message&#x27;</span>) <br>sock.close()<br></code></pre></td></tr></table></figure>

<h4 id="1-3-7-3-客户端运行"><a href="#1-3-7-3-客户端运行" class="headerlink" title="1.3.7.3 客户端运行"></a>1.3.7.3 客户端运行</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># vim tcp-client.py</span><br><span class="hljs-comment">#!/usr/bin/python3</span><br><span class="hljs-keyword">import</span> socket <br>HOST=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span><br>PORT=<span class="hljs-number">9527</span><br>BUFFER=<span class="hljs-number">4096</span><br>sock=socket.socket(socket.AF_INET,socket.SOCK_STREAM)<br>sock.connect((HOST,PORT))<br>sock.send(<span class="hljs-string">b&#x27;hello, tcpServer!,I am tcp client&#x27;</span>) recv=sock.recv(BUFFER) <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[tcpServer said]: %s&#x27;</span> % recv.decode())<br>sock.close()<br></code></pre></td></tr></table></figure>

<h2 id="1-4-HTTP-超文本传输协议"><a href="#1-4-HTTP-超文本传输协议" class="headerlink" title="1.4 HTTP 超文本传输协议"></a>1.4 HTTP 超文本传输协议</h2><h3 id="1-4-1-HTTP-相关概念"><a href="#1-4-1-HTTP-相关概念" class="headerlink" title="1.4.1 HTTP 相关概念"></a>1.4.1 HTTP 相关概念</h3><p>互联网：是网络的网络，是所有类型网络的母集。</p>
<p>因特网：世界上最大的互联网网络。即因特网概念从属于互联网概念。习惯上，大家把连接在因特网上的计算机都成为主机。</p>
<p>万维网：WWW（world wide web）万维网并非某种特殊的计算机网络，是一个大规模的、联机式的信息贮藏库，使用链接的方法能非常方便地从因特网上的一个站点访问另一个站点（超链技术），具有提供分布式服务的特点。万维网是一个分布式的超媒体系统，是超文本系统的扩充，基于B/S架构实现。</p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<p>URL：万维网使用统一资源定位符（Uniform Resource Locator）来标志万维网上的各种文档，并使每个文档在整个因特网的范围内具有唯一的标识符URL。</p>
<p>HTTP：为解决”用什么样的网络协议来实现整个因特网上的万维网文档”这一难题，就要使万维网客户程序（以浏览器为主，但不限于浏览器）与万维网服务器程序之间的交互遵守严格的协议，即超文本传送协议（HyperText Transfer Protocol）。HTTP是处于应用层的协议，使用TCP传输层协议进行可靠的传送。因此，需要特别提醒的是，万维网是基于因特网的一种广泛因特网应用系统，且万维网采用的是HTTP（80/TCP）和 HTTPS（443/TCP）的传输协议，但因特网还有其他的网络应用系统（如：FTP、SMTP等等）。</p>
<p>HTML：为了解决”怎样使不同作者创作的不同风格的万维网文档，都能在因特网上的各种主机上显示出来，同时使用户清楚地知道在什么地方存在着链接”这一问题，万维网使用超文本标记语言（HyperTextMarkup Language），使得万维网页面的设计者可以很方便地用链接从页面的某处链接到因特网的任何一个万维网页面，并且能够在自己的主机品目上将这些页面显示出来。HTML与txt一样，仅仅是是一种文档，不同之处在于，这种文档专供于浏览器上为浏览器用户提供统一的界面呈现的统一规约。且具备<br>结构化的特征，这是txt所不具备的强制规定。</p>
<h3 id="1-4-2-浏览器访问网站的过程"><a href="#1-4-2-浏览器访问网站的过程" class="headerlink" title="1.4.2 浏览器访问网站的过程"></a>1.4.2 浏览器访问网站的过程</h3><p>" srcset="/blog/img/loading.gif<img src=""></p>
<h3 id="1-4-3-HTTP-协议通信过程"><a href="#1-4-3-HTTP-协议通信过程" class="headerlink" title="1.4.3 HTTP 协议通信过程"></a>1.4.3 HTTP 协议通信过程</h3><p>HTTP（HyperText Transfer Protocol，超文本传输协议）是一种用于分布式、协作式和超媒体信息系统的应用层协议。HTTP是万维网的数据通信的基础设计HTTP最初的目的是为了提供一种远距离共享知识的方式，借助多文档进行关联实现超文本，连成相互参阅的WWW（world wide web,万维网）</p>
<p>HTTP的发展是由蒂姆·伯纳斯-李（Tim Berners-Lee）于1989年在欧洲核子研究组织（CERN）所发起。</p>
<p>HTTP的标准制定由万维网协会（World Wide Web Consortium，W3C）和互联网工程任务组（Internet Engineering Task Force，IETF）进行协调，最终发布了一系列的RFC，其中最著名的是1999年6月公布的 RFC 2616，定义了HTTP协议中现今广泛使用的一个版本——HTTP 1.1版。</p>
<p>" srcset="/blog/img/loading.gif<img src="" alt="HTTP服务通信过程"></p>
<p>" srcset="/blog/img/loading.gif<img src="" alt="HTTP协议分层"></p>
<h3 id="1-4-4-HTTP-相关技术"><a href="#1-4-4-HTTP-相关技术" class="headerlink" title="1.4.4 HTTP 相关技术"></a>1.4.4 HTTP 相关技术</h3><h4 id="1-4-4-1-WEB-开发语言"><a href="#1-4-4-1-WEB-开发语言" class="headerlink" title="1.4.4.1 WEB 开发语言"></a>1.4.4.1 WEB 开发语言</h4><p>http：Hyper Text Transfer Protocol 应用层协议，默认端口： 80/tcp<br><strong>WEB前端开发语言：</strong></p>
<ul>
<li>html</li>
<li>css</li>
<li>javascript</li>
</ul>
<h5 id="1-4-4-1-1-html"><a href="#1-4-4-1-1-html" class="headerlink" title="1.4.4.1.1 html"></a>1.4.4.1.1 html</h5><p>Hyper Text Markup Language 超文本标记语言，编程语言，主要负责实现页面的结构</p>
<p>范例：html 语言</p>
<p><strong>注意:html文件编码为utf-8编码</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">Content-Type</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>HTML语言<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://www.cilicili.cc/api/images/tx/img/50.jpg&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color:red&quot;</span>&gt;</span>欢迎<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">https://opentuna.cn</span>&gt;</span>OpenTUNA开源软件镜像站<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>欢迎你<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="1-4-4-1-2-CSS"><a href="#1-4-4-1-2-CSS" class="headerlink" title="1.4.4.1.2 CSS"></a>1.4.4.1.2 CSS</h5><p>Cascading Style Sheet 层叠样式表， 定义了如何显示（装扮） HTML 元素，比如：字体大小和颜色属性等。样式通常保存在外部的 .css 文件中,用于存放一些HTML文件的公共属性,从而通过仅编辑一个简单的 CSS 文档，可以同时改变站点中所有页面的布局和外观。</p>
<p>范例：CSS</p>
<p><strong>注意：建议用Vscode创建文件,用记事本可能会出现乱码</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">html</span>&gt;<br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-attribute">Content</span>-Type <span class="hljs-attribute">content</span>=&quot;text/<span class="hljs-selector-tag">html</span>;charset=utf-<span class="hljs-number">8</span>&quot;&gt;<br>&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;mystyle<span class="hljs-selector-class">.css</span>&quot; /&gt;<br>&lt;/head&gt;<br>&lt;<span class="hljs-selector-tag">body</span>&gt;<br>&lt;<span class="hljs-selector-tag">h1</span>&gt;这是 heading <span class="hljs-number">1</span>&lt;/<span class="hljs-selector-tag">h1</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span>&gt;这是一段普通的段落。请注意，该段落的文本是红色的。在 <span class="hljs-selector-tag">body</span> 选择器中定义了本页面中的默认文本颜<br>色。&lt;/<span class="hljs-selector-tag">p</span>&gt;<br>&lt;<span class="hljs-selector-tag">p</span> class=&quot;ex&quot;&gt;该段落定义了 class=&quot;ex&quot;。该段落中的文本是蓝色的。&lt;/<span class="hljs-selector-tag">p</span>&gt;<br>&lt;/<span class="hljs-selector-tag">body</span>&gt;<br>&lt;/<span class="hljs-selector-tag">html</span>&gt;<br></code></pre></td></tr></table></figure>

<h5 id="1-4-4-1-3-JS"><a href="#1-4-4-1-3-JS" class="headerlink" title="1.4.4.1.3 JS"></a>1.4.4.1.3 JS</h5><p>javascript，实现网页的动画效果，但实属于静态资源。</p>
<p>,Java和javascript的关系: 周杰和周杰伦的关系。</p>
<p>范例：javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;!DOCTYPE html&gt;<br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">Content-Type</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>我的第一个 JavaScript<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;document.getElementById(&#x27;demo&#x27;).innerHTML = Date()&quot;</span>&gt;</span>点击这里来显示日期和时间<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="xml">&lt;pid=&quot;demo&quot;&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<h4 id="1-4-4-2-MIME"><a href="#1-4-4-2-MIME" class="headerlink" title="1.4.4.2 MIME"></a>1.4.4.2 MIME</h4><p>MIME : Multipurpose Internet Mail Extensions 多用途互联网邮件扩展</p>
<p>文件 <code>/etc/mime.types</code> ,来自于mailcap包</p>
<p>MIME格式：type/subtype</p>
<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types</a></p>
<p><a target="_blank" rel="noopener" href="http://www.w3school.com.cn/media/media_mimeref.asp">http://www.w3school.com.cn/media/media_mimeref.asp</a></p>
<p>范例：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino">text/plain <br>text/html <br>text/css<br>image/jpeg  jpg jpeg<br>image/png<br>video/mp4<br>application/javascript<br></code></pre></td></tr></table></figure>

<h3 id="1-4-4-3-URI和URL"><a href="#1-4-4-3-URI和URL" class="headerlink" title="1.4.4.3 URI和URL"></a>1.4.4.3 URI和URL</h3><p>URI： Uniform Resource Identifier 统一资源标识，分为URL 和 URN</p>
<p>URN：Uniform Resource Naming，统一资源命名</p>
<blockquote>
<p> 示例： P2P下载使用的磁力链接是URN的一种实现：magnet:?xt=urn:btih:660557A6890EF888666</p>
</blockquote>
<p>URL：Uniform Resorce Locator，统一资源定位符，用于描述某服务器某特定资源位置</p>
<p>两者区别：URN如同一个人的名称，而URL代表一个人的住址。换言之，URN定义某事物的身份，而URL提供查找该事物的方法。URN仅用于命名，而不指定地址。</p>
<p><strong>URL组成</strong></p>
<p>" srcset="/blog/img/loading.gif<img src="" alt="URL组成"></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">&lt;scheme&gt;://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;path&gt;;&lt;params&gt;?&lt;query&gt;#&lt;frag&gt;<br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>组成部分</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>scheme</td>
<td>方案，访问服务器以获取资源时要使用哪种协议</td>
</tr>
<tr>
<td>user</td>
<td>用户，某些方案访问资源时需要的用户名</td>
</tr>
<tr>
<td>password</td>
<td>密码，用户对应的密码，中间用：分隔</td>
</tr>
<tr>
<td>Host</td>
<td>主机，资源宿主服务器的主机名或IP地址</td>
</tr>
<tr>
<td>port</td>
<td>端口,资源宿主服务器正在监听的端口号，很多方案有默认端口号</td>
</tr>
<tr>
<td>path</td>
<td>路径,服务器资源的本地名，由一个/将其与前面的URL组件分隔</td>
</tr>
<tr>
<td>params</td>
<td>参数，指定输入的参数，参数为名/值对，多个参数，用;分隔</td>
</tr>
<tr>
<td>query</td>
<td>查询，传递参数给程序，如数据库，用？分隔,多个查询用&amp;分隔</td>
</tr>
<tr>
<td>frag</td>
<td>片段,一小片或一部分资源的名字，此组件在客户端使用，用#分隔</td>
</tr>
</tbody></table>
<p><strong>URL示例</strong></p>
<p>" srcset="/blog/img/loading.gif<img src="" alt="URL示例"></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs http">http://www.magedu.com:8080/images/logo.jpg<br>ftp://mage:password@172.16.0.1/pub/linux.ppt<br>rtsp://videoserver/video_demo/ #Real Time Streaming Protocol<br>gcomm://10.0.0.8,10.0.0.18,10.0.0.28<br>http://www.magedu.com/bbs/hello;gender=f/send;type=title<br>https://list.jd.com/list.html?cat=670,671,672&amp;ev=14_2&amp;sort=sort_totalsales15_desc&amp;trans=1<br>http://apache.org/index.html#projects-list<br></code></pre></td></tr></table></figure>

<h4 id="1-4-4-4-网站访问量"><a href="#1-4-4-4-网站访问量" class="headerlink" title="1.4.4.4 网站访问量"></a>1.4.4.4 网站访问量</h4><p><strong>网站访问量统计的重要指标</strong></p>
<ul>
<li><p>IP(独立IP)：即Internet Protocol,指独立IP数。一天内来自相同客户机 IP 地址只计算一次，记录远程客户机IP地址的计算机访问网站的次数，是衡量网站流量的重要指标。</p>
</li>
<li><p>PV(访问量)： 即Page View, 页面浏览量或点击量，用户每次刷新即被计算一次，PV反映的是浏览某网站的页面数，PV与来访者的数量成正比，PV并不是页面的来访者数量，而是网站被访问的页面数量。</p>
</li>
<li><p>UV(独立访客)：即Unique Visitor,访问网站的一台电脑为一个访客。一天内相同的客户端只被计算一次。可以理解成访问某网站的电脑的数量。网站判断来访电脑的身份是通过cookies实现的。如果更换了IP后但不清除cookies，再访问相同网站，该网站的统计中UV数是不变的。</p>
</li>
</ul>
<p>网站统计：<a target="_blank" rel="noopener" href="http://www.alexa.cn/rank/">http://www.alexa.cn/rank/</a></p>
<p>范例：网站访问统计</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">1. 甲乙丙三人在同一台通过 ADSL 上网的电脑上（中间没有断网），分别访问 www.magedu.com 网站，并且每人共用一个浏览器，各个浏览了2个页面，那么网站的流量统计是：<br><span class="hljs-attribute">IP</span><span class="hljs-punctuation">: </span>1 PV:6  UV：1<br><br>2. 若三人都是ADSL重新拨号后,各浏览了2个页面，则<br><span class="hljs-attribute">IP</span><span class="hljs-punctuation">: </span>3 PV:6 UV：1<br></code></pre></td></tr></table></figure>

<p><strong>网站访问量</strong><br>QPS：request per second，每秒请求数</p>
<p>PV，QPS和并发连接数换算公式</p>
<ul>
<li><p>QPS= PV * 页面衍生连接次数/ 统计时间（86400）</p>
</li>
<li><p>并发连接数 =QPS * http平均响应时间 </p>
</li>
</ul>
<p>峰值时间：每天80%的访问集中在20%的时间里，这20%时间为峰值时间</p>
<p>峰值时间每秒请求数(QPS)=( 总PV数 <em>页面衍生连接次数）</em>80% ) / ( 每天秒数 * 20% )</p>
<h3 id="1-4-5-HTTP工作机制"><a href="#1-4-5-HTTP工作机制" class="headerlink" title="1.4.5 HTTP工作机制"></a>1.4.5 HTTP工作机制</h3><p>一次http事务包括：</p>
<ul>
<li>http请求：http request</li>
<li>http响应：http response</li>
</ul>
<h4 id="1-4-5-1-Web资源"><a href="#1-4-5-1-Web资源" class="headerlink" title="1.4.5.1 Web资源"></a>1.4.5.1 Web资源</h4><p>web resource， 一个网页由多个资源（文件）构成，打开一个页面，通常会有多个资源展示出来，但是每个资源都要单独请求。因此，一个”Web 页面”通常并不是单个资源，而是一组资源的集合。</p>
<h4 id="1-4-5-2-资源类型"><a href="#1-4-5-2-资源类型" class="headerlink" title="1.4.5.2 资源类型"></a>1.4.5.2 资源类型</h4><ul>
<li><p>静态文件：无需服务端做出额外处理,服务器端和客户端的文件内容相同。</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">文件后缀：<span class="hljs-string">.html</span>, <span class="hljs-string">.txt</span>, <span class="hljs-string">.jpg</span>, <span class="hljs-string">.js</span>, <span class="hljs-string">.css</span>, <span class="hljs-string">.mp3</span>, <span class="hljs-string">.avi</span><br></code></pre></td></tr></table></figure></li>
<li><p>动态文件：服务端执行程序，返回执行的结果,服务器端和客户端的文件内容不相同。</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">文件后缀：<span class="hljs-string">.php</span>, <span class="hljs-string">.jsp</span> ,<span class="hljs-string">.asp</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-4-5-3-HTTP连接请求"><a href="#1-4-5-3-HTTP连接请求" class="headerlink" title="1.4.5.3 HTTP连接请求"></a>1.4.5.3 HTTP连接请求</h4><p>" srcset="/blog/img/loading.gif<img src="" alt="HTTP连接请求"></p>
<h4 id="1-4-5-4-串行和并行连接"><a href="#1-4-5-4-串行和并行连接" class="headerlink" title="1.4.5.4 串行和并行连接"></a>1.4.5.4 串行和并行连接</h4><p>" srcset="/blog/img/loading.gif<img src="" alt="串行连接"></p>
<p>" srcset="/blog/img/loading.gif<img src="" alt="并行连接"></p>
<h4 id="1-4-5-5-串行-持久连接和管道"><a href="#1-4-5-5-串行-持久连接和管道" class="headerlink" title="1.4.5.5 串行,持久连接和管道"></a>1.4.5.5 串行,持久连接和管道</h4><p>" srcset="/blog/img/loading.gif<img src="" alt="串行,持久连接和管道"></p>
<h4 id="1-4-5-6-提高HTTP连接性能"><a href="#1-4-5-6-提高HTTP连接性能" class="headerlink" title="1.4.5.6 提高HTTP连接性能"></a>1.4.5.6 提高HTTP连接性能</h4><ul>
<li>并行连接：通过多条TCP连接发起并发的HTTP请求。</li>
<li>持久连接：keep-alive，重用TCP连接，以消除连接和关闭的时延,以事务个数和时间来决定是否关闭连接。</li>
<li>管道化连接：通过共享TCP连接，发起并发的HTTP请求。</li>
<li>复用的连接：交替传送请求和响应报文（实验阶段）。</li>
</ul>
<h3 id="1-4-6-HTTP-协议版本"><a href="#1-4-6-HTTP-协议版本" class="headerlink" title="1.4.6 HTTP 协议版本"></a>1.4.6 HTTP 协议版本</h3><p>RFC Hypertext Transfer Protocol – HTTP/1.1</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://www.rfc-editor.org/rfc/rfc2616<br></code></pre></td></tr></table></figure>

<h4 id="1-4-6-1-http-0-9"><a href="#1-4-6-1-http-0-9" class="headerlink" title="1.4.6.1 http/0.9"></a>1.4.6.1 http/0.9</h4><p>1991，原型版本，功能简陋，只有一个命令GET。GET /index.html ,服务器只能回应HTML格式字符串，不能回应别的格式。</p>
<h4 id="1-4-6-2-http-1-0"><a href="#1-4-6-2-http-1-0" class="headerlink" title="1.4.6.2 http/1.0"></a>1.4.6.2 http/1.0</h4><p>1996年5月,支持cache, MIME, method。</p>
<p>每个TCP连接只能发送一个请求，发送数据完毕，连接就关闭，如果还要请求其他资源，就必须再新建一个连接引入了POST命令和HEAD命令头信息是 ASCII 码，后面数据可为任何格式。服务器回应时会告诉客户端，数据是什么格式，即Content-Type字段的作用。这些数据类型总称为MIME 多用途互联网邮件扩展，每个值包括一级类型和二级类型，预定义的类型，也可自定义类型, 常见Content-Type值：text/xml image/jpeg audio/mp3。</p>
<h4 id="1-4-6-3-http-1-1"><a href="#1-4-6-3-http-1-1" class="headerlink" title="1.4.6.3 http/1.1"></a>1.4.6.3 http/1.1</h4><p>1997年1月，引入了持久连接（persistent connection），即TCP连接默认不关闭，可以被多个请求复用，不用声明Connection: keep-alive。对于同一个域名，大多数浏览器允许同时建立6个持久连接引入了管道机制，即在同一个TCP连接里，客户端可以同时发送多个请求，进一步改进了HTTP协议的效率。</p>
<p>新增方法：PUT、PATCH、OPTIONS、DELETE。</p>
<p>同一个TCP连接里，所有的数据通信是按次序进行的。服务器只能顺序处理回应，前面的回应慢，会有许多请求排队，造成”队头堵塞”（Head-of-line blocking）。</p>
<p>为避免上述问题，两种方法：一是减少请求数，二是同时多开持久连接。</p>
<p>网页优化技巧，如合并脚本和样式表、将图片嵌入CSS代码、域名分片（domain sharding）等。</p>
<p>HTTP 协议不带有状态，每次请求都必须附上所有信息。请求的很多字段都是重复的，浪费带宽，影响速度。</p>
<h4 id="1-4-6-4-HTTP1-0和HTTP1-1的区别"><a href="#1-4-6-4-HTTP1-0和HTTP1-1的区别" class="headerlink" title="1.4.6.4 HTTP1.0和HTTP1.1的区别"></a>1.4.6.4 HTTP1.0和HTTP1.1的区别</h4><p>" srcset="/blog/img/loading.gif<img src="" alt="HTTP1.0和HTTP1.1的区别"></p>
<ul>
<li>缓存处理，在HTTP1.0中主要使用header里的If-Modified-Since,Expires来做为缓存判断的标准，HTTP1.1则引入了更多的缓存控制策略例如Entity tag，If-Unmodified-Since, If-Match, If-None-Match等更多可供选择的缓存头来控制缓存策略。</li>
<li>带宽优化及网络连接的使用，HTTP1.0中，存在一些浪费带宽的现象，例如：客户端只是需要某个对象的一部分，而服务器却将整个对象送过来了，并且不支持断点续传功能，HTTP1.1则在请求头引入了range头域，它允许只请求资源的某个部分，即返回码是206（Partial Content），方便了开发者自由的选择以便于充分利用带宽和连接。</li>
<li>错误通知的管理，在HTTP1.1中新增24个状态响应码，如409（Conflict）表示请求的资源与资源当前状态冲突；410（Gone）表示服务器上的某个资源被永久性的删除。</li>
<li>Host 头处理，在HTTP1.0中认为每台服务器都绑定一个唯一的IP地址，因此，请求消息中的URL并没有传递主机名（hostname）。但随着虚拟主机技术的发展，在一台物理服务器上可以存在多个虚拟主机（Multi-homed Web Servers），并且它们共享一个IP地址。HTTP1.1的请求消息和响应消息都应支持Host头域，且请求消息中如果没有Host头域会报告一个错误（400 Bad Request）。</li>
<li>长连接，HTTP 1.1支持持久连接（PersistentConnection）和请求的流水线（Pipelining）处理，在一个TCP连接上可以传送多个HTTP请求和响应，减少了建立和关闭连接的消耗和延迟，在HTTP1.1中默认开启Connection： keep-alive，弥补了HTTP1.0每次请求都要创建连接的缺点。</li>
</ul>
<h4 id="1-4-6-5-HTTP1-0和1-1的问题"><a href="#1-4-6-5-HTTP1-0和1-1的问题" class="headerlink" title="1.4.6.5 HTTP1.0和1.1的问题"></a>1.4.6.5 HTTP1.0和1.1的问题</h4><ul>
<li>HTTP1.x在传输数据时，每次都需要重新建立连接，无疑增加了大量的延迟时间，特别是在移动端更为突出。</li>
<li>HTTP1.x在传输数据时，所有传输的内容都是明文，客户端和服务器端都无法验证对方的身份，无法保证数据的安全性。</li>
<li>HTTP1.x在使用时，header里携带的内容过大，增加了传输的成本，并且每次请求header基本不怎么变化，尤其在移动端增加用户流量。</li>
<li>虽然HTTP1.x支持了keep-alive，来弥补多次创建连接产生的延迟，但是keep-alive使用多了同样会给服务端带来大量的性能压力，并且对于单个文件被不断请求的服务(例如图片存放网站)，keep-alive可能会极大的影响性能，因为它在文件被请求之后还保持了不必要的连接很长时间。</li>
</ul>
<h4 id="1-4-6-6-HTTPS协议"><a href="#1-4-6-6-HTTPS协议" class="headerlink" title="1.4.6.6 HTTPS协议"></a>1.4.6.6 HTTPS协议</h4><p>为解决安全问题，网景在1994年创建了HTTPS，并应用在网景导航者浏览器中。 最初，HTTP是与SSL一起使用的；在SSL逐渐演变到TLS时（其实两个是一个东西，只是名字不同而已），最新的HTTPS也由在2000年五月公布的RFC 2818正式确定下来。HTTPS就是安全版的HTTP，目前大型网站基本实现全站HTTPS。</p>
<h4 id="1-4-6-7-HTTPS特点"><a href="#1-4-6-7-HTTPS特点" class="headerlink" title="1.4.6.7 HTTPS特点"></a>1.4.6.7 HTTPS特点</h4><ul>
<li>HTTPS协议需要到CA申请证书，一般免费证书很少，需要交费。</li>
<li>HTTP协议运行在TCP之上，所有传输的内容都是明文，HTTPS运行在SSL/TLS之上，SSL/TLS运行在TCP之上，所有传输的内容都经过加密的。</li>
<li>HTTP和HTTPS使用的是不同的连接方式，端口不同，前者是80，后者是443。</li>
<li>HTTPS可以有效的防止运营商劫持，解决了防劫持的一个大问题。</li>
<li>HTTPS 实现过程降低用户访问速度，但经过合理优化和部署，HTTPS 对速度的影响还是可以接受的。</li>
</ul>
<h4 id="1-4-6-8-SPDY协议"><a href="#1-4-6-8-SPDY协议" class="headerlink" title="1.4.6.8 SPDY协议"></a>1.4.6.8 SPDY协议</h4><p>SPDY：2009年谷歌研发，综合HTTPS和HTTP两者有点于一体的传输协议，主要特点：</p>
<ul>
<li>降低延迟，针对HTTP高延迟的问题，SPDY优雅的采取了多路复用（multiplexing）。多路复用通过多个请求stream共享一个tcp连接的方式，解决了HOL blocking的问题，降低了延迟同时提高了带宽的利用率。</li>
<li>请求优先级（request prioritization）。多路复用带来一个新的问题是，在连接共享的基础之上有可能会导致关键请求被阻塞。SPDY允许给每个request设置优先级，重要的请求就会优先得到响应。比如浏览器加载首页，首页的html内容应该优先展示，之后才是各种静态资源文件，脚本文件等加载，可以保证用户能第一时间看到网页内容。</li>
<li>header压缩。HTTP1.x的header很多时候都是重复多余的。选择合适的压缩算法可以减小包的大小和数量。</li>
<li>基于HTTPS的加密协议传输，大大提高了传输数据的可靠性。</li>
<li>服务端推送（server push），采用了SPDY的网页，例如网页有一个sytle.css的请求，在客户端收到sytle.css数据的同时，服务端会将sytle.js的文件推送给客户端，当客户端再次尝试获取sytle.js时就可以直接从缓存中获取到，不用再发请求了。</li>
</ul>
<h4 id="1-4-6-9-HTTP2协议"><a href="#1-4-6-9-HTTP2协议" class="headerlink" title="1.4.6.9 HTTP2协议"></a>1.4.6.9 HTTP2协议</h4><p>http/2.0：2015年，HTTP2.0是SPDY的升级版</p>
<ul>
<li>头信息和数据体都是二进制，称为头信息帧和数据帧。</li>
<li>复用TCP连接，在一个连接里，客户端和浏览器都可以同时发送多个请求或回应，且不用按顺序一一对应，避免了”队头堵塞”,此双向的实时通信称为多工（Multiplexing）。</li>
<li>引入头信息压缩机制（header compression）,头信息使用gzip或compress压缩后再发送；客户端和服务器同时维护一张头信息表，所有字段都会存入这个表，生成一个索引号，不发送同样字段，只发送索引号，提高速度。</li>
<li>HTTP/2 允许服务器未经请求，主动向客户端发送资源，即服务器推送（server push）。</li>
</ul>
<h4 id="1-4-6-10-HTTP2-0和SPDY区别"><a href="#1-4-6-10-HTTP2-0和SPDY区别" class="headerlink" title="1.4.6.10 HTTP2.0和SPDY区别"></a>1.4.6.10 HTTP2.0和SPDY区别</h4><ul>
<li>HTTP2.0 支持明文 HTTP 传输，而 SPDY 强制使用 HTTPS。</li>
<li>HTTP2.0 消息头的压缩算法采用 HPACK，而非 SPDY 采用的 DEFLATE。</li>
</ul>
<h3 id="1-4-7-HTTP-请求访问的完整过程"><a href="#1-4-7-HTTP-请求访问的完整过程" class="headerlink" title="1.4.7 HTTP 请求访问的完整过程"></a>1.4.7 HTTP 请求访问的完整过程</h3><h4 id="1-4-7-1-HTTP-请求访问的完整过程图"><a href="#1-4-7-1-HTTP-请求访问的完整过程图" class="headerlink" title="1.4.7.1 HTTP 请求访问的完整过程图"></a>1.4.7.1 HTTP 请求访问的完整过程图</h4><p>" srcset="/blog/img/loading.gif<img src="" alt="HTTP 请求访问的完整过程"></p>
<h4 id="1-4-7-2-一次完整的http请求处理过程"><a href="#1-4-7-2-一次完整的http请求处理过程" class="headerlink" title="1.4.7.2 一次完整的http请求处理过程"></a>1.4.7.2 一次完整的http请求处理过程</h4><p>1、建立连接：接收或拒绝连接请求。</p>
<p>2、接收请求：接收客户端请求报文中对某资源的一次请求的过程。</p>
<p><strong>Web访问响应模型（Web I/O）</strong></p>
<p>" srcset="/blog/img/loading.gif<img src="" alt="Web访问响应模型（Web I/O）"></p>
<ul>
<li>单进程I/O模型：启动一个进程处理用户请求，而且一次只处理一个，多个请求被串行响应。</li>
<li>多进程I/O模型：并行启动多个进程,每个进程响应一个连接请求。</li>
<li>复用I/O结构：启动一个进程，同时响应N个连接请求。</li>
<li>复用的多进程I/O模型：启动M个进程，每个进程响应N个连接请求，同时接收M*N个请求。</li>
</ul>
<p>3、处理请求：服务器对请求报文进行解析，并获取请求的资源及请求方法等相关信息，根据方法，资源，首部和可选的主体部分对请求进行处理。</p>
<p>常用请求Method: GET、POST、HEAD、PUT、DELETE、TRACE、OPTIONS。</p>
<p>4、访问资源</p>
<p>服务器获取请求报文中请求的资源web服务器，即存放了web资源的服务器，负责向请求者提供对方请求的静态资源，或动态运行后生成的资源。</p>
<p>5、构建响应报文</p>
<p>一旦Web服务器识别除了资源，就执行请求方法中描述的动作，并返回响应报文。响应报文中 包含有响应状态码、响应首部，如果生成了响应主体的话，还包括响应主体：<br>1）响应实体：如果事务处理产生了响应主体，就将内容放在响应报文中回送过去。响应报文中通常包括：</p>
<ul>
<li>描述了响应主体MIME类型的Content-Type首部。</li>
<li>描述了响应主体长度的Content-Length。</li>
<li>实际报文的主体内容。</li>
</ul>
<p>2）URL重定向：web服务构建的响应并非客户端请求的资源，而是资源另外一个访问路径。</p>
<p>3）MIME类型： Web服务器要负责确定响应主体的MIME类型。多种配置服务器的方法可将MIME类型与资源管理起来。</p>
<ul>
<li>魔法分类：Apache web服务器可以扫描每个资源的内容，并将其与一个已知模式表(被称为魔法文件)进行匹配，以决定每个文件的MIME类型。这样做可能比较慢，但很方便，尤其是文件没有标准扩展名时。</li>
<li>显式分类：可以对Web服务器进行配置，使其不考虑文件的扩展名或内容，强制特定文件或目录内容拥有某个MIME类型。</li>
<li>类型协商： 有些Web服务器经过配置，可以以多种文档格式来存储资源。在这种情况下，可以配置Web服务器，使其可以通过与用户的协商来决定使用哪种格式(及相关的MIME类型)”最好”。</li>
</ul>
<p>6、发送响应报文</p>
<p>Web服务器通过连接发送数据时也会面临与接收数据一样的问题。服务器可能有很多条到各个客户端的连接，有些是空闲的，有些在向服务器发送数据，还有一些在向客户端回送响应数据。服务器要记录连接的状态，还要特别注意对持久连接的处理。对非持久连接而言，服务器应该在发送了整条报文之后，关闭自己这一端的连接。对持久连接来说，连接可能仍保持打开状态，在这种情况下，服务器要正确地计算Content-Length首部，不然客户端就无法知道响应什么时候结束。</p>
<p>7、记录日志</p>
<p>最后，当事务结束时，Web服务器会在日志文件中添加一个条目，来描述已执行的事务。</p>
<h1 id="二、httpd-安装和组成"><a href="#二、httpd-安装和组成" class="headerlink" title="二、httpd 安装和组成"></a>二、httpd 安装和组成</h1><p>http 服务基于 C/S 结构</p>
<h2 id="2-1-常见-http-服务器程序"><a href="#2-1-常见-http-服务器程序" class="headerlink" title="2.1 常见 http 服务器程序"></a>2.1 常见 http 服务器程序</h2><ul>
<li>httpd apache，存在C10K（10K connections）问题。</li>
<li>nginx 解决C10K问题。</li>
<li>lighttpd。</li>
<li>IIS .asp：应用程序服务器。</li>
<li>tomcat .jsp：应用程序服务器。</li>
<li>jetty： 开源的servlet容器，基于Java的web容器。</li>
<li>Resin： CAUCHO公司，支持servlets和jsp的引擎。</li>
<li>webshpere：IBM公司。</li>
<li>weblogic：BEA，Oracle。</li>
<li>jboss：RedHat，IBM。</li>
<li>oc4j：Oracle</li>
</ul>
<p><strong>HTTP服务器市场占有率统计</strong>： <a target="_blank" rel="noopener" href="https://news.netcraft.com/">https://news.netcraft.com/</a></p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache3.png" srcset="/blog/img/loading.gif"></p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache4.png" srcset="/blog/img/loading.gif"></p>
<h2 id="2-2-apache介绍和特点"><a href="#2-2-apache介绍和特点" class="headerlink" title="2.2 apache介绍和特点"></a>2.2 apache介绍和特点</h2><h3 id="2-2-1-apache-介绍"><a href="#2-2-1-apache-介绍" class="headerlink" title="2.2.1 apache 介绍"></a>2.2.1 apache 介绍</h3><p>20世纪90年代初，国家超级计算机应用中心NCSA开发,1995年开源社区发布apache。</p>
<p>apache 名字来源，流传最广的解释是（也是最显而易见的）：这个名字来自于一个事实：当Apache在1995年初开发的时候，它是由当时最流行的HTTP服务器NCSA HTTPd 1.3的代码修改而成的，因此是”一个修补的（a patchy）”服务器。然而，在Apache服务器官方网站的FAQ中是这么解释的：”Apache这个名字是为了纪念名为Apache的美洲原住民印第安人的一支，众所周知他们拥有高超的作战策略和无穷的耐性。”贝伦多夫说：”我选择阿帕奇这个名字是取其积极含义。阿帕奇族是最后一个屈服于美国政府的民族。当时我们担心大公司迟早会参与竞争并‘教化’这块最早的网络之地，所以在我看来，阿帕奇是个很好的名称，也有人说这个词一语双关-因为正如Apache（与”a patchy”谐音）的名字所表明的那样，他们确实是在给服务器打补丁。”</p>
<p><strong>软件基金会</strong></p>
<ul>
<li><p>ASF：apache software foundation</p>
</li>
<li><p>FSF：Free Software Foundation</p>
</li>
</ul>
<p><strong>apache 功能</strong></p>
<ul>
<li>提供http协议服务。</li>
<li>多个虚拟主机：IP、Port、FQDN。</li>
<li>CGI：Common Gateway Interface，通用网关接口,支持动态程序。</li>
<li>反向代理。</li>
<li>负载均衡。</li>
<li>路径别名。</li>
<li>丰富的用户认证机制：basic，digest。</li>
<li>支持第三方模块。</li>
</ul>
<p><strong>httpd-2.4 新特性</strong></p>
<ul>
<li>MPM支持运行为DSO机制；以模块形式按需加载。</li>
<li>event MPM生产环境可用。</li>
<li>异步读写机制。</li>
<li>支持每模块及每目录的单独日志级别定义。</li>
<li>每请求相关的专用配置。</li>
<li>增强版的表达式分析式。</li>
<li>毫秒级持久连接时长定义。</li>
<li>基于FQDN的虚拟主机不需要NameVirutalHost指令。</li>
<li>新指令。</li>
<li>支持用户自定义变量。</li>
<li>更低的内存消耗。</li>
</ul>
<p><strong>apache特性</strong></p>
<ul>
<li>高度模块化：core + modules</li>
<li>DSO：Dynamic Shared Object 动态加载/卸载</li>
<li>MPM：multi-processing module 多路处理模块</li>
</ul>
<p>httpd 官方链接: <a target="_blank" rel="noopener" href="http://httpd.apache.org/">http://httpd.apache.org/</a></p>
<h3 id="2-2-2-MPM-multi-processing-module-工作模式"><a href="#2-2-2-MPM-multi-processing-module-工作模式" class="headerlink" title="2.2.2 MPM multi-processing module 工作模式"></a>2.2.2 MPM multi-processing module 工作模式</h3><ul>
<li><p>prefork：多进程I/O模型，每个进程响应一个请求，CentOS 7 httpd默认模型。</p>
<p>一个主进程：生成和回收n个子进程，创建套接字，不响应请求。</p>
<p>多个子进程：工作进程，每个子进程处理一个请求；系统初始时，预先生成多个空闲进程，等待请求。</p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<p>Prefork MPM预派生模式，有一个主控制进程，然后生成多个子进程,每个子进程有一个独立的线程响应用户请求，相对比较占用内存，但是比较稳定，可以设置最大和最小进程数，是最古老的一种模式，也是最稳定的模式，适用于访问量不是很大的场景。</p>
<p>优点：稳定。</p>
<p>缺点：慢，占用资源，不适用于高并发场景。</p>
</li>
<li><p>worker：复用的多进程I/O模型,多进程多线程，IIS使用此模型。</p>
<p>一个主进程：生成m个子进程，每个子进程负责生个n个线程，每个线程响应一个请求，并发响应请求：m*n。</p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<p>worker MPM是一种多进程和多线程混合的模型，有一个控制进程，启动多个子进程，每个子进程里面包含固定的线程，使用线程程来处理请求，当线程不够使用的时候会再启动一个新的子进程，然后在进程里面再启动线程处理请求，由于其使用了线程处理请求，因此可以承受更高的并发。</p>
<p>优点：相比prefork 占用的内存较少，可以同时处理更多的请求。</p>
<p>缺点：使用keep-alive的长连接方式，某个线程会一直被占据，即使没有传输数据，也需要一直等待到超时才会被释放。如果过多的线程，被这样占据，也会导致在高并发场景下的无服务线程可用。（该问题在prefork模式下，同样会发生）</p>
</li>
<li><p>event：事件驱动模型（worker模型的变种），CentOS8 默认模型。</p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<p>一个主进程：生成m个子进程，每个子进程负责生个n个线程，每个线程响应一个请求，并发响应请求：m*n，有专门的监控线程来管理这些keep-alive类型的线程，当有真实请求时，将请求传递给服务线程，执行完毕后，又允许释放。这样增强了高并发场景下的请求处理能力。</p>
<p>event MPM是Apache中最新的模式，2012年发布的apache 2.4.X系列正式支持event 模型.。属于事件驱动模型(epoll)，每个进程响应多个请求，在现在版本里的已经是稳定可用的模式。它和worker模式很像，最大的区别在于，它解决了keep-alive场景下，长期被占用的线程的资源浪费问题（某些线程因为被keep-alive，空挂在哪里等待，中间几乎没有请求过来，甚至等到超时）。eventMPM中，会有一个专门的线程来管理这些keep-alive类型的线程，当有真实请求过来的时候，将请求传递给服务线程，执行完毕后，又允许它释放。这样增强了高并发场景下的请求处理能力。</p>
<p>event只在有数据发送的时候才开始建立连接，连接请求才会触发工作线程，即使用了TCP的一个选项，叫做延迟接受连接TCP_DEFER_ACCEPT，加了这个选项后，若客户端只进行TCP连接，不发送请求，则不会触发Accept操作，也就不会触发工作线程去干活，进行了简单的防攻击（TCP连接）。</p>
<p>优点：单线程响应多请求，占据更少的内存，高并发下表现更优秀，会有一个专门的线程来管理keep-alive类型的线程，当有真实请求过来的时候，将请求传递给服务线程，执行完毕后，又允许它释放。</p>
<p>缺点：没有线程安全控制。</p>
<p>httpd-2.4：event 稳定版，centos7 以后默认。</p>
<p>httpd-2.2：event 测试版，centos6 默认。</p>
</li>
</ul>
<h2 id="2-3-Httpd-安装和相关文件"><a href="#2-3-Httpd-安装和相关文件" class="headerlink" title="2.3 Httpd 安装和相关文件"></a>2.3 Httpd 安装和相关文件</h2><h3 id="2-3-1-包安装httpd并启动httpd服务"><a href="#2-3-1-包安装httpd并启动httpd服务" class="headerlink" title="2.3.1 包安装httpd并启动httpd服务"></a>2.3.1 包安装httpd并启动httpd服务</h3><p>版本说明：<br>CentOS 7 以上，默认系统是httpd 2.4，CentOS 6 版默认为httpd 2.2。</p>
<p>Ubuntu 18.04 默认 Apache/2.4.29。</p>
<p><strong>安装方式：</strong></p>
<ul>
<li>包安装: centos发行版，稳定，建议使用</li>
<li>编译：定制或特殊需求</li>
</ul>
<h4 id="2-3-1-1-CentOS-7-X-安装httpd-2-4"><a href="#2-3-1-1-CentOS-7-X-安装httpd-2-4" class="headerlink" title="2.3.1.1 CentOS 7.X 安装httpd 2.4"></a>2.3.1.1 CentOS 7.X 安装httpd 2.4</h4><p><strong>安装httpd</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum install -y httpd</span><br><br><span class="hljs-comment"># httpd -v</span><br>Server version: Apache/2.4.6 (CentOS)<br>Server built:   Mar 24 2022 14:57:57<br><br><span class="hljs-comment"># httpd -V</span><br>Server version: Apache/2.4.6 (CentOS)<br>Server built:   Mar 24 2022 14:57:57<br>Server<span class="hljs-string">&#x27;s Module Magic Number: 20120211:24</span><br><span class="hljs-string">Server loaded:  APR 1.4.8, APR-UTIL 1.5.2</span><br><span class="hljs-string">Compiled using: APR 1.4.8, APR-UTIL 1.5.2</span><br><span class="hljs-string">Architecture:   64-bit</span><br><span class="hljs-string">Server MPM:     prefork</span><br><span class="hljs-string">  threaded:     no</span><br><span class="hljs-string">    forked:     yes (variable process count)</span><br><span class="hljs-string">Server compiled with....</span><br><span class="hljs-string"> -D APR_HAS_SENDFILE</span><br><span class="hljs-string"> -D APR_HAS_MMAP</span><br><span class="hljs-string"> -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)</span><br><span class="hljs-string"> -D APR_USE_SYSVSEM_SERIALIZE</span><br><span class="hljs-string"> -D APR_USE_PTHREAD_SERIALIZE</span><br><span class="hljs-string"> -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT</span><br><span class="hljs-string"> -D APR_HAS_OTHER_CHILD</span><br><span class="hljs-string"> -D AP_HAVE_RELIABLE_PIPED_LOGS</span><br><span class="hljs-string"> -D DYNAMIC_MODULE_LIMIT=256</span><br><span class="hljs-string"> -D HTTPD_ROOT=&quot;/etc/httpd&quot;</span><br><span class="hljs-string"> -D SUEXEC_BIN=&quot;/usr/sbin/suexec&quot;</span><br><span class="hljs-string"> -D DEFAULT_PIDLOG=&quot;/run/httpd/httpd.pid&quot;</span><br><span class="hljs-string"> -D DEFAULT_SCOREBOARD=&quot;logs/apache_runtime_status&quot;</span><br><span class="hljs-string"> -D DEFAULT_ERRORLOG=&quot;logs/error_log&quot;</span><br><span class="hljs-string"> -D AP_TYPES_CONFIG_FILE=&quot;conf/mime.types&quot;</span><br><span class="hljs-string"> -D SERVER_CONFIG_FILE=&quot;conf/httpd.conf&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>启动httpd</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># systemctl enable --now httpd</span><br><span class="hljs-comment"># systemctl status httpd</span><br>● httpd.service - The Apache HTTP Server<br>   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disabled)<br>   Active: active (running) since Fri 2022-11-04 16:44:55 CST; 18s ago<br>     Docs: man:httpd(8)<br>           man:apachectl(8)<br> Main PID: 793 (httpd)<br>   Status: <span class="hljs-string">&quot;Total requests: 0; Current requests/sec: 0; Current traffic:   0 B/sec&quot;</span><br>   CGroup: /system.slice/httpd.service<br>           ├─ 793 /usr/sbin/httpd -DFOREGROUND<br>           ├─1259 /usr/sbin/httpd -DFOREGROUND<br>           ├─1260 /usr/sbin/httpd -DFOREGROUND<br>           ├─1261 /usr/sbin/httpd -DFOREGROUND<br>           ├─1262 /usr/sbin/httpd -DFOREGROUND<br>           └─1263 /usr/sbin/httpd -DFOREGROUND<br><br>Nov 04 16:44:08 CentOS7.9 systemd[1]: Starting The Apache HTTP Server...<br>Nov 04 16:44:55 CentOS7.9 systemd[1]: Started The Apache HTTP Server.<br></code></pre></td></tr></table></figure>

<h4 id="2-3-1-2-Ubuntu-1804-安装-httpd"><a href="#2-3-1-2-Ubuntu-1804-安装-httpd" class="headerlink" title="2.3.1.2 Ubuntu 1804 安装 httpd"></a>2.3.1.2 Ubuntu 1804 安装 httpd</h4><p><strong>安装httpd</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># apt install -y apache2</span><br><span class="hljs-comment"># apache2 -v</span><br><br><span class="hljs-comment"># apache2 -V</span><br></code></pre></td></tr></table></figure>

<p><strong>启动httpd</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># systemctl start apache2</span><br><span class="hljs-comment"># systemctl status apache2</span><br></code></pre></td></tr></table></figure>

<h3 id="2-3-2-httpd-2-4-相关文件"><a href="#2-3-2-httpd-2-4-相关文件" class="headerlink" title="2.3.2 httpd-2.4 相关文件"></a>2.3.2 httpd-2.4 相关文件</h3><p>配置文件：</p>
<ul>
<li><p><code>/etc/httpd/conf/httpd.conf</code> 主配置文件</p>
</li>
<li><p><code>/etc/httpd/conf.d/*.conf</code> 子配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ls /etc/httpd/conf.d/</span><br>autoindex.conf  README  userdir.conf  welcome.conf<br></code></pre></td></tr></table></figure></li>
<li><p><code>/etc/httpd/conf.modules.d</code> 模块加载的配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ls /etc/httpd/conf.modules.d</span><br>00-base.conf  00-dav.conf  00-lua.conf  00-mpm.conf  00-proxy.conf  00-systemd.conf  01-cgi.conf<br></code></pre></td></tr></table></figure></li>
</ul>
<p><strong>检查配置语法</strong>：<code>httpd -t</code> 或 <code>apache2 -t</code></p>
<p>服务单元文件：</p>
<ul>
<li><code>/usr/lib/systemd/system/httpd.service</code></li>
<li>配置文件：<code>/etc/sysconfig/httpd</code></li>
</ul>
<p>服务控制和启动</p>
<ul>
<li>systemctl enable|disable httpd.service</li>
<li>systemctl {start|stop|restart|status|reload} httpd.service</li>
<li>apachectl start|stop|restart|configtest</li>
<li>service httpd configtest</li>
</ul>
<p>站点网页文档根目录：/var/www/html</p>
<p>模块文件路径：</p>
<ul>
<li><p><code>/etc/httpd/modules</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ls /etc/httpd/modules</span><br>mod_access_compat.so    mod_cgid.so                 mod_lbmethod_bytraffic.so  mod_ratelimit.so<br>mod_actions.so          mod_cgi.so                  mod_lbmethod_heartbeat.so  mod_reflector.so<br>mod_alias.so            mod_charset_lite.so         mod_log_config.so          mod_remoteip.so<br>mod_allowmethods.so     mod_data.so                 mod_log_debug.so           mod_reqtimeout.so<br>mod_asis.so             mod_dav_fs.so               mod_log_forensic.so        mod_request.so<br>mod_auth_basic.so       mod_dav_lock.so             mod_logio.so               mod_rewrite.so<br>mod_auth_digest.so      mod_dav.so                  mod_lua.so                 mod_sed.so<br>mod_authn_anon.so       mod_dbd.so                  mod_macro.so               mod_setenvif.so<br>mod_authn_core.so       mod_deflate.so              mod_mime_magic.so          mod_slotmem_plain.so<br>mod_authn_dbd.so        mod_dialup.so               mod_mime.so                mod_slotmem_shm.so<br>mod_authn_dbm.so        mod_dir.so                  mod_mpm_event.so           mod_socache_dbm.so<br>mod_authn_file.so       mod_dumpio.so               mod_mpm_prefork.so         mod_socache_memcache.so<br>mod_authn_socache.so    mod_echo.so                 mod_mpm_worker.so          mod_socache_shmcb.so<br>mod_authz_core.so       mod_env.so                  mod_negotiation.so         mod_speling.so<br>mod_authz_dbd.so        mod_expires.so              mod_proxy_ajp.so           mod_status.so<br>mod_authz_dbm.so        mod_ext_filter.so           mod_proxy_balancer.so      mod_substitute.so<br>mod_authz_groupfile.so  mod_file_cache.so           mod_proxy_connect.so       mod_suexec.so<br>mod_authz_host.so       mod_filter.so               mod_proxy_express.so       mod_systemd.so<br>mod_authz_owner.so      mod_headers.so              mod_proxy_fcgi.so          mod_unique_id.so<br>mod_authz_user.so       mod_heartbeat.so            mod_proxy_fdpass.so        mod_unixd.so<br>mod_autoindex.so        mod_heartmonitor.so         mod_proxy_ftp.so           mod_userdir.so<br>mod_buffer.so           mod_include.so              mod_proxy_http.so          mod_usertrack.so<br>mod_cache_disk.so       mod_info.so                 mod_proxy_scgi.so          mod_version.so<br>mod_cache.so            mod_lbmethod_bybusyness.so  mod_proxy.so               mod_vhost_alias.so<br>mod_cache_socache.so    mod_lbmethod_byrequests.so  mod_proxy_wstunnel.so      mod_watchdog.so<br></code></pre></td></tr></table></figure></li>
<li><p><code>/usr/lib64/httpd/modules</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sh">mod_access_compat.so    mod_cgid.so                 mod_lbmethod_bytraffic.so  mod_ratelimit.so<br>mod_actions.so          mod_cgi.so                  mod_lbmethod_heartbeat.so  mod_reflector.so<br>mod_alias.so            mod_charset_lite.so         mod_log_config.so          mod_remoteip.so<br>mod_allowmethods.so     mod_data.so                 mod_log_debug.so           mod_reqtimeout.so<br>mod_asis.so             mod_dav_fs.so               mod_log_forensic.so        mod_request.so<br>mod_auth_basic.so       mod_dav_lock.so             mod_logio.so               mod_rewrite.so<br>mod_auth_digest.so      mod_dav.so                  mod_lua.so                 mod_sed.so<br>mod_authn_anon.so       mod_dbd.so                  mod_macro.so               mod_setenvif.so<br>mod_authn_core.so       mod_deflate.so              mod_mime_magic.so          mod_slotmem_plain.so<br>mod_authn_dbd.so        mod_dialup.so               mod_mime.so                mod_slotmem_shm.so<br>mod_authn_dbm.so        mod_dir.so                  mod_mpm_event.so           mod_socache_dbm.so<br>mod_authn_file.so       mod_dumpio.so               mod_mpm_prefork.so         mod_socache_memcache.so<br>mod_authn_socache.so    mod_echo.so                 mod_mpm_worker.so          mod_socache_shmcb.so<br>mod_authz_core.so       mod_env.so                  mod_negotiation.so         mod_speling.so<br>mod_authz_dbd.so        mod_expires.so              mod_proxy_ajp.so           mod_status.so<br>mod_authz_dbm.so        mod_ext_filter.so           mod_proxy_balancer.so      mod_substitute.so<br>mod_authz_groupfile.so  mod_file_cache.so           mod_proxy_connect.so       mod_suexec.so<br>mod_authz_host.so       mod_filter.so               mod_proxy_express.so       mod_systemd.so<br>mod_authz_owner.so      mod_headers.so              mod_proxy_fcgi.so          mod_unique_id.so<br>mod_authz_user.so       mod_heartbeat.so            mod_proxy_fdpass.so        mod_unixd.so<br>mod_autoindex.so        mod_heartmonitor.so         mod_proxy_ftp.so           mod_userdir.so<br>mod_buffer.so           mod_include.so              mod_proxy_http.so          mod_usertrack.so<br>mod_cache_disk.so       mod_info.so                 mod_proxy_scgi.so          mod_version.so<br>mod_cache.so            mod_lbmethod_bybusyness.so  mod_proxy.so               mod_vhost_alias.so<br>mod_cache_socache.so    mod_lbmethod_byrequests.so  mod_proxy_wstunnel.so      mod_watchdog.so<br></code></pre></td></tr></table></figure></li>
<li><p>两个的区别</p>
<p><code>/etc/httpd/modules</code>是<code>/usr/lib64/httpd/modules</code>的软链接</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ll /etc/httpd/modules</span><br>lrwxrwxrwx. 1 root root 29 Nov  4 16:39 /etc/httpd/modules -&gt; ../../usr/lib64/httpd/modules<br></code></pre></td></tr></table></figure></li>
</ul>
<p>主服务器程序文件：/usr/sbin/httpd</p>
<p>主进程文件： /etc/httpd/run/httpd.pid</p>
<p>日志文件目录：<code>/var/log/httpd</code></p>
<ul>
<li>access_log: 访问日志</li>
<li>error_log：错误日志</li>
</ul>
<p>帮助文档包：httpd-manual</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://10.0.0.7/manual/<br></code></pre></td></tr></table></figure>

<h3 id="2-3-3-httpd-配置文件的组成"><a href="#2-3-3-httpd-配置文件的组成" class="headerlink" title="2.3.3 httpd 配置文件的组成"></a>2.3.3 httpd 配置文件的组成</h3><p>主要组成</p>
<ul>
<li>Global Environment</li>
<li>Main server configuration</li>
<li>virtual host</li>
</ul>
<p>配置文件格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">directive value<br></code></pre></td></tr></table></figure>

<p>格式说明：</p>
<ul>
<li>directive 不区分字符大小写</li>
<li>value 为路径时，是否区分大小写，取决于文件系统</li>
</ul>
<p>配置文件语法检查：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># apachectl configtest</span><br><span class="hljs-comment"># apachectl -t</span><br><span class="hljs-comment"># httpd -t</span><br></code></pre></td></tr></table></figure>

<p>配置官方帮助： <a target="_blank" rel="noopener" href="http://httpd.apache.org/docs/2.4/">http://httpd.apache.org/docs/2.4/</a></p>
<p>范例：CentOS 7.X 默认配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># grep -Ev &#x27;^ *#|^$&#x27; /etc/httpd/conf/httpd.conf</span><br>ServerRoot <span class="hljs-string">&quot;/etc/httpd&quot;</span><br>Listen 80<br>Include conf.modules.d/*.conf<br>User apache<br>Group apache<br>ServerAdmin root@localhost<br>&lt;Directory /&gt;<br>    AllowOverride none<br>    Require all denied<br>&lt;/Directory&gt;<br>DocumentRoot <span class="hljs-string">&quot;/var/www/html&quot;</span><br>&lt;Directory <span class="hljs-string">&quot;/var/www&quot;</span>&gt;<br>    AllowOverride None<br>    Require all granted<br>&lt;/Directory&gt;<br>&lt;Directory <span class="hljs-string">&quot;/var/www/html&quot;</span>&gt;<br>    Options Indexes FollowSymLinks<br>    AllowOverride None<br>    Require all granted<br>&lt;/Directory&gt;<br>&lt;IfModule dir_module&gt;<br>    DirectoryIndex index.html<br>&lt;/IfModule&gt;<br>&lt;Files <span class="hljs-string">&quot;.ht*&quot;</span>&gt;<br>    Require all denied<br>&lt;/Files&gt;<br>ErrorLog <span class="hljs-string">&quot;logs/error_log&quot;</span><br>LogLevel warn<br>&lt;IfModule log_config_module&gt;<br>    LogFormat <span class="hljs-string">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot;</span> combined<br>    LogFormat <span class="hljs-string">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot;</span> common<br>    &lt;IfModule logio_module&gt;<br>      LogFormat <span class="hljs-string">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot; %I %O&quot;</span> combinedio<br>    &lt;/IfModule&gt;<br>    CustomLog <span class="hljs-string">&quot;logs/access_log&quot;</span> combined<br>&lt;/IfModule&gt;<br>&lt;IfModule alias_module&gt;<br>    ScriptAlias /cgi-bin/ <span class="hljs-string">&quot;/var/www/cgi-bin/&quot;</span><br>&lt;/IfModule&gt;<br>&lt;Directory <span class="hljs-string">&quot;/var/www/cgi-bin&quot;</span>&gt;<br>    AllowOverride None<br>    Options None<br>    Require all granted<br>&lt;/Directory&gt;<br>&lt;IfModule mime_module&gt;<br>    TypesConfig /etc/mime.types<br>    AddType application/x-compress .Z<br>    AddType application/x-gzip .gz .tgz<br>    AddType text/html .shtml<br>    AddOutputFilter INCLUDES .shtml<br>&lt;/IfModule&gt;<br>AddDefaultCharset UTF-8<br>&lt;IfModule mime_magic_module&gt;<br>    MIMEMagicFile conf/magic<br>&lt;/IfModule&gt;<br>EnableSendfile on<br>IncludeOptional conf.d/*.conf<br></code></pre></td></tr></table></figure>

<h3 id="2-3-4-CentOS-7-编译安装-httpd-2-4"><a href="#2-3-4-CentOS-7-编译安装-httpd-2-4" class="headerlink" title="2.3.4 CentOS 7 编译安装 httpd 2.4"></a>2.3.4 CentOS 7 编译安装 httpd 2.4</h3><h4 id="2-3-4-1-编译说明"><a href="#2-3-4-1-编译说明" class="headerlink" title="2.3.4.1 编译说明"></a>2.3.4.1 编译说明</h4><p>" srcset="/blog/img/loading.gif<img src=""></p>
<p>APR：Apache portable Run-time libraries，Apache可移植运行库，主要为上层的应用程序提供一个可以跨越多操作系统平台使用的底层支持接口库。在早期的Apache版本中，应用程序本身必须能够处理各种具体操作系统平台的细节，并针对不同的平台调用不同的处理函数随着Apache的进一步开发，Apache组织决定将这些通用的函数独立出来并发展成为一个新的项目。这样，APR的开发就从Apache中独立出来，Apache仅仅是使用 APR而已。目前APR主要还是由Apache使用，由于APR的较好的移植性，因此一些需要进行移植的C程序也开始使用APR，开源项目：比如用于服务器压力测试的Flood loader tester，项目站点：<a target="_blank" rel="noopener" href="http://httpd.apache.org/test/flood">http://httpd.apache.org/test/flood</a></p>
<p>APR官网：<a target="_blank" rel="noopener" href="http://apr.apache.org/">http://apr.apache.org</a></p>
<p>说明：安装httpd-2.4，依赖于apr-1.4+, apr-util-1.4+</p>
<h4 id="2-3-4-2-编译准备"><a href="#2-3-4-2-编译准备" class="headerlink" title="2.3.4.2 编译准备"></a>2.3.4.2 编译准备</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装相关包：</span><br><span class="hljs-comment"># yum -y install gcc make pcre-devel openssl-devel expat-devel</span><br><br><span class="hljs-comment">#下载源代码并解压缩：</span><br><span class="hljs-comment"># wget https://downloads.apache.org/apr/apr-1.7.0.tar.bz2</span><br><span class="hljs-comment"># wget https://downloads.apache.org/apr/apr-util-1.6.1.tar.bz2</span><br><span class="hljs-comment"># wget https://downloads.apache.org/httpd/httpd-2.4.54.tar.bz2</span><br><br><span class="hljs-comment">#ls</span><br>httpd-2.4.46.tar.bz2,apr-1.7.0.tar.bz2,apr-util-1.6.1.tar.bz2<br><br><span class="hljs-comment">#解压源码包</span><br><span class="hljs-comment"># tar xvf apr-1.7.0.tar.bz2</span><br><span class="hljs-comment"># tar xvf apr-util-1.6.1.tar.bz2</span><br><span class="hljs-comment"># tar xvf httpd-2.4.54.tar.bz2</span><br></code></pre></td></tr></table></figure>

<h4 id="2-3-4-2-编译安装httpd-2-4-方法一"><a href="#2-3-4-2-编译安装httpd-2-4-方法一" class="headerlink" title="2.3.4.2 编译安装httpd-2.4 方法一"></a>2.3.4.2 编译安装httpd-2.4 方法一</h4><p><strong>1 编译安装apr</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># cd apr-1.7.0</span><br><span class="hljs-comment"># ./configure --prefix=/apps/apr</span><br><span class="hljs-comment"># make &amp;&amp; make install</span><br>或<br><span class="hljs-comment"># make -j `lscpu | grep  &#x27;CPU(s):&#x27; | head -1 | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f2` &amp;&amp; make install</span><br></code></pre></td></tr></table></figure>

<p>注意：如果出现：<code>rm: cannot remove &#39;libtoolT&#39;: No such file or directory</code></p>
<p>对<code>$RM &quot;$cfgfile&quot;</code>进行注释</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">31877 <br>31878     cfgfile=<span class="hljs-variable">$&#123;ofile&#125;</span>T<br>31879     <span class="hljs-built_in">trap</span> <span class="hljs-string">&quot;<span class="hljs-variable">$RM</span> \&quot;<span class="hljs-variable">$cfgfile</span>\&quot;; exit 1&quot;</span> 1 2 15<br>31880     <span class="hljs-comment">#$RM &quot;$cfgfile&quot;</span><br>31881 <br>31882     cat &lt;&lt;<span class="hljs-string">_LT_EOF &gt;&gt; &quot;$cfgfile&quot;</span><br><span class="hljs-string">31883 #! $SHELL</span><br></code></pre></td></tr></table></figure>

<p><strong>2 编译安装apr-util</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># cd ../apr-util-1.6.1</span><br><span class="hljs-comment"># ./configure --prefix=/apps/apr-util --with-apr=/apps/apr/</span><br><span class="hljs-comment"># make -j `lscpu | grep  &#x27;CPU(s):&#x27; | head -1 | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f2` &amp;&amp; make install</span><br></code></pre></td></tr></table></figure>

<p><strong>3 编译安装 httpd-2.4</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># cd ../httpd-2.4.54</span><br><span class="hljs-comment"># ./configure --prefix=/apps/httpd24 \</span><br>--enable-so \<br>--enable-ssl \<br>--enable-cgi \<br>--enable-rewrite \<br>--with-zlib \<br>--with-pcre \<br>--with-apr=/apps/apr/ \<br>--with-apr-util=/apps/apr-util/ \<br>--enable-modules=most \<br>--enable-mpms-shared=all \<br>--with-mpm=prefork<br><span class="hljs-comment"># make -j `lscpu | grep  &#x27;CPU(s):&#x27; | head -1 | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f2` &amp;&amp; make install</span><br></code></pre></td></tr></table></figure>

<h4 id="2-3-4-3-编译安装httpd-2-4方法二"><a href="#2-3-4-3-编译安装httpd-2-4方法二" class="headerlink" title="2.3.4.3 编译安装httpd-2.4方法二"></a>2.3.4.3 编译安装httpd-2.4方法二</h4><p><strong>1 将apr 和apr-util源码与httpd 源码合并</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># tar xf apr-1.7.0.tar.bz2</span><br><span class="hljs-comment"># tar xf apr-util-1.6.1.tar.bz2</span><br><span class="hljs-comment"># tar xf httpd-2.4.54.tar.bz2</span><br><br><span class="hljs-comment"># mv apr-1.7.0 httpd-2.4.54/srclib/apr</span><br><span class="hljs-comment"># mv apr-util-1.6.1 httpd-2.4.54/srclib/apr-util</span><br><br><span class="hljs-comment"># ls httpd-2.4.54/srclib/</span><br>apr apr-util Makefile.in<br></code></pre></td></tr></table></figure>

<p><strong>2 将三者一并编译并安装</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># cd httpd-2.4.54/</span><br><span class="hljs-comment"># ./configure \</span><br>--prefix=/apps/httpd24 \<br>--enable-so \<br>--enable-ssl \<br>--enable-cgi \<br>--enable-rewrite \<br>--with-zlib \<br>--with-pcre \<br>--with-included-apr \<br>--enable-modules=most \<br>--enable-mpms-shared=all \<br>--with-mpm=prefork <br><span class="hljs-comment"># make -j `lscpu | grep  &#x27;CPU(s):&#x27; | head -1 | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f2` &amp;&amp; make install</span><br></code></pre></td></tr></table></figure>

<h4 id="2-3-4-4-编译安装后配置"><a href="#2-3-4-4-编译安装后配置" class="headerlink" title="2.3.4.4 编译安装后配置"></a>2.3.4.4 编译安装后配置</h4><p>Httpd编译过程：/apps/httpd24/build/config.nice</p>
<p>自带的服务控制脚本：/apps/httpd24/bin/apachectl</p>
<p><strong>1 创建专用用户</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># useradd -s /sbin/nologin -r apache</span><br></code></pre></td></tr></table></figure>

<p><strong>2 指定运行httpd的用户</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /apps/httpd24/conf/httpd</span><br>user apache<br>group apache<br></code></pre></td></tr></table></figure>

<p><strong>3 配置环境变量</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># echo &#x27;PATH=/apps/httpd24/bin:$PATH&#x27; &gt; /etc/profile.d/httpd.sh</span><br><br><span class="hljs-comment"># . /etc/profile.d/httpd.sh</span><br></code></pre></td></tr></table></figure>

<p><strong>4 查看httpd版本</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># httpd -v</span><br>Server version: Apache/2.4.54 (Unix)<br>Server built:   Nov  4 2022 18:19:07<br><br><span class="hljs-comment"># httpd -V</span><br>Server version: Apache/2.4.54 (Unix)<br>Server built:   Nov  4 2022 18:19:07<br>Server<span class="hljs-string">&#x27;s Module Magic Number: 20120211:124</span><br><span class="hljs-string">Server loaded:  APR 1.7.0, APR-UTIL 1.6.1, PCRE 8.32 2012-11-30</span><br><span class="hljs-string">Compiled using: APR 1.7.0, APR-UTIL 1.6.1, PCRE 8.32 2012-11-30</span><br><span class="hljs-string">Architecture:   64-bit</span><br><span class="hljs-string">Server MPM:     prefork</span><br><span class="hljs-string">  threaded:     no</span><br><span class="hljs-string">    forked:     yes (variable process count)</span><br><span class="hljs-string">Server compiled with....</span><br><span class="hljs-string"> -D APR_HAS_SENDFILE</span><br><span class="hljs-string"> -D APR_HAS_MMAP</span><br><span class="hljs-string"> -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)</span><br><span class="hljs-string"> -D APR_USE_PROC_PTHREAD_SERIALIZE</span><br><span class="hljs-string"> -D APR_USE_PTHREAD_SERIALIZE</span><br><span class="hljs-string"> -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT</span><br><span class="hljs-string"> -D APR_HAS_OTHER_CHILD</span><br><span class="hljs-string"> -D AP_HAVE_RELIABLE_PIPED_LOGS</span><br><span class="hljs-string"> -D DYNAMIC_MODULE_LIMIT=256</span><br><span class="hljs-string"> -D HTTPD_ROOT=&quot;/apps/httpd24&quot;</span><br><span class="hljs-string"> -D SUEXEC_BIN=&quot;/apps/httpd24/bin/suexec&quot;</span><br><span class="hljs-string"> -D DEFAULT_PIDLOG=&quot;logs/httpd.pid&quot;</span><br><span class="hljs-string"> -D DEFAULT_SCOREBOARD=&quot;logs/apache_runtime_status&quot;</span><br><span class="hljs-string"> -D DEFAULT_ERRORLOG=&quot;logs/error_log&quot;</span><br><span class="hljs-string"> -D AP_TYPES_CONFIG_FILE=&quot;conf/mime.types&quot;</span><br><span class="hljs-string"> -D SERVER_CONFIG_FILE=&quot;conf/httpd.conf&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>5 配置帮助</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/man_db.conf</span><br>MANDATORY_MANPATH                       /apps/httpd24/man<br></code></pre></td></tr></table></figure>

<p><strong>6 设置开机自动启动</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/rc.d/rc.local</span><br>/apps/httpd24/bin/apachectl start<br>chmod +x /etc/rc.d/rc.local<br></code></pre></td></tr></table></figure>

<p><strong>7.1 创建service unit文件(CentOS 7 以上版本)</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /usr/lib/systemd/system/httpd24.service</span><br>[Unit]<br>Description=The Apache HTTP Server<br>After=network.target remote-fs.target nss-lookup.target<br>Documentation=man:httpd(8)<br>Documentation=man:apachectl(8)<br>[Service]<br>Type=forking<br><span class="hljs-comment">#EnvironmentFile=/etc/sysconfig/httpd</span><br>ExecStart=/apps/httpd24/bin/apachectl start<br><span class="hljs-comment">#ExecStart=/apps/httpd24/bin/httpd $OPTIONS -k start</span><br>ExecReload=/apps/httpd24/bin/apachectl graceful<br><span class="hljs-comment">#ExecReload=/apps/httpd24/bin/httpd $OPTIONS -k graceful</span><br>ExecStop=/apps/httpd24/bin/apachectl stop<br>KillSignal=SIGCONT<br>PrivateTmp=<span class="hljs-literal">true</span><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure>

<p><strong>7.2 创建启动脚本(CentOS 6 以前版本)</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#自定义启动脚本(参考httpd-2.2的服务脚本)</span><br><span class="hljs-comment"># cp  /etc/rc.d/init.d/httpd /etc/rc.d/init.d/httpd24</span><br><span class="hljs-comment"># vim /etc/rc.d/init.d/httpd24</span><br>apachectl=/apps/httpd24/bin/apachectl<br>httpd=<span class="hljs-variable">$&#123;HTTPD-/apps/httpd24/bin/httpd&#125;</span><br>pidfile=<span class="hljs-variable">$&#123;PIDFILE-/apps/httpd24/logs/httpd.pid&#125;</span><br>lockfile=<span class="hljs-variable">$&#123;LOCKFILE-/var/lock/subsys/httpd24&#125;</span><br><br><span class="hljs-comment"># chkconfig -add httpd24</span><br><span class="hljs-comment"># chkconfig -list httpd24</span><br></code></pre></td></tr></table></figure>

<p><strong>8 查看版本</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># httpd -v</span><br></code></pre></td></tr></table></figure>

<h4 id="2-3-4-5-Shell-脚本安装-httpd-2-4"><a href="#2-3-4-5-Shell-脚本安装-httpd-2-4" class="headerlink" title="2.3.4.5 Shell 脚本安装 httpd-2.4"></a>2.3.4.5 Shell 脚本安装 httpd-2.4</h4><h5 id="2-3-4-5-1-范例-1"><a href="#2-3-4-5-1-范例-1" class="headerlink" title="2.3.4.5.1 范例 1"></a>2.3.4.5.1 范例 1</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#Author: 吴建富N46</span><br><br><span class="hljs-comment"># 安装相关包</span><br>yum -y install wget gcc make pcre-devel openssl-devel expat-devel<br><br><span class="hljs-comment"># 下载源代码并解压缩</span><br>wget -P /usr/<span class="hljs-built_in">local</span>/src/ https://mirror.bit.edu.cn/apache//apr/apr-1.7.0.tar.gz<br>wget -P /usr/<span class="hljs-built_in">local</span>/src/ https://mirror.bit.edu.cn/apache//apr/apr-util-<br>1.6.1.tar.gz<br>wget -P /usr/<span class="hljs-built_in">local</span>/src/ https://mirrors.bfsu.edu.cn/apache//httpd/httpd-<br>2.4.46.tar.gz<br><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/src/<br>tar xf apr-1.7.0.tar.gz<br>tar xf apr-util-1.6.1.tar.gz<br>tar xf httpd-2.4.46.tar.gz<br><br><span class="hljs-comment"># 将apr和apr-util源码与httpd源码合并，三者共同编译安装</span><br>mv apr-1.7.0 httpd-2.4.46/srclib/apr<br>mv apr-util-1.6.1 httpd-2.4.46/srclib/apr-util<br><span class="hljs-built_in">cd</span> httpd-2.4.46/<br>./configure --prefix=/apps/httpd --enable-so --enable-ssl --enable-cgi --<span class="hljs-built_in">enable</span>-<br>rewrite --with-zlib --with-pcre \<br>--with-included-apr --enable-modules=most --enable-mpms-shared=all --with-<br>mpm=prefork<br>make &amp;&amp; make install<br><br><span class="hljs-comment"># 创建apache账户</span><br>useradd -r -s /sbin/nologin apache<br><br><span class="hljs-comment"># 修改配置文件</span><br>sed -i <span class="hljs-string">&#x27;s/^User.*/User apache/&#x27;</span> /apps/httpd/conf/httpd.conf<br>sed -i <span class="hljs-string">&#x27;s/^Group.*/Group apache/&#x27;</span> /apps/httpd/conf/httpd.conf<br><br><span class="hljs-comment"># 配置环境变量</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;PATH=&quot;/apps/httpd/bin:$PATH&quot;&#x27;</span> &gt; /etc/profile.d/httpd.sh<br>. /etc/profile.d/httpd.sh<br><br><span class="hljs-comment"># 配置man帮助</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;MANDATORY_MANPATH  /apps/httpd/man&#x27;</span> &gt;&gt; /etc/man_db.conf<br><br><span class="hljs-comment"># 创建service unit文件，设置开机启动</span><br>cat &gt; /lib/systemd/system/httpd.service &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">[Unit]</span><br><span class="hljs-string">Description=The Apache HTTP Server</span><br><span class="hljs-string">After=network.target remote-fs.target nss-lookup.target</span><br><span class="hljs-string">Documentation=man:httpd(8)</span><br><span class="hljs-string">Documentation=man:apachectl(8)</span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">Type=forking</span><br><span class="hljs-string">ExecStart=/apps/httpd/bin/apachectl start</span><br><span class="hljs-string">ExecReload=/apps/httpd/bin/apachectl graceful</span><br><span class="hljs-string">ExecStop=/apps/httpd/bin/apachectl stop</span><br><span class="hljs-string"># We want systemd to give httpd some time to finish gracefully, but still want</span><br><span class="hljs-string"># it to kill httpd after TimeoutStopSec if something went wrong during the</span><br><span class="hljs-string"># graceful stop. Normally, Systemd sends SIGTERM signal right after the</span><br><span class="hljs-string"># ExecStop, which would kill httpd. We are sending useless SIGCONT here to give</span><br><span class="hljs-string"># httpd time to finish.</span><br><span class="hljs-string">KillSignal=SIGCONT</span><br><span class="hljs-string">PrivateTmp=true</span><br><span class="hljs-string">[Install]</span><br><span class="hljs-string">WantedBy=multi-user.target</span><br><span class="hljs-string">EOF</span><br><br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> --now httpd.service<br></code></pre></td></tr></table></figure>

<h5 id="2-3-4-5-2-范例-2"><a href="#2-3-4-5-2-范例-2" class="headerlink" title="2.3.4.5.2 范例 2"></a>2.3.4.5.2 范例 2</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#Author: 李余生-N46</span><br><span class="hljs-comment">#Description: httpd source code install</span><br><br><span class="hljs-comment">#下载源码包</span><br>target_dir=/usr/<span class="hljs-built_in">local</span>/src<br>install_dir=/usr/<span class="hljs-built_in">local</span>/httpd<br>download_url=https://mirror.bit.edu.cn/apache/httpd/httpd-2.4.46.tar.bz2<br>file_name=<span class="hljs-variable">$&#123;download_url##*/&#125;</span><br>uncompress_dir=<span class="hljs-variable">$&#123;file_name%.tar*&#125;</span><br>rpm -q wget || yum install -y wget<br>wget -O <span class="hljs-variable">$target_dir</span>/<span class="hljs-variable">$file_name</span> <span class="hljs-variable">$download_url</span><br><br><span class="hljs-comment">#安装依赖包</span><br>yum install -y gcc make apr-devel apr-util-devel pcre-devel openssl-devel<br>redhat-rpm-config<br><br><span class="hljs-comment">#添加apache用户</span><br>id apache &amp;&gt; /dev/null || useradd -r -u 80 -d /var/www -s /sbin/nologin apache<br><br><span class="hljs-comment">#解压源码包</span><br>tar xf <span class="hljs-variable">$target_dir</span>/<span class="hljs-variable">$file_name</span> -C <span class="hljs-variable">$target_dir</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$target_dir</span>/<span class="hljs-variable">$uncompress_dir</span><br><br><span class="hljs-comment">#编译安装</span><br>./configure --prefix=<span class="hljs-variable">$install_dir</span> --sysconfdir=/etc/httpd --enable-ssl<br>make -j`lscpu | grep <span class="hljs-string">&quot;^CPU(s)&quot;</span> | awk <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span>` &amp;&amp; make install<br><br><span class="hljs-comment">#设置环境变量</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;PATH=&#x27;</span><span class="hljs-variable">$install_dir</span><span class="hljs-string">&#x27;/bin:$PATH&#x27;</span> &gt; /etc/profile.d/httpd.sh<br><span class="hljs-built_in">source</span> /etc/profile.d/httpd.sh<br><br><span class="hljs-comment">#修改配置文件</span><br>sed -ri <span class="hljs-string">&#x27;s#(User )daemon#\1apache#&#x27;</span> /etc/httpd/httpd.conf<br>sed -ri <span class="hljs-string">&#x27;s#(Group )daemon#\1apache#&#x27;</span> /etc/httpd/httpd.conf<br><br><span class="hljs-comment">#启动httpd服务</span><br>cat &gt; /lib/systemd/system/httpd.service &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">[Unit]</span><br><span class="hljs-string">Description=The Apache HTTP Server</span><br><span class="hljs-string">After=network.target remote-fs.target nss-lookup.target</span><br><span class="hljs-string">Documentation=man:httpd(8)</span><br><span class="hljs-string">Documentation=man:apachectl(8)</span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">Type=forking</span><br><span class="hljs-string">ExecStart=/usr/local/httpd/bin/apachectl start</span><br><span class="hljs-string">ExecReload=/usr/local/httpd/bin/apachectl graceful</span><br><span class="hljs-string">ExecStop=/usr/local/httpd/bin/apachectl stop</span><br><span class="hljs-string">KillSignal=SIGCONT</span><br><span class="hljs-string">PrivateTmp=true</span><br><span class="hljs-string">[Install]</span><br><span class="hljs-string">WantedBy=multi-user.target</span><br><span class="hljs-string">EOF</span><br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> httpd.service<br>systemctl start httpd.service<br><br><span class="hljs-comment">#检查firewalld状态</span><br>firewall_status=`firewall-cmd --state`<br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$firewall_status</span> = running ];<span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;防火墙已启用，开放端口&quot;</span><br> firewall-cmd --permanent --add-service=http --add-service=https<br> firewall-cmd --reload<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>

<h5 id="2-3-4-5-3-范例-3"><a href="#2-3-4-5-3-范例-3" class="headerlink" title="2.3.4.5.3 范例 3"></a>2.3.4.5.3 范例 3</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#Author: M42赵震宇</span><br>CPUS=`lscpu |grep <span class="hljs-string">&quot;CPU(s)&quot;</span>|awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>|head -1`<br>HTTP_URL=<span class="hljs-string">&quot;https://mirrors.tuna.tsinghua.edu.cn/apache/httpd/httpd-2.4.46.tar.gz&quot;</span><br>HTTP_FILE=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;HTTP_URL##*/&#125;</span>&quot;</span><br>APR_URL=<span class="hljs-string">&quot;https://mirrors.tuna.tsinghua.edu.cn/apache/apr/apr-1.7.0.tar.gz&quot;</span><br>APR_FILE=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;APR_URL##*/&#125;</span>&quot;</span><br>APR_UTIL_URL=<span class="hljs-string">&quot;https://mirrors.tuna.tsinghua.edu.cn/apache/apr/apr-util-</span><br><span class="hljs-string">1.6.1.tar.gz&quot;</span><br>APR_UTIL_FILE=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;APR_UTIL_URL##*/&#125;</span>&quot;</span><br><br>INSTALL_DIR=<span class="hljs-string">&quot;/apps/httpd24&quot;</span><br><br><span class="hljs-function"><span class="hljs-title">install_package</span></span>()&#123;<br> grep <span class="hljs-string">&quot;Ubuntu&quot;</span> /etc/issue &amp;&gt; /dev/null<br>  <span class="hljs-keyword">if</span> [ $? -eq 0 ] ;<span class="hljs-keyword">then</span><br>  apt -y install build-essential libpcre3 libpcre3-dev openssl libssl-dev<br>libexpat1-dev wget<br>  <span class="hljs-keyword">fi</span><br> grep <span class="hljs-string">&quot;Kernel&quot;</span> /etc/issue &amp;&gt; /dev/null<br>  <span class="hljs-keyword">if</span> [ $? -eq 0 ] ;<span class="hljs-keyword">then</span><br>  yum -y install gcc make pcre-devel openssl-devel expat-devel wget<br>  <span class="hljs-keyword">fi</span><br> wget <span class="hljs-variable">$&#123;HTTP_URL&#125;</span> &amp;&amp; wget <span class="hljs-variable">$&#123;APR_URL&#125;</span> &amp;&amp; wget <span class="hljs-variable">$&#123;APR_UTIL_URL&#125;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">install_http</span></span>()&#123;<br>tar xvf <span class="hljs-variable">$&#123;HTTP_FILE&#125;</span> &amp;&amp; tar xvf <span class="hljs-variable">$&#123;APR_FILE&#125;</span> &amp;&amp; tar xvf <span class="hljs-variable">$&#123;APR_UTIL_FILE&#125;</span><br> mv <span class="hljs-variable">$&#123;APR_FILE%.tar*&#125;</span> <span class="hljs-variable">$&#123;HTTP_FILE%.tar*&#125;</span>/srclib/apr<br> mv <span class="hljs-variable">$&#123;APR_UTIL_FILE%.tar*&#125;</span> <span class="hljs-variable">$&#123;HTTP_FILE%.tar*&#125;</span>/srclib/apr-util<br> <span class="hljs-built_in">cd</span> <span class="hljs-variable">$&#123;HTTP_FILE%.tar*&#125;</span><br>./configure --prefix=<span class="hljs-variable">$&#123;INSTALL_DIR&#125;</span> --enable-so --enable-ssl --enable-cgi --<br>enable-rewrite --with-zlib --with-pcre --with-included-apr --enable-modules=most<br>--enable-mpms-shared=all --with-mpm=event<br><br> make -j <span class="hljs-variable">$&#123;CPUS&#125;</span> &amp;&amp; make install<br> <br> <span class="hljs-comment">#环境</span><br> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;INSTALL_DIR&#125;</span>/bin:<span class="hljs-variable">$PATH</span>&quot;</span> &gt; /etc/profile.d/http24.sh<br>. /etc/profile.d/http24.sh<br> <span class="hljs-comment">#创建用户</span><br>useradd -s /sbin/nologin -r apache<br> <span class="hljs-comment">#更改运行用户</span><br> sed -Ei <span class="hljs-string">&quot;s/daemon/apache/g&quot;</span> <span class="hljs-variable">$&#123;INSTALL_DIR&#125;</span>/conf/httpd.conf<br> <span class="hljs-comment">#创建service</span><br> cat &gt; /lib/systemd/system/httpd.service &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[Unit]</span><br><span class="hljs-string">Description=The Apache HTTP Server</span><br><span class="hljs-string">After=network.target remote-fs.target nss-lookup.target</span><br><span class="hljs-string">Documentation=man:httpd(8)</span><br><span class="hljs-string">Documentation=man:apachectl(8)</span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">Type=forking</span><br><span class="hljs-string">ExecStart=\$&#123;INSTALL_DIR&#125;/bin/apachectl start</span><br><span class="hljs-string">ExecReload=\$&#123;INSTALL_DIR&#125;/bin/apachectl graceful</span><br><span class="hljs-string">ExecStop=\$&#123;INSTALL_DIR&#125;/bin/apachectl stop</span><br><span class="hljs-string">KillSignal=SIGCONT</span><br><span class="hljs-string">PrivateTmp=true</span><br><span class="hljs-string">[Install]</span><br><span class="hljs-string">WantedBy=multi-user.target</span><br><span class="hljs-string">EOF</span><br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> --now httpd<br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">main</span></span>()&#123;<br>install_package<br>install_http<br>&#125;<br><br>main<br></code></pre></td></tr></table></figure>

<h5 id="2-3-4-5-4-范例-4"><a href="#2-3-4-5-4-范例-4" class="headerlink" title="2.3.4.5.4 范例 4"></a>2.3.4.5.4 范例 4</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment">#Author:  zhanghui-N50</span><br><span class="hljs-comment">#QQ:  19661891</span><br><span class="hljs-comment">#Date:  2021-02-28</span><br><span class="hljs-comment">#FileName：  install_httpd2.4.46.sh</span><br><span class="hljs-comment">#URL:  www.neteagles.cn</span><br><span class="hljs-comment">#Description： install_httpd2.4.46 for centos 7/8 &amp; ubuntu 18.04/20.04</span><br><span class="hljs-comment">#Copyright (C): 2021 All rights reserved</span><br><span class="hljs-comment">#********************************************************************</span><br>APR_URL=https://mirrors.tuna.tsinghua.edu.cn/apache/apr/<br>APR_FILE=apr-1.7.0<br>TAR=.tar.bz2<br>APR_UTIL_URL=https://mirrors.tuna.tsinghua.edu.cn/apache/apr/<br>APR_UTIL_FILE=apr-util-1.6.1<br>HTTPD_URL=https://mirrors.tuna.tsinghua.edu.cn/apache/httpd/<br>HTTPD_FILE=httpd-2.4.46<br>INSTALL_DIR=/apps/httpd24<br>CPUS=`lscpu |awk <span class="hljs-string">&#x27;/^CPU\(s\)/&#123;print $2&#125;&#x27;</span>`<br>MPM=event<br><br><span class="hljs-function"><span class="hljs-title">install_httpd</span></span>()&#123;<br><span class="hljs-keyword">if</span> [ `awk -F<span class="hljs-string">&#x27;&quot;&#x27;</span> <span class="hljs-string">&#x27;/^ID=/&#123;print $2&#125;&#x27;</span> /etc/os-release` == <span class="hljs-string">&quot;centos&quot;</span> ] &amp;&gt;<br>/dev/null;<span class="hljs-keyword">then</span><br> yum -y install gcc make pcre-devel openssl-devel expat-devel wget bzip2<br><span class="hljs-keyword">else</span><br>apt update<br> apt -y install gcc make libapr1-dev libaprutil1-dev libpcre3 libpcre3-dev<br>libssl-dev wget<br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/src<br>wget $APR_URL$APR_FILE<span class="hljs-variable">$TAR</span> &amp;&amp; wget $APR_UTIL_URL$APR_UTIL_FILE<span class="hljs-variable">$TAR</span> &amp;&amp; wget<br>$HTTPD_URL$HTTPD_FILE<span class="hljs-variable">$TAR</span><br>tar xf $APR_FILE<span class="hljs-variable">$TAR</span> &amp;&amp; tar xf $APR_UTIL_FILE<span class="hljs-variable">$TAR</span> &amp;&amp; tar xf $HTTPD_FILE<span class="hljs-variable">$TAR</span><br>mv <span class="hljs-variable">$APR_FILE</span> <span class="hljs-variable">$HTTPD_FILE</span>/srclib/apr<br>mv <span class="hljs-variable">$APR_UTIL_FILE</span> <span class="hljs-variable">$HTTPD_FILE</span>/srclib/apr-util<br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$HTTPD_FILE</span><br>./configure --prefix=<span class="hljs-variable">$INSTALL_DIR</span> --enable-so --enable-ssl --enable-cgi --<br>enable-rewrite --with-zlib --with-pcre --with-included-apr --enable-modules=most<br>--enable-mpms-shared=all --with-mpm=<span class="hljs-variable">$MPM</span><br>make -j <span class="hljs-variable">$CPUS</span> &amp;&amp; make install<br>useradd -s /sbin/nologin -r apache<br>sed -i <span class="hljs-string">&#x27;s/daemon/apache/&#x27;</span> <span class="hljs-variable">$INSTALL_DIR</span>/conf/httpd.conf<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;PATH=<span class="hljs-variable">$INSTALL_DIR</span>/bin:<span class="hljs-variable">$PATH</span>&quot;</span> &gt; /etc/profile.d/http24.sh<br>. /etc/profile.d/http24.sh<br>cat &gt; /lib/systemd/system/httpd.service &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[Unit]</span><br><span class="hljs-string">Description=The Apache HTTP Server</span><br><span class="hljs-string">After=network.target remote-fs.target nss-lookup.target</span><br><span class="hljs-string">Documentation=man:httpd(8)</span><br><span class="hljs-string">Documentation=man:apachectl(8)</span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">Type=forking</span><br><span class="hljs-string">ExecStart=$&#123;INSTALL_DIR&#125;/bin/apachectl start</span><br><span class="hljs-string">ExecReload=$&#123;INSTALL_DIR&#125;/bin/apachectl graceful</span><br><span class="hljs-string">ExecStop=$&#123;INSTALL_DIR&#125;/bin/apachectl stop</span><br><span class="hljs-string">KillSignal=SIGCONT</span><br><span class="hljs-string">PrivateTmp=true</span><br><span class="hljs-string">[Install]</span><br><span class="hljs-string">WantedBy=multi-user.target</span><br><span class="hljs-string">EOF</span><br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> --now httpd<br>&#125;<br><br>install_httpd<br></code></pre></td></tr></table></figure>

<h3 id="2-3-5-利用-ansible-实现批量安装部署-httpd-2-4"><a href="#2-3-5-利用-ansible-实现批量安装部署-httpd-2-4" class="headerlink" title="2.3.5 利用 ansible 实现批量安装部署 httpd-2.4"></a>2.3.5 利用 ansible 实现批量安装部署 httpd-2.4</h3><h4 id="2-3-5-1-ansible-实现yum安装部署-httpd-2-4"><a href="#2-3-5-1-ansible-实现yum安装部署-httpd-2-4" class="headerlink" title="2.3.5.1 ansible 实现yum安装部署 httpd-2.4"></a>2.3.5.1 ansible 实现yum安装部署 httpd-2.4</h4><h4 id="2-3-5-2-ansible-实现编译安装部署-httpd-2-4"><a href="#2-3-5-2-ansible-实现编译安装部署-httpd-2-4" class="headerlink" title="2.3.5.2 ansible 实现编译安装部署 httpd-2.4"></a>2.3.5.2 ansible 实现编译安装部署 httpd-2.4</h4><h1 id="三、httpd-常见配置"><a href="#三、httpd-常见配置" class="headerlink" title="三、httpd 常见配置"></a>三、httpd 常见配置</h1><h2 id="3-1-指定服务器名"><a href="#3-1-指定服务器名" class="headerlink" title="3.1 指定服务器名"></a>3.1 指定服务器名</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># httpd -v</span><br>Server version: Apache/2.4.6 (CentOS)<br>Server built:   Mar 24 2022 14:57:57<br><br><span class="hljs-comment"># vim /etc/httpd/conf/httpd.conf</span><br><span class="hljs-comment">#ServerName www.example.com:80</span><br>ServerName www.rlin.com:80<br><br><span class="hljs-comment"># httpd -t</span><br>Syntax OK<br></code></pre></td></tr></table></figure>

<h2 id="3-2-包含其他配置文件"><a href="#3-2-包含其他配置文件" class="headerlink" title="3.2 包含其他配置文件"></a>3.2 包含其他配置文件</h2><p>指令：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">Include file-path|directory-path|wildcard<br>IncludeOptional file-path|directory-path|wildcard<br></code></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li>Include和IncludeOptional功能相同，都可以包括其它配置文件</li>
<li>但是当无匹配文件时，include会报错，IncludeOptional会忽略错误</li>
<li>编译安装的httpd没有<code>IncludeOptional</code>，需要自行添加</li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#Wildcards may be included in the directory or file portion of the path. This</span><br>example will fail <span class="hljs-keyword">if</span> there is no subdirectory <span class="hljs-keyword">in</span> conf/vhosts that contains at<br>least one *.conf file:<br>Include conf/vhosts/*/*.conf<br><span class="hljs-comment">#Alternatively, the following command will just be ignored in case of missing</span><br>files or directories:<br><br>IncludeOptional conf/vhosts/*/*.conf<br></code></pre></td></tr></table></figure>

<h2 id="3-3-监听的IP和Port"><a href="#3-3-监听的IP和Port" class="headerlink" title="3.3 监听的IP和Port"></a>3.3 监听的IP和Port</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">Listen [IP:]PORT<br></code></pre></td></tr></table></figure>

<p>说明：<br>(1) 省略IP表示为本机所有IP<br>(2) Listen指令至少一个，可重复出现多次</p>
<p>范例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">Listen 192.168.1.100:8080<br>Listen 80<br></code></pre></td></tr></table></figure>

<h2 id="3-4-隐藏服务器版本信息"><a href="#3-4-隐藏服务器版本信息" class="headerlink" title="3.4 隐藏服务器版本信息"></a>3.4 隐藏服务器版本信息</h2><p><strong>由于httpd.conf配置文件没有<code>ServerTokens</code>，需要手动添加子配置文件</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">ServerTokens Major|Minor|Min[imal]|Prod[uctOnly]|OS|Full<br></code></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http">ServerTokens Prod[uctOnly] ：Server: Apache<br>ServerTokens Major: Server: Apache/2<br>ServerTokens Minor: Server: Apache/2.0<br>ServerTokens Min[imal]: Server: Apache/2.0.41<br>ServerTokens OS: Server: Apache/2.0.41 (Unix)<br>ServerTokens Full (or not specified): Server: Apache/2.0.41 (Unix) PHP/4.2.2 MyMod/1.2 此为默认值<br></code></pre></td></tr></table></figure>

<p>建议使用：ServerTokens Prod</p>
<p><strong>禁止错误网页版本泄露</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">ServerSignature On | Off | EMail<br></code></pre></td></tr></table></figure>

<p>默认值Off，如果ServerTokens 使用默认值,并且ServerSignature选项为on，当客户请求的网页并不存在时，服务器将产生错误文档，错误文档的最后一行将包含服务器名字、Apache版本等信息，如果不对外显示这些信息，就可将这个参数设置为Off, 如果设置为Email，将显示ServerAdmin 的Email提示。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">ServerSignature on<br></code></pre></td></tr></table></figure>

<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache5.png" srcset="/blog/img/loading.gif"></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">ServerAdmin root@wangxiaochun.com<br>ServerSignature email<br></code></pre></td></tr></table></figure>

<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache6.png" srcset="/blog/img/loading.gif"></p>
<h2 id="3-5-持久连接"><a href="#3-5-持久连接" class="headerlink" title="3.5 持久连接"></a>3.5 持久连接</h2><p>Persistent Connection：连接建立，每个资源获取完成后不会断开连接，而是继续等待其它的请求完成，默认开启持久连接</p>
<p>断开条件：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">时间限制：以秒为单位， 默认5s，httpd-2.4 支持毫秒级<br>请求数量: 请求数达到指定值,也会断开<br></code></pre></td></tr></table></figure>

<p>副作用：对并发访问量大的服务器，持久连接会使有些请求得不到响应</p>
<p>折衷：使用较短的持久连接时间</p>
<p>持久连接相关指令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">KeepAlive On|Off<br>KeepAliveTimeout 15    <span class="hljs-comment">#连接持续15s,可以以ms为单位,默认值为5s</span><br>MaxKeepAliveRequests 500  <span class="hljs-comment">#持久连接最大接收的请求数,默认值100</span><br></code></pre></td></tr></table></figure>

<p>测试方法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">telnet WEB_SERVER_IP PORT<br>GET /URL HTTP/1.1<br>Host: WEB_SERVER_IP<br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># telnet 10.0.0.17 80</span><br>Trying 10.0.0.17...<br>Connected to 10.0.0.17.<br>Escape character is <span class="hljs-string">&#x27;^]&#x27;</span>.<br>GET /index.html HTTP/1.1<br>host: 2.2.2.2 <span class="hljs-comment">#开启了持久连接，敲回车后需要等待相应的时间</span><br>HTTP/1.1 408 Request Timeout<br>Date: Sat, 05 Nov 2022 04:10:00 GMT<br>Server: Apache/2.4<br>Content-Length: 322<br>Connection: close<br>Content-Type: text/html; charset=iso-8859-1<br><br>&lt;!DOCTYPE HTML PUBLIC <span class="hljs-string">&quot;-//IETF//DTD HTML 2.0//EN&quot;</span>&gt;<br>&lt;html&gt;&lt;head&gt;<br>&lt;title&gt;408 Request Timeout&lt;/title&gt;<br>&lt;/head&gt;&lt;body&gt;<br>&lt;h1&gt;Request Timeout&lt;/h1&gt;<br>&lt;p&gt;Server timeout waiting <span class="hljs-keyword">for</span> the HTTP request from the client.&lt;/p&gt;<br>&lt;hr&gt;<br>&lt;address&gt;Apache/2.4 Server at &lt;a href=<span class="hljs-string">&quot;mailto:rlin@rlin.com&quot;</span>&gt;www.rlin.com&lt;/a&gt; Port 80&lt;/address&gt;<br>&lt;/body&gt;&lt;/html&gt;<br>Connection closed by foreign host.<br></code></pre></td></tr></table></figure>

<h2 id="3-6-DSO-Dynamic-Shared-Object"><a href="#3-6-DSO-Dynamic-Shared-Object" class="headerlink" title="3.6 DSO (Dynamic Shared Object)"></a>3.6 DSO (Dynamic Shared Object)</h2><p>Dynamic Shared Object，加载动态模块配置，不需重启即生效</p>
<p>动态模块所在路径： <code>/usr/lib64/httpd/modules/</code></p>
<p>主配置 <code>/etc/httpd/conf/httpd.conf</code> 文件中指定加载模块配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">ServerRoot <span class="hljs-string">&quot;/etc/httpd&quot;</span><br>Include conf.modules.d/*.conf<br></code></pre></td></tr></table></figure>

<p>配置指定实现模块加载格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">LoadModule &lt;mod_name&gt; &lt;mod_path&gt;<br></code></pre></td></tr></table></figure>

<p>模块文件路径可使用相对路径：相对于ServerRoot（默认/etc/httpd）</p>
<p>范例：查看模块加载的配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ls /etc/httpd/conf.modules.d/</span><br>00-base.conf  00-dav.conf  00-lua.conf  00-mpm.conf  00-proxy.conf  00-systemd.conf  01-cgi.conf<br><br><span class="hljs-comment"># cat /etc/httpd/conf.modules.d/00-base.conf</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># This file loads most of the modules included with the Apache HTTP</span><br><span class="hljs-comment"># Server itself.</span><br><span class="hljs-comment">#</span><br><br>LoadModule access_compat_module modules/mod_access_compat.so<br>LoadModule actions_module modules/mod_actions.so<br>LoadModule alias_module modules/mod_alias.so<br>LoadModule allowmethods_module modules/mod_allowmethods.so<br>LoadModule auth_basic_module modules/mod_auth_basic.so<br>LoadModule auth_digest_module modules/mod_auth_digest.so<br>LoadModule authn_anon_module modules/mod_authn_anon.so<br>LoadModule authn_core_module modules/mod_authn_core.so<br>LoadModule authn_dbd_module modules/mod_authn_dbd.so<br>LoadModule authn_dbm_module modules/mod_authn_dbm.so<br>LoadModule authn_file_module modules/mod_authn_file.so<br>LoadModule authn_socache_module modules/mod_authn_socache.so<br>LoadModule authz_core_module modules/mod_authz_core.so<br>LoadModule authz_dbd_module modules/mod_authz_dbd.so<br>LoadModule authz_dbm_module modules/mod_authz_dbm.so<br>LoadModule authz_groupfile_module modules/mod_authz_groupfile.so<br>LoadModule authz_host_module modules/mod_authz_host.so<br>LoadModule authz_owner_module modules/mod_authz_owner.so<br>LoadModule authz_user_module modules/mod_authz_user.so<br>LoadModule autoindex_module modules/mod_autoindex.so<br>LoadModule cache_module modules/mod_cache.so<br>LoadModule cache_disk_module modules/mod_cache_disk.so<br>LoadModule data_module modules/mod_data.so<br>LoadModule dbd_module modules/mod_dbd.so<br>LoadModule deflate_module modules/mod_deflate.so<br>LoadModule dir_module modules/mod_dir.so<br>LoadModule dumpio_module modules/mod_dumpio.so<br>LoadModule echo_module modules/mod_echo.so<br>LoadModule env_module modules/mod_env.so<br>LoadModule expires_module modules/mod_expires.so<br>LoadModule ext_filter_module modules/mod_ext_filter.so<br>LoadModule filter_module modules/mod_filter.so<br>LoadModule headers_module modules/mod_headers.so<br>LoadModule include_module modules/mod_include.so<br>LoadModule info_module modules/mod_info.so<br>LoadModule log_config_module modules/mod_log_config.so<br>LoadModule logio_module modules/mod_logio.so<br>LoadModule mime_magic_module modules/mod_mime_magic.so<br>LoadModule mime_module modules/mod_mime.so<br>LoadModule negotiation_module modules/mod_negotiation.so<br>LoadModule remoteip_module modules/mod_remoteip.so<br>LoadModule reqtimeout_module modules/mod_reqtimeout.so<br>LoadModule rewrite_module modules/mod_rewrite.so<br>LoadModule setenvif_module modules/mod_setenvif.so<br>LoadModule slotmem_plain_module modules/mod_slotmem_plain.so<br>LoadModule slotmem_shm_module modules/mod_slotmem_shm.so<br>LoadModule socache_dbm_module modules/mod_socache_dbm.so<br>LoadModule socache_memcache_module modules/mod_socache_memcache.so<br>LoadModule socache_shmcb_module modules/mod_socache_shmcb.so<br>LoadModule status_module modules/mod_status.so<br>LoadModule substitute_module modules/mod_substitute.so<br>LoadModule suexec_module modules/mod_suexec.so<br>LoadModule unique_id_module modules/mod_unique_id.so<br>LoadModule unixd_module modules/mod_unixd.so<br>LoadModule userdir_module modules/mod_userdir.so<br>LoadModule version_module modules/mod_version.so<br>LoadModule vhost_alias_module modules/mod_vhost_alias.so<br><br><span class="hljs-comment">#LoadModule buffer_module modules/mod_buffer.so</span><br><span class="hljs-comment">#LoadModule watchdog_module modules/mod_watchdog.so</span><br><span class="hljs-comment">#LoadModule heartbeat_module modules/mod_heartbeat.so</span><br><span class="hljs-comment">#LoadModule heartmonitor_module modules/mod_heartmonitor.so</span><br><span class="hljs-comment">#LoadModule usertrack_module modules/mod_usertrack.so</span><br><span class="hljs-comment">#LoadModule dialup_module modules/mod_dialup.so</span><br><span class="hljs-comment">#LoadModule charset_lite_module modules/mod_charset_lite.so</span><br><span class="hljs-comment">#LoadModule log_debug_module modules/mod_log_debug.so</span><br><span class="hljs-comment">#LoadModule ratelimit_module modules/mod_ratelimit.so</span><br><span class="hljs-comment">#LoadModule reflector_module modules/mod_reflector.so</span><br><span class="hljs-comment">#LoadModule request_module modules/mod_request.so</span><br><span class="hljs-comment">#LoadModule sed_module modules/mod_sed.so</span><br><span class="hljs-comment">#LoadModule speling_module modules/mod_speling.so</span><br></code></pre></td></tr></table></figure>

<p><strong>查看静态编译的模块</strong>：httpd -l</p>
<p><strong>查看静态编译及动态装载的模块</strong>：httpd -M</p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#列出静态编译模块</span><br><span class="hljs-comment"># httpd -l</span><br>Compiled <span class="hljs-keyword">in</span> modules:<br>  core.c<br>  mod_so.c<br>  http_core.c<br>  <br><span class="hljs-comment">#列出静态和动态编译的模块</span><br><span class="hljs-comment"># httpd -M</span><br>Loaded Modules:<br> core_module (static)<br> so_module (static)<br> http_module (static)<br> access_compat_module (shared)<br> actions_module (shared)<br> alias_module (shared)<br> allowmethods_module (shared)<br> auth_basic_module (shared)<br> auth_digest_module (shared)<br> authn_anon_module (shared)<br> authn_core_module (shared)<br> authn_dbd_module (shared)<br> authn_dbm_module (shared)<br> authn_file_module (shared)<br> authn_socache_module (shared)<br> authz_core_module (shared)<br> authz_dbd_module (shared)<br> authz_dbm_module (shared)<br> authz_groupfile_module (shared)<br> authz_host_module (shared)<br> authz_owner_module (shared)<br> authz_user_module (shared)<br> autoindex_module (shared)<br> cache_module (shared)<br> cache_disk_module (shared)<br> data_module (shared)<br> dbd_module (shared)<br> deflate_module (shared)<br> dir_module (shared)<br> dumpio_module (shared)<br> echo_module (shared)<br> env_module (shared)<br> expires_module (shared)<br> ext_filter_module (shared)<br> filter_module (shared)<br> headers_module (shared)<br> include_module (shared)<br> info_module (shared)<br> log_config_module (shared)<br> logio_module (shared)<br> mime_magic_module (shared)<br> mime_module (shared)<br> negotiation_module (shared)<br> remoteip_module (shared)<br> reqtimeout_module (shared)<br> rewrite_module (shared)<br> setenvif_module (shared)<br> slotmem_plain_module (shared)<br> slotmem_shm_module (shared)<br> socache_dbm_module (shared)<br> socache_memcache_module (shared)<br> socache_shmcb_module (shared)<br> status_module (shared)<br> substitute_module (shared)<br> suexec_module (shared)<br> unique_id_module (shared)<br> unixd_module (shared)<br> userdir_module (shared)<br> version_module (shared)<br> vhost_alias_module (shared)<br> dav_module (shared)<br> dav_fs_module (shared)<br> dav_lock_module (shared)<br> lua_module (shared)<br> mpm_prefork_module (shared)<br> proxy_module (shared)<br> lbmethod_bybusyness_module (shared)<br> lbmethod_byrequests_module (shared)<br> lbmethod_bytraffic_module (shared)<br> lbmethod_heartbeat_module (shared)<br> proxy_ajp_module (shared)<br> proxy_balancer_module (shared)<br> proxy_connect_module (shared)<br> proxy_express_module (shared)<br> proxy_fcgi_module (shared)<br> proxy_fdpass_module (shared)<br> proxy_ftp_module (shared)<br> proxy_http_module (shared)<br> proxy_scgi_module (shared)<br> proxy_wstunnel_module (shared)<br> systemd_module (shared)<br> cgi_module (shared)<br></code></pre></td></tr></table></figure>

<h2 id="3-7-MPM-Multi-Processing-Module-多路处理模块"><a href="#3-7-MPM-Multi-Processing-Module-多路处理模块" class="headerlink" title="3.7 MPM (Multi-Processing Module) 多路处理模块"></a>3.7 MPM (Multi-Processing Module) 多路处理模块</h2><p>httpd 支持三种MPM工作模式：prefork, worker, event</p>
<p>切换使用的MPM：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#启用要启用的MPM相关的LoadModule指令即可，其它未启用的两项需要在行首加#注释</span><br>vim /etc/httpd/conf.modules.d/00-mpm.conf<br><span class="hljs-comment">#LoadModule mpm_prefork_module modules/mod_mpm_prefork.so</span><br>LoadModule mpm_worker_module modules/mod_mpm_worker.so<br><span class="hljs-comment">#LoadModule mpm_event_module modules/mod_mpm_event.so</span><br></code></pre></td></tr></table></figure>

<p>注意：不要同时启用多个MPM模块，否则会出现以下错误</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">AH00534: httpd: Configuration error: More than one MPM loaded.<br></code></pre></td></tr></table></figure>

<p>范例：查看CentOS 7 默认的MPM工作模式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># httpd -M |grep mpm</span><br> mpm_prefork_module (shared)<br></code></pre></td></tr></table></figure>

<p>范例：修改CentOS 7使用 event 模型</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/httpd/conf.modules.d/00-mpm.conf</span><br><span class="hljs-comment"># grep Load /etc/httpd/conf.modules.d/00-mpm.conf</span><br><span class="hljs-comment"># Select the MPM module which should be used by uncommenting exactly</span><br><span class="hljs-comment"># one of the following LoadModule lines:</span><br><br><span class="hljs-comment"># prefork MPM: Implements a non-threaded, pre-forking web server</span><br><span class="hljs-comment"># See: http://httpd.apache.org/docs/2.4/mod/prefork.html</span><br><span class="hljs-comment">#LoadModule mpm_prefork_module modules/mod_mpm_prefork.so</span><br><br><span class="hljs-comment"># worker MPM: Multi-Processing Module implementing a hybrid</span><br><span class="hljs-comment"># multi-threaded multi-process web server</span><br><span class="hljs-comment"># See: http://httpd.apache.org/docs/2.4/mod/worker.html</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#LoadModule mpm_worker_module modules/mod_mpm_worker.so</span><br><br><span class="hljs-comment"># event MPM: A variant of the worker MPM with the goal of consuming</span><br><span class="hljs-comment"># threads only for connections with active processing</span><br><span class="hljs-comment"># See: http://httpd.apache.org/docs/2.4/mod/event.html</span><br><span class="hljs-comment">#</span><br>LoadModule mpm_event_module modules/mod_mpm_event.so<br><br><span class="hljs-comment"># httpd -M | grep mpm</span><br> mpm_event_module (shared)<br></code></pre></td></tr></table></figure>

<h2 id="3-8-prefork-模式相关的配置"><a href="#3-8-prefork-模式相关的配置" class="headerlink" title="3.8 prefork 模式相关的配置"></a>3.8 prefork 模式相关的配置</h2><p><strong>相关配置文件路径：<code>/usr/share/doc/httpd-2.4.6/httpd-mpm.conf</code></strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">StartServers    100<br>MinSpareServers  50<br>MaxSpareServers  80<br>ServerLimit   2560 <span class="hljs-comment">#最多进程数,最大值 20000</span><br>MaxRequestWorkers   2560 <span class="hljs-comment">#最大的并发连接数，默认256</span><br>MaxConnectionsPerChild  4000 <span class="hljs-comment">#子进程最多能处理的请求数量。在处理MaxRequestsPerChild 个请求之后,子进程将会被父进程终止，这时候子进程占用的内存就会释放(为0时永远不释放）</span><br>MaxRequestsPerChild 4000  <span class="hljs-comment">#从httpd.2.3.9开始被MaxConnectionsPerChild代替</span><br></code></pre></td></tr></table></figure>

<h2 id="3-9-worker和event-模式相关的配置"><a href="#3-9-worker和event-模式相关的配置" class="headerlink" title="3.9 worker和event 模式相关的配置"></a>3.9 worker和event 模式相关的配置</h2><p><strong>相关配置文件路径：<code>/usr/share/doc/httpd-2.4.6/httpd-mpm.conf</code></strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">ServerLimit     16  <span class="hljs-comment">#最多worker进程数 Upper limit on configurable number of processes</span><br>StartServers     10  <span class="hljs-comment">#Number of child server processes created at startup</span><br>MaxRequestWorkers  150  <span class="hljs-comment">#Maximum number of connections that will be processed simultaneously</span><br>MinSpareThreads   25<br>MaxSpareThreads   75<br>ThreadsPerChild   25  <span class="hljs-comment">#Number of threads created by each child process</span><br></code></pre></td></tr></table></figure>

<h2 id="3-10-定义Main-server的文档页面路径"><a href="#3-10-定义Main-server的文档页面路径" class="headerlink" title="3.10 定义Main server的文档页面路径"></a>3.10 定义Main server的文档页面路径</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">DocumentRoot  <span class="hljs-string">&quot;/path”</span><br><span class="hljs-string">&lt;directory /path&gt;</span><br><span class="hljs-string">    Require all granted</span><br><span class="hljs-string">&lt;/directory&gt;</span><br></code></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li>DocumentRoot指向的路径为URL路径的起始位置</li>
<li>/path 必须显式授权后才可以访问</li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#添加子配置文件</span><br><span class="hljs-comment"># vim /etc/httpd/conf.d/test.conf</span><br>DocumentRoot <span class="hljs-string">&quot;/data/html&quot;</span><br>&lt;directory /data/html&gt;<br>    Require all granted<br>&lt;/directory&gt;<br><br><span class="hljs-comment">#创建文件夹</span><br><span class="hljs-comment"># mkdir -p /data/html/test</span><br><br><span class="hljs-comment">#添加网页文件</span><br><span class="hljs-comment"># echo website.test.com &gt;&gt; /data/html/test/index.html</span><br><br><span class="hljs-comment">#重启httpd</span><br><span class="hljs-comment"># systemctl restart httpd</span><br><br><span class="hljs-comment">#检测</span><br><span class="hljs-comment"># curl 10.0.0.17/test/index.html</span><br>website.test.com<br><br><span class="hljs-comment">#URL和磁盘路径的映射关系</span><br>http://HOST:PORT/<span class="hljs-built_in">test</span>/index.html  --&gt; /data/html/<span class="hljs-built_in">test</span>/index.html<br></code></pre></td></tr></table></figure>

<h2 id="3-11-定义站点默认主页面文件"><a href="#3-11-定义站点默认主页面文件" class="headerlink" title="3.11 定义站点默认主页面文件"></a>3.11 定义站点默认主页面文件</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">DirectoryIndex index.php index.html<br></code></pre></td></tr></table></figure>

<h2 id="3-12-定义路径别名"><a href="#3-12-定义路径别名" class="headerlink" title="3.12 定义路径别名"></a>3.12 定义路径别名</h2><p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">Alias /URL/  <span class="hljs-string">&quot;/PATH/&quot;</span><br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">DocumentRoot <span class="hljs-string">&quot;/www/htdocs&quot;</span><br><span class="hljs-comment">#http://www.magedu.com/download/bash.rpm ==&gt;/www/htdocs/download/bash.rpm</span><br>Alias /download/  <span class="hljs-string">&quot;/rpms/pub/&quot;</span><br><span class="hljs-comment">#http://www.magedu.com/download/bash.rpm ==&gt;/rpms/pub/bash.rpm</span><br><span class="hljs-comment">#http://www.magedu.com/images/logo.png ==&gt;/www/htdocs/images/logo.png</span><br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/httpd/conf.d/test.conf</span><br><span class="hljs-built_in">alias</span> /news /data/html/newsdir/<br>&lt;directory /data/html/newsdir&gt;<br>    require all granted<br>&lt;/directory&gt;<br><br><span class="hljs-comment">#创建文件夹</span><br><span class="hljs-comment"># mkdir -p /data/html/newsdir/</span><br><br><span class="hljs-comment">#添加网页文件</span><br><span class="hljs-comment"># echo website./data/html/newsdir.com &gt; /data/html/newsdir/index.html</span><br><br><span class="hljs-comment">#重启httpd</span><br><span class="hljs-comment"># systemctl restart httpd</span><br><br><span class="hljs-comment">#检测</span><br><span class="hljs-comment"># curl 10.0.0.17/news/index.html</span><br>website./data/html/newsdir.com<br></code></pre></td></tr></table></figure>

<h2 id="3-13-可实现访问控制的资源"><a href="#3-13-可实现访问控制的资源" class="headerlink" title="3.13 可实现访问控制的资源"></a>3.13 可实现访问控制的资源</h2><p>可以针对文件系统和URI的资源进行访问控制</p>
<p>文件系统路径：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#基于目录</span><br>&lt;Directory  <span class="hljs-string">&quot;/path&quot;</span>&gt;<br>...<br>&lt;/Directory&gt;<br><br><span class="hljs-comment">#基于文件</span><br>&lt;Files  <span class="hljs-string">&quot;/path/file”&gt; </span><br><span class="hljs-string">...</span><br><span class="hljs-string">&lt;/Files&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">#基于文件通配符</span><br><span class="hljs-string">&lt;Files  &quot;</span>/path/*file*”&gt; <br>...<br>&lt;/Files&gt;<br><br><span class="hljs-comment">#基于扩展正则表达式</span><br>&lt;FilesMatch  <span class="hljs-string">&quot;regex”&gt;</span><br><span class="hljs-string">...</span><br><span class="hljs-string">&lt;/FilesMatch&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="3-13-1-范例：基于目录实现访问控制"><a href="#3-13-1-范例：基于目录实现访问控制" class="headerlink" title="3.13.1 范例：基于目录实现访问控制"></a>3.13.1 范例：基于目录实现访问控制</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;directory /data/html&gt;<br>    Require all granted<br>&lt;/directory&gt;<br></code></pre></td></tr></table></figure>

<h3 id="3-13-2-范例：基于文件实现访问控制"><a href="#3-13-2-范例：基于文件实现访问控制" class="headerlink" title="3.13.2 范例：基于文件实现访问控制"></a>3.13.2 范例：基于文件实现访问控制</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ls /data/html/newsdir</span><br>fstab.html  index.html<br><br><span class="hljs-comment"># vim /etc/httpd/conf.d/test.conf/test.conf</span><br><span class="hljs-built_in">alias</span> /news /data/html/newsdir/<br>&lt;Directory <span class="hljs-string">&quot;/data/html/newsdir&quot;</span>&gt;<br>    Require all granted<br>    &lt;Files <span class="hljs-string">&quot;fstab.html&quot;</span>&gt;<br>        Require all denied<br>    &lt;/Files&gt;<br>&lt;/Directory&gt;<br><br><span class="hljs-comment"># systemctl restart httpd</span><br><br><span class="hljs-comment"># curl 10.0.0.17/news/index.html</span><br>website./data/html/newsdir.com<br><br><span class="hljs-comment"># curl 10.0.0.17/news/fstab.html</span><br>&lt;!DOCTYPE HTML PUBLIC <span class="hljs-string">&quot;-//IETF//DTD HTML 2.0//EN&quot;</span>&gt;<br>&lt;html&gt;&lt;head&gt;<br>&lt;title&gt;403 Forbidden&lt;/title&gt;<br>&lt;/head&gt;&lt;body&gt;<br>&lt;h1&gt;Forbidden&lt;/h1&gt;<br>&lt;p&gt;You don<span class="hljs-string">&#x27;t have permission to access /news/fstab.html</span><br><span class="hljs-string">on this server.&lt;/p&gt;</span><br><span class="hljs-string">&lt;hr&gt;</span><br><span class="hljs-string">&lt;address&gt;Apache/2.4 Server at &lt;a href=&quot;mailto:rlin@rlin.com&quot;&gt;10.0.0.17&lt;/a&gt; Port 80&lt;/address&gt;</span><br><span class="hljs-string">&lt;/body&gt;&lt;/html&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="3-13-3-基于文件通配符实现访问控制"><a href="#3-13-3-基于文件通配符实现访问控制" class="headerlink" title="3.13.3 基于文件通配符实现访问控制"></a>3.13.3 基于文件通配符实现访问控制</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;Files <span class="hljs-string">&quot;.ht*&quot;</span>&gt; <span class="hljs-comment">#通配符</span><br> Require all denied<br>&lt;/Files&gt;<br></code></pre></td></tr></table></figure>

<h3 id="3-13-4-基于扩展正则表达式实现访问控制"><a href="#3-13-4-基于扩展正则表达式实现访问控制" class="headerlink" title="3.13.4 基于扩展正则表达式实现访问控制"></a>3.13.4 基于扩展正则表达式实现访问控制</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;FilesMatch <span class="hljs-string">&quot;.+\.(gif|jpe?g|png)$&quot;</span>&gt;<br> <span class="hljs-comment"># ...</span><br>&lt;/FilesMatch&gt;<br>或<br>&lt;Directory  <span class="hljs-string">&quot;/path&quot;</span>&gt;<br>    &lt;FilesMatch <span class="hljs-string">&quot;.+\.(gif|jpe?g|png)$&quot;</span>&gt;<br>    <span class="hljs-comment"># ...</span><br>    &lt;/FilesMatch&gt;<br>&lt;/Directory&gt;<br></code></pre></td></tr></table></figure>

<p>URL路径：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;Location  <span class="hljs-string">&quot;URL&quot;</span>&gt;<br>...<br>&lt;/Location&gt;<br><br>&lt;LocationMatch <span class="hljs-string">&quot;regex&quot;</span>&gt;<br>...<br>&lt;/LocationMatch&gt;<br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#/private1, /private1/，/private1/file.txt 匹配</span><br><span class="hljs-comment">#/private1other 不匹配</span><br>&lt;Location <span class="hljs-string">&quot;/private1&quot;</span>&gt;<br>  <span class="hljs-comment"># ...</span><br>&lt;/Location&gt;<br><br><span class="hljs-comment">#/private2/，/private2/file.txt 匹配</span><br><span class="hljs-comment">#/private2，/private2other 不匹配</span><br>&lt;Location <span class="hljs-string">&quot;/private2/&quot;</span>&gt;<br>  <span class="hljs-comment"># ...</span><br>&lt;/Location&gt;<br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;Location /status&gt;<br>&lt;LocationMatch <span class="hljs-string">&quot;/(extra|special)/data&quot;</span>&gt;<br></code></pre></td></tr></table></figure>

<h2 id="3-14-针对目录和URL实现访问控制"><a href="#3-14-针对目录和URL实现访问控制" class="headerlink" title="3.14 针对目录和URL实现访问控制"></a>3.14 针对目录和URL实现访问控制</h2><h3 id="3-1-4-1-Options指令："><a href="#3-1-4-1-Options指令：" class="headerlink" title="3.1.4.1 Options指令："></a>3.1.4.1 Options指令：</h3><p>后跟1个或多个以空白字符分隔的选项列表， 在选项前的+，- 表示增加或删除指定选项</p>
<p>常见选项：</p>
<ul>
<li><p>Indexes：指明的URL路径下不存在与定义的主页面资源相符的资源文件时，返回索引列表给用户 <strong>注意需要将welcome.conf文件注释</strong></p>
</li>
<li><p>FollowSymLinks：允许访问符号链接文件所指向的源文件</p>
</li>
<li><p>None：全部禁用</p>
</li>
<li><p>All： 全部允许</p>
</li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;Directory /web/docs&gt;<br>    Options -Indexes -FollowSymLinks<br>&lt;/Directory&gt;<br><br>&lt;Directory /web/docs/spec&gt;<br>    Options -FollowSymLinks<br>&lt;/Directory&gt;<br></code></pre></td></tr></table></figure>

<p><strong>范例: httpd实现下载功能1（无软连接）</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># mv /etc/httpd/conf.d/welcome.conf&#123;,.backup&#125;</span><br><br><span class="hljs-comment"># vim /etc/httpd/conf.d/test.conf</span><br>&lt;directory /data/html/software&gt;<br>    options Indexes<br>&lt;/directory&gt;<br><br><span class="hljs-comment"># /data/html/software/tree</span><br>.<br>├── fstab.html<br>└── software<br>    └── date.html<br><br>1 directory, 3 files<br></code></pre></td></tr></table></figure>

<p>打开浏览器，访问 <code>http://httpd主机IP/</code> 可看到下面所示</p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache7.png" srcset="/blog/img/loading.gif"></p>
<hr>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache8.png" srcset="/blog/img/loading.gif"></p>
<p><strong>范例: httpd实现下载功能2（有软连接）</strong></p>
<p><strong>注意<code>/data/html/software</code>文件夹中有软连接</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/httpd/conf.d/test.conf</span><br>&lt;directory /data/html/software&gt;<br>    options Indexes FollowSymLinks<br>&lt;/directory&gt;<br><br><span class="hljs-comment"># tree /data/html/software/tree</span><br>.<br>├── fstab.html<br>├── redhat-release -&gt; /etc/redhat-release<br>└── software<br>    ├── access_log -&gt; /var/<span class="hljs-built_in">log</span>/httpd/access_log<br>    └── date.html<br><br>1 directory, 4 files<br></code></pre></td></tr></table></figure>

<p>打开浏览器，访问 <code>http://httpd主机IP/</code> 可看到下面所示</p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache9.png" srcset="/blog/img/loading.gif"></p>
<hr>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache10.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-14-2-AllowOverride指令"><a href="#3-14-2-AllowOverride指令" class="headerlink" title="3.14.2 AllowOverride指令"></a>3.14.2 AllowOverride指令</h3><p>与访问控制相关的哪些指令可以放在指定目录下的.htaccess（由AccessFileName 指令指定,AccessFileName .htaccess 为默认值）文件中，覆盖之前的配置指令，只对<directory>语句有效</p>
<p>常见用法：</p>
<ul>
<li>AllowOverride All: .htaccess中所有指令都有效</li>
<li>AllowOverride None： .htaccess 文件无效，此为httpd 2.3.9以后版的默认值</li>
<li>AllowOverride AuthConfig .htaccess 文件中，除了AuthConfig 其它指令都无法生效</li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#修改配置文件前</span><br><span class="hljs-comment"># cat /etc/httpd/conf.d/test.conf</span><br>DocumentRoot <span class="hljs-string">&quot;/data/html/software&quot;</span><br>&lt;directory /data/html/software&gt;<br>    Require all granted<br>    options Indexes FollowSymLinks<br>&lt;/directory&gt;<br><br><span class="hljs-comment">#修改配置文件后</span><br><span class="hljs-comment"># cat /etc/httpd/conf.d/test.conf</span><br>DocumentRoot <span class="hljs-string">&quot;/data/html/software&quot;</span><br>&lt;directory /data/html/software&gt;<br>    Require all granted<br>    AllowOverride All<br>&lt;/directory&gt;<br><br><span class="hljs-comment"># vim /data/html/software/.htaccess</span><br>options Indexes FollowSymLinks<br><br><span class="hljs-comment"># systemctl restart httpd</span><br><br><span class="hljs-comment"># tree /data/html/software/tree</span><br>.<br>├── fstab.html<br>├── redhat-release -&gt; /etc/redhat-release<br>└── software<br>    ├── access_log -&gt; /var/<span class="hljs-built_in">log</span>/httpd/access_log<br>    └── date.html<br><br>1 directory, 4 files<br><br><span class="hljs-comment"># ll -a</span><br>total 8<br>drwxr-xr-x 3 root root  79 Nov  5 14:28 .<br>drwxr-xr-x 5 root root  67 Nov  5 13:51 ..<br>-rw-r--r-- 1 root root 407 Nov  5 13:51 fstab.html<br>-rw-r--r-- 1 root root  31 Nov  5 14:26 .htaccess<br>lrwxrwxrwx 1 root root  19 Nov  5 13:52 redhat-release -&gt; /etc/redhat-release<br>drwxr-xr-x 2 root root  41 Nov  5 14:10 software<br></code></pre></td></tr></table></figure>

<p>打开浏览器，访问 <code>http://httpd主机IP/</code> ，可以看到applink的软链接</p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache11.png" srcset="/blog/img/loading.gif"></p>
<p>范例：.htaccess文件默认被禁止访问</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># grep -Ev &#x27;^ *#|^$&#x27; /etc/httpd/conf/httpd.conf |grep -A 2 &#x27;ht\*&#x27;</span><br>&lt;Files <span class="hljs-string">&quot;.ht*&quot;</span>&gt;<br> Require all denied<br>&lt;/Files&gt;<br></code></pre></td></tr></table></figure>

<h2 id="3-15-基于客户端-IP-地址实现访问控制"><a href="#3-15-基于客户端-IP-地址实现访问控制" class="headerlink" title="3.15 基于客户端 IP 地址实现访问控制"></a>3.15 基于客户端 IP 地址实现访问控制</h2><p>针对各种资源，可以基于以下两种方式的访问控制：</p>
<ul>
<li>客户端来源地址</li>
<li>用户账号</li>
</ul>
<p>基于客户端的IP地址的访问控制:</p>
<ul>
<li><p>无明确授权的目录，默认拒绝</p>
</li>
<li><p>允许所有主机访问：Require all granted</p>
</li>
<li><p>拒绝所有主机访问：Require all denied</p>
</li>
<li><p>控制特定的IP访问：</p>
<p>Require ip IPADDR：授权指定来源的IP访问</p>
<p>Require not ip IPADDR：拒绝特定的IP访问</p>
</li>
<li><p>控制特定的主机访问：</p>
<p>Require host HOSTNAME：授权特定主机访问</p>
<p>Require not host HOSTNAME：拒绝</p>
<p>​        HOSTNAME：</p>
<p>​                FQDN：特定主机</p>
<p>​                domin.tld：指定域名下的所有主机</p>
</li>
</ul>
<p><RequireAll>黑名单, 不能有失败，至少有一个成功匹配才成功，即失败优先</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;RequireAll&gt;<br>    Require all granted<br>    Require not ip 172.16.1.1 <span class="hljs-comment">#拒绝特定IP</span><br>&lt;/RequireAll&gt;<br></code></pre></td></tr></table></figure>

<p><RequireAny>白名单, 多个语句有一个成功，则成功，即成功优先</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;RequireAny&gt;<br>    Require all denied<br>    require ip  172.16.1.1  <span class="hljs-comment">#允许特定IP</span><br>&lt;/RequireAny&gt;<br></code></pre></td></tr></table></figure>

<p>提示：早期版本使用 <code>mod_access_compat</code> 模块提供的 Allow,Deny,Order指令，将被废弃，不推荐使用 <a target="_blank" rel="noopener" href="http://httpd.apache.org/docs/2.4/mod/mod_access_compat.html">http://httpd.apache.org/docs/2.4/mod/mod_access_compat.html</a></p>
<p>Available in Apache HTTP Server 2.3 as a compatibility module with previous versions of Apache httpd 2.x. The directives provided by this module have been deprecated by the new authz refactoring. Please see <code>mod_authz_host</code>.</p>
<p>The <code>Allow </code>, <code>Deny</code> , and <code>Order directives</code>, provided by <code>mod_access_compat</code> , are deprecated and will go away in a future version. You should avoid using them, and avoid outdated tutorials recomm.</p>
<p>范例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html">DocumentRoot &quot;/data/html/software&quot;<br><span class="hljs-tag">&lt;<span class="hljs-name">directory</span> /<span class="hljs-attr">data</span>/<span class="hljs-attr">html</span>/<span class="hljs-attr">software</span>&gt;</span><br>    Require all granted<br>    <span class="hljs-tag">&lt;<span class="hljs-name">RequireAll</span>&gt;</span><br>        Require all granted<br>        Require not ip 127.0.0.1<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">RequireAll</span>&gt;</span><br>    AllowOverride All<br><span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="3-16-日志设定"><a href="#3-16-日志设定" class="headerlink" title="3.16 日志设定"></a>3.16 日志设定</h2><p>httpd有两种日志类型</p>
<ul>
<li><p>访问日志</p>
</li>
<li><p>错误日志</p>
</li>
</ul>
<h3 id="3-16-1-错误日志"><a href="#3-16-1-错误日志" class="headerlink" title="3.16.1 错误日志"></a>3.16.1 错误日志</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">LogLevel warn  <span class="hljs-comment">#LogLevel 可选值: debug, info, notice, warn，error, crit, alert，emerg</span><br>ErrorLog logs/error_log<br></code></pre></td></tr></table></figure>

<h3 id="3-16-2-访问日志"><a href="#3-16-2-访问日志" class="headerlink" title="3.16.2 访问日志"></a>3.16.2 访问日志</h3><ul>
<li><p>定义日志格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">LogFormat format  nickname<br></code></pre></td></tr></table></figure></li>
<li><p>使用日志格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">CustomLog file  nickname<br></code></pre></td></tr></table></figure></li>
</ul>
<p>范例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">LogFormat &quot;%h %l %u [%&#123;%F %T&#125;t] \&quot;%r\&quot; %&gt;s %b \&quot;%&#123;Referer&#125;i\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot;   testlog<br></code></pre></td></tr></table></figure>

<p>参考帮助：<a target="_blank" rel="noopener" href="http://httpd.apache.org/docs/2.4/mod/mod_log_config.html#formats">http://httpd.apache.org/docs/2.4/mod/mod_log_config.html#formats</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">%h <span class="hljs-comment">#客户端IP地址</span><br>%l <span class="hljs-comment">#远程用户,启用mod_ident才有效，通常为减号&quot;-”</span><br>%u <span class="hljs-comment">#验证（basic，digest）远程用户,非登录访问时，为一个减号&quot;-”</span><br>%t <span class="hljs-comment">#服务器收到请求时的时间</span><br>%r <span class="hljs-comment">#First line of request，即表示请求报文的首行；记录了此次请求的&quot;方法”，&quot;URL”以及协议版本</span><br>%&gt;s <span class="hljs-comment">#响应状态码</span><br>%b <span class="hljs-comment">#响应报文的大小，单位是字节；不包括响应报文http首部</span><br>%&#123;Referer&#125;i <span class="hljs-comment">#请求报文中首部&quot;referer”的值；即从哪个页面中的超链接跳转至当前页面的</span><br>%&#123;User-Agent&#125;i <span class="hljs-comment">#请求报文中首部&quot;User-Agent”的值；即发出请求的应用程序</span><br>%&#123;VARNAME&#125;i  <span class="hljs-comment">#The contents of VARNAME: header line(s) in the request sent to the server</span><br></code></pre></td></tr></table></figure>

<p>范例1 : 通过自定义访问日志格式,实现自定义时间格式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#vim /etc/httpd/conf/httpd.conf</span><br>LogFormat <span class="hljs-string">&quot;\&quot;%h\&quot; \&quot;%&#123;%F %T&#125;t\&quot; \&quot;%&#123;User-Agent&#125;i\&quot;&quot;</span> testlog<br>CustomLog <span class="hljs-string">&quot;logs/access_log&quot;</span> testlog<br><br>[root@centos8 ~]<span class="hljs-comment">#tail -f /var/log/httpd/access_log</span><br><span class="hljs-string">&quot;10.0.0.1&quot;</span> <span class="hljs-string">&quot;2022-11-05 16:31:53&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="3-17-基于用户的访问控制"><a href="#3-17-基于用户的访问控制" class="headerlink" title="3.17 基于用户的访问控制"></a>3.17 基于用户的访问控制</h2><p>认证质询：WWW-Authenticate，响应码为401，拒绝客户端请求，并说明要求客户端需要提供账号和密码</p>
<p>认证：Authorization，客户端用户填入账号和密码后再次发送请求报文；认证通过时，则服务器发送响应的资源</p>
<p>认证方式两种：</p>
<ul>
<li>basic：明文</li>
<li>digest：消息摘要认证,兼容性差</li>
</ul>
<p>安全域：需要用户认证后方能访问的路径；应该通过名称对其进行标识，以便于告知用户认证的原因</p>
<p>用户的账号和密码</p>
<p>虚拟账号：仅用于访问某服务时用到的认证标识</p>
<p>存储：文本文件，SQL数据库，ldap目录存储，nis等</p>
<h3 id="3-17-1-基于用户账号进行认证"><a href="#3-17-1-基于用户账号进行认证" class="headerlink" title="3.17.1 基于用户账号进行认证"></a>3.17.1 基于用户账号进行认证</h3><h4 id="3-17-1-1-定义安全域"><a href="#3-17-1-1-定义安全域" class="headerlink" title="3.17.1.1 定义安全域"></a>3.17.1.1 定义安全域</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;Directory <span class="hljs-string">&quot;/path&quot;</span>&gt;<br>Options None<br>AllowOverride None<br>AuthType Basic<br>AuthName <span class="hljs-string">&quot;String&quot;</span>  <span class="hljs-comment">#浏览器不同,可能这字符不一定能显示出来</span><br>AuthUserFile  <span class="hljs-string">&quot;/PATH/HTTPD_USER_PASSWD_FILE&quot;</span><br>Require valid-user  <span class="hljs-comment">#允许账号文件中的所有用户登录访问</span><br><span class="hljs-comment">#Require user username1 username2 ... 指定用户</span><br>&lt;/Directory&gt;<br></code></pre></td></tr></table></figure>

<h4 id="3-17-1-2-提供账号和密码存储（文本文件）"><a href="#3-17-1-2-提供账号和密码存储（文本文件）" class="headerlink" title="3.17.1.2 提供账号和密码存储（文本文件）"></a>3.17.1.2 提供账号和密码存储（文本文件）</h4><p>使用专用命令完成此类文件的创建及用户管理</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">htpasswd [options] /PATH/HTTPD_PASSWD_FILE username password<br><br><span class="hljs-comment">#创建账号文件</span><br><span class="hljs-comment"># htpasswd -cb /PATH/HTTPD_PASSWD_FILE user password</span><br><br><span class="hljs-comment">#继续添加用户</span><br><span class="hljs-comment"># htpasswd -b /PATH/HTTPD_PASSWD_FILE user password</span><br><br><span class="hljs-comment">#需要确保apache用户对此文件要有read权限</span><br>setfacl -m u:apache:r /PATH/HTTPD_PASSWD_FILE<br></code></pre></td></tr></table></figure>

<p>选项：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">-c 自动创建文件，仅应该在文件不存在时使用<br>-b 非交互方式创建用户,命令后面可以接密码<br>-p 明文密码<br>-d CRYPT格式加密，默认<br>-m md5格式加密<br>-s sha格式加密<br>-D 删除指定用户<br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># mkdir /data/html/admin</span><br><br><span class="hljs-comment"># echo admin.user &gt; /data/html/admin/index.html</span><br><br><span class="hljs-comment"># vim /etc/httpd/conf.d/test.conf</span><br>&lt;Directory <span class="hljs-string">&quot;/data/html/admin&quot;</span>&gt;<br>    Options None<br>    AllowOverride None<br>    AuthType Basic<br>    AuthName <span class="hljs-string">&quot;FBI Warning&quot;</span><br>    AuthUserFile  <span class="hljs-string">&quot;/etc/httpd/conf.d/.htttpuser&quot;</span><br>    Require valid-user<br>&lt;/Directory&gt;<br><br><span class="hljs-comment">#创建账号文件</span><br><span class="hljs-comment"># htpasswd -cb /etc/httpd/conf.d/.htttpuser rlin 123456</span><br>Adding password <span class="hljs-keyword">for</span> user rlin<br><br><span class="hljs-comment">#继续添加用户</span><br><span class="hljs-comment"># htpasswd -b /etc/httpd/conf.d/.htttpuser zhangxiaofeng 123456</span><br>Adding password <span class="hljs-keyword">for</span> user zhangxiaofeng<br><br><span class="hljs-comment">#查看账号文件</span><br><span class="hljs-comment"># cat /etc/httpd/conf.d/.htttpuser </span><br>rlin:$apr1<span class="hljs-variable">$jT</span>/ToIm2<span class="hljs-variable">$CQ5RTLMJr4b</span>/J/D0.3Rzb0<br>zhangxiaofeng:$apr1$U5L85flC$.5AZkrzE20LU9W7VPX91n1<br><br><span class="hljs-comment"># systemctl reload httpd</span><br><br><span class="hljs-comment"># curl http://rlin:123456@10.0.0.17/admin/</span><br>admin.user<br><span class="hljs-comment"># curl -u zhangxiaofeng:123456 http://10.0.0.17/admin/</span><br>admin.user<br></code></pre></td></tr></table></figure>

<p>浏览器访问 <code>http://httpd服务器/admin</code> 可以看到以下显示</p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache12.png" srcset="/blog/img/loading.gif"></p>
<hr>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache13.png" srcset="/blog/img/loading.gif"></p>
<p>使用wireshark 抓包软件，可以看到明文密码</p>
<p>查看访问日志文件/var/logs/httpd/access_log，可以观察到以下内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># tail -f /var/log/httpd/access.log</span><br>10.0.0.1 - rlin [05/Nov/2022:17:03:36 +0800] <span class="hljs-string">&quot;GET /admin HTTP/1.1&quot;</span> 500 624 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&quot;</span><br></code></pre></td></tr></table></figure>

<p>范例：方法2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># mkdir /data/html/admin</span><br><br><span class="hljs-comment"># echo admin.user &gt; /data/html/admin/index.html</span><br><br><span class="hljs-comment"># vim /data/html/admin/.htaccess</span><br>AuthType Basic<br>AuthName <span class="hljs-string">&quot;FBI Warning&quot;</span><br>AuthUserFile  <span class="hljs-string">&quot;/etc/httpd/conf.d/.htttpuser&quot;</span><br>Require user zhangxiaofeng<br><br><span class="hljs-comment"># vim /etc/httpd/conf.d/test.conf</span><br>&lt;Directory <span class="hljs-string">&quot;/data/html/admin&quot;</span>&gt;<br>    Require all granted<br>    Options None<br>    AllowOverride authconfig<br>&lt;/Directory&gt;<br><br><span class="hljs-comment"># systemctl reload httpd</span><br></code></pre></td></tr></table></figure>

<h3 id="3-17-2-基于组账号进行认证"><a href="#3-17-2-基于组账号进行认证" class="headerlink" title="3.17.2 基于组账号进行认证"></a>3.17.2 基于组账号进行认证</h3><h4 id="3-17-2-1-定义安全域"><a href="#3-17-2-1-定义安全域" class="headerlink" title="3.17.2.1 定义安全域"></a>3.17.2.1 定义安全域</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;Directory <span class="hljs-string">&quot;/path&quot;</span>&gt;<br>AuthType Basic<br>AuthName <span class="hljs-string">&quot;String&quot;</span><br>AuthUserFile  <span class="hljs-string">&quot;/PATH/HTTPD_USER_PASSWD_FILE&quot;</span><br>AuthGroupFile <span class="hljs-string">&quot;/PATH/HTTPD_GROUP_FILE&quot;</span><br>Require group grpname1 grpname2 ...<br>&lt;/Directory&gt;<br></code></pre></td></tr></table></figure>

<h4 id="3-17-2-2-创建用户账号和组账号文件"><a href="#3-17-2-2-创建用户账号和组账号文件" class="headerlink" title="3.17.2.2 创建用户账号和组账号文件"></a>3.17.2.2 创建用户账号和组账号文件</h4><p>组文件：每一行定义一个组</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">GRP_NAME: username1 username2 ...<br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#cat /etc/httpd/conf.d/test.conf</span><br>&lt;directory /data/html/admin&gt;<br>    Require all granted<br>    Options None<br>    AllowOverride authconfig<br>&lt;/directory&gt;<br><br><span class="hljs-comment"># cat /data/html/admin/.htaccess</span><br>AuthType Basic<br>AuthName <span class="hljs-string">&quot;FBI warning&quot;</span><br>AuthUserFile  <span class="hljs-string">&quot;/etc/httpd/conf.d/.httpuser&quot;</span><br>AuthGroupFile <span class="hljs-string">&quot;/etc/httpd/conf.d/.httpgroup&quot;</span><br>Require group webadmins<br><br><span class="hljs-comment"># cat /etc/httpd/conf.d/.httpuser</span><br>rlin:$apr1<span class="hljs-variable">$jT</span>/ToIm2<span class="hljs-variable">$CQ5RTLMJr4b</span>/J/D0.3Rzb0<br>zhangxiaofeng:$apr1$U5L85flC$.5AZkrzE20LU9W7VPX91n1<br><br><span class="hljs-comment"># cat /etc/httpd/conf.d/.httpgroup</span><br>webadmins: rlin zhangxiaofeng<br></code></pre></td></tr></table></figure>

<h2 id="3-18-status-状态页"><a href="#3-18-status-状态页" class="headerlink" title="3.18 status 状态页"></a>3.18 status 状态页</h2><p>httpd 提供了状态页，可以用来观察httpd的运行情况。此功能需要加载mod_status.so模块才能实现</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">LoadModule status_module modules/mod_status.so<br>&lt;Location <span class="hljs-string">&quot;/status&quot;</span>&gt;<br>SetHandler server-status<br>&lt;/Location&gt;<br>ExtendedStatus On  <span class="hljs-comment">#显示扩展信息,httpd 2.3.6以后版默认为On</span><br></code></pre></td></tr></table></figure>

<p>范例 1：启用状态页</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#确认加载mod_status.so模块</span><br><span class="hljs-comment"># httpd -M |grep status</span><br>status_module (shared)<br><br><span class="hljs-comment"># vim /etc/httpd/conf.d/status.conf</span><br>&lt;Location <span class="hljs-string">&quot;/status&quot;</span>&gt;<br>    SetHandler server-status<br>    Require all granted<br>&lt;/Location&gt;<br>ExtendedStatus Off  <span class="hljs-comment">#是否详细的信息,默认值为on</span><br><br><span class="hljs-comment"># systemctl restart httpd</span><br></code></pre></td></tr></table></figure>

<p>打开浏览器访问 <code>http://httpd服务器IP/status</code>可以参看到以下页面</p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache14.png" srcset="/blog/img/loading.gif"></p>
<p>范例 2：启用状态页，并限制访问</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#确认加载mod_status.so模块</span><br><span class="hljs-comment"># httpd -M |grep status</span><br>status_module (shared)<br><br><span class="hljs-comment"># vim /etc/httpd/conf.d/status.conf</span><br>&lt;Location <span class="hljs-string">&quot;/status&quot;</span>&gt;<br>    SetHandler server-status<br>    &lt;RequireAny&gt;<br>        Require all denied<br>        require ip 172.16.1.1  <span class="hljs-comment">#允许特定IP</span><br>    &lt;/RequireAny&gt;<br>   <span class="hljs-comment">#Order Deny,Allow  此方式也可以控制访问</span><br>   <span class="hljs-comment">#Deny from all</span><br>   <span class="hljs-comment">#Allow from 192.168.100</span><br>&lt;/Location&gt;<br>ExtendedStatus Off  <span class="hljs-comment">#是否详细的信息,默认值为on</span><br><br><span class="hljs-comment"># systemctl restart httpd</span><br></code></pre></td></tr></table></figure>

<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache15.png" srcset="/blog/img/loading.gif"></p>
<p>范例 3：对status页面进行登录认证</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos7 ~]<span class="hljs-comment">#vim /apps/httpd24/conf.d/test.conf</span><br>&lt;Location <span class="hljs-string">&quot;/status&quot;</span>&gt;<br>AuthType Basic<br>AuthName <span class="hljs-string">&quot;Please login&quot;</span>                            <br>AuthUserFile  <span class="hljs-string">&quot;/etc/httpd/conf.d/.httpuser&quot;</span><br>Require user rlin<br>SetHandler server-status<br>&lt;/Location&gt;<br></code></pre></td></tr></table></figure>

<h2 id="3-19-多虚拟主机"><a href="#3-19-多虚拟主机" class="headerlink" title="3.19 多虚拟主机"></a>3.19 多虚拟主机</h2><p>httpd 支持在一台物理主机上实现多个网站，即多虚拟主机</p>
<p>网站的唯一标识：</p>
<ul>
<li>IP相同，但端口不同</li>
<li>IP不同，但端口均为默认端口</li>
</ul>
<p>FQDN不同, IP和端口都相同</p>
<p>多虚拟主机有三种实现方案：</p>
<ul>
<li>基于ip：为每个虚拟主机准备至少一个ip地址</li>
<li>基于port：为每个虚拟主机使用至少一个独立的port</li>
<li>基于FQDN：为每个虚拟主机使用至少一个FQDN，请求报文中首部 Host: <a target="_blank" rel="noopener" href="http://www.rlin.com/">www.rlin.com</a></li>
</ul>
<p>注意：httpd 2.4版本中，基于FQDN的虚拟主机不再需要NameVirutalHost指令</p>
<p>虚拟主机的基本配置方法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">&lt;VirtualHost IP:PORT&gt;<br>ServerName FQDN<br>DocumentRoot  <span class="hljs-string">&quot;/path&quot;</span><br>&lt;/VirtualHost&gt;<br></code></pre></td></tr></table></figure>

<p>建议：上述配置存放在独立的配置文件中</p>
<p>其它常用可用指令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">ServerAlias：虚拟主机的别名；可多次使用<br>ErrorLog： 错误日志<br>CustomLog：访问日志<br>&lt;Directory <span class="hljs-string">&quot;/path&quot;</span>&gt; &lt;/Directory&gt;<br></code></pre></td></tr></table></figure>

<p>范例：基于端口的虚拟主机</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># mkdir /data/website&#123;1..3&#125;</span><br><span class="hljs-comment"># echo /data/website1/index.html &gt; /data/website1/index.html</span><br><span class="hljs-comment"># echo /data/website2/index.html &gt; /data/website2/index.html</span><br><span class="hljs-comment"># echo /data/website3/index.html &gt; /data/website3/index.html</span><br><br>[root@centos8 ~]<span class="hljs-comment">#cat /etc/httpd/conf.d/test.conf</span><br>listen 8001<br>listen 8002<br>listen 8003<br>&lt;virtualhost *:8001&gt;<br>documentroot /data/website1/<br>CustomLog logs/website1_access.log combined<br>&lt;directory /data/website1&gt;<br>require all granted<br>&lt;/directory&gt;<br>&lt;/virtualhost&gt;<br>&lt;virtualhost *:8002&gt;<br>documentroot /data/website2/<br>CustomLog logs/website2_access.log combined<br>&lt;directory /data/website2&gt;<br>require all granted<br>&lt;/directory&gt;<br>&lt;/virtualhost&gt;<br>&lt;virtualhost *:8003&gt;<br>documentroot /data/website3/<br>CustomLog logs/website3_access.log combined<br>&lt;directory /data/website3&gt;<br>require all granted<br>&lt;/directory&gt;<br>&lt;/virtualhost&gt;<br><br><span class="hljs-comment"># systemctl restart httpd</span><br><br><span class="hljs-comment"># ll /var/log/httpd/</span><br>total 44<br>-rw-r--r-- 1 root root 10679 Dec 10 12:00 access_log<br>-rw-r--r-- 1 root root 18883 Dec 10 11:59 error_log<br>-rw-r--r-- 1 root root  1969 Dec 10 12:00 website1_access.log<br>-rw-r--r-- 1 root root  482 Dec 10 12:00 website2_access.log<br>-rw-r--r-- 1 root root  482 Dec 10 12:00 website3_access.log<br><br><span class="hljs-comment">#浏览器访问不同端口，得到不同的页面</span><br><span class="hljs-comment"># curl http://10.0.0.17:8001/</span><br>/data/website1/index.html<br><span class="hljs-comment"># curl http://10.0.0.17:8002/</span><br>/data/website2/index.html<br><span class="hljs-comment"># curl http://10.0.0.17:8003/</span><br>/data/website3/index.html<br><br><span class="hljs-comment">#查看端口</span><br><span class="hljs-comment"># ss -tnl</span><br>State      Recv-Q Send-Q              Local Address:Port                             Peer Address:Port              <br>LISTEN     0      128                             *:22                                          *:*                  <br>LISTEN     0      128                          [::]:80                                       [::]:*                  <br>LISTEN     0      128                          [::]:22                                       [::]:*                  <br>LISTEN     0      128                          [::]:8001                                     [::]:*                  <br>LISTEN     0      128                          [::]:8002                                     [::]:*                  <br>LISTEN     0      128                          [::]:8003                                     [::]:*<br></code></pre></td></tr></table></figure>

<p>范例：基于IP的虚拟主机</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ip a a 10.0.0.17/24 dev eth0 label eth0:1</span><br><span class="hljs-comment"># ip a a 10.0.0.27/24 dev eth0 label eth0:2</span><br><span class="hljs-comment"># ip a a 10.0.0.37/24 dev eth0 label eth0:3</span><br><br><span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br> inet 127.0.0.1/8 scope host lo<br>   valid_lft forever preferred_lft forever<br> inet6 ::1/128 scope host<br>   valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000<br> link/ether 00:0c:29:f9:8d:90 brd ff:ff:ff:ff:ff:ff<br> inet 192.168.39.8/24 brd 192.168.39.255 scope global noprefixroute eth0<br>   valid_lft forever preferred_lft forever<br> inet 10.0.0.8/24 scope global eth0<br>   valid_lft forever preferred_lft forever<br> inet 10.0.0.18/24 scope global secondary eth0<br>   valid_lft forever preferred_lft forever<br> inet 10.0.0.28/24 scope global secondary eth0<br>   valid_lft forever preferred_lft forever<br> inet6 fe80::20c:29ff:fef9:8d90/64 scope link<br>   valid_lft forever preferred_lft forever<br><span class="hljs-comment"># vim /etc/httpd/conf.d/test.conf</span><br>&lt;virtualhost 10.0.0.17:80&gt;<br>documentroot /data/website1/<br>CustomLog logs/website1_access.log combined<br>&lt;directory /data/website1&gt;<br>require all granted<br>&lt;/directory&gt;<br>&lt;/virtualhost&gt;<br><br>&lt;virtualhost 10.0.0.27:80&gt;<br>documentroot /data/website2/<br>CustomLog logs/website2_access.log combined<br>&lt;directory /data/website2&gt;<br>require all granted<br>&lt;/directory&gt;<br>&lt;/virtualhost&gt;<br><br>&lt;virtualhost 10.0.0.37:80&gt;<br>documentroot /data/website3/<br>CustomLog logs/website3_access.log combined<br>&lt;directory /data/website3&gt;<br>require all granted<br>&lt;/directory&gt;<br>&lt;/virtualhost&gt;<br><br><span class="hljs-comment"># httpd -t</span><br>Syntax OK<br><span class="hljs-comment"># systemctl reload httpd</span><br><br><span class="hljs-comment"># curl 10.0.0.17</span><br>/data/website1/index.html<br><span class="hljs-comment"># curl 10.0.0.27</span><br>/data/website2/index.html<br><span class="hljs-comment"># curl 10.0.0.37</span><br>/data/website3/index.html<br></code></pre></td></tr></table></figure>

<p>范例：基于FQDN虚拟主机</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># mkdir /data/html/&#123;a,b,c&#125;</span><br><span class="hljs-comment"># echo /data/html/a/index.html &gt; /data/html/a/index.html</span><br><span class="hljs-comment"># echo /data/html/b/index.html &gt; /data/html/b/index.html</span><br><span class="hljs-comment"># echo /data/html/c/index.html &gt; /data/html/c/index.html</span><br><br>vim /etc/httpd/conf.d/test.conf<br>&lt;VirtualHost *:80&gt;<br>ServerName www.a.com<br>DocumentRoot <span class="hljs-string">&quot;/data/html/a&quot;</span><br>CustomLog <span class="hljs-string">&quot;logs/a_access_log&quot;</span> combined<br>ErrorLog <span class="hljs-string">&quot;logs/a_error_log&quot;</span><br>&lt;Directory <span class="hljs-string">&quot;/data/html/a&quot;</span>&gt;<br>Options None<br>AllowOverride None<br>Require all granted<br>&lt;/Directory&gt;<br>&lt;/VirtualHost&gt;<br><br>&lt;VirtualHost *:80&gt;<br>ServerName www.b.com<br>DocumentRoot <span class="hljs-string">&quot;/data/html/b&quot;</span><br>ErrorLog <span class="hljs-string">&quot;logs/b_error_log&quot;</span><br>CustomLog <span class="hljs-string">&quot;logs/b_access_log&quot;</span> combined<br>&lt;Directory <span class="hljs-string">&quot;/data/html/b&quot;</span>&gt;<br>Options None<br>AllowOverride None<br>Require all granted<br>&lt;/Directory&gt;<br>&lt;/VirtualHost&gt;<br><br>&lt;VirtualHost *:80&gt;<br>ServerName www.c.com<br>DocumentRoot <span class="hljs-string">&quot;/data/html/c&quot;</span><br>ErrorLog <span class="hljs-string">&quot;logs/c_error_log&quot;</span><br>CustomLog <span class="hljs-string">&quot;logs/c_access_log&quot;</span> combined<br>&lt;Directory <span class="hljs-string">&quot;/data/html/c&quot;</span>&gt;<br>Options None<br>AllowOverride None<br>Require all granted<br>&lt;/Directory&gt;<br>&lt;/VirtualHost&gt;<br><br><span class="hljs-comment"># httpd -t</span><br><br><span class="hljs-comment"># systemctl restart httpd</span><br><br><span class="hljs-comment"># curl http://www.a.com</span><br>/data/html/a/index.html<br><span class="hljs-comment"># curl http://www.b.com</span><br>/data/html/b/index.html<br><span class="hljs-comment"># curl http://www.c.com</span><br>/data/html/c/index.html<br></code></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>任意目录下的页面只有显式授权才能被访问</li>
<li>三种方式的虚拟主机可以混和使用</li>
<li>基于主机头的第一个虚拟主机将成为默认站点</li>
</ul>
<h2 id="3-20-压缩"><a href="#3-20-压缩" class="headerlink" title="3.20 压缩"></a>3.20 压缩</h2><p>使用<code>mod_deflate</code>模块压缩页面优化传输速度</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">LoadModule deflate_module modules/mod_deflate.so SetOutputFilter<br></code></pre></td></tr></table></figure>

<p>适用场景：<br>（1）节约带宽，额外消耗CPU；同时，可能有些较老浏览器不支持</p>
<p>（2） 压缩适于压缩的资源，例如文本文</p>
<p>可压缩选项：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">cat /etc/mime.types <span class="hljs-comment">#内容太多不一一列举</span><br></code></pre></td></tr></table></figure>

<p>压缩指令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#可选项</span><br>SetOutputFilter DEFLATE <br><br><span class="hljs-comment"># 指定对哪种MIME类型进行压缩，必须指定项</span><br>AddOutputFilterByType DEFLATE text/plain<br>AddOutputFilterByType DEFLATE text/html<br>AddOutputFilterByType DEFLATE application/xhtml+xml<br>AddOutputFilterByType DEFLATE text/xml<br>AddOutputFilterByType DEFLATE application/xml<br>AddOutputFilterByType DEFLATE application/x-javascript<br>AddOutputFilterByType DEFLATE text/javascript<br>AddOutputFilterByType DEFLATE text/css<br><br><span class="hljs-comment">#压缩级别 (Highest 9 - Lowest 1)</span><br>DeflateCompressionLevel 9<br><span class="hljs-comment">#排除特定旧版本的浏览器，不支持压缩</span><br><span class="hljs-comment">#Netscape 4.x 只压缩text/html</span><br>BrowserMatch ^Mozilla/4 gzip-only-text/html<br><span class="hljs-comment">#Netscape 4.06-08 三个版本 不压缩</span><br>BrowserMatch ^Mozilla/4\.0[678] no-gzip<br><span class="hljs-comment">#Internet Explorer标识本身为&quot;Mozilla / 4”，但实际上是能够处理请求的压缩。如果用户代理首部匹配字符串&quot;MSIE”（&quot;B”为单词边界”），就关闭之前定义的限制</span><br>BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html<br></code></pre></td></tr></table></figure>

<h2 id="3-21-实现-https"><a href="#3-21-实现-https" class="headerlink" title="3.21 实现 https"></a>3.21 实现 https</h2><p>https：http over ssl ,实现验证和加密功能</p>
<h3 id="3-21-1-HTTPS-会话的简化过程"><a href="#3-21-1-HTTPS-会话的简化过程" class="headerlink" title="3.21.1 HTTPS 会话的简化过程"></a>3.21.1 HTTPS 会话的简化过程</h3><p>" srcset="/blog/img/loading.gif<img src=""></p>
<ol>
<li><p>客户端发送可供选择的加密方式，并向服务器请求证书</p>
</li>
<li><p>服务器端发送证书以及选定的加密方式给客户端</p>
</li>
<li><p>客户端取得证书并进行证书验证，如果信任给其发证书的CA<br> (a) 验证证书来源的合法性；用CA的公钥解密证书上数字签名<br> (b) 验证证书的内容的合法性：完整性验证<br> (c) 检查证书的有效期限<br> (d) 检查证书是否被吊销<br> (e) 证书中拥有者的名字，与访问的目标主机要一致</p>
</li>
<li><p>客户端生成临时会话密钥（对称密钥），并使用服务器端的公钥加密此数据发送给服务器，完成密<br> 钥交换</p>
</li>
<li><p>服务用此密钥加密用户请求的资源，响应给客户端</p>
</li>
</ol>
<p>注意：SSL是基于IP地址实现,单IP的httpd主机，仅可以使用一个https虚拟主机</p>
<h3 id="3-21-2-apache实现https过程"><a href="#3-21-2-apache实现https过程" class="headerlink" title="3.21.2 apache实现https过程"></a>3.21.2 apache实现https过程</h3><ol>
<li>为服务器申请数字证书<br>可以通过私建CA颁发证书实现<br>(a) 创建私有CA<br>(b) 在服务器创建证书签署请求<br>(c) CA签证</li>
<li>配置httpd支持使用ssl，及使用的证书</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装mod_ssl包</span><br>yum -y install mod_ssl<br><br><span class="hljs-comment">#mod_ssl包的内容</span><br><span class="hljs-comment"># rpm -ql mod_ssl</span><br>/etc/httpd/conf.d/ssl.conf<br>/etc/httpd/conf.modules.d/00-ssl.conf<br>/usr/lib64/httpd/modules/mod_ssl.so<br>/usr/libexec/httpd-ssl-pass-dialog<br>/var/cache/httpd/ssl<br><br><span class="hljs-comment">#需要修改对应的配置文件：/etc/httpd/conf.d/ssl.conf</span><br>DocumentRoot<br>ServerName<br>SSLCertificateFile  /path/file<br>SSLCertificateKeyFile /path/file<br>SSLCACertificateFile /path/file<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>测试基于https访问相应的主机</li>
</ol>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">openssl s_client [-connect host:port] [-cert filename] [-CApath directory] [-CAfile filename]<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># openssl s_client -connect www.wangxiaochun.com:443 -CAfile 3395645_wangxiaochun.com_chain.crt</span><br>CONNECTED(00000003)<br>depth=1 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = Encryption<br>Everywhere DV TLS CA - G1<br>verify error:num=2:unable to get issuer certificate<br>issuer= C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert Global<br>Root CA<br>verify <span class="hljs-built_in">return</span>:1<br>depth=0 CN = wangxiaochun.com<br>issuer= C = US, O = DigiCert Inc, OU = www.digicert.com, CN = Encryption<br>Everywhere DV TLS CA - G1<br>verify <span class="hljs-built_in">return</span>:1<br>---<br>Certificate chain<br>0 s:CN = wangxiaochun.com<br> i:C = US, O = DigiCert Inc, OU = www.digicert.com, CN = Encryption Everywhere<br>DV TLS CA - G1<br>1 s:C = US, O = DigiCert Inc, OU = www.digicert.com, CN = Encryption Everywhere<br>DV TLS CA - G1<br> i:C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert Global Root<br>CA<br>---<br>Server certificate<br>-----BEGIN CERTIFICATE-----<br>MIIFnzCCBIegAwIBAgIQB3425GSzkfzbXJPdk93h+DANBgkqhkiG9w0BAQsFADBu<br>MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3<br>d3cuZGlnaWNlcnQuY29tMS0wKwYDVQQDEyRFbmNyeXB0aW9uIEV2ZXJ5d2hlcmUg<br>RFYgVExTIENBIC0gRzEwHhcNMjAwMTE4MDAwMDAwWhcNMjEwMTE3MTIwMDAwWjAb<br>MRkwFwYDVQQDExB3YW5neGlhb2NodW4uY29tMIIBIjANBgkqhkiG9w0BAQEFAAOC<br>AQ8AMIIBCgKCAQEAnZ46i/1IDnCTiB/tUVKop4YXovxPZdgnMzHsZ93Y8hZ/a19s<br>uHao9NLO2LLrHocGzbWkdHsk/oG0a3UIGmiLLbbZxJZ+8zR6ipREYpIkFVOWJDVZ<br>qGhmZl03/0q/ufJ80yROpjPPJcsvGIbooKrFdDcdjK0zB0g7hBAyBBiA5QpRc7ZA<br>3aXy1eCZ/kT1jzhqsqkjhxvrMc7k5aeL6QgvD4HmjecQokGgiQGGkUsVbNw73pPO<br>GD4VQPjtWwNuS23QPnubHQWpaRoWN2uMuYfzhbz2Fn6sST1Vkw/EhS61mrKGkEe+<br>BY2KFsF5W63a7cpInC9cyVKVZIhuGqny9qYfHwIDAQABo4ICijCCAoYwHwYDVR0j<br>BBgwFoAUVXRPsnJP9WC6UNHX5lFcmgGHGtcwHQYDVR0OBBYEFNKlDzPfND0TLQKc<br>Fn35dAZ9TjyYMDEGA1UdEQQqMCiCEHdhbmd4aWFvY2h1bi5jb22CFHd3dy53YW5n<br>eGlhb2NodW4uY29tMA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcD<br>AQYIKwYBBQUHAwIwTAYDVR0gBEUwQzA3BglghkgBhv1sAQIwKjAoBggrBgEFBQcC<br>ARYcaHR0cHM6Ly93d3cuZGlnaWNlcnQuY29tL0NQUzAIBgZngQwBAgEwgYAGCCsG<br>AQUFBwEBBHQwcjAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuZGlnaWNlcnQuY29t<br>MEoGCCsGAQUFBzAChj5odHRwOi8vY2FjZXJ0cy5kaWdpY2VydC5jb20vRW5jcnlw<br>dGlvbkV2ZXJ5d2hlcmVEVlRMU0NBLUcxLmNydDAJBgNVHRMEAjAAMIIBBAYKKwYB<br>BAHWeQIEAgSB9QSB8gDwAHcA7ku9t3XOYLrhQmkfq+GeZqMPfl+wctiDAMR7iXqo<br>/csAAAFvuAJFYgAABAMASDBGAiEAuJSX24WIpQs38JcGTL0vIrKyVIELyCx0J9Gr<br>mufF0mICIQCa+H3Nn5SopmabRllEbs3HDB+A2JGXuXVVzk8KEpwEDwB1AESUZS6w<br>7s6vxEAH2Kj+KMDa5oK+2MsxtT/TM5a1toGoAAABb7gCRMgAAAQDAEYwRAIgfiq4<br>Kdu7nH2x21VGG5lJm1NoaMFeYyIpXPrFexQQI4gCICGSoDqbM7sz+hojEKwJhksE<br>whi4AwbleDrzE4deDsjCMA0GCSqGSIb3DQEBCwUAA4IBAQCe2M2wDM9buKog6IYe<br>ZlNwQ2JwUgBkxF4ttNX3Wj8+2vExfZMsfxUvyQeo5u8hVtbTHkNoNTckbFo+fmvc<br>uvExkSHD0bi506OOtJvND5mD8qsXJM/wsls1qW8znD3SAFRsbHo8LLLn2mUt5L//<br>9Qs54mwixrBBDOuxCxra/Ou/dEMRcl1Ni0tbiTNsdsg1FwDcz01DvmYpbm8RNcw2<br>ZYIXlmEighMGGfsPIt2qvG79dxlVToB1y3qtoPxEzAoM13EtQaJQRw4otrNcVIGl<br>BvhXcG06qgnjS5TBAzFcp93AM12QcJWKaiCgAQgFj0wSz9vbQ4b2AUOow0ybj+Ug<br>W9U0<br>-----END CERTIFICATE-----<br>subject=CN = wangxiaochun.com<br><br>issuer=C = US, O = DigiCert Inc, OU = www.digicert.com, CN = Encryption<br>Everywhere DV TLS CA - G1<br><br>---<br>No client certificate CA names sent<br>Peer signing digest: SHA256<br>Peer signature <span class="hljs-built_in">type</span>: RSA-PSS<br>Server Temp Key: X25519, 253 bits<br>---<br>SSL handshake has <span class="hljs-built_in">read</span> 3202 bytes and written 408 bytes<br>Verification error: unable to get issuer certificate<br>---<br>New, TLSv1.3, Cipher is TLS_AES_256_GCM_SHA384<br>Server public key is 2048 bit<br>Secure Renegotiation IS NOT supported<br>Compression: NONE<br>Expansion: NONE<br>No ALPN negotiated<br>Early data was not sent<br>Verify <span class="hljs-built_in">return</span> code: 2 (unable to get issuer certificate)<br>---<br>---<br>Post-Handshake New Session Ticket arrived:<br>SSL-Session:<br> Protocol : TLSv1.3<br> Cipher  : TLS_AES_256_GCM_SHA384<br> Session-ID: 98D722FD0FD8EC13824F3A06EEE40D05D8CDD2614991595145FCD93652DC5036<br> Session-ID-ctx:<br> Resumption PSK:<br>39190C81F06CD7EBFDD18B43A132F2939F3AB57214FB7141CA13A6B6F4B23EC7EF572EA0B8C6B3F3<br>0D5504163C396EC2<br> PSK identity: None<br> PSK identity hint: None<br> SRP username: None<br> TLS session ticket lifetime hint: 300 (seconds)<br> TLS session ticket:<br>  0000 - 51 70 e5 b9 58 07 67 ee-c1 24 0b a4 49 <span class="hljs-built_in">cd</span> 2c 6c  Qp..X.g..$..I.,l<br>  0010 - ec 9e c4 47 5d 9d bf bb-d3 1d 8a fb 3d 3d 36 8f  ...G].......==6.<br>  0020 - 73 63 2e b8 d9 cc 42 c4-c1 09 06 45 75 2f 2b 5f  sc....B....Eu/+_<br>  0030 - 0e b6 32 59 0b 48 4f 1d-35 27 a8 fa 23 e5 bd c8  ..2Y.HO.5<span class="hljs-string">&#x27;..#...</span><br><span class="hljs-string">  0040 - fe 38 fe 4f 8b df 0f 0f-1b 0f c8 dc 73 f4 dc 41  .8.O........s..A</span><br><span class="hljs-string">  0050 - ab 3f c0 7d b6 d3 7e 23-39 fc ae 8c ce 52 f6 5c  .?.&#125;..~#9....R.\</span><br><span class="hljs-string">  0060 - b9 01 c8 81 b9 d6 8c 23-96 24 c7 a2 ad c5 96 d9  .......#.$......</span><br><span class="hljs-string">  0070 - 0e bb dc 11 68 4d 97 da-d8 c6 6f 15 55 9c 5c 72  ....hM....o.U.\r</span><br><span class="hljs-string">  0080 - 34 b6 a7 b0 f0 fd bd 94-15 86 46 1a 6e e2 e3 b1  4.........F.n...</span><br><span class="hljs-string">  0090 - fd a0 b5 0b 34 63 cd 5c-f9 6d 76 f2 4f 00 bf e2  ....4c.\.mv.O...</span><br><span class="hljs-string"> 00a0 - ce f7 23 16 c0 66 d6 72-49 ea 26 d8 be 6a 79 76  ..#..f.rI.&amp;..jyv</span><br><span class="hljs-string"> 00b0 - c2 2d 44 14 5b 8b e6 36-ec 93 1d dd 86 71 5c a4  .-D.[..6.....q\.</span><br><span class="hljs-string"> 00c0 - 6d 85 60 14 a6 2e fe 4e-ea da 23 be 2a 23 cd fe  m.`....N..#.*#..</span><br><span class="hljs-string"> 00d0 - ae fa bb 29 70 44 33 1d-0e 81 7a 2f 98 71 64 19  ...)pD3...z/.qd.</span><br><span class="hljs-string"> </span><br><span class="hljs-string"> Start Time: 1592987408</span><br><span class="hljs-string"> Timeout  : 7200 (sec)</span><br><span class="hljs-string"> Verify return code: 2 (unable to get issuer certificate)</span><br><span class="hljs-string"> Extended master secret: no</span><br><span class="hljs-string"> Max Early Data: 0</span><br><span class="hljs-string">---</span><br><span class="hljs-string">read R BLOCK</span><br><span class="hljs-string">---</span><br><span class="hljs-string">Post-Handshake New Session Ticket arrived:</span><br><span class="hljs-string">SSL-Session:</span><br><span class="hljs-string"> Protocol : TLSv1.3</span><br><span class="hljs-string"> Cipher  : TLS_AES_256_GCM_SHA384</span><br><span class="hljs-string"> Session-ID: F7B2F3B606DAB7B2B165F4631D27D19CBB36BBACAD17D977C8905807295392A2</span><br><span class="hljs-string"> Session-ID-ctx:</span><br><span class="hljs-string"> Resumption PSK:</span><br><span class="hljs-string">02E7598DB3F88D1A1D194BE3C3D8EB87960895A58D246D220FB83A40A0533CDC6BCBC2C5670A7DA8</span><br><span class="hljs-string">065B74CDC054230C</span><br><span class="hljs-string"> PSK identity: None</span><br><span class="hljs-string"> PSK identity hint: None</span><br><span class="hljs-string"> SRP username: None</span><br><span class="hljs-string"> TLS session ticket lifetime hint: 300 (seconds)</span><br><span class="hljs-string"> TLS session ticket:</span><br><span class="hljs-string">  0000 - 51 70 e5 b9 58 07 67 ee-c1 24 0b a4 49 cd 2c 6c  Qp..X.g..$..I.,l</span><br><span class="hljs-string">  0010 - d2 89 a6 22 ee 14 20 05-8a 75 ac 5f 44 7a f5 c6  ...&quot;.. ..u._Dz..</span><br><span class="hljs-string">  0020 - 97 da f8 84 22 c3 d9 d2-d4 06 06 fa 1c d1 ce 14  ....&quot;...........</span><br><span class="hljs-string">  0030 - 9c d4 e5 98 4c 42 5b 54-fd 23 34 af f0 17 f6 f9  ....LB[T.#4.....</span><br><span class="hljs-string">  0040 - 98 e5 2a 49 01 df 6d 4d-3e 54 e3 58 1b 9b b9 d7  ..*I..mM&gt;T.X....</span><br><span class="hljs-string">  0050 - c2 aa 06 c9 18 7c 48 eb-b1 88 9e 3f e8 aa 86 4e  .....|H....?...N</span><br><span class="hljs-string">  0060 - 7e 54 57 0e d9 14 6d d6-0c 70 e9 c7 4e 0b 40 4f  ~TW...m..p..N.@O</span><br><span class="hljs-string">  0070 - d9 15 88 53 a0 eb 26 aa-ff 81 de 6a aa 17 b9 e0  ...S..&amp;....j....</span><br><span class="hljs-string">  0080 - 73 5c 7e f7 cd 6a 46 c0-ff 59 f8 69 e1 54 0c c4  s\~..jF..Y.i.T..</span><br><span class="hljs-string">  0090 - 9a f0 6e 97 5e bc b1 8c-11 64 b0 e3 2f a9 20 69  ..n.^....d../. i</span><br><span class="hljs-string"> 00a0 - c6 8f 0f 0f c3 97 4a 30-2d 7b 18 c2 41 56 cb 6b  ......J0-&#123;..AV.k</span><br><span class="hljs-string"> 00b0 - c7 d5 75 46 a9 43 a2 b9-0b bd be 02 da 3a 84 b4  ..uF.C.......:..</span><br><span class="hljs-string"> 00c0 - fe 65 e7 7a 99 aa d8 e4-5f 62 dc 51 65 bd df d6  .e.z...._b.Qe...</span><br><span class="hljs-string"> 00d0 - d9 3e f1 d2 4d 38 e7 76-a8 8d f3 14 18 ec 6e b2  .&gt;..M8.v......n.</span><br><span class="hljs-string"> </span><br><span class="hljs-string"> Start Time: 1592987408</span><br><span class="hljs-string"> Timeout  : 7200 (sec)</span><br><span class="hljs-string"> Verify return code: 2 (unable to get issuer certificate)</span><br><span class="hljs-string"> Extended master secret: no</span><br><span class="hljs-string"> Max Early Data: 0</span><br><span class="hljs-string">---</span><br><span class="hljs-string">read R BLOCK</span><br><span class="hljs-string"></span><br><span class="hljs-string">HTTP/1.1 400 Bad Request</span><br><span class="hljs-string">Date: Wed, 24 Jun 2020 08:30:25 GMT</span><br><span class="hljs-string">Server: Apache/2.4.37 (centos) OpenSSL/1.1.1c</span><br><span class="hljs-string">Content-Length: 226</span><br><span class="hljs-string">Connection: close</span><br><span class="hljs-string">Content-Type: text/html; charset=iso-8859-1</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;</span><br><span class="hljs-string">&lt;html&gt;&lt;head&gt;</span><br><span class="hljs-string">&lt;title&gt;400 Bad Request&lt;/title&gt;</span><br><span class="hljs-string">&lt;/head&gt;&lt;body&gt;</span><br><span class="hljs-string">&lt;h1&gt;Bad Request&lt;/h1&gt;</span><br><span class="hljs-string">&lt;p&gt;Your browser sent a request that this server could not understand.&lt;br /&gt;</span><br><span class="hljs-string">&lt;/p&gt;</span><br><span class="hljs-string">&lt;/body&gt;&lt;/html&gt;</span><br><span class="hljs-string">closed</span><br></code></pre></td></tr></table></figure>

<h3 id="3-21-3-实现https-实战案例"><a href="#3-21-3-实现https-实战案例" class="headerlink" title="3.21.3 实现https 实战案例"></a>3.21.3 实现https 实战案例</h3><h4 id="3-21-3-1-范例1：单个虚拟主机使用生成自签名证书实现https"><a href="#3-21-3-1-范例1：单个虚拟主机使用生成自签名证书实现https" class="headerlink" title="3.21.3.1 范例1：单个虚拟主机使用生成自签名证书实现https"></a>3.21.3.1 范例1：单个虚拟主机使用生成自签名证书实现https</h4><h5 id="3-21-3-1-1-安装mode-ssl包"><a href="#3-21-3-1-1-安装mode-ssl包" class="headerlink" title="3.21.3.1.1 安装mode_ssl包"></a>3.21.3.1.1 安装<code>mode_ssl</code>包</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装mod_ssl包</span><br><span class="hljs-comment"># yum -y install mod_ssl</span><br></code></pre></td></tr></table></figure>

<h5 id="3-21-3-1-2-建立证书存放目录"><a href="#3-21-3-1-2-建立证书存放目录" class="headerlink" title="3.21.3.1.2 建立证书存放目录"></a>3.21.3.1.2 建立证书存放目录</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># mkdir /etc/httpd/certs</span><br></code></pre></td></tr></table></figure>

<h5 id="3-21-3-1-3-修改Makefile"><a href="#3-21-3-1-3-修改Makefile" class="headerlink" title="3.21.3.1.3 修改Makefile"></a>3.21.3.1.3 修改Makefile</h5><p><strong>修改Makefile的目的：为了在生成证书时进行加密</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#修改Makefile</span><br><span class="hljs-comment"># cd /etc/pki/tls/certs</span><br><span class="hljs-comment"># ls</span><br>ca-bundle.crt ca-bundle.trust.crt make-dummy-cert Makefile renew-dummy-cert<br><span class="hljs-comment"># vim Makefile</span><br><span class="hljs-comment">#/usr/bin/openssl genrsa -aes128 $(KEYLEN) &gt; $@ #约58行</span><br>/usr/bin/openssl genrsa $(KEYLEN) &gt; <span class="hljs-variable">$@</span><br></code></pre></td></tr></table></figure>

<h5 id="3-21-3-1-4-生成自签名证书"><a href="#3-21-3-1-4-生成自签名证书" class="headerlink" title="3.21.3.1.4 生成自签名证书"></a>3.21.3.1.4 生成自签名证书</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#生成自签名证书</span><br><span class="hljs-comment"># make /etc/httpd/certs/www.rlin.com.crt</span><br><span class="hljs-built_in">umask</span> 77 ; \<br><span class="hljs-comment">#/usr/bin/openssl genrsa -aes128 2048 &gt; /etc/httpd/certs/www.rlin.com.key</span><br>/usr/bin/openssl genrsa 2048 &gt; /etc/httpd/certs/www.rlin.com.key<br>Generating RSA private key, 2048 bit long modulus<br>.......................................................+++<br>..............................................................................................................................................................................+++<br>e is 65537 (0x10001)<br><span class="hljs-built_in">umask</span> 77 ; \<br>/usr/bin/openssl req -utf8 -new -key /etc/httpd/certs/www.rlin.com.key -x509 -days 365 -out /etc/httpd/certs/www.rlin.com.crt <br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter <span class="hljs-string">&#x27;.&#x27;</span>, the field will be left blank.<br>-----<br>Country Name (2 letter code) [XX]:CN<br>State or Province Name (full name) []:GuangDong<br>Locality Name (eg, city) [Default City]:GuangZhou<br>Organization Name (eg, company) [Default Company Ltd]:rlin<br>Organizational Unit Name (eg, section) []:it<br>Common Name (eg, your name or your server<span class="hljs-string">&#x27;s hostname) []:www.rlin.com</span><br><span class="hljs-string">Email Address []:</span><br><span class="hljs-string"></span><br><span class="hljs-string"># ls /etc/httpd/certs/</span><br><span class="hljs-string">www.rlin.com.crt  www.rlin.com.key</span><br></code></pre></td></tr></table></figure>

<h5 id="3-21-3-1-5-添加httpd配置文件"><a href="#3-21-3-1-5-添加httpd配置文件" class="headerlink" title="3.21.3.1.5 添加httpd配置文件"></a>3.21.3.1.5 添加httpd配置文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/httpd/conf.d/ssl.conf</span><br>......<br><span class="hljs-comment">#SSLCertificateFile /etc/pki/tls/certs/localhost.crt</span><br>SSLCertificateFile /etc/httpd/certs/www.rlin.com.crt<br>......<br><span class="hljs-comment">#SSLCertificateKeyFile /etc/pki/tls/private/localhost.key</span><br>SSLCertificateKeyFile /etc/httpd/certs/www.rlin.com.key<br></code></pre></td></tr></table></figure>

<h5 id="3-21-3-1-6-添加网页文件并重启"><a href="#3-21-3-1-6-添加网页文件并重启" class="headerlink" title="3.21.3.1.6 添加网页文件并重启"></a>3.21.3.1.6 添加网页文件并重启</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># echo /data/html/index.html &gt; /data/html/index.html</span><br><span class="hljs-comment"># systemctl restart httpd</span><br></code></pre></td></tr></table></figure>

<h5 id="3-21-3-1-7-验证"><a href="#3-21-3-1-7-验证" class="headerlink" title="3.21.3.1.7 验证"></a>3.21.3.1.7 验证</h5><p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache16.png" srcset="/blog/img/loading.gif"></p>
<hr>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache17.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-21-3-2-范例2-：多个虚拟主机使用生成自签名证书实现https"><a href="#3-21-3-2-范例2-：多个虚拟主机使用生成自签名证书实现https" class="headerlink" title="3.21.3.2 范例2 ：多个虚拟主机使用生成自签名证书实现https"></a>3.21.3.2 范例2 ：多个虚拟主机使用生成自签名证书实现https</h4><p>参考博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/yaqiang2017/article/details/124723223">https://blog.csdn.net/yaqiang2017/article/details/124723223</a></p>
<h4 id="3-21-3-3-范例2：互联网网站证书实现"><a href="#3-21-3-3-范例2：互联网网站证书实现" class="headerlink" title="3.21.3.3 范例2：互联网网站证书实现"></a>3.21.3.3 范例2：互联网网站证书实现</h4><p>基于编译安装实现证书加密</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#编译安装过程略</span><br><br><span class="hljs-comment">#启用SSL模块</span><br><span class="hljs-comment"># vim /apps/httpd/conf/httpd.conf</span><br>LoadModule ssl_module modules/mod_ssl.so  <span class="hljs-comment">#默认没有加载ssl模块,需要取消此行注释</span><br>LoadModule socache_shmcb_module modules/mod_socache_shmcb.so <span class="hljs-comment">#启用支持cache模块</span><br>[root@centos7 ~]<span class="hljs-comment">#httpd -M |grep ssl</span><br>ssl_module (shared)<br><br><span class="hljs-comment">#启用ssl相关的子配置文件</span><br><span class="hljs-comment"># vim /apps/httpd/conf/httpd.conf </span><br>Include conf/extra/httpd-ssl.conf  <span class="hljs-comment">#默认没有加载ssl配置文件,需要取消此行注释</span><br><br><span class="hljs-comment">#准备证书相关文件及权限</span><br><span class="hljs-comment"># mkdir /apps/httpd/conf.d/ssl</span><br><span class="hljs-comment"># chown -R apache.apache /apps/httpd/conf.d/ssl/</span><br><span class="hljs-comment"># chmod 600 /apps/httpd/conf.d/ssl/wangxiaochun.com.key</span><br><span class="hljs-comment"># ll /apps/httpd/conf.d/ssl</span><br>total 12<br>-rw-r--r-- 1 apache apache 1679 Mar  3 16:50 wangxiaochun.com_chain.crt<br>-rw------- 1 apache apache 1679 Mar  3 16:50 wangxiaochun.com.key<br>-rw-r--r-- 1 apache apache 1988 Mar  3 16:50 wangxiaochun.com_public.crt<br><br><span class="hljs-comment">#修改子配置文件指向证书相关文件的路径</span><br><span class="hljs-comment"># vim /apps/httpd/conf/extra/httpd-ssl.conf</span><br>SSLCertificateFile <span class="hljs-string">&quot;/apps/httpd/conf.d/ssl/wangxiaochun.com_public.crt&quot;</span><br>SSLCertificateKeyFile <span class="hljs-string">&quot;/apps/httpd/conf.d/ssl/wangxiaochun.com.key&quot;</span><br>SSLCertificateChainFile <span class="hljs-string">&quot;/apps/httpd/conf.d/ssl/wangxiaochun.com_chain.crt&quot;</span><br><br><span class="hljs-comment"># systemctl restart httpd</span><br><span class="hljs-comment"># ss -ntl</span><br>State   Recv-Q Send-Q   Local Address:Port    Peer Address:Port  <br>LISTEN   0    128                    *:22                *:*     <br>LISTEN   0    100            127.0.0.1:25                *:*     <br>LISTEN   0    128                 [::]:80             [::]:*     <br>LISTEN   0    128                 [::]:22             [::]:*     <br>LISTEN   0    100                [::1]:25             [::]:*     <br>LISTEN   0    128                 [::]:443            [::]:*<br><br><span class="hljs-comment"># curl https://www.wangxiaochun.com</span><br>&lt;h1&gt; www.wangxiaochun.com &lt;/h1&gt;<br></code></pre></td></tr></table></figure>

<p>" srcset="/blog/img/loading.gif<img src=""></p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<h4 id="3-21-3-2-范例3：互联网网站证书实现"><a href="#3-21-3-2-范例3：互联网网站证书实现" class="headerlink" title="3.21.3.2 范例3：互联网网站证书实现"></a>3.21.3.2 范例3：互联网网站证书实现</h4><p>基于yum 安装实现证书加密</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># dnf -y install  mod_ssl</span><br><span class="hljs-comment"># ll /etc/httpd/conf.d/ssl/</span><br>total 24<br>-rw-r--r-- 1 root root 1679 Dec 10  2019 www.wangxiaochun.com_chain.crt<br>-rw-r--r-- 1 root root 1675 Dec 10  2019 www.wangxiaochun.com.key<br>-rw-r--r-- 1 root root 2021 Dec 10  2019 www.wangxiaochun.com_public.crt<br><br><span class="hljs-comment"># cd /etc/httpd/conf.d/ssl/</span><br><span class="hljs-comment"># openssl x509 -in www.wangxiaochun.com_public.crt -noout -text</span><br>Certificate:<br> Data:<br>   Version: 3 (0x2)<br>   Serial Number:<br>      07:7e:36:e4:64:b3:91:<span class="hljs-built_in">fc</span>:db:5c:93:dd:93:dd:e1:f8<br>   Signature Algorithm: sha256WithRSAEncryption<br>   Issuer: C = US, O = DigiCert Inc, OU = www.digicert.com, CN = Encryption<br>Everywhere DV TLS CA - G1<br>   Validity<br>     Not Before: Jan 18 00:00:00 2020 GMT<br>     Not After : Jan 17 12:00:00 2021 GMT<br>   Subject: CN = wangxiaochun.com<br>   Subject Public Key Info:<br>     Public Key Algorithm: rsaEncryption<br>       RSA Public-Key: (2048 bit)<br>       Modulus:<br>          00:9d:9e:3a:8b:fd:48:0e:70:93:88:1f:ed:51:52:<br>         a8:a7:86:17:a2:<span class="hljs-built_in">fc</span>:4f:65:d8:27:33:31:ec:67:dd:<br>         d8:f2:16:7f:6b:5f:6c:b8:76:a8:f4:d2:ce:d8:b2:<br>         eb:1e:87:06:<span class="hljs-built_in">cd</span>:b5:a4:74:7b:24:fe:81:b4:6b:75:<br>          08:1a:68:8b:2d:b6:d9:c4:96:7e:f3:34:7a:8a:94:<br>          44:62:92:24:15:53:96:24:35:59:a8:68:66:66:5d:<br>          37:ff:4a:bf:b9:f2:7c:d3:24:4e:a6:33:cf:25:cb:<br>         2f:18:86:e8:a0:aa:c5:74:37:1d:8c:ad:33:07:48:<br>         3b:84:10:32:04:18:80:e5:0a:51:73:b6:40:dd:a5:<br>         f2:d5:e0:99:fe:44:f5:8f:38:6a:b2:a9:23:87:1b:<br>         eb:31:ce:e4:e5:a7:8b:e9:08:2f:0f:81:e6:8d:e7:<br>          10:a2:41:a0:89:01:86:91:4b:15:6c:dc:3b:de:93:<br>         ce:18:3e:15:40:f8:ed:5b:03:6e:4b:6d:d0:3e:7b:<br>         9b:1d:05:a9:69:1a:16:37:6b:8c:b9:87:f3:85:bc:<br>         f6:16:7e:ac:49:3d:55:93:0f:c4:85:2e:b5:9a:b2:<br>          86:90:47:be:05:8d:8a:16:c1:79:5b:ad:da:ed:ca:<br>          48:9c:2f:5c:c9:52:95:64:88:6e:1a:a9:f2:f6:a6:<br>         1f:1f<br>       Exponent: 65537 (0x10001)<br>   X509v3 extensions:<br>     X509v3 Authority Key Identifier:<br>      <br>keyid:55:74:4F:B2:72:4F:F5:60:BA:50:D1:D7:E6:51:5C:9A:01:87:1A:D7<br>     X509v3 Subject Key Identifier:<br>       D2:A5:0F:33:DF:34:3D:13:2D:02:9C:16:7D:F9:74:06:7D:4E:3C:98<br>     X509v3 Subject Alternative Name:<br>       DNS:wangxiaochun.com, DNS:www.wangxiaochun.com<br>       X509v3 Key Usage: critical<br>       Digital Signature, Key Encipherment<br>     X509v3 Extended Key Usage:<br>       TLS Web Server Authentication, TLS Web Client Authentication<br>     X509v3 Certificate Policies:<br>       Policy: 2.16.840.1.114412.1.2<br>        CPS: https://www.digicert.com/CPS<br>       Policy: 2.23.140.1.2.1<br>    Authority Information Access:<br>       OCSP - URI:http://ocsp.digicert.com<br>       CA Issuers -<br>URI:http://cacerts.digicert.com/EncryptionEverywhereDVTLSCA-G1.crt<br><br>X509v3 Basic Constraints:<br>       CA:FALSE<br>     CT Precertificate SCTs:<br>       Signed Certificate Timestamp:<br>         Version  : v1 (0x0)<br>         Log ID  : EE:4B:BD:B7:75:CE:60:BA:E1:42:69:1F:AB:E1:9E:66:<br>               A3:0F:7E:5F:B0:72:D8:83:00:C4:7B:89:7A:A8:FD:CB<br>         Timestamp : Jan 18 09:35:54.210 2020 GMT<br>         Extensions: none<br>         Signature : ecdsa-with-SHA256<br>                30:46:02:21:00:B8:94:97:DB:85:88:A5:0B:37:F0:97:<br>                06:4C:BD:2F:22:B2:B2:54:81:0B:C8:2C:74:27:D1:AB:<br>               9A:E7:C5:D2:62:02:21:00:9A:F8:7D:CD:9F:94:A8:A6:<br>                66:9B:46:59:44:6E:CD:C7:0C:1F:80:D8:91:97:B9:75:<br>                55:CE:4F:0A:12:9C:04:0F<br>       Signed Certificate Timestamp:<br>         Version  : v1 (0x0)<br>         Log ID  : 44:94:65:2E:B0:EE:CE:AF:C4:40:07:D8:A8:FE:28:C0:<br>               DA:E6:82:BE:D8:CB:31:B5:3F:D3:33:96:B5:B6:81:A8<br>         Timestamp : Jan 18 09:35:54.056 2020 GMT<br>         Extensions: none<br>         Signature : ecdsa-with-SHA256<br>                30:44:02:20:7E:2A:B8:29:DB:BB:9C:7D:B1:DB:55:46:<br>               1B:99:49:9B:53:68:68:C1:5E:63:22:29:5C:FA:C5:7B:<br>                14:10:23:88:02:20:21:92:A0:3A:9B:33:BB:33:FA:1A:<br>                23:10:AC:09:86:4B:04:C2:18:B8:03:06:E5:78:3A:F3:<br>                13:87:5E:0E:C8:C2<br> Signature Algorithm: sha256WithRSAEncryption<br>    9e:d8:<span class="hljs-built_in">cd</span>:b0:0c:cf:5b:b8:aa:20:e8:86:1e:66:53:70:43:62:<br>    70:52:00:64:c4:5e:2d:b4:d5:f7:5a:3f:3e:da:f1:31:7d:93:<br>    2c:7f:15:2f:c9:07:a8:e6:ef:21:56:d6:d3:1e:43:68:35:37:<br>    24:6c:5a:3e:7e:6b:dc:ba:f1:31:91:21:c3:d1:b8:b9:d3:a3:<br>    8e:b4:9b:<span class="hljs-built_in">cd</span>:0f:99:83:f2:ab:17:24:cf:f0:b2:5b:35:a9:6f:<br>    33:9c:3d:d2:00:54:6c:6c:7a:3c:2c:b2:e7:da:65:2d:e4:bf:<br>    ff:f5:0b:39:e2:6c:22:c6:b0:41:0c:eb:b1:0b:1a:da:<span class="hljs-built_in">fc</span>:eb:<br>    bf:74:43:11:72:5d:4d:8b:4b:5b:89:33:6c:76:c8:35:17:00:<br>    dc:cf:4d:43:be:66:29:6e:6f:11:35:cc:36:65:82:17:96:61:<br>    22:82:13:06:19:fb:0f:22:dd:aa:bc:6e:fd:77:19:55:4e:80:<br>    75:cb:7a:ad:a0:<span class="hljs-built_in">fc</span>:44:cc:0a:0c:d7:71:2d:41:a2:50:47:0e:<br>    28:b6:b3:5c:54:81:a5:06:f8:57:70:6d:3a:aa:09:e3:4b:94:<br>    c1:03:31:5c:a7:dd:c0:33:5d:90:70:95:8a:6a:20:a0:01:08:<br>    05:8f:4c:12:cf:db:db:43:86:f6:01:43:a8:c3:4c:9b:8f:e5:<br>    20:5b:d5:34<br>    <br><span class="hljs-comment"># grep -Ev &quot;^ *#|^$&quot; /etc/httpd/conf.d/ssl.conf</span><br>Listen 443 https<br>SSLPassPhraseDialog <span class="hljs-built_in">exec</span>:/usr/libexec/httpd-ssl-pass-dialog<br>SSLSessionCache     shmcb:/run/httpd/sslcache(512000)<br>SSLSessionCacheTimeout  300<br>SSLCryptoDevice <span class="hljs-built_in">builtin</span><br>&lt;VirtualHost _default_:443&gt;<br>ErrorLog logs/ssl_error_log<br>TransferLog logs/ssl_access_log<br>LogLevel warn<br>SSLEngine on<br>SSLHonorCipherOrder on<br>SSLCipherSuite PROFILE=SYSTEM<br>SSLProxyCipherSuite PROFILE=SYSTEM<br>SSLCertificateFile /etc/httpd/conf.d/ssl/www.wangxiaochun.com_public.crt<br>SSLCertificateKeyFile /etc/httpd/conf.d/ssl/www.wangxiaochun.com.key<br>SSLCertificateChainFile /etc/httpd/conf.d/ssl/www.wangxiaochun.com_chain.crt<br>&lt;FilesMatch <span class="hljs-string">&quot;\.(cgi|shtml|phtml|php)$&quot;</span>&gt;<br> SSLOptions +StdEnvVars<br>&lt;/FilesMatch&gt;<br>&lt;Directory <span class="hljs-string">&quot;/var/www/cgi-bin&quot;</span>&gt;<br> SSLOptions +StdEnvVars<br>&lt;/Directory&gt;<br>BrowserMatch <span class="hljs-string">&quot;MSIE [2-5]&quot;</span> \<br>    nokeepalive ssl-unclean-shutdown \<br>    downgrade-1.0 force-response-1.0<br>CustomLog logs/ssl_request_log \<br>     <span class="hljs-string">&quot;%t %h %&#123;SSL_PROTOCOL&#125;x %&#123;SSL_CIPHER&#125;x \&quot;%r\&quot; %b&quot;</span><br>&lt;/VirtualHost&gt;    <br></code></pre></td></tr></table></figure>

<h2 id="3-22-URL重定向"><a href="#3-22-URL重定向" class="headerlink" title="3.22 URL重定向"></a>3.22 URL重定向</h2><p>URL重定向，即将httpd 请求的URL转发至另一个的URL</p>
<p>重定向指令</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">Redirect [status] URL-path URL<br></code></pre></td></tr></table></figure>

<p>status状态：</p>
<ul>
<li>permanent： 返回永久重定向状态码 301,此重定向信息进行缓存</li>
<li>temp：返回临时重定向状态码302. 此为默认值</li>
</ul>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/httpd/conf.d/test.conf</span><br>Redirect permanent / https://www.bilibili.com/<br></code></pre></td></tr></table></figure>

<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache18.png" srcset="/blog/img/loading.gif"></p>
<hr>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache19.png" srcset="/blog/img/loading.gif"></p>
<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /etc/httpd/conf.d/test.conf</span><br>Redirect permanent / http://www.b.com/<br></code></pre></td></tr></table></figure>

<p>范例: 用此方式实现http跳转到https会出现死循环的跳转</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim test.conf</span><br>Redirect temp / https://www.magedu.org<br><br><span class="hljs-comment"># curl -IkL www.magedu.org</span><br>.......<br>HTTP/1.1 302 Found<br>Date: Wed, 03 Mar 2021 10:00:41 GMT<br>Server: Apache/2.4.46 (Unix) OpenSSL/1.0.2k-fips<br>Location: https://www.magedu.org<br>Content-Type: text/html; charset=iso-8859-1<br><br>HTTP/1.1 302 Found<br>Date: Wed, 03 Mar 2021 10:00:41 GMT<br>Server: Apache/2.4.46 (Unix) OpenSSL/1.0.2k-fips<br>Location: https://www.magedu.org<br>Content-Type: text/html; charset=iso-8859-1<br><br>curl: (47) Maximum (50) redirects followed<br></code></pre></td></tr></table></figure>

<h2 id="3-23-http实现重定向https"><a href="#3-23-http实现重定向https" class="headerlink" title="3.23 http实现重定向https"></a>3.23 http实现重定向https</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">#注意: RewriteEngine指令需要开启mod_rewrite.so模块<br>[root@centos8 ~]# vim /etc/httpd/conf.d/test.conf<br>RewriteEngine on<br>RewriteRule ^(/.*)$ https://%&#123;HTTP_HOST&#125;$1 [redirect=302]<br></code></pre></td></tr></table></figure>



<h1 id="四、http-协议及报文头部结构"><a href="#四、http-协议及报文头部结构" class="headerlink" title="四、http 协议及报文头部结构"></a>四、http 协议及报文头部结构</h1><p>浏览器访问网页的过程</p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<p>http协议：http/0.9, http/1.0, http/1.1, http/2.0，http/3.0</p>
<p>http协议：stateless 无状态, 服务器无法持续追踪访问者来源</p>
<p>解决http协议无状态方法</p>
<ul>
<li>cookie 客户端存放</li>
<li>session 服务端存放 </li>
</ul>
<p>http事务：一次访问的过程</p>
<ul>
<li>请求：request</li>
<li>响应：response</li>
</ul>
<p>HTTP报文结构</p>
<p>协议查看或分析的工具：tcpdump, wireshark,tshark</p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP">https://developer.mozilla.org/zh-CN/docs/Web/HTTP</a></p>
<h2 id="4-1-HTTP请求报文"><a href="#4-1-HTTP请求报文" class="headerlink" title="4.1 HTTP请求报文"></a>4.1 HTTP请求报文</h2><p>" srcset="/blog/img/loading.gif<img src=""></p>
<p><strong>request报文格式</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">&lt;method&gt; &lt;request-URL&gt; &lt;version&gt;<br>&lt;headers&gt;<br>&lt;entity-body&gt;<br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>www.magedu.com<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>HTTPie/0.9.4<br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html">#post.html<br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;index.html&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span><br>username:<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>password:<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> &gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Submit&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="4-2-HTTP响应报文"><a href="#4-2-HTTP响应报文" class="headerlink" title="4.2 HTTP响应报文"></a>4.2 HTTP响应报文</h2><p>" srcset="/blog/img/loading.gif<img src=""></p>
<p><strong>response报文格式</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">&lt;version&gt; &lt;status&gt; &lt;reason-phrase&gt;<br>&lt;headers&gt;<br>&lt;entity-body&gt;<br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=3, must-revalidate<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><span class="hljs-attribute">Content-Encoding</span><span class="hljs-punctuation">: </span>gzip<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>text/html; charset=UTF-8<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Thu, 07 Nov 2019 03:44:14 GMT<br><span class="hljs-attribute">Server</span><span class="hljs-punctuation">: </span>Tengine<br><span class="hljs-attribute">Transfer-Encoding</span><span class="hljs-punctuation">: </span>chunked<br><span class="hljs-attribute">Vary</span><span class="hljs-punctuation">: </span>Accept-Encoding<br><span class="hljs-attribute">Vary</span><span class="hljs-punctuation">: </span>Accept-Encoding, Cookie<br></code></pre></td></tr></table></figure>

<h2 id="4-3-HTTP报文格式详解"><a href="#4-3-HTTP报文格式详解" class="headerlink" title="4.3 HTTP报文格式详解"></a>4.3 HTTP报文格式详解</h2><h3 id="4-3-1-Method-方法"><a href="#4-3-1-Method-方法" class="headerlink" title="4.3.1 Method 方法"></a>4.3.1 Method 方法</h3><p>请求方法，标明客户端希望服务器对资源执行的动作，包括以下：</p>
<ul>
<li>GET： 从服务器获取一个资源</li>
<li>HEAD： 只从服务器获取文档的响应首部</li>
<li>POST： 向服务器输入数据，通常会再由网关程序继续处理</li>
<li>PUT： 将请求的主体部分存储在服务器中，如上传文件</li>
<li>DELETE： 请求删除服务器上指定的文档</li>
<li>TRACE： 追踪请求到达服务器中间经过的代理服务器</li>
<li>OPTIONS：请求服务器返回对指定资源支持使用的请求方法</li>
<li>CONNECT：建立一个到由目标资源标识的服务器的隧道</li>
<li>PATCH：用于对资源应用部分修改</li>
</ul>
<h3 id="4-3-2-version版本"><a href="#4-3-2-version版本" class="headerlink" title="4.3.2 version版本"></a>4.3.2 version版本</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">HTTP/&lt;major&gt;.&lt;minor&gt;<br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">HTTP/1.1<br></code></pre></td></tr></table></figure>

<h3 id="4-3-3-status-状态码"><a href="#4-3-3-status-状态码" class="headerlink" title="4.3.3 status 状态码"></a>4.3.3 status 状态码</h3><p>三位数字，标记请求处理过程中发生的情况<br>参考资料：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status</a><br><strong>http协议状态码分类</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">1xx：100-101 信息提示<br>2xx：200-206 成功<br>3xx：300-307 重定向<br>4xx：400-415 错误类信息，客户端错误<br>5xx：500-505 错误类信息，服务器端错误<br></code></pre></td></tr></table></figure>

<p><strong>http协议常用的状态码</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">200： 成功，请求数据通过响应报文的entity-body部分发送;OK<br>301： 请求的URL指向的资源已经被删除；但在响应报文中通过首部Location指明了资源现在所处的新位置；Moved Permanently<br>302： 响应报文Location指明资源临时新位置 Moved Temporarily<br>304： 客户端发出了条件式请求，但服务器上的资源未曾发生改变，则通过响应此响应状态码通知客户端；Not Modified<br>307： 浏览器内部重定向<br>401： 需要输入账号和密码认证方能访问资源；Unauthorized<br>403： 请求被禁止；Forbidden<br>404： 服务器无法找到客户端请求的资源；Not Found<br>500： 服务器内部错误；Internal Server Error<br>502： 代理服务器从后端服务器收到了一条伪响应，如无法连接到网关；Bad Gateway<br>503： 服务不可用，临时服务器维护或过载，服务器无法处理请求<br>504： 网关超时<br></code></pre></td></tr></table></figure>

<h3 id="4-3-4-reason-phrase原因短语"><a href="#4-3-4-reason-phrase原因短语" class="headerlink" title="4.3.4 reason-phrase原因短语"></a>4.3.4 reason-phrase原因短语</h3><p>状态码所标记的状态的简要描述</p>
<h3 id="4-3-5-headers首部字段头"><a href="#4-3-5-headers首部字段头" class="headerlink" title="4.3.5 headers首部字段头"></a>4.3.5 headers首部字段头</h3><p>首部字段包含的信息最为丰富。首部字段同时存在于请求和响应报文内，并涵盖 HTTP 报文相关的内容信息。使用首部字段是为了给客服端和服务器端提供报文主体大小、所使用的语言、认证信息等内容</p>
<p>首部字段是由首部字段名和字段值构成的，中间用冒号”：”分隔字段值对应，即key/value 键/值对</p>
<p>单个 HTTP 首部字段可以有多个值</p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers</a></p>
<p><strong>首部的分类：</strong></p>
<ol>
<li>通用首部:请求报文和响应报文两方都会使用的首部</li>
<li>请求首部:从客户端向服务器端发送请求报文时使用的首部。补充了请求的附加内容、客户端信息、<br>请求内容相关优先级等信息</li>
<li>响应首部：从服务器端向客户端返回响应报文时使用的首部。补充了响应的附加内容，也会要求客<br>户端附加额外的内容信息</li>
<li>实体首部：针对请求报文和响应报文的实体部分使用的首部。补充了资源内容更新时间等与实体有<br>关的的信息</li>
<li>扩展首部</li>
</ol>
<p><strong>通用首部：</strong></p>
<ul>
<li>Date: 报文的创建时间</li>
<li>Connection：连接状态，如keep-alive, close</li>
<li>Via：显示报文经过的中间节点（代理，网关）</li>
<li>Cache-Control：控制缓存，如缓存时长</li>
<li>MIME-Version:发送端使用的MIME版本</li>
<li>Warning：错误通知</li>
</ul>
<p><strong>请求首部：</strong></p>
<ul>
<li>Accept：通知服务器自己可接受的媒体类型</li>
<li>Accept-Charset： 客户端可接受的字符集</li>
<li>Accept-Encoding：客户端可接受编码格式，如gzip</li>
<li>Accept-Language：客户端可接受的语言</li>
<li>Client-IP: 请求的客户端IP</li>
<li>Host: 请求的服务器名称和端口号</li>
<li>Referer：跳转至当前URI的前一个URL</li>
<li>User-Agent：客户端代理，浏览器版本</li>
</ul>
<p><strong>条件式请求首部：</strong></p>
<ul>
<li><p>Expect：允许客户端列出某请求所要求的服务器行为</p>
</li>
<li><p>If-Modified-Since：自从指定的时间之后，请求的资源是否发生过修改</p>
</li>
<li><p>If-Unmodified-Since：与上面相反</p>
</li>
<li><p>If-None-Match：本地缓存中存储的文档的ETag标签是否与服务器文档的Etag不匹配If-Match：与上面相反</p>
</li>
</ul>
<p>安全请求首部：</p>
<ul>
<li><p> Authorization：向服务器发送认证信息，如账号和密码</p>
</li>
<li><p>Cookie: 客户端向服务器发送cookie</p>
</li>
</ul>
<p>代理请求首部：</p>
<ul>
<li>Proxy-Authorization: 向代理服务器认证</li>
</ul>
<p><strong>响应首部：</strong><br>信息性：</p>
<ul>
<li>Age：从最初创建开始，响应持续时长</li>
<li>Server：服务器程序软件名称和版本</li>
</ul>
<p>协商首部：某资源有多种表示方法时使用</p>
<ul>
<li>Accept-Ranges：服务器可接受的请求范围类型</li>
<li>Vary：服务器查看的其它首部列表</li>
</ul>
<p>安全响应首部：</p>
<ul>
<li>Set-Cookie：向客户端设置cookie</li>
<li>WWW-Authenticate：来自服务器对客户端的质询列表</li>
</ul>
<p><strong>实体首部：</strong></p>
<ul>
<li>Allow: 列出对此资源实体可使用的请求方法</li>
<li>Location：告诉客户端真正的实体位于何处</li>
<li>Content-Encoding:对主体执行的编码</li>
<li>Content-Language:理解主体时最适合的语言</li>
<li>Content-Length: 主体的长度</li>
<li>Content-Location: 实体真正所处位置</li>
<li>Content-Type：主体的对象类型，如text</li>
</ul>
<p>缓存相关：</p>
<ul>
<li>ETag：实体的扩展标签</li>
<li>Expires：实体的过期时间</li>
<li>Last-Modified：最后一次修改的时间</li>
</ul>
<h3 id="4-3-6-entity-body实体"><a href="#4-3-6-entity-body实体" class="headerlink" title="4.3.6 entity-body实体"></a>4.3.6 entity-body实体</h3><p>请求时附加的数据或响应时附加的数据，例如：登录网站时的用户名和密码，博客的上传文章，论坛上的发言等。</p>
<h2 id="4-4-Cookie-和-session"><a href="#4-4-Cookie-和-session" class="headerlink" title="4.4 Cookie 和 session"></a>4.4 Cookie 和 session</h2><p>无状态协议是指协议对事物处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它应答就很快。</p>
<p>HTTP是超本文传输协议，顾名思义，这个协议支持超文本的传输。什么是超文本？说白了就是使用HTML编写的页面。通常，我们使用客户端浏览器访问服务器的资源，最常见的URL也是以html为后缀的文件，因此可以说超文本是网络上最主要的资源。</p>
<p>既然HTTP协议的目的是在于支持超文本的传输，也就是资源的传输，那么客户端浏览器向HTTP服务器发送请求，继而HTTP服务器将相信资源发回给客户端这样一个过程中，无论对于客户端还是服务器，都没有必要记录这个过程，因为每一次请求和响应都是相对独立的，一般而言，一个URL对应着一个唯一的超文本，正是因为这样的唯一性，使得记录用户的行为状态变得毫无意义，所以，HTTP协议被设计为无状态的连接协议符合它本身的需求。</p>
<p>HTTP协议这种特性有优点也有缺点，优点在于解放了服务器，每一次请求”点到为止”，不会造成不必要的连接占用，缺点在于如果为了保留状态，每次请求都会传输大量的重复信息内容。</p>
<p>可是随着 Web 的不断发展，很多业务都需要对通信状态进行保存.</p>
<p>如果是一次性会话的过程： 打开浏览器 -&gt; 访问一些服务器内容 -&gt; 关闭浏览器</p>
<blockquote>
<p>但目前有很多WEB访问场景，并不是一次性会话，而是多次相关的会话，比如：</p>
<p>登录场景：</p>
<p>打开浏览器 -&gt; 浏览到登陆页面 -&gt; 输入用户名和密码 -&gt; 访问到用户主页(显示用户名) -&gt; 修改密码（输入原密码）-&gt; 修改收货地址…….</p>
</blockquote>
<p>问题：在此处登录会话过程中产生的数据（用户会话数据）如何保存下来呢？</p>
<blockquote>
<p>购物场景：<br>打开浏览器 -&gt; 浏览商品列表 -&gt; 加入购物车(把商品信息保存下来) -&gt; 关闭浏览器</p>
<p>打开浏览器-&gt; 直接进入购物车 -&gt; 查看到上次加入购物车的商品 -&gt; 下订单 -&gt; 支付</p>
</blockquote>
<p>问题： 在购物会话过程中，如何保存商品信息？</p>
<blockquote>
<p>以上场景都需要保留会话数据，需要会话管理机制。</p>
<p>会话管理： 管理浏览器客户端和服务器端之间会话过程中产生的会话数据。</p>
<p>为了会话管理，HTTP就需要传输大量重复信息内容的问题，造成大量的网络带宽消耗。于是 Cookie 和Session 技术闪亮登场了，它们可以为用户进行会话管理，实现保存状态。</p>
</blockquote>
<h3 id="4-4-1-Cookie"><a href="#4-4-1-Cookie" class="headerlink" title="4.4.1 Cookie"></a>4.4.1 Cookie</h3><p>Cookie 又称为”小甜饼”。类型为”小型文本文件”，指某些网站为了辨别用户身份而储存在用户本地终端（Client Side）上的数据（通常经过加密）。由网景公司的前雇员卢·蒙特利在1993年3月发明</p>
<p>因为HTTP协议是无状态的，即服务器不知道用户上一次做了什么，这严重阻碍了交互式Web应用程序的实现。在典型的网上购物场景中，用户浏览了几个页面，买了一盒饼干和两瓶饮料。最后结帐时，由于HTTP的无状态性，不通过额外的手段，服务器并不知道用户到底买了什么，所以Cookie就是用来绕开HTTP的无状态性的”额外手段”之一。服务器可以设置或读取Cookies中包含信息，借此维护用户跟服务器会话中的状态。</p>
<p>在上面的购物场景中，当用户选购了第一项商品，服务器在向用户发送网页的同时，还发送了一段Cookie，记录着那项商品的信息。当用户访问另一个页面，浏览器会把Cookie发送给服务器，于是服务器知道他之前选购了什么。用户继续选购饮料，服务器就在原来那段Cookie里追加新的商品信息。结帐时，服务器读取发送来的Cookie就行了。</p>
<p>Cookie基于HTTP协议，也叫Web Cookie或浏览器Cookie，是服务器发送到用户浏览器并保存在客户端本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。通常，它用于告知服务端两个请求是否来自同一浏览器，如保持用户的登录状态。Cookie使基于无状态的HTTP协议记录稳定的状态信息成为了可能。</p>
<p><strong>cookie 的获取过程</strong></p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<p><strong>第一次请求过程</strong></p>
<ol>
<li>浏览器第一次发送请求时,不会携带任何cookie信息</li>
<li>服务器接收到请求之后，发现请求中没有任何cookie信息</li>
<li>服务器生成和设置一个cookie，并将此cookie设置通过set_cookie的首部字段保存在响应报文中返回给浏览器</li>
<li>浏览器接收到这个响应报文之后,发现里面有cookie信息,浏览器会将cookie信息保存起来</li>
</ol>
<p><strong>第二次及其之后的过程</strong></p>
<ol>
<li>当浏览器第二次及其之后的请求报文中自动 cookie的首部字段携带第一次响应报文中获取的cookie信息</li>
<li>服务器再次接收到请求之后,会发现请求中携带的cookie信息,这样的话就认识是谁发的请求了</li>
<li>之后的响应报文中不会再添加set_cookie首部字段</li>
</ol>
<p><strong>Cookie主要用于以下三个方面：</strong></p>
<ul>
<li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li>
<li>个性化设置（如用户自定义设置、主题等）</li>
<li>浏览器行为跟踪（如跟踪分析用户行为等）</li>
</ul>
<p>使用 Cookie 的状态管理</p>
<p>Cookie 技术通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态。当服务器收到HTTP请求时，服务器可以在响应头里面添加一个Set-Cookie选项。浏览器收到响应后通常会保存下Cookie，之后对该服务器每一次请求中都通过Cookie请求头部将Cookie信息发送给服务器。服务器端发现客户端发送过来的 Cookie 后，会去检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息.另外，Cookie的过期时间、域、路径、有效期、适用站点都可以根据需要来指定。</p>
<p><strong>Set-Cookie首部字段</strong></p>
<ul>
<li><p>NAME=VALUE 赋予 Cookie 的名称和其值,此为必需项</p>
</li>
<li><p>expires=DATE Cookie 的有效期，若不明确指定则默认为浏览器关闭前为止</p>
<p><strong>会话期Cookie</strong><br>基于内存保存，会话期Cookie是最简单的Cookie：浏览器关闭之后它会被自动删除，也就是说它仅在会话期内有效。会话期Cookie不需要指定过期时间（Expires）或者有效期（Max-Age）。需要注意的是，有些浏览器提供了会话恢复功能，这种情况下即使关闭了浏览器，会话期Cookie也会被保留下来，就好像浏览器从来没有关闭一样。<br><strong>持久性Cookie</strong><br>基于硬盘保存，和关闭浏览器便失效的会话期Cookie不同，持久性Cookie可以指定一个特定的过期时间（Expires）或有效期（Max-Age）。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Set-Cookie</span><span class="hljs-punctuation">: </span>id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;<br></code></pre></td></tr></table></figure>

<p>提示：当Cookie的过期时间被设定时，设定的日期和时间只与客户端相关，而不是服务端。</p>
</li>
<li><p>path=PATH 指定了主机下的哪些路径可以接受Cookie（该URL路径必须存在于请求URL中）。若不指定则默认为文档所在的文件目录,以字符 <code>%x2F</code> (“/“) 作为路径分隔符，子路径也会被匹配。</p>
<p>例如，设置 Path=/docs ，则以下地址都会匹配：</p>
<ul>
<li><code>/docs</code></li>
<li><code>/docs/Web/</code></li>
<li><code>/docs/Web/HTTP</code></li>
</ul>
</li>
<li><p>domain=域名，指定了哪些主机可以接受Cookie。如果不指定，默认为当前文档的主机（不包含子域名）。如果指定了Domain，则一般包含子域名。</p>
<p>例如，如果设置 Domain=magedu.com，则Cookie也包含子域名（如：study.magedu.com）</p>
</li>
<li><p>Secure 标记为 Secure 的Cookie只应通过被HTTPS协议加密过的请求发送给服务端。但即便设置了 Secure 标记，敏感信息也不应该通过Cookie传输，因为Cookie有其固有的不安全性，Secure标记也无法提供确实的安全保障。从 Chrome 52 和 Firefox 52 开始，不安全的站点（http:）无法使用Cookie的 Secure 标记。</p>
</li>
<li><p>HttpOnly 加以限制使 Cookie 不能被 JavaScript 脚本访问,为避免跨域脚本 (XSS) 攻击，通过JavaScript的 Document.cookie API无法访问带有 HttpOnly 标记的Cookie，它们只应该发送给服务端。如果包含服务端 Session 信息的 Cookie 不想被客户端 JavaScript 脚本调用，那么就应该为其设置 HttpOnly 标记</p>
</li>
</ul>
<p><strong>浏览器对cookie的限制：</strong><br>Cookie 存储的限制是不一样的。例如：单个域名可存储的 Cookie 数量、Cookie 大小等。</p>
<table>
<thead>
<tr>
<th></th>
<th>IE6.0</th>
<th>IE7.0/8.0</th>
<th>Opera</th>
<th>FF</th>
<th>Safari</th>
<th>Chrome</th>
</tr>
</thead>
<tbody><tr>
<td>cookie个数</td>
<td>每个域为20个</td>
<td>每个域为50个</td>
<td>每个域为30个</td>
<td>每个域为50个</td>
<td>没有个数限制</td>
<td>每个月为53个</td>
</tr>
<tr>
<td>cookie大小</td>
<td>4095个字节</td>
<td>4095个字节</td>
<td>4096个字节</td>
<td>4097个字节</td>
<td>4097个自节</td>
<td>4097个字节</td>
</tr>
</tbody></table>
<p><strong>在进行页面 Cookie 操作的时候，应该尽量保证 Cookie 的个数小于 20 个，总大小小于 4KB，这是一个安全且保险的范围。</strong></p>
<p>范例：响应报文中的set-cookie首部</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.0</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">Content-type</span><span class="hljs-punctuation">: </span>text/html<br><span class="hljs-attribute">Set-Cookie</span><span class="hljs-punctuation">: </span>yummy_cookie=choco<br><span class="hljs-attribute">Set-Cookie</span><span class="hljs-punctuation">: </span>tasty_cookie=strawberry<br></code></pre></td></tr></table></figure>

<p>范例：请求报文中的cookie首部字段</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/sample_page.html</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>www.example.org<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>yummy_cookie=choco; tasty_cookie=strawberry<br></code></pre></td></tr></table></figure>

<p>范例：响应报文set-cookie中的Secure 和 HttpOnly</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Set-Cookie</span><span class="hljs-punctuation">: </span>id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly<br></code></pre></td></tr></table></figure>

<p>范例：浏览器查看cookie</p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<p>范例：chrome 浏览器禁止cookie</p>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache20.png" srcset="/blog/img/loading.gif"></p>
<hr>
<p><img src="C:\Users\kinci\Desktop\blog-picture\apache\apache21.png" srcset="/blog/img/loading.gif"></p>
<p>范例：php语言实现cookie的管理</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">#设置cookie</span><br><span class="hljs-comment">#cat setcookie.php</span><br><span class="hljs-meta">&lt;?php</span><br>setcookie(<span class="hljs-string">&#x27;title&#x27;</span>,<span class="hljs-string">&#x27;cto&#x27;</span>);   <span class="hljs-comment">#有效期为会话级</span><br>setcookie(<span class="hljs-string">&#x27;user&#x27;</span>,<span class="hljs-string">&#x27;wang&#x27;</span>,time()+<span class="hljs-number">3600</span>*<span class="hljs-number">12</span>);  <span class="hljs-comment">#有效期为12小时</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h1&gt;test setcookie &lt;/h1&gt;&quot;</span><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">#说明：setcookie设置的cookie，只有下一次http请求才能生效</span><br>    <br><span class="hljs-comment">#显示cookie</span><br>cat showcookies.php<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h1&gt;test showcookie &lt;/h1&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;user&quot;</span>];   <span class="hljs-comment">#显示user的这一个cookie</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br /&gt;&quot;</span>;<br>var_dump(<span class="hljs-variable">$_COOKIE</span>);    <span class="hljs-comment">#显示所有cookie</span><br><span class="hljs-comment">//print_r($_COOKIE);   #不如上面方式详细</span><br><span class="hljs-meta">?&gt;</span><br>    <br><span class="hljs-comment">#删除cookie，通过设置过期时间实现</span><br><span class="hljs-comment">#vim delcookie.php</span><br><span class="hljs-meta">&lt;?php</span><br>setcookie(<span class="hljs-string">&#x27;user&#x27;</span>,<span class="hljs-string">&#x27;wang&#x27;</span>,time()-<span class="hljs-number">3600</span>*<span class="hljs-number">12</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h1&gt;cookie:user is deleted &lt;/h1&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="4-4-2-Session"><a href="#4-4-2-Session" class="headerlink" title="4.4.2 Session"></a>4.4.2 Session</h3><p>" srcset="/blog/img/loading.gif<img src=""></p>
<p><strong>session</strong><br>session是相对于cookie的另外一个状态保持的解决方案，它是通过服务器来保持状态的。session指的是服务器上为每个客户端所开辟的独立存储空间，在其中保存的信息就是用于保存状态的。</p>
<p>Session是服务器端程序运行的过程中创建的，不同语言实现的应用程序有不同创建session的方法。在创建了session的同时，服务器会为该session生成唯一的sessionId，而这个sessionId被创建了之后，就可以调用session相关的方法往session中增加内容了，而这些内容只会保存在服务器中，每个sessionid就像数据库中主键，可以根据SessionId 关联每个session的相关信息，比如：购物车里的商器，登录用户等。但发送给客户端浏览器的只有sessionId。当客户端浏览器再次发送http请求时，会自动地将这个sessionId 附加在请求报文中 ，服务器收到请求之后就会根据sessionId找到对应的session，从而再次使用，使得用户的状态得以保持。</p>
<p>每个session都有一个sessionId，这个ID存放有两种方式：</p>
<p>1、通过URL存取，比如：Java程序中，URL会带上一个jsessionId=xxxxxx等，这样每次重新请求的时候都传了sessionId给服务器,但此方式不安全,所以很少使用,所以一般session是依赖于cookie的.即如果浏览器禁用了cookie,则session无法实现</p>
<p>2、通过cookie存取（Tomcat默认如此），这种cookie是session cookie，区别于persistent cookies也就是我们常说的cookie，session cookie要注意的是存储在浏览器内存中，而不是写到硬盘上。程序一<br>开始执行，服务器就生成一个sessionId并通过cookie携带客户端浏览器的缓存中，当下一次访问的时候，服务器先检测一下是否有这个cookie，如果有就取它的ID，如果没有就再生成一个。这就是为什么<br>关闭浏览器之后，再进去session已经没有了，其实在服务器端session并没有清空，而是sessionId变了。</p>
<p>当将浏览器关闭，服务器保存的session数据不是立即释放的，此时数据还会存在一段时间（可以在程序中加以设置，Tomcat默认15分钟），只要我们知道那个sessionId，就可以继续通过请求获得此session的信息。session里面的数据都放在服务器端，通过sessionId保证不会访问错误，服务端自动对session进行管理，如果在规定的时间内没有访问，则释放掉这个session。</p>
<p>最后提两点：<br>1、sessionId通常在浏览器地址中是看不到的，但是当我们把浏览器的cookie禁止之后，Web服务器会采用URL重写的方式传递sessionId，这样就可以在地址栏看到sessionId了</p>
<p>2、session cookie不可以跨窗口使用，但可以跨同一个窗口的多个标签页。</p>
<p><strong>session 的工作流程</strong><br>第一次请求:</p>
<ul>
<li>浏览器发起第一次请求的时候可以携带一些信息(比如: 用户名/密码) cookie中没有任何信息</li>
<li>当服务器接收到这个请求之后,进行用户名和密码的验证,验证成功后则可以设置session信息</li>
<li>在设置session信息的同时(session信息保存在服务器端) .服务器会在响应头中设置一个随机的session id的cookie信息</li>
<li>客户端(浏览器)在接收到响应之后,会将cookie信息保存起来(保存session id的信息)</li>
</ul>
<p>第二次及其之后的请求:</p>
<ul>
<li>第二次及其之后的请求都会携带session id信息</li>
<li>当服务器接收到这个请求之后,会获取到session id信息,然后进行验证</li>
<li>验证成功,则可以获取session信息(session信息保存在服务器端)</li>
</ul>
<p><strong>范例：PHP的PHPSESSID</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>session_start();<br><span class="hljs-keyword">echo</span> session_id();<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">#执行结果如下图</span><br></code></pre></td></tr></table></figure>

<p>" srcset="/blog/img/loading.gif<img src=""></p>
<p><strong>范例：JAVA的JSESSIONID</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsp">#cat /usr/local/tomcat/webapps/ROOT/session.jsp<br>&lt;h1&gt;<br>sessionId: &lt;%=request.getSession().getId()%&gt;<br>&lt;/h1&gt;<br></code></pre></td></tr></table></figure>

<p>" srcset="/blog/img/loading.gif<img src=""></p>
<h3 id="4-4-3-cookie和session比较"><a href="#4-4-3-cookie和session比较" class="headerlink" title="4.4.3 cookie和session比较"></a>4.4.3 cookie和session比较</h3><p>cookie和session的相同和不同：</p>
<ul>
<li><p>cookie通常是在服务器生成,但也可以在客户端生成,session是在服务器端生成的</p>
</li>
<li><p>session 将数据信息保存在服务器端，可以是内存，文件，数据库等多种形式,cookie 将数据保存在客户端的内存或文件中</p>
</li>
<li><p>单个cookie保存的数据不能超过4K，每个站点cookie个数有限制，比如IE8为50个、Firefox为50个、Opera为30个；session存储在服务器，没有容量限制</p>
</li>
<li><p>cookie存放在用户本地，可以被轻松访问和修改，安全性不高；session存储于服务器，比较安全</p>
</li>
<li><p>cookie有会话cookie和持久cookie，生命周期为浏览器会话期的会话cookie保存在缓存，关闭浏览器窗口就消失，持久cookie被保存在硬盘，知道超过设定的过期时间；随着服务端session存储压力增大，会根据需要定期清理session数据</p>
</li>
<li><p>session中有众多数据，只将sessionID这一项可以通过cookie发送至客户端进行保留，客户端下次访问时，在请求报文中的cookie会自动携带sessionID，从而和服务器上的的session进行关联</p>
</li>
</ul>
<p>cookie缺点：<br>1、使用cookie来传递信息，随着cookie个数的增多和访问量的增加，它占用的网络带宽也很大，试想假如cookie占用200字节，如果一天的PV有几个亿，那么它要占用多少带宽？</p>
<p>2、cookie并不安全，因为cookie是存放在客户端的，所以这些cookie可以被访问到，设置可以通过插件添加、修改cookie。所以从这个角度来说，我们要使用sesssion，session是将数据保存在服务端的，只是通过cookie传递一个sessionId而已，所以session更适合存储用户隐私和重要的数据</p>
<p>session 缺点：</p>
<p>1、不容易在多台服务器之间共享，可以使用session绑定，session复制，session共享解决</p>
<p>2、session存放在服务器中，所以session如果太多会非常消耗服务器的性能</p>
<p>cookie和session各有优缺点，在大型互联网系统中，单独使用cookie和session都是不可行的</p>
<h1 id="五、Web相关工具"><a href="#五、Web相关工具" class="headerlink" title="五、Web相关工具"></a>五、Web相关工具</h1><h2 id="5-1-links"><a href="#5-1-links" class="headerlink" title="5.1 links"></a>5.1 links</h2><p>格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">links [OPTION]... [URL]...<br></code></pre></td></tr></table></figure>

<p>常用选项：</p>
<ul>
<li>-dump 非交互式模式，显示输出结果</li>
<li>-source 打印源码</li>
</ul>
<h2 id="5-2-wget"><a href="#5-2-wget" class="headerlink" title="5.2 wget"></a>5.2 wget</h2><p>格式：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">wget [OPTION]... [URL]...<br></code></pre></td></tr></table></figure>

<p>常用选项：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#启动</span><br>-V, -version <span class="hljs-comment">#显示wget的版本后退出</span><br>-h, -<span class="hljs-built_in">help</span> <span class="hljs-comment">#打印语法帮助</span><br>-b, -background <span class="hljs-comment">#启动后转入后台执行</span><br>-e, -execute=COMMAND <span class="hljs-comment">#执行`.wgetrc&#x27;格式的命令，wgetrc格式参见/etc/wgetrc或~/.wgetrc</span><br><br><span class="hljs-comment">#记录和输入文件</span><br>-o, -output-file=FILE <span class="hljs-comment">#把记录写到FILE文件中</span><br>-a, -append-output=FILE <span class="hljs-comment">#把记录追加到FILE文件中</span><br>-d, -debug <span class="hljs-comment">#打印调试输出</span><br>-q, -quiet <span class="hljs-comment">#安静模式(没有输出)</span><br>-v, -verbose <span class="hljs-comment">#冗长模式(这是缺省设置)</span><br>-nv, -non-verbose <span class="hljs-comment">#关掉冗长模式，但不是安静模式</span><br>-i, -input-file=FILE <span class="hljs-comment">#下载在FILE文件中出现的URLs</span><br>-F, -force-html <span class="hljs-comment">#把输入文件当作HTML格式文件对待</span><br>-B, -base=URL <span class="hljs-comment">#将URL作为在-F -i参数指定的文件中出现的相对链接的前缀</span><br>-sslcertfile=FILE <span class="hljs-comment">#可选客户端证书</span><br>-sslcertkey=KEYFILE <span class="hljs-comment">#可选客户端证书的KEYFILE</span><br>-egd-file=FILE <span class="hljs-comment">#指定EGD socket的文件名</span><br><br><span class="hljs-comment">#下载</span><br>-bind-address=ADDRESS <span class="hljs-comment">#指定本地使用地址(主机名或IP，当本地有多个IP或名字时使用)</span><br>-t, -tries=NUMBER <span class="hljs-comment">#设定最大尝试链接次数(0 表示无限制).</span><br>-O -output-document=FILE <span class="hljs-comment">#把文档写到FILE文件中</span><br>-nc, -no-clobber <span class="hljs-comment">#不要覆盖存在的文件或使用.#前缀</span><br>-c, -<span class="hljs-built_in">continue</span> <span class="hljs-comment">#接着下载没下载完的文件</span><br>-progress=TYPE <span class="hljs-comment">#设定进程条标记</span><br>-N, -timestamping <span class="hljs-comment">#不要重新下载文件除非比本地文件新</span><br>-S, -server-response <span class="hljs-comment">#打印服务器的回应</span><br>-spider <span class="hljs-comment">#不下载任何东西</span><br>-T, -timeout=SECONDS <span class="hljs-comment">#设定响应超时的秒数</span><br>-w, -<span class="hljs-built_in">wait</span>=SECONDS <span class="hljs-comment">#两次尝试之间间隔SECONDS秒</span><br>-waitretry=SECONDS <span class="hljs-comment">#在重新链接之间等待1…SECONDS秒</span><br>-random-wait <span class="hljs-comment">#在下载之间等待0…2*WAIT秒</span><br>-Y, -proxy=on/off <span class="hljs-comment">#打开或关闭代理</span><br>-Q, -quota=NUMBER <span class="hljs-comment">#设置下载的容量限制</span><br>-limit-rate=RATE <span class="hljs-comment">#限定下载输率</span><br><br><span class="hljs-comment">#目录</span><br>-nd -no-directories <span class="hljs-comment">#不创建目录</span><br>-x, -force-directories <span class="hljs-comment">#强制创建目录</span><br>-nH, -no-host-directories <span class="hljs-comment">#不创建主机目录</span><br>-P, -directory-prefix=PREFIX <span class="hljs-comment">#将文件保存到目录 PREFIX/…</span><br>-cut-dirs=NUMBER <span class="hljs-comment">#忽略 NUMBER层远程目录</span><br><br><span class="hljs-comment">#HTTP 选项</span><br>-http-user=USER <span class="hljs-comment">#设定HTTP用户名为 USER.</span><br>-http-passwd=PASS <span class="hljs-comment">#设定http密码为 PASS.</span><br>-C, -cache=on/off <span class="hljs-comment">#允许/不允许服务器端的数据缓存 (一般情况下允许).</span><br>-E, -html-extension <span class="hljs-comment">#将所有text/html文档以.html扩展名保存</span><br>-ignore-length <span class="hljs-comment">#忽略 `Content-Length&#x27;头域</span><br>-header=STRING <span class="hljs-comment">#在headers中插入字符串 STRING</span><br>-proxy-user=USER <span class="hljs-comment">#设定代理的用户名为 USER</span><br>-proxy-passwd=PASS <span class="hljs-comment">#设定代理的密码为 PASS</span><br>-referer=URL <span class="hljs-comment">#在HTTP请求中包含 `Referer: URL&#x27;头</span><br>-s, -save-headers <span class="hljs-comment">#保存HTTP头到文件</span><br>-U, -user-agent=AGENT <span class="hljs-comment">#设定代理的名称为 AGENT而不是 Wget/VERSION.</span><br>-no-http-keep-alive <span class="hljs-comment">#关闭 HTTP活动链接 (永远链接).</span><br>-cookies=off <span class="hljs-comment">#不使用 cookies.</span><br>-load-cookies=FILE <span class="hljs-comment">#在开始会话前从文件 FILE中加载cookie</span><br>-save-cookies=FILE <span class="hljs-comment">#在会话结束后将 cookies保存到 FILE文件中</span><br><br><span class="hljs-comment">#FTP 选项</span><br>-nr, -dont-remove-listing <span class="hljs-comment">#不移走 `.listing&#x27;文件</span><br>-g, -glob=on/off <span class="hljs-comment">#打开或关闭文件名的 globbing机制</span><br>-passive-ftp <span class="hljs-comment">#使用被动传输模式 (缺省值).</span><br>-active-ftp <span class="hljs-comment">#使用主动传输模式</span><br>-retr-symlinks <span class="hljs-comment">#在递归的时候，将链接指向文件(而不是目录)</span><br><br><span class="hljs-comment">#递归下载</span><br>-r, -recursive <span class="hljs-comment">#递归下载－－慎用!</span><br>-l, -level=NUMBER <span class="hljs-comment">#最大递归深度 (inf 或 0 代表无穷).</span><br>-delete-after <span class="hljs-comment">#在现在完毕后局部删除文件</span><br>-k, -convert-links <span class="hljs-comment">#转换非相对链接为相对链接</span><br>-K, -backup-converted <span class="hljs-comment">#在转换文件X之前，将之备份为 X.orig</span><br>-m, -mirror <span class="hljs-comment">#等价于 -r -N -l inf -nr.</span><br>-p, -page-requisites <span class="hljs-comment">#下载显示HTML文件的所有图片</span><br><br><span class="hljs-comment">#递归下载中的包含和不包含(accept/reject)</span><br>-A, -accept=LIST <span class="hljs-comment">#分号分隔的被接受扩展名的列表</span><br>-R, -reject=LIST <span class="hljs-comment">#分号分隔的不被接受的扩展名的列表</span><br>-D, -domains=LIST <span class="hljs-comment">#分号分隔的被接受域的列表</span><br>-exclude-domains=LIST <span class="hljs-comment">#分号分隔的不被接受的域的列表</span><br>-follow-ftp <span class="hljs-comment">#跟踪HTML文档中的FTP链接</span><br>-follow-tags=LIST <span class="hljs-comment">#分号分隔的被跟踪的HTML标签的列表</span><br>-G, -ignore-tags=LIST <span class="hljs-comment">#分号分隔的被忽略的HTML标签的列表</span><br>-H, -span-hosts <span class="hljs-comment">#当递归时转到外部主机</span><br>-L, -relative <span class="hljs-comment">#仅仅跟踪相对链接</span><br>-I, -include-directories=LIST <span class="hljs-comment">#允许目录的列表</span><br>-X, -exclude-directories=LIST <span class="hljs-comment">#不被包含目录的列表</span><br>-np, -no-parent <span class="hljs-comment">#不要追溯到父目录</span><br></code></pre></td></tr></table></figure>

<p>常用选项:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">-q 静默模式<br>-c 断点续传<br>-P /path 保存在指定目录<br>-O filename 保存为指定文件名，filename 为 - 时，发送至标准输出<br>--limit-rate= 指定传输速率，单位K，M等<br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># wget --limit-rate 1M -P /data https://mirrors.aliyun.com/centos/8/isos/x86_64/CentOS-8.5.2111-x86_64-boot.iso?spm=a2c6h.25603864.0.0.57907e09ucFUYW</span><br>--2022-11-04 11:59:16--  https://mirrors.aliyun.com/centos/8/isos/x86_64/CentOS-8.5.2111-x86_64-boot.iso?spm=a2c6h.25603864.0.0.57907e09ucFUYW<br>Resolving mirrors.aliyun.com (mirrors.aliyun.com)... 121.14.152.248, 121.14.152.242, 121.14.152.243, ...<br>Connecting to mirrors.aliyun.com (mirrors.aliyun.com)|121.14.152.248|:443... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 827326464 (789M) [application/x-cd-image]<br>Saving to: ‘/data/CentOS-8.5.2111-x86_64-boot.iso?spm=a2c6h.25603864.0.0.57907e09ucFUYW’<br><br><span class="hljs-comment"># ls /data</span><br>entOS-8.5.2111-x86_64-boot.iso?spm=a2c6h.25603864.0.0.57907e09ucFUYW<br></code></pre></td></tr></table></figure>

<p>范例：实现浏览器功能</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># wget -qO - http://10.0.0.17/</span><br>/var/www/html/index.html<br></code></pre></td></tr></table></figure>

<p>范例: 下载指定目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@centos8 ~]<span class="hljs-comment">#wget -r -np -nH -R index.html http://www.example.com/dir/</span><br>[root@centos8 ~]<span class="hljs-comment">#wget -c -r -np -k -L -p http://www.example.com/dir/</span><br><br>-r : 遍历所有子目录<br>-np : 不到上一层子目录去<br>-nH : 不要将文件保存到主机名文件夹<br>-R index.html : 不下载 index.html 文件<br></code></pre></td></tr></table></figure>

<h2 id="5-3-curl"><a href="#5-3-curl" class="headerlink" title="5.3 curl"></a>5.3 curl</h2><p>curl是基于URL语法在命令行方式下工作的文件传输工具，它支持FTP, FTPS, HTTP, HTTPS, GOPHER,TELNET, DICT, FILE及LDAP等协议。curl支持HTTPS认证，并且支持HTTP的POST、PUT等方法， FTP上传， kerberos认证，HTTP上传，代理服务器，cookies，用户名/密码认证， 下载文件断点续传，上载文件断点续传, http代理服务器管道（ proxy tunneling），还支持IPv6，socks5代理服务器，通过http代理服务器上传文件到FTP服务器等，功能十分强大</p>
<p>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl [options] [URL...]<br></code></pre></td></tr></table></figure>

<p>常见选项：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sh">-A/--user-agent &lt;string&gt; <span class="hljs-comment">#设置用户代理发送给服务器</span><br>-e/--referer &lt;URL&gt; <span class="hljs-comment">#来源网址</span><br>--cacert &lt;file&gt; <span class="hljs-comment">#CA证书 (SSL)</span><br>-k/--insecure  <span class="hljs-comment">#允许忽略证书进行 SSL 连接</span><br>--compressed <span class="hljs-comment">#要求返回是压缩的格式</span><br>-H/--header <span class="hljs-string">&quot;key:value” #自定义首部字段传递给服务器</span><br><span class="hljs-string">-i #显示页面内容，包括报文首部信息</span><br><span class="hljs-string">-I/--head #只显示响应报文首部信息</span><br><span class="hljs-string">-D/--dump-header &lt;file&gt; #将url的header信息存放在指定文件中</span><br><span class="hljs-string">--basic #使用HTTP基本认证</span><br><span class="hljs-string">-u/--user &lt;user[:password]&gt; #设置服务器的用户和密码</span><br><span class="hljs-string">-L #如果有3xx响应码，重新发请求到新位置</span><br><span class="hljs-string">-O #使用URL中默认的文件名保存文件到本地</span><br><span class="hljs-string">-o &lt;file&gt; #将网络文件保存为指定的文件中</span><br><span class="hljs-string">--limit-rate &lt;rate&gt; #设置传输速度</span><br><span class="hljs-string">-0/--http1.0 #数字0，使用HTTP 1.0</span><br><span class="hljs-string">-v/--verbose #更详细</span><br><span class="hljs-string">-C #选项可对文件使用断点续传功能</span><br><span class="hljs-string">-c/--cookie-jar &lt;file name&gt; #将url中cookie存放在指定文件中</span><br><span class="hljs-string">-x/--proxy &lt;proxyhost[:port]&gt; #指定代理服务器地址</span><br><span class="hljs-string">-X/--request &lt;command&gt; #向服务器发送指定请求方法</span><br><span class="hljs-string">-U/--proxy-user &lt;user:password&gt; #代理服务器用户和密码</span><br><span class="hljs-string">-T #选项可将指定的本地文件上传到FTP服务器上</span><br><span class="hljs-string">--data/-d #方式指定使用POST方式传递数据</span><br><span class="hljs-string">-s --silent  #Silent mode</span><br><span class="hljs-string">-b name=data #从服务器响应set-cookie得到值，返回给服务器</span><br><span class="hljs-string">-w &lt;format&gt; #显示相应的指定的报文信息，如：%&#123;http_code&#125;，%&#123;remote_ip&#125;等</span><br><span class="hljs-string">-m, --max-time &lt;time&gt; #允许最大传输时间</span><br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># curl -I http://www.163.com</span><br>HTTP/1.1 403 Forbidden<br>Date: Thu, 12 Dec 2019 01:18:11 GMT<br>Content-Type: text/html<br>Content-Length: 234<br>Connection: keep-alive<br>Server: web cache<br>Expires: Thu, 12 Dec 2019 01:18:11 GMT<br>X-Ser: BC14_lt-tianjin-tianjin-3-cache-3<br>Cache-Control: no-cache,no-store,private<br>cdn-user-ip: 123.118.223.243<br>cdn-ip: 125.39.21.14<br>X-Cache-Remote: HIT<br>cdn-source: baishan<br><br><span class="hljs-comment"># curl -I -A ie10 http://www.163.com</span><br>HTTP/1.1 200 OK<br>Date: Thu, 12 Dec 2019 01:19:30 GMT<br>Content-Type: text/html; charset=GBK<br>Connection: keep-alive<br>Expires: Thu, 12 Dec 2019 01:20:45 GMT<br>Server: nginx<br>Cache-Control: no-cache,no-store,private<br>Age: 5<br>Vary: Accept-Encoding<br>X-Ser: BC20_dx-lt-yd-fujian-xiamen-8-cache-2, BC57_dx-lt-yd-fujian-xiamen-8-<br>cache-2, BC5_lt-tianjin-tianjin-3-cache-3, BC13_lt-tianjin-tianjin-3-cache-3<br>cdn-user-ip: 123.118.223.243<br>cdn-ip: 125.39.21.13<br>X-Cache-Remote: HIT<br>cdn-source: baishan<br><br><span class="hljs-comment"># curl -H &quot;user-agent: firefox&quot; http://www.163.com</span><br></code></pre></td></tr></table></figure>

<p>范例:：shell脚本判断网站正常</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim web_status.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-subst">$(curl -sL -w &#x27;%&#123;http_code&#125;&#x27; http://www.baidu.com -o /dev/null)</span>&quot;</span> = <span class="hljs-string">&quot;200&quot;</span> ]; <span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Success&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Fail&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># vim web_stataus.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-keyword">if</span> curl -sL --fail http://www.baidu.com -o /dev/null;<br><span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Success&quot;</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Fail&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>

<p>范例：利用curl 获取响应码和远程主机IP</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># curl -s -I -m10 -o /dev/null -w %&#123;http_code&#125; http://www.baidu.com/</span><br>HTTP/1.1 200 OK<br>Accept-Ranges: bytes<br>Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform<br>Connection: keep-alive<br>Content-Length: 277<br>Content-Type: text/html<br>Date: Mon, 07 Nov 2022 05:08:29 GMT<br>Etag: <span class="hljs-string">&quot;575e1f72-115&quot;</span><br>Last-Modified: Mon, 13 Jun 2016 02:50:26 GMT<br>Pragma: no-cache<br>Server: bfe/1.0.8.18<br><br><span class="hljs-comment"># curl -s -I -m10 -o /dev/null -w %&#123;remote_ip&#125; http://baidu.com/</span><br>110.242.68.66<br><br><span class="hljs-comment"># curl -s -I -m10 -o /dev/null -w %&#123;local_ip&#125; http://bilibili.com/</span><br>10.0.0.17<br><br><span class="hljs-comment"># curl -s -I -m10 -o /dev/null -w %&#123;local_port&#125; http://bilibili.com/</span><br>59848<br><br><span class="hljs-comment"># curl -s -I -m10 -o /dev/null -w %&#123;remote_port&#125; http://bilibili.com/</span><br>80<br></code></pre></td></tr></table></figure>

<h2 id="5-4-httpie"><a href="#5-4-httpie" class="headerlink" title="5.4 httpie"></a>5.4 httpie</h2><p>HTTPie 工具是功能丰富的 HTTP 命令行客户端，它能通过命令行界面与 Web 服务进行交互。它提供一个简单的 http 命令，允许使用简单而自然的语法发送任意的 HTTP 请求，并会显示彩色的输出</p>
<p>HTTPie 能用于测试、调试及与 HTTP 服务器交互。</p>
<p>主要特点：</p>
<ul>
<li>具表达力的和直观语法</li>
<li>格式化的及彩色化的终端输出</li>
<li>内置 JSON 支持</li>
<li>表单和文件上传</li>
<li>HTTPS、代理和认证</li>
<li>任意请求数据</li>
<li>自定义头部</li>
<li>持久化会话</li>
<li>类似 wget 的下载</li>
<li>支持 Python 2.7 和 3.x</li>
</ul>
<p>官方网站：<a target="_blank" rel="noopener" href="https://httpie.org/">https://httpie.org</a></p>
<p>安装：基于EPEL（CentOS 8 目前还不支持）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># yum install httpie -y</span><br></code></pre></td></tr></table></figure>

<p>范例：查看帮助</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># http --help</span><br>usage: http [--json] [--form] [--pretty &#123;all,colors,format,none&#125;]<br>            [--style STYLE] [--<span class="hljs-built_in">print</span> WHAT] [--headers] [--body] [--verbose]<br>            [--all] [--history-print WHAT] [--stream] [--output FILE]<br>            [--download] [--<span class="hljs-built_in">continue</span>]<br>            [--session SESSION_NAME_OR_PATH | --session-read-only SESSION_NAME_OR_PATH]<br>            [--auth USER[:PASS]] [--auth-type &#123;basic,digest&#125;]<br>            [--proxy PROTOCOL:PROXY_URL] [--follow]<br>            [--max-redirects MAX_REDIRECTS] [--timeout SECONDS]<br>            [--check-status] [--verify VERIFY]<br>            [--ssl &#123;ssl2.3,ssl3,tls1,tls1.1,tls1.2&#125;] [--cert CERT]<br>            [--cert-key CERT_KEY] [--ignore-stdin] [--<span class="hljs-built_in">help</span>] [--version]<br>            [--traceback] [--default-scheme DEFAULT_SCHEME] [--debug]<br>            [METHOD] URL [REQUEST_ITEM [REQUEST_ITEM ...]]<br></code></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#显示信息（包含响应头200）</span><br><span class="hljs-comment"># http http://www.cilicili.cc/</span><br><br><span class="hljs-comment">#显示详细的请求（包含请求和返回头200）</span><br><span class="hljs-comment">#http -v www.cilicili.cc</span><br><br><span class="hljs-comment">#只显示Header</span><br><span class="hljs-comment"># http -h www.cilicili.cc</span><br><span class="hljs-comment"># http --head www.cilicili.cc</span><br><span class="hljs-comment"># http --header www.cilicili.cc</span><br><span class="hljs-comment"># http --headers www.cilicili.cc</span><br><br><span class="hljs-comment">#只显示Body</span><br><span class="hljs-comment"># http -b www.cilicili.cc</span><br><span class="hljs-comment"># http --body www.cilicili.cc</span><br><br><span class="hljs-comment">#下载文件</span><br><span class="hljs-comment"># http -d http -b www.cilicili.cc</span><br><br><span class="hljs-comment">#模拟提交表单</span><br><span class="hljs-comment"># http -f POST www.magedu.com username=&#x27;wang&#x27;</span><br><br><span class="hljs-comment">#请求删除的方法</span><br><span class="hljs-comment"># http DELETE www.magedu.com</span><br><br><span class="hljs-comment">#传递JSON数据请求(默认就是JSON数据请求)</span><br><span class="hljs-comment"># http PUT www.magedu.com username=&#x27;wang&#x27; password=&#x27;magedu&#x27;</span><br><br><span class="hljs-comment">#如果JSON数据存在不是字符串则用:=分隔，例如</span><br><span class="hljs-comment"># http PUT www.magedu.com username=&#x27;wang&#x27; password=&#x27;magedu&#x27; age:=30 a:=true</span><br>streets:=<span class="hljs-string">&#x27;[&quot;a&quot;, &quot;b&quot;]&#x27;</span><br><br><span class="hljs-comment">#模拟Form的Post请求, Content-Type: application/x-www-form-urlencoded;charset=utf-8</span><br><span class="hljs-comment"># http --form POST www.magedu.com username=&#x27;wang&#x27;</span><br><br><span class="hljs-comment">#模拟Form的上传, Content-Type: multipart/form-data</span><br><span class="hljs-comment"># http -f POST www.magedu.com/jobs username=&#x27;wang&#x27; file@~/test.pdf</span><br><br><span class="hljs-comment">#修改请求头, 使用:分隔</span><br><span class="hljs-comment"># http www.magedu.com User-Agent:magedu-agent/1.0  &#x27;Cookie:a=b;b=c&#x27;</span><br>Referer:http://www.google.com/<br><br><span class="hljs-comment">#认证</span><br><span class="hljs-comment"># http -a username:password www.magedu.com</span><br><span class="hljs-comment">#http -A basic -a username:password www.magedu.com</span><br><br><span class="hljs-comment">#使用http代理</span><br><span class="hljs-comment"># http --proxy=http:http://172.16.0.100:8081 proxy.magedu.com</span><br><span class="hljs-comment"># http --proxy=http:http://user:pass@172.16.0.100:8081 proxy.magedu.com</span><br><span class="hljs-comment"># http --proxy=https:http://172.16.0.100:8118 proxy.magedu.com</span><br><span class="hljs-comment"># http --proxy=https:http://user:pass@172.16.0.100:8118 proxy.magedu.com</span><br></code></pre></td></tr></table></figure>

<p>范例：查看信息及响应头</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># http 10.0.0.17/index.html</span><br>HTTP/1.1 200 OK<br>Accept-Ranges: bytes<br>Connection: Keep-Alive<br>Content-Length: 25<br>Content-Type: text/html; charset=UTF-8<br>Date: Mon, 07 Nov 2022 05:40:20 GMT<br>ETag: <span class="hljs-string">&quot;19-5ecca0994c1fa&quot;</span><br>Keep-Alive: timeout=5, max=100<br>Last-Modified: Sun, 06 Nov 2022 09:36:11 GMT<br>Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips<br><br>/var/www/html/index.html<br></code></pre></td></tr></table></figure>

<p>范例：查看请示和响应头部及信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># http -v 10.0.0.17/index.html</span><br>GET /index.html HTTP/1.1<br>Accept: */*<br>Accept-Encoding: gzip, deflate<br>Connection: keep-alive<br>Host: 10.0.0.17<br>User-Agent: HTTPie/1.0.3<br><br><br><br>HTTP/1.1 200 OK<br>Accept-Ranges: bytes<br>Connection: Keep-Alive<br>Content-Length: 25<br>Content-Type: text/html; charset=UTF-8<br>Date: Mon, 07 Nov 2022 05:40:58 GMT<br>ETag: <span class="hljs-string">&quot;19-5ecca0994c1fa&quot;</span><br>Keep-Alive: timeout=5, max=100<br>Last-Modified: Sun, 06 Nov 2022 09:36:11 GMT<br>Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips<br><br>/var/www/html/index.html<br></code></pre></td></tr></table></figure>

<p>范例：查看响应报文头部</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># http HEAD http://www.cilicili.cc</span><br>HTTP/1.1 200 OK<br>Connection: Keep-Alive<br>Content-Encoding: gzip<br>Content-Length: 20<br>Content-Type: text/html; charset=UTF-8<br>Date: Mon, 07 Nov 2022 05:41:47 GMT<br>Keep-Alive: timeout=5, max=100<br>Server: Apache<br>Strict-Transport-Security: max-age=63072000; includeSubdomains; preload<br>Vary: Accept-Encoding<br>X-Powered-By: PHP/5.6.20<br><br></code></pre></td></tr></table></figure>

<p>范例： 查看请求和响应报文头部</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># http -p Hh http://www.cilicili.cc</span><br>GET / HTTP/1.1<br>Accept: */*<br>Accept-Encoding: gzip, deflate<br>Connection: keep-alive<br>Host: www.cilicili.cc<br>User-Agent: HTTPie/1.0.3<br><br>HTTP/1.1 200 OK<br>Connection: Keep-Alive<br>Content-Encoding: gzip<br>Content-Length: 6477<br>Content-Type: text/html; charset=UTF-8<br>Date: Mon, 07 Nov 2022 05:42:09 GMT<br>Keep-Alive: timeout=5, max=100<br>Server: Apache<br>Strict-Transport-Security: max-age=63072000; includeSubdomains; preload<br>Vary: Accept-Encoding<br>X-Powered-By: PHP/5.6.20<br><br><span class="hljs-comment"># http -p Hh http://www.bilibili.com</span><br>GET / HTTP/1.1<br>Accept: */*<br>Accept-Encoding: gzip, deflate<br>Connection: keep-alive<br>Host: www.bilibili.com<br>User-Agent: HTTPie/1.0.3<br><br>HTTP/1.1 301 Moved Permanently<br>Connection: keep-alive<br>Content-Length: 239<br>Content-Type: text/html<br>Date: Mon, 07 Nov 2022 05:42:26 GMT<br>Location: https://www.bilibili.com/<br>Server: Tengine<br></code></pre></td></tr></table></figure>

<p>范例：指定请求头部的首部字段</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># http -p H http://www.cilicili.cc User-Agent:cilicili</span><br>GET / HTTP/1.1<br>Accept: */*<br>Accept-Encoding: gzip, deflate<br>Connection: keep-alive<br>Host: www.cilicili.cc<br>User-Agent: cilicili<br></code></pre></td></tr></table></figure>

<p>范例：下载资源</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#方法1</span><br><span class="hljs-comment"># http http://www.cilicili.cc/api/images/tx/img/14.jpg &gt; logo.jpg</span><br><span class="hljs-comment"># file logo.jpg </span><br>logo.jpg: JPEG image data, JFIF standard 1.01, comment: <span class="hljs-string">&quot;CREATOR: gd-jpeg v1.0 (using IJG JPEG v62), quality = 80&quot;</span><br><br><span class="hljs-comment">#方法2</span><br><span class="hljs-comment"># http --download http://www.cilicili.cc/api/images/tx/img/11.jpg</span><br>HTTP/1.1 200 OK<br>Accept-Ranges: bytes<br>Connection: Keep-Alive<br>Content-Length: 33511<br>Content-Type: image/jpeg<br>Date: Mon, 07 Nov 2022 05:47:28 GMT<br>ETag: <span class="hljs-string">&quot;ba011e-82e7-5d0824d31f9c0&quot;</span><br>Keep-Alive: timeout=5, max=100<br>Last-Modified: Thu, 11 Nov 2021 12:15:43 GMT<br>Server: Apache<br>Strict-Transport-Security: max-age=63072000; includeSubdomains; preload<br><br>Downloading 32.73 kB to <span class="hljs-string">&quot;11.jpg&quot;</span><br>Done. 32.73 kB <span class="hljs-keyword">in</span> 0.64271s (50.92 kB/s)<br></code></pre></td></tr></table></figure>

<p>范例：用POST方法提交json格式的数据</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># http http://www.magedu.com user=wang password=magedu</span><br></code></pre></td></tr></table></figure>

<p>范例：用POST方法，指交表单数据</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># http -f POST http://www.magedu.com user=wang password=magedu</span><br></code></pre></td></tr></table></figure>

<h2 id="5-5-压力测试工具"><a href="#5-5-压力测试工具" class="headerlink" title="5.5 压力测试工具"></a>5.5 压力测试工具</h2><p>httpd的压力测试工具：</p>
<ul>
<li>ab, webbench, http_load, seige</li>
<li>Jmeter 开源</li>
<li>Loadrunner 商业，有相关认证</li>
<li>tcpcopy：网易，复制生产环境中的真实请求，并将之保存</li>
</ul>
<p>ab 来自httpd-tools包</p>
<p>命令格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">ab [OPTIONS] URL<br></code></pre></td></tr></table></figure>

<p>常见选项：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http">-n：总请求数<br>-c：模拟的并发数<br>-k：以持久连接模式测试<br></code></pre></td></tr></table></figure>

<p><strong>说明：并发数高于1024时，需要用 ulimit -n # 调整能打开的文件数</strong></p>
<h2 id="5-6-httpd自带的工具程序"><a href="#5-6-httpd自带的工具程序" class="headerlink" title="5.6 httpd自带的工具程序"></a>5.6 httpd自带的工具程序</h2><p>htpasswd：basic认证基于文件实现时，用到的账号密码文件生成工具</p>
<p>apachectl：httpd自带的服务控制脚本，支持start和stop</p>
<h1 id="六、练习"><a href="#六、练习" class="headerlink" title="六、练习"></a>六、练习</h1><ul>
<li>建立httpd服务，要求如下：<br>(1) 提供两个基于名称的虚拟主机：<br><a target="_blank" rel="noopener" href="http://www.a.com/">www.a.com</a><pre><code>页面文件目录为/web/vhosts/www1
错误日志为/var/log/httpd/www1/error_log
访问日志为/var/log/httpd/www1/access_log
</code></pre>
<a target="_blank" rel="noopener" href="http://www.b.com/">www.b.com</a><pre><code>页面文件目录为/web/vhosts/www2
错误日志为/var/log/httpd/www2/error_log
访问日志为/var/log/httpd/www2/access_log
</code></pre>
(2) 为两个虚拟主机建立各自的主页文件index.html，内容分别为其对应的主机名<br>(3) 通过<a target="_blank" rel="noopener" href="http://www.a.com/server-status%E8%BE%93%E5%87%BA%E5%85%B6%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF%EF%BC%8C%E4%B8%94%E8%A6%81%E6%B1%82%E5%8F%AA%E5%85%81%E8%AE%B8192.168.1.0/24%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E4%B8%BB%E6%9C%BA%E8%AE%BF%E9%97%AE">www.a.com/server-status输出其状态信息，且要求只允许192.168.1.0/24网络中的主机访问</a> </li>
<li>为上面的第2个虚拟主机<a target="_blank" rel="noopener" href="http://www.b.com/">www.b.com</a> 提供https服务，使得用户可以通过https安全的访问此web站点<br>(1) 要求使用证书认证，证书中要求使用国家（CN），省份（Beijing），城市（Beijing），组织为(MageEdu)<br>(2) 设置部门为Ops, 主机名为<a target="_blank" rel="noopener" href="http://www.b.com/">www.b.com</a></li>
</ul>
<h1 id="七、面试题"><a href="#七、面试题" class="headerlink" title="七、面试题"></a>七、面试题</h1><h2 id="7-1-http协议版本的区别"><a href="#7-1-http协议版本的区别" class="headerlink" title="7.1 http协议版本的区别"></a>7.1 http协议版本的区别</h2><h2 id="7-2-说明在浏览器中输入一个网站链接后发生的过程"><a href="#7-2-说明在浏览器中输入一个网站链接后发生的过程" class="headerlink" title="7.2 说明在浏览器中输入一个网站链接后发生的过程"></a>7.2 说明在浏览器中输入一个网站链接后发生的过程</h2><h2 id="7-3-解释说明apache-的MPM模型"><a href="#7-3-解释说明apache-的MPM模型" class="headerlink" title="7.3 解释说明apache 的MPM模型"></a>7.3 解释说明apache 的MPM模型</h2><h2 id="7-4-https-的工作原理"><a href="#7-4-https-的工作原理" class="headerlink" title="7.4 https 的工作原理"></a>7.4 https 的工作原理</h2><h2 id="7-5-请解释一下以下-response-header-各行的含义？"><a href="#7-5-请解释一下以下-response-header-各行的含义？" class="headerlink" title="7.5 请解释一下以下 response header 各行的含义？"></a>7.5 请解释一下以下 response header 各行的含义？</h2>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/Apache-httpd/">Apache httpd</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2022/11/07/%E5%AE%9E%E7%8E%B0LAMP%E6%9E%B6%E6%9E%84/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">实现LAMP架构</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2022/10/19/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">
                        <span class="hidden-mobile">文本处理工具和正则表达式</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/blog/js/debouncer.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/blog/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/blog/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/blog/js/boot.js" ></script>



</body>
</html>
