

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="rlin">
  <meta name="keywords" content="">
  <title>企业级容器技术docker（三）docker数据管理 - rlin的运维笔记</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/blog/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/blog/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"rintime.gitee.io","root":"/blog/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>rlin的运维笔记</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="企业级容器技术docker（三）docker数据管理">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-09-02 14:28" pubdate>
        2021年9月2日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      10.6k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      171
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">企业级容器技术docker（三）docker数据管理</h1>
            
            <div class="markdown-body">
              <h1 id="企业级容器技术docker"><a href="#企业级容器技术docker" class="headerlink" title="企业级容器技术docker"></a>企业级容器技术docker</h1><h1 id="三、-Docker-数据管理"><a href="#三、-Docker-数据管理" class="headerlink" title="三、 Docker 数据管理"></a>三、 Docker 数据管理</h1><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker57.png" srcset="/blog/img/loading.gif"></p>
<p>Docker镜像由多个只读层叠加而成，启动容器时，Docker会加载只读镜像层并在镜像栈顶部添加一个读写层</p>
<p>如果运行中的容器修改了现有的一个已经存在的文件，那该文件将会从读写层下面的只读层复制到读写层，该文件的只读版本仍然存在，只是已经被读写层中该文件的副本所隐藏，此即“写时复制(COWcopy on write)”机制</p>
<p>如果将正在运行中的容器修改生成了新的数据，那么新产生的数据将会被复制到读写层，进行持久化保存，这个读写层也就是容器的工作目录，也为写时复制(COW) 机制。</p>
<p>COW机制节约空间,但会导致性低下,虽然关闭重启容器,数据不受影响,但会随着容器的删除,其对应的可写层也会随之而删除,即数据也会丢失.如果容器需要持久保存数据,并不影响性能可以用数据卷技术实现</p>
<p>如下图是将对根的数据写入到了容器的可写层，但是把/data 中的数据写入到了一个另外的volume 中用于数据持久化</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker58.png" srcset="/blog/img/loading.gif"></p>
<h2 id="3-1-容器的数据管理介绍"><a href="#3-1-容器的数据管理介绍" class="headerlink" title="3.1 容器的数据管理介绍"></a>3.1 容器的数据管理介绍</h2><p>Docker镜像是分层设计的，镜像层是只读的，通过镜像启动的容器添加了一层可读写的文件系统，用户写入的数据都保存在这一层中。</p>
<h3 id="3-1-1-Docker容器的分层"><a href="#3-1-1-Docker容器的分层" class="headerlink" title="3.1.1 Docker容器的分层"></a>3.1.1 Docker容器的分层</h3><p>容器的数据分层目录</p>
<ul>
<li>LowerDir: image 镜像层,即镜像本身，只读</li>
<li>UpperDir: 容器的上层,可读写 ,容器变化的数据存放在此处</li>
<li>MergedDir: 容器的文件系统，使用Union FS（联合文件系统）将lowerdir 和 upperdir 合并完成后给容器使用,最终呈现给用户的统一视图</li>
<li>WorkDir: 容器在宿主机的工作目录,挂载后内容会被清空，且在使用过程中其内容用户不可见</li>
</ul>
<p>范例: 查看指定容器数据分层</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect 53cc14218528</span><br>[<br>    &#123;<br>        <span class="hljs-string">&quot;Id&quot;</span>: <span class="hljs-string">&quot;53cc142185282a7cc2fd0b3692d46d6cb050e7a9c9d5ba511c8c3e71bfa3e531&quot;</span>,<br>        <span class="hljs-string">&quot;Created&quot;</span>: <span class="hljs-string">&quot;2021-06-30T09:01:34.330534883Z&quot;</span>,<br>        <span class="hljs-string">&quot;Path&quot;</span>: <span class="hljs-string">&quot;sh&quot;</span>,<br>        <span class="hljs-string">&quot;Args&quot;</span>: [],<br>        <span class="hljs-string">&quot;State&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Status&quot;</span>: <span class="hljs-string">&quot;running&quot;</span>,<br>            <span class="hljs-string">&quot;Running&quot;</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-string">&quot;Paused&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;Restarting&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;OOMKilled&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;Dead&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;Pid&quot;</span>: 2191,<br>            <span class="hljs-string">&quot;ExitCode&quot;</span>: 0,<br>            <span class="hljs-string">&quot;Error&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;StartedAt&quot;</span>: <span class="hljs-string">&quot;2021-06-30T09:01:34.926343902Z&quot;</span>,<br>            <span class="hljs-string">&quot;FinishedAt&quot;</span>: <span class="hljs-string">&quot;0001-01-01T00:00:00Z&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;Image&quot;</span>: <span class="hljs-string">&quot;sha256:e389ae58922402a7ded319e79f06ac428d05698d8e61ecbe88d2cf850e42651d&quot;</span>,<br>        <span class="hljs-string">&quot;ResolvConfPath&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/containers/53cc142185282a7cc2fd0b3692d46d6cb050e7a9c9d5ba511c8c3e71bfa3e531/resolv.conf&quot;</span>,<br>        <span class="hljs-string">&quot;HostnamePath&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/containers/53cc142185282a7cc2fd0b3692d46d6cb050e7a9c9d5ba511c8c3e71bfa3e531/hostname&quot;</span>,<br>        <span class="hljs-string">&quot;HostsPath&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/containers/53cc142185282a7cc2fd0b3692d46d6cb050e7a9c9d5ba511c8c3e71bfa3e531/hosts&quot;</span>,<br>        <span class="hljs-string">&quot;LogPath&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/containers/53cc142185282a7cc2fd0b3692d46d6cb050e7a9c9d5ba511c8c3e71bfa3e531/53cc142185282a7cc2fd0b3692d46d6cb050e7a9c9d5ba511c8c3e71bfa3e531-json.log&quot;</span>,<br>        <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;/heuristic_kowalevski&quot;</span>,<br>        <span class="hljs-string">&quot;RestartCount&quot;</span>: 0,<br>        <span class="hljs-string">&quot;Driver&quot;</span>: <span class="hljs-string">&quot;overlay2&quot;</span>,<br>        <span class="hljs-string">&quot;Platform&quot;</span>: <span class="hljs-string">&quot;linux&quot;</span>,<br>        <span class="hljs-string">&quot;MountLabel&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;ProcessLabel&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;AppArmorProfile&quot;</span>: <span class="hljs-string">&quot;docker-default&quot;</span>,<br>        <span class="hljs-string">&quot;ExecIDs&quot;</span>: null,<br>        <span class="hljs-string">&quot;HostConfig&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Binds&quot;</span>: null,<br>            <span class="hljs-string">&quot;ContainerIDFile&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;LogConfig&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;Type&quot;</span>: <span class="hljs-string">&quot;json-file&quot;</span>,<br>                <span class="hljs-string">&quot;Config&quot;</span>: &#123;&#125;<br>            &#125;,<br>            <span class="hljs-string">&quot;NetworkMode&quot;</span>: <span class="hljs-string">&quot;default&quot;</span>,<br>            <span class="hljs-string">&quot;PortBindings&quot;</span>: &#123;&#125;,<br>            <span class="hljs-string">&quot;RestartPolicy&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;no&quot;</span>,<br>                <span class="hljs-string">&quot;MaximumRetryCount&quot;</span>: 0<br>            &#125;,<br>            <span class="hljs-string">&quot;AutoRemove&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;VolumeDriver&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;VolumesFrom&quot;</span>: null,<br>            <span class="hljs-string">&quot;CapAdd&quot;</span>: null,<br>            <span class="hljs-string">&quot;CapDrop&quot;</span>: null,<br>            <span class="hljs-string">&quot;Capabilities&quot;</span>: null,<br>            <span class="hljs-string">&quot;Dns&quot;</span>: [],<br>            <span class="hljs-string">&quot;DnsOptions&quot;</span>: [],<br>            <span class="hljs-string">&quot;DnsSearch&quot;</span>: [],<br>            <span class="hljs-string">&quot;ExtraHosts&quot;</span>: null,<br>            <span class="hljs-string">&quot;GroupAdd&quot;</span>: null,<br>            <span class="hljs-string">&quot;IpcMode&quot;</span>: <span class="hljs-string">&quot;private&quot;</span>,<br>            <span class="hljs-string">&quot;Cgroup&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;Links&quot;</span>: null,<br>            <span class="hljs-string">&quot;OomScoreAdj&quot;</span>: 0,<br>            <span class="hljs-string">&quot;PidMode&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;Privileged&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;PublishAllPorts&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;ReadonlyRootfs&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;SecurityOpt&quot;</span>: null,<br>            <span class="hljs-string">&quot;UTSMode&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;UsernsMode&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;ShmSize&quot;</span>: 67108864,<br>            <span class="hljs-string">&quot;Runtime&quot;</span>: <span class="hljs-string">&quot;runc&quot;</span>,<br>            <span class="hljs-string">&quot;ConsoleSize&quot;</span>: [<br>                0,<br>                0<br>            ],<br>            <span class="hljs-string">&quot;Isolation&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;CpuShares&quot;</span>: 0,<br>            <span class="hljs-string">&quot;Memory&quot;</span>: 0,<br>            <span class="hljs-string">&quot;NanoCpus&quot;</span>: 0,<br>            <span class="hljs-string">&quot;CgroupParent&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;BlkioWeight&quot;</span>: 0,<br>            <span class="hljs-string">&quot;BlkioWeightDevice&quot;</span>: [],<br>            <span class="hljs-string">&quot;BlkioDeviceReadBps&quot;</span>: null,<br>            <span class="hljs-string">&quot;BlkioDeviceWriteBps&quot;</span>: null,<br>            <span class="hljs-string">&quot;BlkioDeviceReadIOps&quot;</span>: null,<br>            <span class="hljs-string">&quot;BlkioDeviceWriteIOps&quot;</span>: null,<br>            <span class="hljs-string">&quot;CpuPeriod&quot;</span>: 0,<br>            <span class="hljs-string">&quot;CpuQuota&quot;</span>: 0,<br>            <span class="hljs-string">&quot;CpuRealtimePeriod&quot;</span>: 0,<br>            <span class="hljs-string">&quot;CpuRealtimeRuntime&quot;</span>: 0,<br>            <span class="hljs-string">&quot;CpusetCpus&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;CpusetMems&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;Devices&quot;</span>: [],<br>            <span class="hljs-string">&quot;DeviceCgroupRules&quot;</span>: null,<br>            <span class="hljs-string">&quot;DeviceRequests&quot;</span>: null,<br>            <span class="hljs-string">&quot;KernelMemory&quot;</span>: 0,<br>            <span class="hljs-string">&quot;KernelMemoryTCP&quot;</span>: 0,<br>            <span class="hljs-string">&quot;MemoryReservation&quot;</span>: 0,<br>            <span class="hljs-string">&quot;MemorySwap&quot;</span>: 0,<br>            <span class="hljs-string">&quot;MemorySwappiness&quot;</span>: null,<br>            <span class="hljs-string">&quot;OomKillDisable&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;PidsLimit&quot;</span>: null,<br>            <span class="hljs-string">&quot;Ulimits&quot;</span>: null,<br>            <span class="hljs-string">&quot;CpuCount&quot;</span>: 0,<br>            <span class="hljs-string">&quot;CpuPercent&quot;</span>: 0,<br>            <span class="hljs-string">&quot;IOMaximumIOps&quot;</span>: 0,<br>            <span class="hljs-string">&quot;IOMaximumBandwidth&quot;</span>: 0,<br>            <span class="hljs-string">&quot;MaskedPaths&quot;</span>: [<br>                <span class="hljs-string">&quot;/proc/asound&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/acpi&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/kcore&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/keys&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/latency_stats&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/timer_list&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/timer_stats&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/sched_debug&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/scsi&quot;</span>,<br>                <span class="hljs-string">&quot;/sys/firmware&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;ReadonlyPaths&quot;</span>: [<br>                <span class="hljs-string">&quot;/proc/bus&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/fs&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/irq&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/sys&quot;</span>,<br>                <span class="hljs-string">&quot;/proc/sysrq-trigger&quot;</span><br>            ]<br>        &#125;,<br>        <span class="hljs-string">&quot;GraphDriver&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Data&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;LowerDir&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210-init/diff:/var/lib/docker/overlay2/4b578b5436cf5543018259e82c63735c0d8021fda21e3a38ce4de3adbc23fe1b/diff&quot;</span>,<br>                <span class="hljs-string">&quot;MergedDir&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/merged&quot;</span>,<br>                <span class="hljs-string">&quot;UpperDir&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/diff&quot;</span>,<br>                <span class="hljs-string">&quot;WorkDir&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/work&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;overlay2&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;Mounts&quot;</span>: [],<br>        <span class="hljs-string">&quot;Config&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Hostname&quot;</span>: <span class="hljs-string">&quot;53cc14218528&quot;</span>,<br>            <span class="hljs-string">&quot;Domainname&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;User&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;AttachStdin&quot;</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-string">&quot;AttachStdout&quot;</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-string">&quot;AttachStderr&quot;</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-string">&quot;Tty&quot;</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-string">&quot;OpenStdin&quot;</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-string">&quot;StdinOnce&quot;</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-string">&quot;Env&quot;</span>: [<br>                <span class="hljs-string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;Cmd&quot;</span>: [<br>                <span class="hljs-string">&quot;sh&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;Image&quot;</span>: <span class="hljs-string">&quot;alpine:3.11&quot;</span>,<br>            <span class="hljs-string">&quot;Volumes&quot;</span>: null,<br>            <span class="hljs-string">&quot;WorkingDir&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;Entrypoint&quot;</span>: null,<br>            <span class="hljs-string">&quot;OnBuild&quot;</span>: null,<br>            <span class="hljs-string">&quot;Labels&quot;</span>: &#123;&#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;NetworkSettings&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Bridge&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;SandboxID&quot;</span>: <span class="hljs-string">&quot;0cf8eff00f6c58e6d4015b7dd1e911d24be032ca645903bff15d627f0ca1c601&quot;</span>,<br>            <span class="hljs-string">&quot;HairpinMode&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;LinkLocalIPv6Address&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;LinkLocalIPv6PrefixLen&quot;</span>: 0,<br>            <span class="hljs-string">&quot;Ports&quot;</span>: &#123;&#125;,<br>            <span class="hljs-string">&quot;SandboxKey&quot;</span>: <span class="hljs-string">&quot;/var/run/docker/netns/0cf8eff00f6c&quot;</span>,<br>            <span class="hljs-string">&quot;SecondaryIPAddresses&quot;</span>: null,<br>            <span class="hljs-string">&quot;SecondaryIPv6Addresses&quot;</span>: null,<br>            <span class="hljs-string">&quot;EndpointID&quot;</span>: <span class="hljs-string">&quot;82ce887898855635d1131e723b248491d0f9a8aac0471f06344ba605b9db23b3&quot;</span>,<br>            <span class="hljs-string">&quot;Gateway&quot;</span>: <span class="hljs-string">&quot;172.17.0.1&quot;</span>,<br>            <span class="hljs-string">&quot;GlobalIPv6Address&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,<br>            <span class="hljs-string">&quot;IPAddress&quot;</span>: <span class="hljs-string">&quot;172.17.0.2&quot;</span>,<br>            <span class="hljs-string">&quot;IPPrefixLen&quot;</span>: 16,<br>            <span class="hljs-string">&quot;IPv6Gateway&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;MacAddress&quot;</span>: <span class="hljs-string">&quot;02:42:ac:11:00:02&quot;</span>,<br>            <span class="hljs-string">&quot;Networks&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;bridge&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;IPAMConfig&quot;</span>: null,<br>                    <span class="hljs-string">&quot;Links&quot;</span>: null,<br>                    <span class="hljs-string">&quot;Aliases&quot;</span>: null,<br>                    <span class="hljs-string">&quot;NetworkID&quot;</span>: <span class="hljs-string">&quot;9c2ede1604da433bd760839b3aa9a20f57e5dc15e56fd61739069eab7f0d8a80&quot;</span>,<br>                    <span class="hljs-string">&quot;EndpointID&quot;</span>: <span class="hljs-string">&quot;82ce887898855635d1131e723b248491d0f9a8aac0471f06344ba605b9db23b3&quot;</span>,<br>                    <span class="hljs-string">&quot;Gateway&quot;</span>: <span class="hljs-string">&quot;172.17.0.1&quot;</span>,<br>                    <span class="hljs-string">&quot;IPAddress&quot;</span>: <span class="hljs-string">&quot;172.17.0.2&quot;</span>,<br>                    <span class="hljs-string">&quot;IPPrefixLen&quot;</span>: 16,<br>                    <span class="hljs-string">&quot;IPv6Gateway&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>                    <span class="hljs-string">&quot;GlobalIPv6Address&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>                    <span class="hljs-string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,<br>                    <span class="hljs-string">&quot;MacAddress&quot;</span>: <span class="hljs-string">&quot;02:42:ac:11:00:02&quot;</span>,<br>                    <span class="hljs-string">&quot;DriverOpts&quot;</span>: null<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>]<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll -i /var/lib/docker/overlay2/4b578b5436cf5543018259e82c63735c0d8021fda21e3a38ce4de3adbc23fe1b</span><br>total 24<br>3018747 drwx------  3 root root  4096 Jun 30 11:06 ./<br>2623458 drwx------ 20 root root 12288 Jun 30 16:23 ../<br>3019406 -rw-------  1 root root     0 Jun 30 11:07 committed<br>3018754 drwxr-xr-x 19 root root  4096 Jun 30 11:01 diff/<br>3018755 -rw-r--r--  1 root root    26 Jun 30 11:01 link<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll -i /var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210</span><br>total 36<br>2753782 drwx------  5 root root  4096 Jun 30 17:01 ./<br>2623458 drwx------ 22 root root 12288 Jun 30 17:01 ../<br>2753794 drwxr-xr-x  3 root root  4096 Jun 30 17:01 diff/<br>2753795 -rw-r--r--  1 root root    26 Jun 30 17:01 link<br>2753798 -rw-r--r--  1 root root    57 Jun 30 17:01 lower<br>2753093 drwxr-xr-x  1 root root  4096 Jun 30 17:01 merged/<br>2753796 drwx------  3 root root  4096 Jun 30 17:01 work/<br><br>[root@ubuntu1804 ~]<span class="hljs-comment"># tree -d /var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210</span><br>/var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210<br>├── diff<br>│   └── root<br>├── merged<br>│   ├── bin<br>│   ├── dev<br>│   │   ├── pts<br>│   │   └── shm<br>│   ├── etc<br>│   │   ├── apk<br>│   │   │   ├── keys<br>│   │   │   └── protected_paths.d<br>│   │   ├── conf.d<br>│   │   ├── crontabs<br>│   │   ├── init.d<br>│   │   ├── logrotate.d<br>│   │   ├── modprobe.d<br>│   │   ├── modules-load.d<br>│   │   ├── network<br>│   │   │   ├── if-down.d<br>│   │   │   ├── if-post-down.d<br>│   │   │   ├── if-post-up.d<br>│   │   │   ├── if-pre-down.d<br>│   │   │   ├── if-pre-up.d<br>│   │   │   └── if-up.d<br>│   │   ├── opt<br>│   │   ├── periodic<br>│   │   │   ├── 15min<br>│   │   │   ├── daily<br>│   │   │   ├── hourly<br>│   │   │   ├── monthly<br>│   │   │   └── weekly<br>│   │   ├── profile.d<br>│   │   ├── ssl<br>│   │   │   ├── certs<br>│   │   │   ├── misc<br>│   │   │   └── private<br>│   │   └── sysctl.d<br>│   ├── home<br>│   ├── lib<br>│   │   ├── apk<br>│   │   │   └── db<br>│   │   ├── firmware<br>│   │   └── mdev<br>│   ├── media<br>│   │   ├── cdrom<br>│   │   ├── floppy<br>│   │   └── usb<br>│   ├── mnt<br>│   ├── opt<br>│   ├── proc<br>│   ├── root<br>│   ├── run<br>│   ├── sbin<br>│   ├── srv<br>│   ├── sys<br>│   ├── tmp<br>│   ├── usr<br>│   │   ├── bin<br>│   │   ├── lib<br>│   │   │   └── engines-1.1<br>│   │   ├── <span class="hljs-built_in">local</span><br>│   │   │   ├── bin<br>│   │   │   ├── lib<br>│   │   │   └── share<br>│   │   ├── sbin<br>│   │   └── share<br>│   │       ├── apk<br>│   │       │   └── keys<br>│   │       │       ├── aarch64<br>│   │       │       ├── armhf<br>│   │       │       ├── ppc64le<br>│   │       │       ├── s390x<br>│   │       │       ├── x86<br>│   │       │       └── x86_64<br>│   │       ├── man<br>│   │       ├── misc<br>│   │       └── udhcpc<br>│   └── var<br>│       ├── cache<br>│       │   ├── apk<br>│       │   └── misc<br>│       ├── empty<br>│       ├── lib<br>│       │   ├── apk<br>│       │   ├── misc<br>│       │   └── udhcpd<br>│       ├── <span class="hljs-built_in">local</span><br>│       ├── lock<br>│       │   └── subsys<br>│       ├── <span class="hljs-built_in">log</span><br>│       ├── mail<br>│       ├── opt<br>│       ├── run -&gt; /run<br>│       ├── spool<br>│       │   ├── cron<br>│       │   └── mail -&gt; /var/mail<br>│       └── tmp<br>└── work<br>    └── work<br><br>99 directories<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it alpine:3.11 sh</span><br>/ <span class="hljs-comment"># dd if=/dev/zero of=/root/test.img bs=1M count=10</span><br>10+0 records <span class="hljs-keyword">in</span><br>10+0 records out<br>/ <span class="hljs-comment">#</span><br><br><span class="hljs-comment">#每个镜像层目录中包含了一个文件link，文件内容则是当前层对应的短标识符，镜像层的内容则存放在diff目录</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#find  /var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210 -name test.img -ls</span><br> 2753813  10240 -rw-r--r--   1 root     root     10485760 Jun 30 17:01 /var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/diff/root/test.img<br>  2753813  10240 -rw-r--r--   1 root     root     10485760 Jun 30 17:01 /var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/merged/root/test.img<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#mount </span><br>overlay on /var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/merged <span class="hljs-built_in">type</span> overlay (rw,relatime,lowerdir=/var/lib/docker/overlay2/l/ACM5P2EN6IDKDGYU6CJX7GYI5Z:/var/lib/docker/overlay2/l/4I7DGOUN4VHLSYJKXDNCKYNDRB,upperdir=/var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/diff,workdir=/var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/work)<br>nsfs on /run/docker/netns/0cf8eff00f6c <span class="hljs-built_in">type</span> nsfs (rw)<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#tree /var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/diff/</span><br>/var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/diff/<br>└── root<br>    └── test.img<br><br>1 directory, 1 file<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls /var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/merged/</span><br>bin dev etc home lib media mnt opt proc root run sbin srv sys tmp usr var<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it alpine:3.11 sh</span><br>/ <span class="hljs-comment"># echo welcome to rlin.org &gt;&gt; /etc/issue </span><br>/ <span class="hljs-comment"># cat /etc/issue </span><br>Welcome to Alpine Linux 3.11<br>Kernel \r on an \m (\l)<br><br>welcome to rlin.org<br>/ <span class="hljs-comment"># </span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#tree /var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/diff/</span><br>var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210/diff/<br>├── etc<br>│   └── issue<br>└── root<br>    └── test.img<br><br>2 directories, 2 files<br><br><span class="hljs-comment">#删除容器后，所有容器数据目录都随之而删除</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm -f 53cc14218528</span><br>53cc14218528<br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls /var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210</span><br>ls: cannot access <span class="hljs-string">&#x27;/var/lib/docker/overlay2/078aff53b3d121f301e6fdff261a236888290df3c46520b7cb2e199596e39210&#x27;</span>: No such file or directory<br></code></pre></td></tr></table></figure>

<h3 id="3-1-2-哪些数据需要持久化"><a href="#3-1-2-哪些数据需要持久化" class="headerlink" title="3.1.2 哪些数据需要持久化"></a>3.1.2 哪些数据需要持久化</h3><p><strong>有状态的协议</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">有状态协议就是就通信双方要记住双方，并且共享一些信息。而无状态协议的通信每次都是独立的，与上一次的通信没什么关系。<span class="hljs-string">&quot;状态”可以理解为“记忆”，有状态对应有记忆，无状态对应无记忆</span><br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker59.png" srcset="/blog/img/loading.gif"></p>
<ul>
<li>左侧是无状态的http请求服务，右侧为有状态</li>
<li>下层为不需要存储的服务，上层为需要存储的部分服务</li>
</ul>
<h3 id="3-1-3-容器数据持久保存方式"><a href="#3-1-3-容器数据持久保存方式" class="headerlink" title="3.1.3 容器数据持久保存方式"></a>3.1.3 容器数据持久保存方式</h3><p>如果要将写入到容器的数据永久保存，则需要将容器中的数据保存到宿主机的指定目录</p>
<p>Docker的数据类型分为两种:</p>
<ul>
<li>数据卷(Data Volume): 直接将宿主机目录挂载至容器的指定的目录 ，推荐使用此种方式，此方式较常用</li>
<li>数据卷容器(Data Volume Container): 间接使用宿主机空间，数据卷容器是将宿主机的目录挂载至一个专门的数据卷容器，然后让其他容器通过数据卷容器读写宿主机的数据 ，此方式不常用</li>
</ul>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker60.png" srcset="/blog/img/loading.gif"></p>
<h2 id="3-2-数据卷-data-volume"><a href="#3-2-数据卷-data-volume" class="headerlink" title="3.2 数据卷(data volume)"></a>3.2 数据卷(data volume)</h2><h3 id="3-2-1-数据卷特点和使用"><a href="#3-2-1-数据卷特点和使用" class="headerlink" title="3.2.1 数据卷特点和使用"></a>3.2.1 数据卷特点和使用</h3><p>数据卷实际上就是宿主机上的目录或者是文件，可以被直接mount到容器当中使用</p>
<p>实际生成环境中，需要针对不同类型的服务、不同类型的数据存储要求做相应的规划，最终保证服务的可扩展性、稳定性以及数据的安全性</p>
<h4 id="3-2-1-1-数据卷使用场景"><a href="#3-2-1-1-数据卷使用场景" class="headerlink" title="3.2.1.1 数据卷使用场景"></a>3.2.1.1 数据卷使用场景</h4><ul>
<li>数据库</li>
<li>日志输出</li>
<li>静态web页面</li>
<li>应用配置文件</li>
<li>多容器间目录或文件共享</li>
</ul>
<h4 id="3-2-1-2-数据卷的特点"><a href="#3-2-1-2-数据卷的特点" class="headerlink" title="3.2.1.2 数据卷的特点"></a>3.2.1.2 数据卷的特点</h4><ul>
<li>数据卷是目录或者文件，并且可以在多个容器之间共同使用,实现容器之间共享和重用</li>
<li>对数据卷更改数据在所有容器里面会立即更新。</li>
<li>数据卷的数据可以持久保存，即使删除使用使用该容器卷的容器也不影响。</li>
<li>在容器里面的写入数据不会影响到镜像本身,即数据卷的变化不会影响镜像的更新</li>
<li>依赖于宿主机目录，宿主机出问题，上面容器会受影响，当宿主机较多时，不方便统一管理</li>
<li>匿名和命名数据卷在容器启动时初始化，如果容器使用的镜像在挂载点包含了数据，会拷贝到新初始化的数据卷中</li>
</ul>
<h4 id="3-2-1-3-数据卷使用方法"><a href="#3-2-1-3-数据卷使用方法" class="headerlink" title="3.2.1.3 数据卷使用方法"></a>3.2.1.3 数据卷使用方法</h4><p>启动容器时，可以指定使用数据卷实现容器数据的持久化,数据卷有三种</p>
<ul>
<li>指定宿主机目录或文件: 指定宿主机的具体路径和容器路径的挂载关系</li>
<li>匿名卷: 不指定数据名称,只指定容器内目录路径充当挂载点,docker自动指定宿主机的路径进行挂载</li>
<li>命名卷: 指定数据卷的名称和容器路径的挂载关系</li>
</ul>
<p>docker run 命令的以下格式可以实现数据卷</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">-v, --volume=[host-src:]container-dest[:&lt;options&gt;]<br><br>&lt;options&gt;<br>ro 从容器内对此数据卷是只读，不写此项默认为可读可写<br>rw 从容器内对此数据卷可读可写,此为默认值<br></code></pre></td></tr></table></figure>

<p><strong>方式1</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#指定宿主机目录或文件格式:</span><br>-v  &lt;宿主机绝对路径的目录或文件&gt;:&lt;容器目录或文件&gt;[:ro]  <span class="hljs-comment">#将宿主机目录挂载容器目录，两个目录都可自动创建</span><br></code></pre></td></tr></table></figure>

<p><strong>方式2</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#匿名卷,只指定容器内路径,没有指定宿主机路径信息,宿主机自动生成/var/lib/docker/volumes/&lt;卷ID&gt;/_data目录,并挂载至容器指定路径</span><br>-v &lt;容器内路径&gt;<br><br><span class="hljs-comment">#示例:</span><br>docker run --name nginx -v /etc/nginx nginx<br></code></pre></td></tr></table></figure>

<p><strong>方式3</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#命名卷将固定的存放在/var/lib/docker/volumes/&lt;卷名&gt;/_data</span><br>-v &lt;卷名&gt;:&lt;容器目录路径&gt;<br><span class="hljs-comment">#可以通过以下命令事先创建,如可没有事先创建卷名,docker run时也会自动创建卷</span><br>docker volume create &lt;卷名&gt;<br><br><span class="hljs-comment">#示例:</span><br>docker run -d  -p 80:80 --name nginx01 -v vol1:/usr/share/nginx/html nginx<br></code></pre></td></tr></table></figure>

<p><strong>docker rm 的 -v 选项可以删除容器时，同时删除相关联的匿名卷</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-v, --volumes  Remove the volumes associated with the container<br></code></pre></td></tr></table></figure>

<p><strong>管理卷命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker volume COMMAND<br><br>Commands:<br>  create      Create a volume<br>  inspect     Display detailed information on one or more volumes<br>  ls          List volumes<br>  prune       Remove all unused <span class="hljs-built_in">local</span> volumes<br>  rm          Remove one or more volumes<br></code></pre></td></tr></table></figure>

<p><strong>关于匿名数据卷和命名数据卷</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">命名卷就是有名字的卷，使用 docker volume create &lt;卷名&gt; 形式创建并命名的卷；而匿名卷就是没名字的卷，一般是 docker run -v /data 这种不指定卷名的时候所产生，或者 Dockerfile 里面的定义直接使用的。<br><br>有名字的卷，在用过一次后，以后挂载容器的时候还可以使用，因为有名字可以指定。所以一般需要保存的数据使用命名卷保存。<br>而匿名卷则是随着容器建立而建立，随着容器消亡而淹没于卷列表中（对于 docker run 匿名卷不会被自动删除）。 因此匿名卷只存放无关紧要的临时数据，随着容器消亡，这些数据将失去存在的意义。<br><br>Dockerfile中指定VOLUME为匿名数据卷,其目的只是为了将某个路径确定为卷。<br><br>按照最佳实践的要求，不应该在容器存储层内进行数据写入操作，所有写入应该使用卷。如果定制镜像的时候，就可以确定某些目录会发生频繁大量的读写操作，那么为了避免在运行时由于用户疏忽而忘记指定卷，导致容器发生存储层写入的问题，就可以在 Dockerfile 中使用 VOLUME 来指定某些目录为匿名卷。这样即使用户忘记了指定卷，也不会产生不良的后果。<br><br>这个设置可以在运行时覆盖。通过 docker run 的 -v 参数或者 docker-compose.yml 的 volumes指定。使用命名卷的好处是可以复用，其它容器可以通过这个命名数据卷的名字来指定挂载，共享其内容（不过要注意并发访问的竞争问题）。<br><br>比如，Dockerfile 中说 VOLUME /data，那么如果直接 docker run，其 /data 就会被挂载为匿名卷，向 /data 写入的操作不会写入到容器存储层，而是写入到了匿名卷中。但是如果运行时 docker run -v mydata:/data，这就覆盖了 /data 的挂载设置，要求将 /data 挂载到名为 mydata 的命名卷中。<br>所以说 Dockerfile 中的 VOLUME 实际上是一层保险，确保镜像运行可以更好的遵循最佳实践，不向容器存储层内进行写入操作。<br><br>数据卷默认可能会保存于 /var/lib/docker/volumes，不过一般不需要、也不应该访问这个位置<br></code></pre></td></tr></table></figure>

<p>查看数据卷的挂载关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker inspect --format=<span class="hljs-string">&quot;&#123;&#123;.Mounts&#125;&#125;&quot;</span> &lt;容器ID&gt;<br></code></pre></td></tr></table></figure>

<p>范例: 删除所有数据卷</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume rm `docker volume ls -q`</span><br></code></pre></td></tr></table></figure>

<h3 id="3-2-2-实战案例-目录数据卷"><a href="#3-2-2-实战案例-目录数据卷" class="headerlink" title="3.2.2 实战案例: 目录数据卷"></a>3.2.2 实战案例: 目录数据卷</h3><h4 id="3-2-2-1-在宿主机创建容器所使用的目录"><a href="#3-2-2-1-在宿主机创建容器所使用的目录" class="headerlink" title="3.2.2.1 在宿主机创建容器所使用的目录"></a>3.2.2.1 在宿主机创建容器所使用的目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#mkdir /data/testdir</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo Test page on host &gt; /data/testdir/index.html</span><br></code></pre></td></tr></table></figure>

<h4 id="3-2-2-2-查看容器相关目录路径"><a href="#3-2-2-2-查看容器相关目录路径" class="headerlink" title="3.2.2.2 查看容器相关目录路径"></a>3.2.2.2 查看容器相关目录路径</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker images &quot;*nginx*&quot;</span><br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br>nginx-ubuntu1804    1.16.1              f5d4e8278be8        7 hours ago         386MB<br>nginx-alpine        1.16.1              2d647b5fa754        9 hours ago         212MB<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --rm nginx-alpine:1.16.1 sh</span><br>/ <span class="hljs-comment"># cat /apps/nginx/conf/nginx.conf</span><br>...<br> server &#123;<br>...<br>   location / &#123;<br>     root  /data/nginx/html;  <span class="hljs-comment">#nginx存放网页文件的路径</span><br>     index index.html index.htm;<br>   &#125;<br>...<br>/ <span class="hljs-comment"># cat /data/nginx/html/index.html</span><br>Test Page based nginx-alpine<br>/ <span class="hljs-comment"># exit</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS                        PORTS               NAMES<br></code></pre></td></tr></table></figure>

<h4 id="3-2-2-3-引用宿主机的数据卷启动容器"><a href="#3-2-2-3-引用宿主机的数据卷启动容器" class="headerlink" title="3.2.2.3 引用宿主机的数据卷启动容器"></a>3.2.2.3 引用宿主机的数据卷启动容器</h4><p>引用数据卷目录，开启多个容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -v /data/testdir:/data/nginx/html/ -p 8001:80 nginx-alpine:1.16.1</span><br>077eb0b06f815065abd280dfa9b76197d718034c941082d4ef31a64e97d0ac02<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -v /data/testdir:/data/nginx/html/ -p 8002:80 nginx-alpine:1.16.1</span><br>ce591a7d64f9dc19430a4ab5a43a4269365b34d8468cd5231be58a03aca8bc50<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS              PORTS                           NAMES<br>ce591a7d64f9        nginx-alpine:1.16.1   <span class="hljs-string">&quot;nginx&quot;</span>             17 seconds ago      Up 16 seconds       443/tcp, 0.0.0.0:8002-&gt;80/tcp   sad_leakey<br>077eb0b06f81        nginx-alpine:1.16.1   <span class="hljs-string">&quot;nginx&quot;</span>             31 seconds ago      Up 30 seconds       443/tcp, 0.0.0.0:8001-&gt;80/tcp   reverent_mayer<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8001</span><br>Test page on host<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8002</span><br>Test page on host<br></code></pre></td></tr></table></figure>

<h4 id="3-2-2-3-进入到容器内测试写入数据"><a href="#3-2-2-3-进入到容器内测试写入数据" class="headerlink" title="3.2.2.3 进入到容器内测试写入数据"></a>3.2.2.3 进入到容器内测试写入数据</h4><p>进入其中一个容器写入数据，可以其它容器的数据也变化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it ce591a7d64f9 sh</span><br>/ <span class="hljs-comment"># df</span><br>Filesystem           1K-blocks      Used Available Use% Mounted on<br>overlay              102685624   6034788  91391676   6% /<br>tmpfs                    65536         0     65536   0% /dev<br>tmpfs                  2007828         0   2007828   0% /sys/fs/cgroup<br>shm                      65536         0     65536   0% /dev/shm<br>/dev/sda1            102685624   6034788  91391676   6% /etc/resolv.conf<br>/dev/sda1            102685624   6034788  91391676   6% /etc/hostname<br>/dev/sda1            102685624   6034788  91391676   6% /etc/hosts<br>/dev/sda1            102685624   6034788  91391676   6% /data/nginx/html<br>tmpfs                  2007828         0   2007828   0% /proc/asound<br>tmpfs                  2007828         0   2007828   0% /proc/acpi<br>tmpfs                    65536         0     65536   0% /proc/kcore<br>tmpfs                    65536         0     65536   0% /proc/keys<br>tmpfs                    65536         0     65536   0% /proc/timer_list<br>tmpfs                    65536         0     65536   0% /proc/sched_debug<br>tmpfs                  2007828         0   2007828   0% /proc/scsi<br>tmpfs                  2007828         0   2007828   0% /sys/firmware<br>/ <span class="hljs-comment"># cat /data/nginx/html/index.html</span><br>Test page on host<br>/ <span class="hljs-comment"># echo Test page v2 on host &gt; /data/nginx/html/index.html</span><br><br><span class="hljs-comment">#进入另一个容器看到数据变化</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it 077eb0b06f81 sh</span><br>/ <span class="hljs-comment"># cat /data/nginx/html/index.html</span><br>Test page v2 on host<br><br><span class="hljs-comment">#访问应用</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8001</span><br>Test page v2 on host<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8002</span><br>Test page v2 on host<br></code></pre></td></tr></table></figure>

<h4 id="3-2-2-4-在宿主机修改数据"><a href="#3-2-2-4-在宿主机修改数据" class="headerlink" title="3.2.2.4 在宿主机修改数据"></a>3.2.2.4 在宿主机修改数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#echo Test page v3 on host &gt; /data/testdir/index.html</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /data/testdir/index.html</span><br>Test page v3 on host<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8001</span><br>Test page v3 on host<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8002</span><br>Test page v3 on host<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it ce591a7d64f9 sh</span><br>/ <span class="hljs-comment"># cat /data/nginx/html/index.html</span><br>Test page v3 on host<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it 077eb0b06f81 sh</span><br>/ <span class="hljs-comment"># cat /data/nginx/html/index.html</span><br>Test page v3 on host<br></code></pre></td></tr></table></figure>

<h4 id="3-2-2-5-只读方法挂载数据卷"><a href="#3-2-2-5-只读方法挂载数据卷" class="headerlink" title="3.2.2.5 只读方法挂载数据卷"></a>3.2.2.5 只读方法挂载数据卷</h4><p>默认数据卷为可读可写，加ro选项，可以实现只读挂载，对于不希望容器修改的数据，比如: 配置文件，脚本等，可以用此方式挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -v /data/testdir:/data/nginx/html/:ro -p 8004:80 nginx-alpine:1.16.1</span><br>e5a6015c86170ad374d2970619f3d84c778bcb7880009bcbab3877ef8e75b599<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it e5a6015c8617 sh</span><br>/ <span class="hljs-comment"># cat /data/nginx/html/index.html</span><br>Test page v3 on host<br>/ <span class="hljs-comment"># echo Test page v4 on host &gt; /data/nginx/html/index.html</span><br>sh: can<span class="hljs-string">&#x27;t create /data/nginx/html/index.html: Read-only file system</span><br><span class="hljs-string">/ # cat /data/nginx/html/index.html</span><br></code></pre></td></tr></table></figure>

<h4 id="3-2-2-6-删除容器"><a href="#3-2-2-6-删除容器" class="headerlink" title="3.2.2.6 删除容器"></a>3.2.2.6 删除容器</h4><p>删除容器后，宿主机的数据卷还存在，可继续给新的容器使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS              PORTS                           NAMES<br>ce591a7d64f9        nginx-alpine:1.16.1   <span class="hljs-string">&quot;nginx&quot;</span>             2 minutes ago       Up 2 minutes        443/tcp, 0.0.0.0:8002-&gt;80/tcp   sad_leakey<br>077eb0b06f81        nginx-alpine:1.16.1   <span class="hljs-string">&quot;nginx&quot;</span>             2 minutes ago       Up 2 minutes        443/tcp, 0.0.0.0:8001-&gt;80/tcp   reverent_mayer<br>e5a6015c8617        nginx-alpine:1.16.1   <span class="hljs-string">&quot;nginx&quot;</span>             4 minutes ago       Up 4 minutes        443/tcp, 0.0.0.0:8004-&gt;80/tcp   lucid_bassi<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm -f `docker ps -aq`</span><br>ce591a7d64f9<br>077eb0b06f81<br>e5a6015c8617<br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /data/testdir/index.html</span><br>Test page v3 on host<br><br><span class="hljs-comment">#新建的容器还可以继续使用原有的数据卷</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -v /data/testdir:/data/nginx/html/ -p 8003:80 nginx-alpine:1.16.1</span><br>b6733e257a12f444b53f15e24c8e272a4f18cd244c5d6698d6c37d3b13a4212a<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8003</span><br>Test page v3 on host<br></code></pre></td></tr></table></figure>

<h3 id="3-2-3-安战案例-MySQL使用的数据卷"><a href="#3-2-3-安战案例-MySQL使用的数据卷" class="headerlink" title="3.2.3 安战案例: MySQL使用的数据卷"></a>3.2.3 安战案例: MySQL使用的数据卷</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull mysql:5.7.30</span><br> docker pull mysql:5.7.30<br>5.7.30: Pulling from library/mysql<br>8559a31e96f4: Pull complete <br>d51ce1c2e575: Pull complete <br>c2344adc4858: Pull complete <br>fcf3ceff18fc: Pull complete <br>16da0c38dc5b: Pull complete <br>b905d1797e97: Pull complete <br>4b50d1c6b05c: Pull complete <br>d85174a87144: Pull complete <br>a4ad33703fa8: Pull complete <br>f7a5433ce20d: Pull complete <br>3dcd2a278b4a: Pull complete <br>Digest: sha256:32f9d9a069f7a735e28fd44ea944d53c61f990ba71460c5c183e610854ca4854<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> mysql:5.7.30<br>docker.io/library/mysql:5.7.30<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images &quot;mysql*&quot;</span><br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br>mysql               5.7.30              9cfcce23593a        12 months ago       448MB<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7.30</span><br>eaa817b4363814164bdb1050f7f641b2087afdfe315c52f5300e0f52e0fd1038<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>ONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                               NAMES<br>eaa817b43638        mysql:5.7.30          <span class="hljs-string">&quot;docker-entrypoint.s…&quot;</span>   15 seconds ago      Up 14 seconds       0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   thirsty_bose<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it eaa817b43638 bash</span><br>root@eaa817b43638:/<span class="hljs-comment"># cat /etc/issue</span><br>Debian GNU/Linux 10 \n \l<br><br>root@eaa817b43638:/<span class="hljs-comment"># cat /etc/mysql/my.cnf</span><br>......<br><br>!includedir /etc/mysql/conf.d/<br>!includedir /etc/mysql/mysql.conf.d/<br><br>root@eaa817b43638:/<span class="hljs-comment"># cat /etc/mysql/mysql.conf.d/mysqld.cnf</span><br><br>[mysqld]<br>pid-file	= /var/run/mysqld/mysqld.pid<br>socket		= /var/run/mysqld/mysqld.sock<br>datadir		= /var/lib/mysql <span class="hljs-comment">#数据存放路径</span><br><br>root@eaa817b43638:/<span class="hljs-comment"># pstree -p</span><br>mysqld(1)-+-&#123;mysqld&#125;(131)<br>          |-&#123;mysqld&#125;(132)<br>          |-&#123;mysqld&#125;(133)<br>          |-&#123;mysqld&#125;(134)<br>          |-&#123;mysqld&#125;(135)<br>          |-&#123;mysqld&#125;(136)<br>          |-&#123;mysqld&#125;(137)<br>          |-&#123;mysqld&#125;(138)<br>          |-&#123;mysqld&#125;(139)<br>          |-&#123;mysqld&#125;(140)<br>          |-&#123;mysqld&#125;(141)<br>          |-&#123;mysqld&#125;(142)<br>          |-&#123;mysqld&#125;(144)<br>          |-&#123;mysqld&#125;(145)<br>          |-&#123;mysqld&#125;(146)<br>          |-&#123;mysqld&#125;(147)<br>          |-&#123;mysqld&#125;(148)<br>          |-&#123;mysqld&#125;(149)<br>          |-&#123;mysqld&#125;(150)<br>          |-&#123;mysqld&#125;(151)<br>          |-&#123;mysqld&#125;(152)<br>          |-&#123;mysqld&#125;(153)<br>          |-&#123;mysqld&#125;(154)<br>          |-&#123;mysqld&#125;(155)<br>          |-&#123;mysqld&#125;(156)<br>          `-&#123;mysqld&#125;(157)<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#mysql -uroot -p123456 -h127.0.0.1</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor. Commands end with ; or \g.<br>Your MySQL connection id is 2<br>Server version: 5.7.30 MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+--------------------+<br>4 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; create database dockerdb;<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| dockerdb           |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+--------------------+<br>5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.01 sec)<br><br>mysql&gt;<br><br><span class="hljs-comment">#删除容器后，再创建新的容器，数据库信息丢失</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm -f eaa817b43638</span><br>eaa817b43638<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7.30</span><br>7f0448a6b93771bc56b43e580bfb9c3b11d54097c1567dc1bc8e6cfec06e9f43<br>[root@ubuntu1804 ~]<span class="hljs-comment">#mysql -uroot -p123456 -h127.0.0.1</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor. Commands end with ; or \g.<br>Your MySQL connection id is 2<br>Server version: 5.7.30 MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+--------------------+<br>4 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br><span class="hljs-comment">#利用数据卷创建容器</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#mkdir /data/mysql</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name mysql -p 3306:3306 -v /data/mysql/:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7.30</span><br>fa73046121ec83265526ec97158ab5072e148dda92aca44a6be5921b1571bcf2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#mysql -uroot -p123456 -h127.0.0.1</span><br>mysql&gt; create database dockerdb;<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| dockerdb           |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+--------------------+<br>5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; <span class="hljs-built_in">exit</span><br><span class="hljs-comment">#删除容器，数据存放在挂载数据卷中，不会删除</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm -fv mysql</span><br>mysql<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls /data/mysql/</span><br>auto.cnf    client-cert.pem  ib_buffer_pool  ib_logfile1  performance_schema  server-cert.pem  wordpress<br>ca-key.pem  client-key.pem   ibdata1         ibtmp1       private_key.pem     server-key.pem<br>ca.pem      dockerdb         ib_logfile0     mysql        public_key.pem      sys<br><br><span class="hljs-comment">#重新创建新容器，之前数据还在</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name mysql -p 3306:3306 -v /data/mysql/:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7.30</span><br>d9720d87c0298de26e3ac2d05de6c20d1ba905c9471888de154bf9171a9a5ad0<br>[root@ubuntu1804 ~]<span class="hljs-comment">#mysql -uroot -p123456 -h127.0.0.1</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor. Commands end with ; or \g.<br>Your MySQL connection id is 2<br>Server version: 5.7.30 MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| dockerdb           |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+--------------------+<br>5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; <span class="hljs-built_in">exit</span><br><br><span class="hljs-comment">#指定多个数据卷，创建MySQL</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run --name mysql-test1 -v /data/mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=wordpress -e MYSQL_USER=wpuser -e MYSQL_PASSWORD=123456 -d -p 3306:3306 mysql:5.7.30</span><br>744f8a081b5f58d71d9eded0ead7e8ffdd2101392d3dca282ebef02b898f9b9c<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim env.list</span><br>MYSQL_ROOT_PASSWORD=123456<br>MYSQL_DATABASE=wordpress<br>MYSQL_USER=wpuser<br>MYSQL_PASSWORD=wppass<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim mysql/mysql-test.cnf</span><br>[mysqld]<br>server-id=100<br>log-bin=mysql-bin<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run --name mysql-test2 -v /root/mysql/:/etc/mysql/conf.d -v /data/mysql2:/var/lib/mysql --env-file=env.list -d -p 3307:3306 mysql:5.7.30</span><br>0f7ce382e190653664e90b348edf49515a35f9e42746d4952072e2c06cba15bb<br><br></code></pre></td></tr></table></figure>

<h3 id="3-2-4-实战案例-文件数据卷"><a href="#3-2-4-实战案例-文件数据卷" class="headerlink" title="3.2.4 实战案例: 文件数据卷"></a>3.2.4 实战案例: 文件数据卷</h3><p>文件挂载用于很少更改文件内容的场景，比如: nginx 的配置文件、tomcat的配置文件等。</p>
<h4 id="3-2-4-1-准备相关文件"><a href="#3-2-4-1-准备相关文件" class="headerlink" title="3.2.4.1 准备相关文件"></a>3.2.4.1 准备相关文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#mkdir -p /data/&#123;bin,testapp,logs&#125;</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo testapp v1 &gt; /data/testapp/index.html</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /data/testapp/index.html</span><br>testapp v1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#cp /data/dockerfile/web/tomcat/tomcat-base-8.5.50/apache-tomcat-8.5.50/bin/catalina.sh /data/bin/</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /data/bin/catalina.sh</span><br><span class="hljs-comment">#加下面tomcat的优化参数行</span><br><span class="hljs-comment"># -----------------------------------------------------------------------------</span><br>JAVA_OPTS=<span class="hljs-string">&quot;-server -Xms4g -Xmx4g -Xss512k -Xmn1g -XX:CMSInitiatingOccupancyFraction=65 -XX:+UseFastAccessorMethods -XX:+AggressiveOpts -XX:+UseBiasedLocking -XX:+DisableExplicitGC -XX:MaxTenuringThreshold=10 -XX:NewSize=2048M -XX:MaxNewSize=2048M -XX:NewRatio=2 -XX:PermSize=128m -XX:MaxPermSize=512m -XX:CMSFullGCsBeforeCompaction=5 -XX:+ExplicitGCInvokesConcurrent -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:+CMSParallelRemarkEnabled -XX:+UseCMSCompactAtFullCollection -XX:LargePageSizeInBytes=128m -XX:+UseFastAccessorMethods&quot;</span><br><span class="hljs-comment"># OS specific support. $var _must_ be set to either true or false.</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#chown 2019:2019 /data/bin/catalina.sh</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll /data/bin/catalina.sh</span><br>-rwxr-x--- 1 2019 2019 24324 Jan 31 21:43 /data/bin/catalina.sh*<br>[root@ubuntu1804 ~]<span class="hljs-comment">#chown 2019:2019 /data/logs/</span><br></code></pre></td></tr></table></figure>

<h4 id="3-2-4-2-引用文件数据卷启动容器"><a href="#3-2-4-2-引用文件数据卷启动容器" class="headerlink" title="3.2.4.2 引用文件数据卷启动容器"></a>3.2.4.2 引用文件数据卷启动容器</h4><p>同时挂载可读可写方式的目录数据卷和只读方式的文件数据卷，实现三个数据卷的挂载，数据，日志和启动脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -v /data/bin/catalina.sh:/apps/tomcat/bin/catalina.sh:ro -v /data/testapp:/data/tomcat/webapps/testapp -v /data/logs:/apps/tomcat/logs -p 8080:8080 tomcat-web:app1</span><br>07952b7c2a221e89eb77c348e626e33aa8437dc3e8e50a6ccf157129d81e2797<br></code></pre></td></tr></table></figure>

<h4 id="3-2-4-3-验证容器可以访问"><a href="#3-2-4-3-验证容器可以访问" class="headerlink" title="3.2.4.3 验证容器可以访问"></a>3.2.4.3 验证容器可以访问</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8080/testapp/</span><br>testapp v1<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls -l /data/logs/</span><br>total 36<br>drwxr-xr-x 2 2019 2019 4096 Jan 31 22:44 ./<br>drwxr-xr-x 7 root root 4096 Jan 31 22:43 ../<br>-rw-r----- 1 2019 2019 8336 Jan 31 22:44 catalina.2020-01-31.log<br>-rw-r----- 1 2019 2019 8808 Jan 31 22:44 catalina.out<br>-rw-r----- 1 2019 2019   0 Jan 31 22:44 host-manager.2020-01-31.log<br>-rw-r----- 1 2019 2019   0 Jan 31 22:44 localhost.2020-01-31.log<br>-rw-r----- 1 2019 2019  76 Jan 31 22:44 localhost_access_log.2020-01-31.txt<br>-rw-r----- 1 2019 2019   0 Jan 31 22:44 manager.2020-01-31.log<br></code></pre></td></tr></table></figure>

<h4 id="3-2-4-4-直接修改宿主机的数据"><a href="#3-2-4-4-直接修改宿主机的数据" class="headerlink" title="3.2.4.4 直接修改宿主机的数据"></a>3.2.4.4 直接修改宿主机的数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#宿主机修改目录数据卷</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo testapp v2 &gt; /data/testapp/index.html</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8080/testapp/</span><br>testapp v2<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll /data/bin/catalina.sh</span><br>-rwxr-x--- 1 2019 2019 24324 Jan 31 21:43 /data/bin/catalina.sh*<br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo &gt;&gt; /data/bin/catalina.sh</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll /data/bin/catalina.sh</span><br>-rwxr-x--- 1 2019 2019 24325 Jan 31 22:21 /data/bin/catalina.sh*<br></code></pre></td></tr></table></figure>

<h4 id="3-2-4-5-进入容器修改数据"><a href="#3-2-4-5-进入容器修改数据" class="headerlink" title="3.2.4.5 进入容器修改数据"></a>3.2.4.5 进入容器修改数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it 07952b7c2a22 bash</span><br>[root@07952b7c2a22 /]<span class="hljs-comment"># netstat -ntl</span><br>Active Internet connections (only servers)<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State<br>tcp     0    0 127.0.0.1:8005      0.0.0.0:*        LISTEN  <br>tcp     0    0 0.0.0.0:8009       0.0.0.0:*        LISTEN  <br>tcp     0    0 0.0.0.0:8080       0.0.0.0:*        LISTEN  <br><br><span class="hljs-comment">#文件数据卷上的文件为只读</span><br>[root@07952b7c2a22 /]<span class="hljs-comment"># echo &gt;&gt; /apps/tomcat/bin/catalina.sh</span><br>bash: /apps/tomcat/bin/catalina.sh: Read-only file system<br><br><span class="hljs-comment">#目录数据卷可读可写</span><br>[root@07952b7c2a22 /]<span class="hljs-comment"># cat /data/tomcat/webapps/testapp/index.html</span><br>testapp v2<br>[root@07952b7c2a22 /]<span class="hljs-comment"># echo testapp v3 &gt; /data/tomcat/webapps/testapp/index.html</span><br>[root@07952b7c2a22 /]<span class="hljs-comment"># cat /data/tomcat/webapps/testapp/index.html</span><br>testapp v3<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8080/testapp/</span><br>testapp v3<br></code></pre></td></tr></table></figure>

<h4 id="3-2-4-6-查看容器中挂载和进程信息"><a href="#3-2-4-6-查看容器中挂载和进程信息" class="headerlink" title="3.2.4.6 查看容器中挂载和进程信息"></a>3.2.4.6 查看容器中挂载和进程信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@07952b7c2a22 /]<span class="hljs-comment"># mount</span><br>......<br>/dev/sda3 on /apps/apache-tomcat-8.5.50/bin/catalina.sh <span class="hljs-built_in">type</span> ext4<br>(ro,relatime,data=ordered)<br>/dev/sda3 on /data/tomcat/webapps/testapp <span class="hljs-built_in">type</span> ext4 (rw,relatime,data=ordered)<br>......<br>[root@07952b7c2a22 /]<span class="hljs-comment"># df</span><br>Filesystem     1K-blocks    Used Available Use% Mounted on<br>overlay        102685624 8250760  89175704   9% /<br>tmpfs              65536       0     65536   0% /dev<br>tmpfs            2007828       0   2007828   0% /sys/fs/cgroup<br>shm                65536       0     65536   0% /dev/shm<br>/dev/sda1      102685624 8250760  89175704   9% /etc/hosts<br>tmpfs            2007828       0   2007828   0% /proc/asound<br>tmpfs            2007828       0   2007828   0% /proc/acpi<br>tmpfs            2007828       0   2007828   0% /proc/scsi<br>tmpfs            2007828       0   2007828   0% /sys/firmware<br><br>[root@07952b7c2a22 /]<span class="hljs-comment"># ps aux</span><br>USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND<br>root          1  0.0  0.0  13304  3068 ?        Ss   10:39   0:00 /bin/bash /apps/tomcat/bin/run_tomcat.sh<br>www          26  0.6  3.2 7761452 131392 ?      Sl   10:39   0:02 /usr/<span class="hljs-built_in">local</span>/jdk/bin/java -Djava.util.logging.config.file=/a<br>root         27  0.0  0.1  83596  4520 ?        S    10:39   0:00 su - www -c tail -f /etc/hosts<br>www          29  0.0  0.0   4416   724 ?        Ss   10:39   0:00 tail -f /etc/hosts<br>root         77  0.0  0.0  13944  3980 pts/0    Ss   10:40   0:00 bash<br>root        101  0.0  0.0  53368  3876 pts/0    R+   10:44   0:00 ps aux<br>[root@07952b7c2a22 /]<span class="hljs-comment"># ps aux|grep java</span><br>www          26  0.6  3.2 7761452 131392 ?      Sl   10:39   0:02 /usr/<span class="hljs-built_in">local</span>/jdk/bin/java -Djava.util.logging.config.file=/apps/tomcat/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -server -Xms4g -Xmx4g -Xss512k -Xmn1g -XX:CMSInitiatingOccupancyFraction=65 -XX:+UseFastAccessorMethods -XX:+AggressiveOpts -XX:+UseBiasedLocking -XX:+DisableExplicitGC -XX:MaxTenuringThreshold=10 -XX:NewSize=2048M -XX:MaxNewSize=2048M -XX:NewRatio=2 -XX:PermSize=128m -XX:MaxPermSize=512m -XX:CMSFullGCsBeforeCompaction=5 -XX:+ExplicitGCInvokesConcurrent -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:+CMSParallelRemarkEnabled -XX:+UseCMSCompactAtFullCollection -XX:LargePageSizeInBytes=128m -XX:+UseFastAccessorMethods -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK=0027 -Dignore.endorsed.dirs= -classpath /apps/tomcat/bin/bootstrap.jar:/apps/tomcat/bin/tomcat-juli.jar -Dcatalina.base=/apps/tomcat -Dcatalina.home=/apps/tomcat -Djava.io.tmpdir=/apps/tomcat/temp org.apache.catalina.startup.Bootstrap start<br>root        103  0.0  0.0  10704  2288 pts/0    S+   10:45   0:00 grep --color=auto java<br></code></pre></td></tr></table></figure>

<h3 id="3-2-5-实战案例-匿名数据卷"><a href="#3-2-5-实战案例-匿名数据卷" class="headerlink" title="3.2.5 实战案例: 匿名数据卷"></a>3.2.5 实战案例: 匿名数据卷</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume ls</span><br>DRIVER       VOLUME NAME<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES<br><br><span class="hljs-comment">#利用匿名数据卷创建容器</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -p 80:80 --name nginx01 -v /usr/share/nginx/html nginx</span><br>914c622af7ebae68aab0b0075da39534fdb118cd5d4d7adf3054da94eb2a4952<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br>&lt;style&gt;<br> body &#123;<br>   width: 35em;<br>   margin: 0 auto;<br>   font-family: Tahoma, Verdana, Arial, sans-serif;<br> &#125;<br>&lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;<br>&lt;p&gt;If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.&lt;/p&gt;<br>&lt;p&gt;For online documentation and support please refer to<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;<br>Commercial support is available at<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;<br>&lt;p&gt;&lt;em&gt;Thank you <span class="hljs-keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br><span class="hljs-comment">#查看自动生成的匿名数据卷</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume ls</span><br>DRIVER       VOLUME NAME<br><span class="hljs-built_in">local</span>        2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe<br><br><span class="hljs-comment">#查看匿名数据卷的详细信息</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume inspect 2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe</span><br>[<br> &#123;<br>    <span class="hljs-string">&quot;CreatedAt&quot;</span>: <span class="hljs-string">&quot;2020-07-21T19:17:07+08:00&quot;</span>,<br>    <span class="hljs-string">&quot;Driver&quot;</span>: <span class="hljs-string">&quot;local&quot;</span>,<br>    <span class="hljs-string">&quot;Labels&quot;</span>: null,<br>    <span class="hljs-string">&quot;Mountpoint&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/docker/volumes/2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe/_data&quot;</span>,<br>    <span class="hljs-string">&quot;Name&quot;</span>:<br><span class="hljs-string">&quot;2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe&quot;</span>,<br>    <span class="hljs-string">&quot;Options&quot;</span>: null,<br>    <span class="hljs-string">&quot;Scope&quot;</span>: <span class="hljs-string">&quot;local&quot;</span><br> &#125;<br>]<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect --format=&quot;&#123;&#123;.Mounts&#125;&#125;&quot; nginx01</span><br>[&#123;volume 2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe<br>/var/lib/docker/volumes/2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe/_data /usr/share/nginx/html <span class="hljs-built_in">local</span>  <span class="hljs-literal">true</span> &#125;]<br><br><span class="hljs-comment">#查看匿名数据卷的文件</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls /var/lib/docker/volumes/2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe/_data</span><br>50x.html index.html<br><br><span class="hljs-comment">#修改宿主机中匿名数据卷的文件</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo Anonymous Volume &gt; /var/lib/docker/volumes/2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe/_data/index.html</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1</span><br>Anonymous Volume<br><br><span class="hljs-comment">#删除容器不会删除匿名数据卷</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm -f nginx01</span><br>nginx01<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume ls</span><br>DRIVER       VOLUME NAME<br><span class="hljs-built_in">local</span>        2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -p 80:80 --name nginx01 -v /usr/share/nginx/html nginx</span><br>40a99ae066cc60aa0ad7d073e46101a15446509acbd7971e677f3cbe6733aa79<br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /var/lib/docker/volumes/2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe/_data/index.html</span><br>Anonymous Volume<br><br><span class="hljs-comment">#删除匿名数据卷</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume rm 2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe</span><br>2a18aff09215e7830c6df56a80e0f8ace9b44f3384d512daf06d75502f8b40fe<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume ls</span><br>DRIVER       VOLUME NAME<br></code></pre></td></tr></table></figure>

<h3 id="3-2-6-实战案例-命名数据卷"><a href="#3-2-6-实战案例-命名数据卷" class="headerlink" title="3.2.6 实战案例: 命名数据卷"></a>3.2.6 实战案例: 命名数据卷</h3><h4 id="3-2-6-1-创建命名数据卷"><a href="#3-2-6-1-创建命名数据卷" class="headerlink" title="3.2.6.1 创建命名数据卷"></a>3.2.6.1 创建命名数据卷</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume create vol1</span><br>vol1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume ls</span><br>DRIVER       VOLUME NAME<br><span class="hljs-built_in">local</span>        vol1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect vol1</span><br>[<br> &#123;<br>    <span class="hljs-string">&quot;CreatedAt&quot;</span>: <span class="hljs-string">&quot;2020-07-21T18:36:45+08:00&quot;</span>,<br>    <span class="hljs-string">&quot;Driver&quot;</span>: <span class="hljs-string">&quot;local&quot;</span>,<br>    <span class="hljs-string">&quot;Labels&quot;</span>: &#123;&#125;,<br>    <span class="hljs-string">&quot;Mountpoint&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/volumes/vol1/_data&quot;</span>,<br>    <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;vol1&quot;</span>,<br>    <span class="hljs-string">&quot;Options&quot;</span>: &#123;&#125;,<br>    <span class="hljs-string">&quot;Scope&quot;</span>: <span class="hljs-string">&quot;local&quot;</span><br> &#125;<br>]<br></code></pre></td></tr></table></figure>

<h4 id="3-2-6-2-使用命名数据卷创建容器"><a href="#3-2-6-2-使用命名数据卷创建容器" class="headerlink" title="3.2.6.2 使用命名数据卷创建容器"></a>3.2.6.2 使用命名数据卷创建容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -p 8001:80 --name nginx01 -v vol1:/usr/share/nginx/html nginx</span><br>2a2ad99de2984521cbce777eae8e482c3e6e55e35ab5f398a35c7986fa39cc99<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8001</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br>&lt;style&gt;<br> body &#123;<br>   width: 35em;<br>   margin: 0 auto;<br>       font-family: Tahoma, Verdana, Arial, sans-serif;<br> &#125;<br>&lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;<br>&lt;p&gt;If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.&lt;/p&gt;<br>&lt;p&gt;For online documentation and support please refer to<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;<br>Commercial support is available at<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;<br>&lt;p&gt;&lt;em&gt;Thank you <span class="hljs-keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br><span class="hljs-comment">#显示命名数据卷</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume ls</span><br>DRIVER       VOLUME NAME<br><span class="hljs-built_in">local</span>        vol1<br><br><span class="hljs-comment">#查看命名数据卷详解信息</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume inspect vol1</span><br>[<br> &#123;<br>    <span class="hljs-string">&quot;CreatedAt&quot;</span>: <span class="hljs-string">&quot;2020-07-21T18:44:03+08:00&quot;</span>,<br>    <span class="hljs-string">&quot;Driver&quot;</span>: <span class="hljs-string">&quot;local&quot;</span>,<br>    <span class="hljs-string">&quot;Labels&quot;</span>: &#123;&#125;,<br>    <span class="hljs-string">&quot;Mountpoint&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/volumes/vol1/_data&quot;</span>,<br>    <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;vol1&quot;</span>,<br>    <span class="hljs-string">&quot;Options&quot;</span>: &#123;&#125;,<br>    <span class="hljs-string">&quot;Scope&quot;</span>: <span class="hljs-string">&quot;local&quot;</span><br> &#125;<br>]<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect --format=&quot;&#123;&#123;.Mounts&#125;&#125;&quot; nginx01</span><br>[&#123;volume vol1 /var/lib/docker/volumes/vol1/_data /usr/share/nginx/html <span class="hljs-built_in">local</span> z <span class="hljs-literal">true</span> &#125;]<br><br><span class="hljs-comment">#查看命名数据卷的文件</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls /var/lib/docker/volumes/vol1/_data</span><br>50x.html index.html<br><br><span class="hljs-comment">#修改宿主机命名数据卷的文件</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo nginx vol1 website &gt; /var/lib/docker/volumes/vol1/_data/index.html</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8001</span><br>nginx vol1 website<br><br><span class="hljs-comment">#利用现在的命名数据卷再创建新容器,可以和原有容器共享同一个命名数据卷的数据</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -p 8002:80 --name nginx02 -v vol1:/usr/share/nginx/html nginx</span><br>fb8739438992b7797a3f23dc495d2fd43f513fd793114848171f376c4325675e<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8002</span><br>nginx vol1 website<br></code></pre></td></tr></table></figure>

<h4 id="3-2-6-3-创建容器时自动创建命名数据卷"><a href="#3-2-6-3-创建容器时自动创建命名数据卷" class="headerlink" title="3.2.6.3 创建容器时自动创建命名数据卷"></a>3.2.6.3 创建容器时自动创建命名数据卷</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#创建容器自动创建命名数据卷</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -p 8003:80 --name nginx03 -v vol2:/usr/share/nginx/html nginx</span><br>5d7497c04907babcb2084f8f7a16874223e07965410fd4da14bc2fe993277aed<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume ls</span><br>DRIVER       VOLUME NAME<br><span class="hljs-built_in">local</span>        portainer_data<br><span class="hljs-built_in">local</span>        vol1<br><span class="hljs-built_in">local</span>        vol2<br></code></pre></td></tr></table></figure>

<h4 id="3-2-6-4-删除数据卷"><a href="#3-2-6-4-删除数据卷" class="headerlink" title="3.2.6.4 删除数据卷"></a>3.2.6.4 删除数据卷</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#删除指定的命名数据卷</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume rm vol1</span><br><br><span class="hljs-comment">#清理全部不再使用的卷</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker volume prune -f</span><br></code></pre></td></tr></table></figure>

<h2 id="3-3-数据卷容器"><a href="#3-3-数据卷容器" class="headerlink" title="3.3 数据卷容器"></a>3.3 数据卷容器</h2><h3 id="3-3-1-数据卷容器介绍"><a href="#3-3-1-数据卷容器介绍" class="headerlink" title="3.3.1 数据卷容器介绍"></a>3.3.1 数据卷容器介绍</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker61.png" srcset="/blog/img/loading.gif"></p>
<p>在Dockerfile中创建的是匿名数据卷,无法直接实现多个容器之间共享数据</p>
<p>数据卷容器最大的功能是可以让数据在多个docker容器之间共享</p>
<p>如下图所示: 即可以让B容器访问A容器的内容，而容器C也可以访问A容器的内容，即可以实现A，B，C 三个容器之间的数据读写共享。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker62.png" srcset="/blog/img/loading.gif"></p>
<p>相当于先要创建一个后台运行的容器作为 Server，用于提供数据卷，这个卷可以为其他容器提供数据存储服务，其他使用此卷的容器作为client端 ，但此方法并不常使用</p>
<p>缺点: 因为依赖一个 Server 的容器，所以此 Server 容器出了问题，其它 Client容器都会受影响</p>
<h3 id="3-3-2-使用数据卷容器"><a href="#3-3-2-使用数据卷容器" class="headerlink" title="3.3.2 使用数据卷容器"></a>3.3.2 使用数据卷容器</h3><p>启动容器时，指定使用数据卷容器</p>
<p>docker run 命令的以下选项可以实现数据卷容器，格式如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">--volumes-from &lt;数据卷容器&gt;   Mount volumes from the specified container(s)<br></code></pre></td></tr></table></figure>

<h3 id="3-3-3-实战案例-数据卷容器"><a href="#3-3-3-实战案例-数据卷容器" class="headerlink" title="3.3.3 实战案例: 数据卷容器"></a>3.3.3 实战案例: 数据卷容器</h3><h4 id="3-3-3-1-创建一个数据卷容器-Server"><a href="#3-3-3-1-创建一个数据卷容器-Server" class="headerlink" title="3.3.3.1 创建一个数据卷容器 Server"></a>3.3.3.1 创建一个数据卷容器 Server</h4><p>先创建一个容器而无需启动也可以，并挂载宿主机的数据目录</p>
<p>范例: 使用之前的镜像创建数据卷容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#数据卷容器一般无需映射端口</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name volume-server -v /data/bin/catalina.sh:/apps/tomcat/bin/catalina.sh:ro -v /data/testapp:/data/tomcat/webapps/testapp tomcat-web:app1</span><br>ee1232c322412e75792f3102677fc38607ae73a6cff7200dc1dc25aea67c3038<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                NAMES<br>ee1232c32241        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   24 seconds ago      Up 23 seconds       8009/tcp, 8080/tcp   volume-server<br></code></pre></td></tr></table></figure>

<h4 id="3-3-3-2-启动多个数据卷容器-Client"><a href="#3-3-3-2-启动多个数据卷容器-Client" class="headerlink" title="3.3.3.2 启动多个数据卷容器 Client"></a>3.3.3.2 启动多个数据卷容器 Client</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name client1 --volumes-from volume-server -p 8081:8080 tomcat-web:app1</span><br>84de5bdf7695d637d52616b4d8831a303eaebc12ebdc41a3e0d54430c052abae<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name client2 --volumes-from volume-server -p 8082:8080 tomcat-web:app1</span><br>d37d085f54a81c0d2d4c467e6622f6ce2d84eac07a11c6c5589c49b46b7b7338<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS                              NAMES<br>d37d085f54a8        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   12 seconds ago       Up 11 seconds       8009/tcp, 0.0.0.0:8082-&gt;8080/tcp   client2<br>84de5bdf7695        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   25 seconds ago       Up 23 seconds       8009/tcp, 0.0.0.0:8081-&gt;8080/tcp   client1<br>ee1232c32241        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   About a minute ago   Up About a minute   8009/tcp, 8080/tcp                 volume-server<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h4 id="3-3-3-3-验证访问"><a href="#3-3-3-3-验证访问" class="headerlink" title="3.3.3.3 验证访问"></a>3.3.3.3 验证访问</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8081/testapp/</span><br>testapp v3<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8082/testapp/</span><br>testapp v3<br></code></pre></td></tr></table></figure>

<h4 id="3-3-3-4-进入容器测试读写"><a href="#3-3-3-4-进入容器测试读写" class="headerlink" title="3.3.3.4 进入容器测试读写"></a>3.3.3.4 进入容器测试读写</h4><p>读写权限依赖于源数据卷Server容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#进入 Server 容器修改数据</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it volume-server bash</span><br>[root@ee1232c32241 /]<span class="hljs-comment"># cat /data/tomcat/webapps/testapp/index.html</span><br>testapp v3<br>[root@ee1232c32241 /]<span class="hljs-comment"># echo testapp v4 &gt; /data/tomcat/webapps/testapp/index.html</span><br>[root@ee1232c32241 /]<span class="hljs-comment">#</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8081/testapp/</span><br>testapp v4<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8082/testapp/</span><br>testapp v4<br><br><span class="hljs-comment">#进入 Client 容器修改数据</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it client1 bash</span><br>[root@84de5bdf7695 /]<span class="hljs-comment"># cat /data/tomcat/webapps/testapp/index.html</span><br>testapp v4<br>[root@84de5bdf7695 /]<span class="hljs-comment"># echo testapp v4 &gt; /data/tomcat/webapps/testapp/index.html</span><br>[root@84de5bdf7695 /]<span class="hljs-comment"># cat /data/tomcat/webapps/testapp/index.html</span><br>testapp v5<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8081/testapp/</span><br>testapp v5<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8082/testapp/</span><br>testapp v5<br></code></pre></td></tr></table></figure>

<h4 id="3-3-3-5-在宿主机直接修改"><a href="#3-3-3-5-在宿主机直接修改" class="headerlink" title="3.3.3.5 在宿主机直接修改"></a>3.3.3.5 在宿主机直接修改</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#cat /data/testapp/index.html</span><br>testapp v5<br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo testapp v6 &gt; /data/testapp/index.html</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /data/testapp/index.html</span><br>testapp v6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8081/testapp/</span><br>testapp v6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8082/testapp/</span><br>testapp v6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it volume-server bash</span><br>[root@109a34c5a83b /]<span class="hljs-comment"># cat /data/tomcat/webapps/testapp/index.html</span><br>testapp v6<br>[root@109a34c5a83b /]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h4 id="3-3-3-6-关闭卷容器Server测试能否启动新容器"><a href="#3-3-3-6-关闭卷容器Server测试能否启动新容器" class="headerlink" title="3.3.3.6 关闭卷容器Server测试能否启动新容器"></a>3.3.3.6 关闭卷容器Server测试能否启动新容器</h4><p>关闭卷容器Server，仍然可以创建新的client容器及访问旧的client容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker stop volume-server</span><br>volume-server<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                              NAMES<br>d37d085f54a8        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   About an hour ago   Up About an hour    8009/tcp, 0.0.0.0:8082-&gt;8080/tcp   client2<br>84de5bdf7695        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   About an hour ago   Up About an hour    8009/tcp, 0.0.0.0:8081-&gt;8080/tcp   client1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name client3 --volumes-from volume-server -p 8083:8080 tomcat-web:app1</span><br>7e7f5a688e096641d626d9097858f5ccf04c683d13fe8b1a36f82626e0bd2c92<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                            PORTS                              NAMES<br>7e7f5a688e09        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   11 seconds ago      Up 10 seconds                     8009/tcp, 0.0.0.0:8083-&gt;8080/tcp   client3<br>d37d085f54a8        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   About an hour ago   Up About an hour                  8009/tcp, 0.0.0.0:8082-&gt;8080/tcp   client2<br>84de5bdf7695        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   About an hour ago   Up About an hour                  8009/tcp, 0.0.0.0:8081-&gt;8080/tcp   client1<br>ee1232c32241        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   About an hour ago   Exited (137) About a minute ago                                      volume-server<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8081/testapp/</span><br>testapp v6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8082/testapp/</span><br>testapp v6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8083/testapp/</span><br>testapp v6<br></code></pre></td></tr></table></figure>

<h4 id="3-3-3-7-删除源卷容器Server，访问client和创建新的client容器"><a href="#3-3-3-7-删除源卷容器Server，访问client和创建新的client容器" class="headerlink" title="3.3.3.7 删除源卷容器Server，访问client和创建新的client容器"></a>3.3.3.7 删除源卷容器Server，访问client和创建新的client容器</h4><p><strong>删除数据卷容器后，旧的client 容器仍能访问，但无法再创建新的client容器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm -fv volume-server</span><br>volume-server<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS                              NAMES<br>7e7f5a688e09        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   About a minute ago   Up About a minute   8009/tcp, 0.0.0.0:8083-&gt;8080/tcp   client3<br>d37d085f54a8        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   About an hour ago    Up About an hour    8009/tcp, 0.0.0.0:8082-&gt;8080/tcp   client2<br>84de5bdf7695        tomcat-web:app1     <span class="hljs-string">&quot;/apps/tomcat/bin/ru…&quot;</span>   About an hour ago    Up About an hour    8009/tcp, 0.0.0.0:8081-&gt;8080/tcp   client1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name client4 --volumes-from volume-server -p 8084:8080 tomcat-web:app1</span><br>Unable to find image <span class="hljs-string">&#x27;tomcat-web:app1&#x27;</span> locally<br>docker: Error response from daemon: pull access denied <span class="hljs-keyword">for</span> tomcat-web,<br>repository does not exist or may require <span class="hljs-string">&#x27;docker login&#x27;</span>: denied: requested<br>access to the resource is denied.<br>See <span class="hljs-string">&#x27;docker run --help&#x27;</span>.<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8081/testapp/</span><br>testapp v6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8082/testapp/</span><br>testapp v6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8083/testapp/</span><br>testapp v6<br></code></pre></td></tr></table></figure>

<h4 id="3-3-3-8-重新创建容器卷-Server"><a href="#3-3-3-8-重新创建容器卷-Server" class="headerlink" title="3.3.3.8 重新创建容器卷 Server"></a>3.3.3.8 重新创建容器卷 Server</h4><p><strong>重新创建容器卷容器后，还可继续创建新client 容器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name volume-server -v /data/bin/catalina.sh:/apps/tomcat/bin/catalina.sh:ro -v /data/testapp:/data/tomcat/webapps/testapp tomcat-web:app1</span><br>ee0dacff6a4531dc8ecc1d416b449e087d8bf27dad2d6a6e515faf10455a1cc0<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name client4 --volumes-from volume-server -p 8084:8080 tomcat-web:app1</span><br>dcd002fe87887a0c5d1f62b24cd7665e42ee864c975d1a2953c383af0cb65a70<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8084/testapp/</span><br>testapp v6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8081/testapp/</span><br>testapp v6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8082/testapp/</span><br>testapp v6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8083/testapp/</span><br>testapp v6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:8084/testapp/</span><br>testapp v6<br></code></pre></td></tr></table></figure>

<h3 id="3-3-4-利用数据卷容器备份指定容器的数据卷实现"><a href="#3-3-4-利用数据卷容器备份指定容器的数据卷实现" class="headerlink" title="3.3.4 利用数据卷容器备份指定容器的数据卷实现"></a>3.3.4 利用数据卷容器备份指定容器的数据卷实现</h3><p>由于匿名数据卷在宿主机中的存储位置不确定,所以为了方便的备份匿名数据卷,可以利用数据卷容器实现数据卷的备份</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker63.png" srcset="/blog/img/loading.gif"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#在执行备份命令容器上执行备份方式</span><br>docker run -it --rm --volumes-from [container name] -v $(<span class="hljs-built_in">pwd</span>):/backup ubuntu<br>root@ca5bb2c1f877:/<span class="hljs-comment">#tar cvf /backup/backup.tar [container data volume]</span><br><br><span class="hljs-comment">#说明</span><br>[container name] <span class="hljs-comment">#表示需要备份的容器</span><br>[container data volume] <span class="hljs-comment">#表示容器内的需要备份的数据卷对应的目录</span><br><br><span class="hljs-comment">#还原方式</span><br>docker run -it --rm --volumes-from [container name] -V $(<span class="hljs-built_in">pwd</span>):/backup ubuntu<br>root@ca5bb2c1f877:/<span class="hljs-comment">#tar xvf /backup/backup.tar -C [container data volume]</span><br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#创建需要备份的数据卷容器</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it -v /datavolume1 --name volume-server centos bash</span><br>[root@7909736788c6 /]<span class="hljs-comment"># ls</span><br>bin  datavolume1  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var<br>[root@7909736788c6 /]<span class="hljs-comment"># touch /datavolume1/centos.txt</span><br>[root@7909736788c6 /]<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES<br><br><span class="hljs-comment">#可以看到数据卷对应的宿主机目录</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect --format=&quot;&#123;&#123;.Mounts&#125;&#125;&quot; volume-server</span><br>[&#123;volume 58600a0daca6b7a8342a24abd30dabd28b3bd6c98d8457ae1462964e49ee5b8d /var/lib/docker/volumes/58600a0daca6b7a8342a24abd30dabd28b3bd6c98d8457ae1462964e49ee5b8d/_data /datavolume1 <span class="hljs-built_in">local</span>  <span class="hljs-literal">true</span> &#125;]<br><br><span class="hljs-comment">#利用数据卷容器创建执行备份操作容器</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --rm --volumes-from volume-server -v ~/backup:/backup --name backup-server ubuntu</span><br>root@7c6106d0caa9:/<span class="hljs-comment"># ls</span><br>backup  boot         dev  home  lib32  libx32  mnt  proc  run   srv  tmp  var<br>bin     datavolume1  etc  lib   lib64  media   opt  root  sbin  sys  usr<br>root@7c6106d0caa9:/<span class="hljs-comment"># ls /backup/</span><br>root@7c6106d0caa9:/<span class="hljs-comment"># ls /datavolume1/</span><br>centos.txt<br>root@7c6106d0caa9:/<span class="hljs-comment"># cd /datavolume1/</span><br>root@7c6106d0caa9:/datavolume1<span class="hljs-comment"># tar cvf /backup/data.tar .</span><br>./<br>./centos.txt<br>root@7c6106d0caa9:/datavolume1<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls ~/backup/</span><br>data.tar<br><br><span class="hljs-comment">#删除容器的数据</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker start -i volume-server</span><br>[root@7909736788c6 /]<span class="hljs-comment"># rm -rf /datavolume1/*</span><br>[root@7909736788c6 /]<span class="hljs-comment"># ls /datavolume1/</span><br>[root@7909736788c6 /]<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br><br><span class="hljs-comment">#进行还原</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run --rm --volumes-from volume-server -v ~/backup:/backup --name backup-server ubuntu tar xvf /backup/data.tar -C /datavolume1/</span><br>./<br>./centos.txt<br><br><span class="hljs-comment">#验证是否还原</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker start -i volume-server</span><br>[root@88bbc22a3072 /]<span class="hljs-comment"># ls /datavolume1/</span><br>centos.txt<br><br><span class="hljs-comment">#总结：</span><br>1.volume-server 是需要备份的容器卷的名字，<br>2./datavolume1 是容器卷里的文件夹<br>3.centos.txt 是文件夹里的文件<br>4./backup:/backup 是存储备份文件的文件夹<br>5.使用百度云盘来做一个类比<br>5.1 叫volume-server的百度云盘存放着/datavolume1的文件夹和centos.txt的文件，由于某种原因里面的文件会被删除，所以就将centos.txt文件下载保存到本地计算机名叫/backup的文件夹里。等以后在再将此文件上传到百度云盘里<br></code></pre></td></tr></table></figure>

<h3 id="3-3-5-数据卷容器总结"><a href="#3-3-5-数据卷容器总结" class="headerlink" title="3.3.5 数据卷容器总结"></a>3.3.5 数据卷容器总结</h3><p>将提供卷的容器Server 删除，已经运行的容器Client依然可以使用挂载的卷，因为容器是通过挂载访问数据的，但是无法创建新的卷容器客户端，但是再把卷容器Server创建后即可正常创建卷容器Client，此方式可以用于线上共享数据目录等环境，因为即使数据卷容器被删除了，其他已经运行的容器依然可以挂载使用</p>
<p>由此可知, 数据卷容器的功能只是将数据挂载信息传递给了其它使用数据卷容器的容器,而数据卷容器本身并不提供数据存储功能</p>
<p>数据卷容器可以作为共享的方式为其他容器提供文件共享，类似于NFS共享，可以在生产中启动一个实例挂载本地的目录，然后其他的容器分别挂载此容器的目录，即可保证各容器之间的数据一致性</p>
<p>数据卷容器的 Server 和 Client 可以不使用同一个镜像生成</p>
<p><strong>数据卷容器类似一个数据库</strong></p>
<p>挂载数据卷的容器，因为权限问题导致容器里的用户没权限访问，可以在宿主机里将挂载的目录所属修改为容器里的用户的uid和gid</p>
<p>比如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">容器用户</span><br>groupadd -g 2022 rlin<br>useradd -g rlin -u 2022 rlin<br><span class="hljs-meta">#</span><span class="bash">宿主机</span><br>chown -R 2022.2022 /data/tomcat<br></code></pre></td></tr></table></figure>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/linux-docker/">linux docker</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2021/09/02/%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AFdocker%EF%BC%88%E4%B8%83%EF%BC%89docker%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">企业级容器技术docker（七）docker资源限制</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2021/09/02/%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AFdocker%EF%BC%88%E5%9B%9B%EF%BC%89docker%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86/">
                        <span class="hidden-mobile">企业级容器技术docker（四）docker网络管理</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/blog/js/debouncer.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/blog/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/blog/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/blog/js/boot.js" ></script>



</body>
</html>
