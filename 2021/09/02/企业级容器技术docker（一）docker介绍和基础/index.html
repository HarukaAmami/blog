

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="rlin">
  <meta name="keywords" content="">
  <title>企业级容器技术docker（一）docker介绍和基础 - rlin的运维笔记</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/blog/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/blog/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"rintime.gitee.io","root":"/blog/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>rlin的运维笔记</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="企业级容器技术docker（一）docker介绍和基础">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-09-02 14:26" pubdate>
        2021年9月2日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      54k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      915
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">企业级容器技术docker（一）docker介绍和基础</h1>
            
            <div class="markdown-body">
              <h1 id="企业级容器技术docker"><a href="#企业级容器技术docker" class="headerlink" title="企业级容器技术docker"></a>企业级容器技术docker</h1><h1 id="一、Docker-介绍和基础操作"><a href="#一、Docker-介绍和基础操作" class="headerlink" title="一、Docker 介绍和基础操作"></a>一、Docker 介绍和基础操作</h1><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker1.png" srcset="/blog/img/loading.gif"></p>
<p>Container 即容器，平时生活中指的是可以装下其它物品的工具， 以方便人类归纳放置物品 、存储和异地运输 ，比如人类使用的衣柜 、行李箱、 背包等可以成为容器，Container 除了容器以外，另一个意思是集装箱, 很多码头工人将很多装有不同物品但却整齐划一的箱子装载到停靠在岸边大船，然后方便的运来运去。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker2.png" srcset="/blog/img/loading.gif"></p>
<p>为什么这些集装箱可以很方便的运来运去呢？因为它们大小一致标准化尺寸的箱子，并且可以安全的隔离开,所以当我们使用 Container 来形容容器的时候，就是我们想要让容器达到一个可以打包，符合标准的状态。</p>
<p><strong>集装箱标准尺寸重量</strong></p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">大小</th>
<th align="center">内长m</th>
<th align="center">内宽m</th>
<th align="center">内高m</th>
<th align="center">门高m</th>
<th align="center">门宽m</th>
<th align="center">容积m³</th>
<th align="center">载重T</th>
<th align="center">皮重T</th>
</tr>
</thead>
<tbody><tr>
<td align="center">普通箱</td>
<td align="center">20GP</td>
<td align="center">5.898</td>
<td align="center">2.352</td>
<td align="center">2.385</td>
<td align="center">2.280</td>
<td align="center">2.343</td>
<td align="center">28.00</td>
<td align="center">18</td>
<td align="center">2.3</td>
</tr>
<tr>
<td align="center">普通箱</td>
<td align="center">40GP</td>
<td align="center">12.032</td>
<td align="center">2.352</td>
<td align="center">2.385</td>
<td align="center">2.280</td>
<td align="center">2.343</td>
<td align="center">57.00</td>
<td align="center">28</td>
<td align="center">3.4</td>
</tr>
<tr>
<td align="center">高箱</td>
<td align="center">40HC</td>
<td align="center">12.032</td>
<td align="center">352</td>
<td align="center">2.690</td>
<td align="center">2.585</td>
<td align="center">2.343</td>
<td align="center">67.00</td>
<td align="center">28</td>
<td align="center">4.0</td>
</tr>
</tbody></table>
<p>但今天我们所说的容器是一种 IT 技术。容器其实是一种沙盒技术。顾名思义，沙盒就是能够像一个集装箱一样，把你的应用装起来。这样，应用与应用之间就有了边界而不会相互干扰;同时装在沙盒里面的应用，也可以很方便的被搬来搬去，这也是 PaaS 想要的最理想的状态**(可移植性,标准化,隔离性)**。</p>
<p>容器是软件工业上的集装箱的技术，集装箱的标准化，减少了包装成本，大大提高货物运输和装卸效率，是传统运输行业的重大变革。早期的软件项目中软件更新，发布低效，开发测试发布周期很长，很难敏捷。有了容器技术，就可以利用其标准化的特点，大幅提高生产效率。</p>
<p>容器技术是虚拟化、云计算、大数据之后的一门新兴的并且是炙手可热的新技术， 容器技术提高了硬件资源利用率、 方便了企业的业务快速横向扩容（可以达到秒级快速扩容）、 实现了业务宕机自愈功能（配合K8S可以实现，但OpenStack无此功能），因此未来数年会是一个容器愈发流行的时代 ，这是一个对于 IT 行业来说非常有影响和价值的技术，而对于IT行业的从业者来说， 熟练掌握容器技术无疑是一个很有前景的行业工作机会。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker3.png" srcset="/blog/img/loading.gif"></p>
<h2 id="1-1-Docker-介绍"><a href="#1-1-Docker-介绍" class="headerlink" title="1.1 Docker 介绍"></a>1.1 Docker 介绍</h2><h3 id="1-1-1-容器历史"><a href="#1-1-1-容器历史" class="headerlink" title="1.1.1 容器历史"></a>1.1.1 容器历史</h3><p>虽然 docker 把容器技术推向了巅峰，但容器技术却不是从 docker 诞生的。实际上，容器技术连新技术都算不上，因为它的诞生和使用确实有些年头了。下面的一串名称可能有的你都没有听说过，但它们的确都是容器技术的应用:</p>
<p>1、Chroot Jail<br>就是我们常见的 chroot 命令的用法。它在 1979 年的时候就出现了，被认为是最早的容器化技术之一。它可以把一个进程的文件系统隔离起来。</p>
<p>2、The FreeBSD Jail<br>Freebsd Jail (监狱)实现了操作系统级别的虚拟化，它是操作系统级别虚拟化技术的先驱之一。2000年，伴随FreeBSD4.0版的发布</p>
<p>3、Linux VServer<br>使用添加到 Linux 内核的系统级别的虚拟化功能实现的专用虚拟服务器。允许创建许多独立的虚拟专用服务器（VPS），这些虚拟专用服务器在单个物理服务器上全速同时运行，从而有效地共享硬件资源。VPS提供与传统Linux服务器几乎相同的操作环境。可以在这样的VPS上启动所有服务（例如ssh，邮件，Web和数据库服务器），而无需（或者在特殊情况下只需进行很少的修改），就像在任何真实服务器上一样。</p>
<p>每个VPS都有自己的用户帐户数据库和root密码，并且与其他虚拟服务器隔离，但它们共享相同的硬件资源</p>
<p>2003年11月1日 VServer 1.0 发布</p>
<p>官网:<a target="_blank" rel="noopener" href="http://linux-vserver.org/">http://linux-vserver.org/</a></p>
<p>4、Solaris Containers<br>它也是操作系统级别的虚拟化技术，专为 X86 和 SPARC 系统设计。Solaris 容器是系统资源控制和通过”区域” 提供边界隔离的组合。</p>
<p>5、OpenVZ<br>OpenVZ 是一种 Linux 中操作系统级别的虚拟化技术。 它允许创建多个安全隔离的 Linux 容器，即<br>VPS。</p>
<p>6、Process Containers<br>Process 容器由 Google 的工程师开发，一般被称为 cgroups。</p>
<p>7、LXC<br>LXC为Linux Container的简写。可以提供轻量级的虚拟化，以便隔离进程和资源，而且不需要提供指令解释机制以及全虚拟化的其他复杂性。容器有效地将由单个操作系统管理的资源划分到孤立的组中，以更好地在孤立的组之间平衡有冲突的资源使用需求Linux Container提供了在单一可控主机节点上支持多个相互隔离的server container同时执行的机制。Linux Container有点像chroot，提供了一个拥有自己进程和网络空间的虚拟环境，但又有别于虚拟机，因为lxc是一种操作系统层次上的资源的虚拟化。</p>
<p>8、Warden<br>在最初阶段，Warden 使用 LXC 作为容器运行时。 如今已被 CloudFoundy 取代。</p>
<p>9、LMCTFY<br>LMCTY 是 Let me contain that for you 的缩写。它是 Google 的容器技术栈的开源版本。Google 的工程师一直在与 docker 的 libertainer 团队合作，并将 libertainer 的核心概念进行抽象并移植到此项目中。该项目的进展不明，估计会被 libcontainer 取代。</p>
<p>10、Docker<br>Docker 是一个可以将应用程序及其依赖打包到几乎可以在任何服务器上运行的容器的工具。</p>
<p>11、RKT<br>RKT 是 Rocket 的缩写，它是一个专注于安全和开放标准的应用程序容器引擎。</p>
<p>综上所述正如我们所看到的，docker 并不是第一个容器化技术，但它的确是最知名的一个。</p>
<h3 id="1-1-2-Docker-是什么"><a href="#1-1-2-Docker-是什么" class="headerlink" title="1.1.2 Docker 是什么"></a>1.1.2 Docker 是什么</h3><p>Docker （码头工人）是一个开源项目，诞生于 2013 年初，最初是 dotCloud 公司（后由于 Docker 开源后大受欢迎就将公司改名为 Docker Inc ，总部位于美国加州的旧金山）内部的一个开源的 PAAS 服务 (Platform as a ServiceService )的业余项目。它基于 Google 公司推出的 Go 语言实现。 项目后来加入了 Linux 基金会，遵从了 Apache 2.0 协议，项目代码在 GitHub 上进行维护。</p>
<p>Docker 是基于 linux 内核实现，Docker 最早采用 LXC 技术 ，LXC 是 Linux 原生支持的容器技术 ，可以提供轻量级的虚拟化 ，可以说 docker 就是基于 LXC 发展起来 的，提供 LXC 的高级封装，标准的配置方法，在LXC的基础之上，docker提供了一系列更强大的功能。而虚拟化技术 KVM(KernelKernel-based Virtual Machine Machine) 基于 模块实现， 后来Docker 改为自己研发并开源的 runc 技术运行容器，彻底抛弃了LXC。</p>
<p>Docker 相比虚拟机的交付速度更快，资源消耗更低，Docker 采用客户端/服务端架构，使用远程API来管理和创建容器，其可以轻松的创建一个轻量级的、可移植的、自给自足的容器，docker 的三大理念是build(构建)、ship(运输)、 run(运行)，Docker遵从apache 2.0协议，并通过（namespace及cgroup等）来提供容器的资源隔离与安全保障等，所以Docke容器在运行时不需要类似虚拟机（空运行的虚拟机占用物理机6-8%性能）的额外资源开销，因此可以大幅提高资源利用率,总而言之Docker是一种用了新颖方式实现的轻量级虚拟机.类似于VM但是在原理和应用上和VM的差别还是很大的，并且docker的专业叫法是应用容器(Application Container)。</p>
<p><strong>Docker的主要目标</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker4.png" srcset="/blog/img/loading.gif"></p>
<p>Build, Ship and Run Any App, Anywhere，即通过对应用组件的封装（Packaging）、分发（Distribution）、部署（Deployment）、运行（Runtime）等生命周期的管理，达到应用组件级别的“一次封装，到处运行”。这里的应用组件，既可以是一个Web应用，也可以是一套数据库服务，甚至是一个操作系统。将应用运行在Docker 容器上，可以实现跨平台，跨服务器，只需一次配置准备好相关的应用环境，即可实现到处运行，保证研发和生产环境的一致性，解决了应用和运行环境的兼容性问题，从而极大提升了部署效率，减少故障的可能性</p>
<p><strong>使用Docker 容器化封装应用程序的意义:</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker5.png" srcset="/blog/img/loading.gif"></p>
<ul>
<li>统一基础设施环境-docker环境<ul>
<li>硬件的组成配置</li>
<li>操作系统的版本</li>
<li>运行时环境的异构</li>
</ul>
</li>
<li>统一程序打包（装箱）方式-docker镜像<ul>
<li>java程序</li>
<li>python程序</li>
<li>nodejs程序</li>
</ul>
</li>
<li>统一程序部署（运行）方式-docker容器<ul>
<li>java-jar…→ docker run…</li>
<li>python manage.py runserver… → docker run…</li>
<li>npm run dev … → docker run…</li>
</ul>
</li>
</ul>
<h3 id="1-1-3-Docker-和虚拟机，物理主机"><a href="#1-1-3-Docker-和虚拟机，物理主机" class="headerlink" title="1.1.3 Docker 和虚拟机，物理主机"></a>1.1.3 Docker 和虚拟机，物理主机</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker6.png" srcset="/blog/img/loading.gif"></p>
<p><strong>容器和虚拟机技术比较</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker7.png" srcset="/blog/img/loading.gif"></p>
<ul>
<li>传统虚拟机是虚拟出一个主机硬件，并且运行一个完整的操作系统 ，然后在这个系统上安装和运行软件</li>
<li>容器内的应用直接运行在宿主机的内核之上，容器并没有自己的内核，也不需要虚拟硬件，相当轻量化</li>
<li>每个容器间是互相隔离，每个容器内都有一个属于自己的独立文件系统，独立的进程空间，网络空间，用户空间等，所以在同一个宿主机上的多个容器之间彼此不会相互影响</li>
</ul>
<p><strong>容器和虚拟机表现比较</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker8.png" srcset="/blog/img/loading.gif"></p>
<ul>
<li><p>资源利用率更高: 开销更小，不需要启动单独的虚拟机OS内核占用硬件资源，可以将服务器性能压榨至极致.虚拟机一般会有5-20%的损耗，容器运行基本无损耗，所以生产中一台物理机只能运行数十个虚拟机，但是一般可以运行数百个容器</p>
</li>
<li><p>启动速度更快: 可以在数秒内完成启动</p>
<p>容器&gt;虚拟机&gt;物理机（启动速度，从快到慢排序）</p>
</li>
<li><p>占用空间更小: 容器一般占用的磁盘空间以MB为单位,而虚拟机以GB</p>
</li>
<li><p>集成性更好: 和CI/CD（持续集成/持续部署）相关技术结合性更好，实现打包镜像发布测试可以一键运行，做到自动化并快速的部署管理,实现高效的开发生命周期</p>
</li>
</ul>
<p>使用虚拟机是为了更好的实现服务运行环境隔离，每个虚拟机都有独立的内核，虚拟化可以实现不同操作系统的虚拟机，但是通常一个虚拟机只运行一个服务，很明显资源利用率比较低且造成不必要的性能损耗，我们创建虚拟机的目的是为了运行应用程序，比如Nginx、PHP、Tomcat等web程序，使用虚拟机无疑带来了一些不必要的资源开销，但是容器技术则基于减少中间运行环节带来较大的性能提升。</p>
<p>相比于虚拟机的隔离性，容器的隔离性没有像虚拟机那样那么测地，因为容器的隔离性是通过<code>Namespave</code>来实现的。但是我们也不需要那么彻底的隔离。</p>
<p>根据实验，一个运行着CentOS的KVM虚拟机启动后，在不做优化的情况下，虚拟机自己就需要占用100~200 MB内存。此外，用户应用运行在虚拟机里面，它对宿主机操作系统的调用就不可避免地要经过虚拟化软件的拦截和处理，这本身又是一层性能损耗，尤其对计算资源、网络和磁盘I/O的损耗非常大。</p>
<p>比如: 一台96G内存的物理服务器，为了运行java程序的虚拟机一般需要分配8G内存/4核的资源，只能运行13台左右虚拟机，但是改为在docker容器上运行Java程序，每个容器只需要分配4G内存即可，同样的物理服务器就可以运行25个左右容器，运行数量相当于提高一倍，可以大幅节省IT支出，通常情况下至少可节约一半以上的物理设备</p>
<h3 id="1-1-4-Docker-的组成"><a href="#1-1-4-Docker-的组成" class="headerlink" title="1.1.4 Docker 的组成"></a>1.1.4 Docker 的组成</h3><p>docker 官网: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://www.docker.com<br></code></pre></td></tr></table></figure>

<p>帮助文档链接: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://docs.docker.com/<br></code></pre></td></tr></table></figure>

<p>docker 镜像: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://hub.docker.com/<br></code></pre></td></tr></table></figure>

<p>docker 中文网站: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://www.docker.org.cn/<br></code></pre></td></tr></table></figure>



<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker9.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker10.png" srcset="/blog/img/loading.gif"></p>
<ul>
<li>Docker 主机(Host): 一个物理机或虚拟机，用于运行Docker服务进程和容器，也称为宿主机，node节点</li>
<li>Docker 服务端(Server): Docker守护进程，运行docker容器Docker 客户端(Client): 客户端使用 docker 命令或其他工具调用docker API</li>
<li>Docker 镜像(Images): 镜像可以理解为创建实例使用的模板,本质上就是一些程序文件的集合</li>
<li>Docker 仓库(Registry): 保存镜像的仓库，官方仓库: <code>https://hub.docker.com/</code>，可以搭建私有仓库harbor</li>
<li>Docker 容器(Container): 容器是从镜像生成对外提供服务的一个或一组服务,其本质就是将镜像中的程序启动后生成的进程（真正运行的）</li>
</ul>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker11.png" srcset="/blog/img/loading.gif"></p>
<h3 id="1-1-5-Namespace"><a href="#1-1-5-Namespace" class="headerlink" title="1.1.5 Namespace"></a>1.1.5 Namespace</h3><p>一个宿主机运行了N个容器，多个容器共用一个 OS，必然带来的以下问题:</p>
<ul>
<li>怎么样保证每个容器都有不同的文件系统并且能互不影响？</li>
<li>一个docker主进程内的各个容器都是其子进程，那么如果实现同一个主进程下不同类型的子进程？各个容器子进程间能相互通信(内存数据)吗？</li>
<li>每个容器怎么解决IP及端口分配的问题？</li>
<li>多个容器的主机名能一样吗？</li>
<li>每个容器都要不要有root用户？怎么解决账户重名问题？</li>
</ul>
<p>Namespace是Linux系统的底层概念，在内核层实现，即有一些不同类型的命名空间被部署在核内，各个docker容器运行在同一个docker主进程并且共用同一个宿主机系统内核，各docker容器运行在宿主机的用户空间，每个容器都要有类似于虚拟机一样的相互隔离的运行空间，但是容器技术是在一个进程内实现运行指定服务的运行环境，并且还可以保护宿主机内核不受其他进程的干扰和影响，如文件系统空间、网络空间、进程空间等，目前主要通过以下技术实现容器运行空间的相互隔离。</p>
<p><strong>注意：Namespace实现的是资源隔离</strong></p>
<table>
<thead>
<tr>
<th align="center">隔离类型</th>
<th align="center">功能</th>
<th align="center">系统调用参数</th>
<th align="center">内核</th>
</tr>
</thead>
<tbody><tr>
<td align="center">MNT Namespace(mount)</td>
<td align="center">提供磁盘挂载点和文件系统的隔离能力</td>
<td align="center">CLONE_NEWNS</td>
<td align="center">2.4.19</td>
</tr>
<tr>
<td align="center">IPC Namespace(Inter-Process Communication)</td>
<td align="center">提供进程间通信的隔离能力,包括信号量,消息队列和共享内存</td>
<td align="center">CLONE_NEWIPC</td>
<td align="center">2.6.19</td>
</tr>
<tr>
<td align="center">UTS Namespace(UNIXTimesharing System)</td>
<td align="center">提供内核,主机名和域名隔离能力</td>
<td align="center">CLONE_NEWUTS</td>
<td align="center">2.6.19</td>
</tr>
<tr>
<td align="center">PID Namespace(ProcessIdentification)</td>
<td align="center">提供进程隔离能力</td>
<td align="center">CLONE_NEWPID</td>
<td align="center">2.6.24</td>
</tr>
<tr>
<td align="center">Net Namespace(network)</td>
<td align="center">提供网络隔离能力,包括网络设备,网络栈,端口等</td>
<td align="center">CLONE_NEWNET</td>
<td align="center">2.6.29</td>
</tr>
<tr>
<td align="center">User Namespace(user)</td>
<td align="center">提供用户隔离能力,包括用户和组</td>
<td align="center">CLONE_NEWUSER</td>
<td align="center">3.8</td>
</tr>
</tbody></table>
<p><strong>建议安装docker的系统需要在内核3.10以上，比如CentOS 7</strong></p>
<h4 id="1-1-5-1-MNT-Namespace"><a href="#1-1-5-1-MNT-Namespace" class="headerlink" title="1.1.5.1 MNT Namespace"></a>1.1.5.1 MNT Namespace</h4><p>每个容器都要有独立的根文件系统有独立的用户空间，以实现在容器里面启动服务并且使用容器的运行环境，即一个宿主机是ubuntu的服务器，可以在里面启动一个centos运行环境的容器并且在容器里面启动一个Nginx服务，此Nginx运行时使用的运行环境就是centos系统目录的运行环境，但是在容器里面是不能访问宿主机的资源，宿主机是使用了chroot技术把容器锁定到一个指定的运行目录里面。</p>
<p>例如:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/containerd/i</span>o.containerd.<span class="hljs-keyword">runtime</span>.v1.linux<span class="hljs-regexp">/moby/</span>容器ID<br></code></pre></td></tr></table></figure>

<p>根目录:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/docker/</span>overlay2/ID<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#启动三个容器用于以下验证过程: </span><br><span class="hljs-comment"># docker version</span><br>Client: Docker Engine - Community<br>Version:      19.03.5<br>API version:    1.40<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:       Wed Nov 13 07:29:52 2019<br>OS/Arch:      linux/amd64<br>Experimental:    <span class="hljs-literal">false</span><br><br>Server: Docker Engine - Community<br>Engine:<br>Version:      19.03.5<br>API version:    1.40 (minimum version 1.12)<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:      Wed Nov 13 07:28:22 2019<br>OS/Arch:     linux/amd64<br>Experimental:   <span class="hljs-literal">false</span><br>containerd:<br>Version:      1.2.10<br>GitCommit:    b34a5c8af56e510852c35414db4c1f4fa6172339<br>runc:<br>Version:      1.0.0-rc8+dev<br>GitCommit:    3e425f80a8c931f88e6d94a8c831b9d5aa481657<br>docker-init:<br>Version:      0.18.0<br>GitCommit:    fec3683<br><br><span class="hljs-comment"># docker run -d --name nginx-1 -p 80:80 nginx</span><br><span class="hljs-comment"># docker run -d --name nginx-2 -p 81:80 nginx</span><br><span class="hljs-comment"># docker run -d --name nginx-3 -p 82:80 nginx</span><br></code></pre></td></tr></table></figure>

<p>范例: 查看存储</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                NAMES<br>2b254319376b   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   7 seconds ago    Up 5 seconds    0.0.0.0:82-&gt;80/tcp   nginx-3<br>a7a46e9f0ced   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   11 seconds ago   Up 10 seconds   0.0.0.0:81-&gt;80/tcp   nginx-2<br>5bc77e6e9a9d   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   19 seconds ago   Up 14 seconds   0.0.0.0:80-&gt;80/tcp   nginx-1<br><span class="hljs-comment"># ls /var/lib/containerd/io.containerd.runtime.v1.linux/moby/</span><br>2b254319376bf28685aa849a16c569ac084da9b1a73f748d247c8ab7a51df1e7  a7a46e9f0cedac9d07ae4e15af82be5fe84768e0e182b67ed7b742cc2ce22281<br>5bc77e6e9a9d276c028523c2dd2c1d345cd6acd7de7ddc511026f94c9a2f70e7<br><span class="hljs-comment"># ls /var/lib/docker/overlay2/4679eaff510e46a1919e845c5821454aeff2218b2f89f96719178758c59bfd40/merged/</span><br>bin   dev                  docker-entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  var<br>boot  docker-entrypoint.d  etc                   lib   media  opt  root  sbin  sys  usr<br></code></pre></td></tr></table></figure>

<p>范例: 验证容器的根文件系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos8 ~]<span class="hljs-comment"># podman exec nginx cat /etc/issue</span><br>Debian GNU/Linux 9 \n \l<br>[root@centos8 ~]<span class="hljs-comment"># podman exec nginx ls /</span><br>bin<br>boot<br>data<br>dev<br>etc<br>home<br>lib<br>lib64<br>media<br>mnt<br>opt<br>proc<br>root<br>run<br>sbin<br>srv<br>sys<br>tmp<br>usr<br>var<br></code></pre></td></tr></table></figure>

<p>范例: 容器和宿主机共享内核</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos8 ~]<span class="hljs-comment"># podman exec nginx uname -r</span><br>4.18.0-147.el8.x86_64<br>[root@centos8 ~]<span class="hljs-comment"># uname -r</span><br>4.18.0-147.el8.x86_64<br></code></pre></td></tr></table></figure>

<h4 id="1-1-5-2-IPC-Namespace"><a href="#1-1-5-2-IPC-Namespace" class="headerlink" title="1.1.5.2 IPC Namespace"></a>1.1.5.2 IPC Namespace</h4><p>一个容器内的进程间通信，允许一个容器内的不同进程的(内存、缓存等)数据访问，但是不能跨容器直接访问其他容器的数据</p>
<h4 id="1-1-5-3-UTS-Namespace"><a href="#1-1-5-3-UTS-Namespace" class="headerlink" title="1.1.5.3 UTS Namespace"></a>1.1.5.3 UTS Namespace</h4><p>UTS namespace（UNIX Timesharing System包含了运行内核的名称、版本、底层体系结构类型等信息）用于系统标识，其中包含了主机名hostname 和域名domainname ，它使得一个容器拥有属于自己主机名标识，这个主机名标识独立于宿主机系统和其上的其他容器。<br>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># docker pull centos:centos8.1.1911</span><br><span class="hljs-comment"># docker run -it centos:centos8.1.1911</span><br><span class="hljs-comment"># docker ps -a</span><br>CCONTAINER ID   IMAGE                   COMMAND                  CREATED          STATUS          PORTS          NAMES<br>17ff44b1dbff    centos:centos8.1.1911   <span class="hljs-string">&quot;/bin/bash&quot;</span>              26 seconds ago   Up 25 seconds                  goofy_engelbart<br><span class="hljs-comment"># docker exec -it 17ff44b1dbff sh</span><br>sh-4.4<span class="hljs-comment"># hostname</span><br>17ff44b1dbff<br><br>sh-4.4<span class="hljs-comment"># cat /etc/hosts</span><br>127.0.0.1 localhost<br>::1 localhost ip6-localhost ip6-loopback<br>fe00::0 ip6-localnet<br>ff00::0 ip6-mcastprefix<br>ff02::1 ip6-allnodes<br>ff02::2 ip6-allrouters<br>172.17.0.2 17ff44b1dbff<br><br>sh-4.4<span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br> inet 127.0.0.1/8 scope host lo<br>   valid_lft forever preferred_lft forever<br>60: eth0@if61: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default<br> link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0<br> inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0<br> alid_lft forever preferred_lft forever<br><br>sh-4.4<span class="hljs-comment"># uname -r</span><br>4.15.0-29-generic<br><br>sh-4.4<span class="hljs-comment"># free -h</span><br>      total    used    free   shared buff/cache  available<br>Mem:     962Mi    268Mi    81Mi    1.0Mi    612Mi    522Mi<br>Swap:     1.9Gi    17Mi    1.8Gi<br><br>sh-4.4<span class="hljs-comment"># lscpu</span><br>Architecture:    x86_64<br>CPU op-mode(s):    32-bit, 64-bit<br>Byte Order:     Little Endian<br>CPU(s):        1<br>On-line CPU(s) list: 0<br>Thread(s) per core:  1<br>Core(s) per socket:  1<br>Socket(s):      1<br>NUMA node(s):     1<br>Vendor ID:      GenuineIntel<br>CPU family:      6<br>Model:        60<br>Model name:     Intel(R) Core(TM) i7-4710HQ CPU @ 2.50GHz<br>Stepping:       3<br>CPU MHz:       2494.237<br>BogoMIPS:       4988.47<br>Hypervisor vendor:  VMware<br>Virtualization <span class="hljs-built_in">type</span>: full<br>L1d cache:      32K<br>L1i cache:      32K<br>L2 cache:      256K<br>L3 cache:      6144K<br>NUMA node0 CPU(s):  0<br>Flags:        fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca<br>cmov pat pse36 clflush mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm<br>constant_tsc arch_perfmon nopl xtopology tsc_reliable nonstop_tsc cpuid pni<br>pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt<br>tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm cpuid_fault<br>invpcid_single pti ssbd ibrs ibpb stibp fsgsbase tsc_adjust bmi1 avx2 smep bmi2<br>invpcid xsaveopt arat arch_capabilities<br><br>sh-4.4<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br><br><span class="hljs-comment"># uname -r</span><br>4.15.0-29-generic<br></code></pre></td></tr></table></figure>

<h4 id="1-1-5-4-PID-Namespace"><a href="#1-1-5-4-PID-Namespace" class="headerlink" title="1.1.5.4 PID Namespace"></a>1.1.5.4 PID Namespace</h4><p>Linux系统中，有一个PID为1的进程(init/systemd)是其他所有进程的父进程，那么在每个容器内也要有一个父进程来管理其下属的子进程，那么多个容器的进程通PID namespace进程隔离(比如PID编号重复、器内的主进程生成与回收子进程等)。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker12.png" srcset="/blog/img/loading.gif"></p>
<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"> <span class="hljs-comment">#docker exec -it 17ff44b1dbff sh</span><br>sh-4.4<span class="hljs-comment"># ping 127.0.0.1</span><br>PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.<br>64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.061 ms<br>64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.039 ms<br>64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.049 ms<br>64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.051 ms<br>64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.050 ms<br>64 bytes from 127.0.0.1: icmp_seq=6 ttl=64 time=0.051 ms<br>^Z<br>[1]+ Stopped(SIGTSTP)     ping 127.0.0.1<br>sh-4.4<span class="hljs-comment"># ps aux</span><br>USER    PID %CPU %MEM  VSZ  RSS TTY   STAT START  TIME COMMAND<br>root      1  0.0  0.3  12024  3172 pts/0  Ss+  10:41  0:00 /bin/bash<br>root     46  1.2  0.3  12024  3228 pts/1  Ss  11:24  0:00 sh<br>root     51  0.0  0.2  29460  2280 pts/1  T   11:24  0:00 ping 127.0.0.1<br>root     52  0.0  0.3  43960  3332 pts/1  R+  11:24  0:00 ps aux<br>sh-4.4<span class="hljs-comment">#</span><br><br><span class="hljs-comment"># pstree -p</span><br>systemd(1)─┬─VGAuthService(816)<br>     ├─accounts-daemon(819)─┬─&#123;accounts-daemon&#125;(828)<br>     │           └─&#123;accounts-daemon&#125;(839)<br>     ├─agetty(887)<br>     ├─atd(807)<br>     ├─blkmapd(512)<br>     ├─containerd(3371)─┬─containerd-shim(12233)─┬─bash(12259)<br>     │         │            ├─sh(13359)───ping(13395)<br>     │         │            ├─&#123;containerd-shim&#125;<br>(12234)<br></code></pre></td></tr></table></figure>

<p>例如: 下图是在一个容器内使用top命令看到的PID为1的进程是nginx: :</p>
<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker13.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<p>容器内的Nginx主进程与工作进程:</p>
<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker14.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<p>那么宿主机的PID究竟与容器内的PID是什么关系？</p>
<p>范例: 查看宿主机上的PID信息</p>
<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker15.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<h4 id="1-1-5-5-NET-Namespace"><a href="#1-1-5-5-NET-Namespace" class="headerlink" title="1.1.5.5 NET Namespace"></a>1.1.5.5 NET Namespace</h4><p>每一个容器都类似于虚拟机一样有自己的网卡、监听端口、TCP/IP协议栈等，</p>
<p>Docker使用network namespace启动一个vethX接口，这样你的容器将拥有它自己的桥接ip地址，通常是docker0，而docker0实质就是Linux的虚拟网桥,网桥是在OSI七层模型的数据链路层的网络设备，通过mac地址对网络进行划分，并且在不同网络直接传递数据。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker16.png" srcset="/blog/img/loading.gif"></p>
<p><strong>查看宿主机的网卡信息:</strong></p>
<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker17.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<p><strong>查看宿主机桥接设备:</strong><br>通过brctl show命令查看桥接设备:</p>
<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker18.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker19.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<p><strong>逻辑网络图:</strong></p>
<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker20.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<p><strong>宿主机iptables规则:</strong></p>
<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker21.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker22.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED      STATUS       PORTS        NAMES<br><span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group<br>default qlen 1000<br> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br> inet 127.0.0.1/8 scope host lo<br>   valid_lft forever preferred_lft forever<br> inet6 ::1/128 scope host<br>   valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP<br>group default qlen 1000<br> link/ether 00:0c:29:34:df:91 brd ff:ff:ff:ff:ff:ff<br> inet 10.0.0.100/24 brd 10.0.0.255 scope global eth0<br>   valid_lft forever preferred_lft forever<br> inet6 fe80::20c:29ff:fe34:df91/64 scope link<br>   valid_lft forever preferred_lft forever<br>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state<br>DOWN group default<br> link/ether 02:42:9c:90:17:99 brd ff:ff:ff:ff:ff:ff<br> inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0<br>   valid_lft forever preferred_lft forever<br> inet6 fe80::42:9cff:fe90:1799/64 scope link<br>   valid_lft forever preferred_lft forever<br><br><span class="hljs-comment"># docker run -itd -p 8888:80 nginx</span><br>d9d89e9fad9b4a61a5e82f8afc060d93a8a0342fd50dc56e8cf6a0d2843d35a6<br><br><span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    link/ether 00:0c:29:5d:69:8a brd ff:ff:ff:ff:ff:ff<br>    inet 10.0.0.101/16 brd 10.0.255.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::20c:29ff:fe5d:698a/64 scope link <br>       valid_lft forever preferred_lft forever<br>3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default <br>    link/ether 02:42:fe:84:0b:fe brd ff:ff:ff:ff:ff:ff<br>    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::42:feff:fe84:bfe/64 scope link <br>       valid_lft forever preferred_lft forever<br>15: vethf6337ca@if14: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default <br>    link/ether 2a:b5:a1:4e:4d:32 brd ff:ff:ff:ff:ff:ff link-netnsid 0<br>    inet6 fe80::28b5:a1ff:fe4e:4d32/64 scope link <br>       valid_lft forever preferred_lft forever<br><br><span class="hljs-comment"># docker exec -it d9d89e9fad9b bash</span><br><br>root@5dee9be9afdb:/<span class="hljs-comment"># apt update</span><br>Get:1 http://deb.debian.org/debian bullseye InRelease [116 kB]<br>Get:2 http://deb.debian.org/debian-security bullseye-security InRelease [48.4 kB]<br>Get:3 http://deb.debian.org/debian bullseye-updates InRelease [44.1 kB]<br>Get:4 http://deb.debian.org/debian bullseye/main amd64 Packages [8184 kB]<br>Get:5 http://deb.debian.org/debian-security bullseye-security/main amd64 Packages [210 kB]                                            <br>Get:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [14.6 kB]                                                     <br>Fetched 8616 kB <span class="hljs-keyword">in</span> 23s (377 kB/s)                                                                                                     <br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>All packages are up to date.<br><br>root@5dee9be9afdb:/<span class="hljs-comment"># apt install net-tools</span><br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following NEW packages will be installed:<br>  net-tools<br>0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.<br>Need to get 250 kB of archives.<br>After this operation, 1015 kB of additional disk space will be used.<br>Get:1 http://deb.debian.org/debian bullseye/main amd64 net-tools amd64 1.60+git20181103.0eebece-1 [250 kB]<br>Fetched 250 kB <span class="hljs-keyword">in</span> 1s (286 kB/s)    <br>debconf: delaying package configuration, since apt-utils is not installed<br>Selecting previously unselected package net-tools.<br>(Reading database ... 7823 files and directories currently installed.)<br>Preparing to unpack .../net-tools_1.60+git20181103.0eebece-1_amd64.deb ...<br>Unpacking net-tools (1.60+git20181103.0eebece-1) ...<br>Setting up net-tools (1.60+git20181103.0eebece-1) ...<br><br>root@5dee9be9afdb:/<span class="hljs-comment"># ifconfig</span><br>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255<br>        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)<br>        RX packets 4760  bytes 9127995 (8.7 MiB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 2941  bytes 160256 (156.5 KiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>        inet 127.0.0.1  netmask 255.0.0.0<br>        loop  txqueuelen 1000  (Local Loopback)<br>        RX packets 0  bytes 0 (0.0 B)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 0  bytes 0 (0.0 B)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br>   <br>root@5dee9be9afdb:/<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br><br><span class="hljs-comment"># iptables -vnL -t nat</span><br>Chain PREROUTING (policy ACCEPT 7 packets, 474 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    8  3143 DOCKER     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ADDRTYPE match dst-type LOCAL<br><br>Chain INPUT (policy ACCEPT 0 packets, 0 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br><br>Chain OUTPUT (policy ACCEPT 2 packets, 152 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    0     0 DOCKER     all  --  *      *       0.0.0.0/0           !127.0.0.0/8          ADDRTYPE match dst-type LOCAL<br><br>Chain POSTROUTING (policy ACCEPT 2 packets, 152 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    4   240 MASQUERADE  all  --  *      !docker0  172.17.0.0/16        0.0.0.0/0           <br>    0     0 MASQUERADE  tcp  --  *      *       172.17.0.2           172.17.0.2           tcp dpt:80<br><br>Chain DOCKER (2 references)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    0     0 RETURN     all  --  docker0 *       0.0.0.0/0            0.0.0.0/0           <br>    0     0 DNAT       tcp  --  !docker0 *       0.0.0.0/0            0.0.0.0/0            tcp dpt:8888 to:172.17.0.2:80<br><br><br><span class="hljs-comment"># ss -ntlp</span><br>State            Recv-Q            Send-Q                        Local Address:Port                        Peer Address:Port     <br>LISTEN           0                 128                                 0.0.0.0:111                              0.0.0.0:*       <br>LISTEN           0                 128                                 0.0.0.0:58706                            0.0.0.0:*       <br>LISTEN           0                 128                                 0.0.0.0:21492                            0.0.0.0:*       <br>LISTEN           0                 128                           127.0.0.53%lo:53                               0.0.0.0:*       <br>LISTEN           0                 128                                 0.0.0.0:22                               0.0.0.0:*       <br>LISTEN           0                 64                                  0.0.0.0:2049                             0.0.0.0:*       <br>LISTEN           0                 64                                  0.0.0.0:25058                            0.0.0.0:*       <br>LISTEN           0                 128                                 0.0.0.0:19242                            0.0.0.0:*       <br>LISTEN           0                 128                                    [::]:111                                 [::]:*       <br>LISTEN           0                 128                                    [::]:22                                  [::]:*       <br>LISTEN           0                 20480                                     *:8888                                   *:*       <br>LISTEN           0                 128                                    [::]:44698                               [::]:*       <br>LISTEN           0                 128                                    [::]:54746                               [::]:*       <br>LISTEN           0                 128                                    [::]:54714                               [::]:*       <br>LISTEN           0                 64                                     [::]:2049                                [::]:*       <br>LISTEN           0                 64                                     [::]:29480                               [::]:*<br><br><span class="hljs-comment"># apt install bridge-utils</span><br>Reading package lists... Done<br>Building dependency tree       <br>Reading state information... Done<br>Suggested packages:<br>  ifupdown<br>The following NEW packages will be installed:<br>  bridge-utils<br>0 upgraded, 1 newly installed, 0 to remove and 262 not upgraded.<br>Need to get 30.1 kB of archives.<br>After this operation, 102 kB of additional disk space will be used.<br>Get:1 http://mirrors.aliyun.com/ubuntu bionic/main amd64 bridge-utils amd64 1.5-15ubuntu1 [30.1 kB]<br>Fetched 30.1 kB <span class="hljs-keyword">in</span> 0s (152 kB/s)    <br>Selecting previously unselected package bridge-utils.<br>(Reading database ... 71810 files and directories currently installed.)<br>Preparing to unpack .../bridge-utils_1.5-15ubuntu1_amd64.deb ...<br>Unpacking bridge-utils (1.5-15ubuntu1) ...<br>Setting up bridge-utils (1.5-15ubuntu1) ...<br>Processing triggers <span class="hljs-keyword">for</span> man-db (2.8.3-2ubuntu0.1) ...<br><br><span class="hljs-comment"># brctl show</span><br>bridge name	bridge id		STP enabled	interfaces<br>docker0		8000.0242fe840bfe	no		vethf6337ca<br></code></pre></td></tr></table></figure>

<h4 id="1-1-5-6-User-Namespace"><a href="#1-1-5-6-User-Namespace" class="headerlink" title="1.1.5.6 User Namespace"></a>1.1.5.6 User Namespace</h4><p>各个容器内可能会出现重名的用户和用户组名称，或重复的用户UID或者GID，那么怎么隔离各个容器内的用户空间呢？</p>
<p>User Namespace允许在各个宿主机的各个容器空间内创建相同的用户名以及相同的用户UID和GID，只是会把用户的作用范围限制在每个容器内，即A容器和B容器可以有相同的用户名称和ID的账户，但是此用户的有效范围仅是当前容器内，不能访问另外一个容器内的文件系统，即相互隔离、互不影响、永不相见。</p>
<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker23.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<h3 id="1-1-6-Control-groups"><a href="#1-1-6-Control-groups" class="headerlink" title="1.1.6 Control groups"></a>1.1.6 Control groups</h3><p>Linux Cgroups的全称是Linux Control Groups，是Linux内核的一个功能。最早是由Google的工程师（主要是Paul Menage和Rohit Seth）在2006年发起，最早的名称为<strong>进程容器（process containers）</strong>。在2007年时，因为在Linux内核中，容器（container）这个名词有许多不同的意义，为避免混乱，被重命名为cgroup，并且被合并到2.6.24版的内核中去。自那以后，又添加了很多功能。</p>
<p>如果不对一个容器做任何资源限制，则宿主机会允许其占用无限大的内存空间，有时候会因为代码bug程序会一直申请内存，直到把宿主机内存占完，为了避免此类的问题出现，宿主机有必要对容器进行资源分配限制，比如CPU、内存等</p>
<p>Cgroups 最主要的作用，就是限制一个进程组能够使用的资源上限，包括CPU、内存、磁盘、网络带宽等等。此外，还能够对进程进行优先级设置，资源的计量以及资源的控制(比如:将进程挂起和恢复等操作)。</p>
<p><strong>别人公司：一台虚拟机一般是4Cpu8G内存60GB磁盘</strong></p>
<h4 id="1-1-6-1-验证系统-cgroups"><a href="#1-1-6-1-验证系统-cgroups" class="headerlink" title="1.1.6.1 验证系统 cgroups"></a>1.1.6.1 验证系统 cgroups</h4><p>Cgroups在内核层默认已经开启，从CentOS 和 Ubuntu 不同版本对比，显然内核较新的支持的功能更多。<br><strong>Centos 8.1 cgroups:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos8 ~]<span class="hljs-comment"># cat /etc/redhat-release</span><br>CentOS Linux release 8.1.1911 (Core)<br>[root@centos8 ~]<span class="hljs-comment"># grep CGROUP /boot/config-4.18.0-147.el8.x86_64</span><br>CONFIG_CGROUPS=y<br>CONFIG_BLK_CGROUP=y<br><span class="hljs-comment"># CONFIG_DEBUG_BLK_CGROUP is not set</span><br>CONFIG_CGROUP_WRITEBACK=y<br>CONFIG_CGROUP_SCHED=y<br>CONFIG_CGROUP_PIDS=y<br>CONFIG_CGROUP_RDMA=y<br>CONFIG_CGROUP_FREEZER=y<br>CONFIG_CGROUP_HUGETLB=y<br>CONFIG_CGROUP_DEVICE=y<br>CONFIG_CGROUP_CPUACCT=y<br>CONFIG_CGROUP_PERF=y<br>CONFIG_CGROUP_BPF=y<br><span class="hljs-comment"># CONFIG_CGROUP_DEBUG is not set</span><br>CONFIG_SOCK_CGROUP_DATA=y<br><span class="hljs-comment"># CONFIG_BLK_CGROUP_IOLATENCY is not set</span><br>CONFIG_NETFILTER_XT_MATCH_CGROUP=m<br>CONFIG_NET_CLS_CGROUP=y<br>CONFIG_CGROUP_NET_PRIO=y<br>CONFIG_CGROUP_NET_CLASSID=y<br>[root@centos8 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p><strong>Centos 7.6 cgroups:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment"># cat /etc/redhat-release</span><br>CentOS Linux release 7.6.1810 (Core)<br>[root@centos7 ~]<span class="hljs-comment"># grep CGROUP /boot/config-3.10.0-957.el7.x86_64</span><br>CONFIG_CGROUPS=y<br><span class="hljs-comment"># CONFIG_CGROUP_DEBUG is not set</span><br>CONFIG_CGROUP_FREEZER=y<br>CONFIG_CGROUP_PIDS=y<br>CONFIG_CGROUP_DEVICE=y<br>CONFIG_CGROUP_CPUACCT=y<br>CONFIG_CGROUP_HUGETLB=y<br>CONFIG_CGROUP_PERF=y<br>CONFIG_CGROUP_SCHED=y<br>CONFIG_BLK_CGROUP=y<br><span class="hljs-comment"># CONFIG_DEBUG_BLK_CGROUP is not set</span><br>CONFIG_NETFILTER_XT_MATCH_CGROUP=m<br>CONFIG_NET_CLS_CGROUP=y<br>CONFIG_NETPRIO_CGROUP=y<br></code></pre></td></tr></table></figure>

<p><strong>ubuntu cgroups:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment"># grep CGROUP /boot/config-4.15.0-55-generic</span><br>CONFIG_CGROUPS=y<br>CONFIG_BLK_CGROUP=y<br><span class="hljs-comment"># CONFIG_DEBUG_BLK_CGROUP is not set</span><br>CONFIG_CGROUP_WRITEBACK=y<br>CONFIG_CGROUP_SCHED=y<br>CONFIG_CGROUP_PIDS=y<br>CONFIG_CGROUP_RDMA=y<br>CONFIG_CGROUP_FREEZER=y<br>CONFIG_CGROUP_HUGETLB=y<br>CONFIG_CGROUP_DEVICE=y<br>CONFIG_CGROUP_CPUACCT=y<br>CONFIG_CGROUP_PERF=y<br>CONFIG_CGROUP_BPF=y<br><span class="hljs-comment"># CONFIG_CGROUP_DEBUG is not set</span><br>CONFIG_SOCK_CGROUP_DATA=y<br>CONFIG_NETFILTER_XT_MATCH_CGROUP=m<br>CONFIG_NET_CLS_CGROUP=m<br>CONFIG_CGROUP_NET_PRIO=y<br>CONFIG_CGROUP_NET_CLASSID=y<br></code></pre></td></tr></table></figure>

<p><strong>cgroups 中内存模块:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment"># grep MEMCG /boot/config-4.15.0-55-generic</span><br>CONFIG_MEMCG=y<br>CONFIG_MEMCG_SWAP=y<br><span class="hljs-comment"># CONFIG_MEMCG_SWAP_ENABLED is not set</span><br>CONFIG_SLUB_MEMCG_SYSFS_ON=y<br><br>[root@centos8 ~]<span class="hljs-comment"># grep MEMCG /boot/config-4.18.0-240.el8.x86_64 </span><br>CONFIG_MEMCG=y<br>CONFIG_MEMCG_SWAP=y<br>CONFIG_MEMCG_SWAP_ENABLED=y<br>CONFIG_MEMCG_KMEM=y<br><br>[root@centos7 ~]<span class="hljs-comment"># grep MEMCG /boot/config-3.10.0-693.el7.x86_64 </span><br>CONFIG_MEMCG=y<br>CONFIG_MEMCG_SWAP=y<br>CONFIG_MEMCG_SWAP_ENABLED=y<br>CONFIG_MEMCG_KMEM=y<br></code></pre></td></tr></table></figure>

<h4 id="1-1-6-2-cgroups-具体实现"><a href="#1-1-6-2-cgroups-具体实现" class="headerlink" title="1.1.6.2 cgroups 具体实现"></a>1.1.6.2 cgroups 具体实现</h4><ul>
<li>blkio: 块设备IO限制</li>
<li>cpu: 使用调度程序为 cgroup 任务提供 cpu 的访问</li>
<li>cpuacct: 产生 cgroup 任务的 cpu 资源报告</li>
<li>cpuset: 如果是多核心的 cpu，这个子系统会为 cgroup 任务分配单独的 cpu 和内存</li>
<li>devices: 允许或拒绝 cgroup 任务对设备的访问</li>
<li>freezer: 暂停和恢复 cgroup 任务</li>
<li>memory: 设置每个 cgroup 的内存限制以及产生内存资源报告</li>
<li>net_cls: 标记每个网络包以供 cgroup 方便使用</li>
<li>ns: 命名空间子系统</li>
<li>perf_event: 增加了对每 group 的监测跟踪的能力，可以监测属于某个特定的 group 的所有线程以及运行在特定CPU上的线程</li>
</ul>
<h4 id="1-1-6-3-查看系统-cgroups"><a href="#1-1-6-3-查看系统-cgroups" class="headerlink" title="1.1.6.3 查看系统 cgroups"></a>1.1.6.3 查看系统 cgroups</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ll /sys/fs/cgroup/</span><br>total 0<br>drwxr-xr-x 15 root root 380 Jan 22 16:20 ./<br>drwxr-xr-x 10 root root  0 Jan 22 16:20 ../<br>dr-xr-xr-x  5 root root  0 Jan 22 16:20 blkio/<br>lrwxrwxrwx  1 root root  11 Jan 22 16:20 cpu -&gt; cpu,cpuacct/<br>lrwxrwxrwx  1 root root  11 Jan 22 16:20 cpuacct -&gt; cpu,cpuacct/<br>dr-xr-xr-x  5 root root  0 Jan 22 16:20 cpu,cpuacct/<br>dr-xr-xr-x  3 root root  0 Jan 22 16:20 cpuset/<br>dr-xr-xr-x  5 root root  0 Jan 22 16:20 devices/<br>dr-xr-xr-x  3 root root  0 Jan 22 16:20 freezer/<br>dr-xr-xr-x  3 root root  0 Jan 22 16:20 hugetlb/<br>dr-xr-xr-x  5 root root  0 Jan 22 16:20 memory/<br>lrwxrwxrwx  1 root root  16 Jan 22 16:20 net_cls -&gt; net_cls,net_prio/<br>dr-xr-xr-x  3 root root  0 Jan 22 16:20 net_cls,net_prio/<br>lrwxrwxrwx  1 root root  16 Jan 22 16:20 net_prio -&gt; net_cls,net_prio/<br>dr-xr-xr-x  3 root root  0 Jan 22 16:20 perf_event/<br>dr-xr-xr-x  5 root root  0 Jan 22 16:20 pids/<br>dr-xr-xr-x  2 root root  0 Jan 22 16:20 rdma/<br>dr-xr-xr-x  6 root root  0 Jan 22 16:20 systemd/<br>dr-xr-xr-x  5 root root  0 Jan 22 16:20 unified/<br><br><span class="hljs-comment"># cat /sys/fs/cgroup/cpu/docker/5dee9be9afdbab8c2f6c4c5eb0f956c9579efe93110daf638f8fd15f43d961e2/cpuacct.usage</span><br>4751336886<br><span class="hljs-comment"># cat /sys/fs/cgroup/memory/docker/5dee9be9afdbab8c2f6c4c5eb0f956c9579efe93110daf638f8fd15f43d961e2/cpuacct.usage</span><br>cat:<br>/sys/fs/cgroup/memory/docker/5dee9be9afdbab8c2f6c4c5eb0f956c9579efe93110daf638f8fd15f43d961e2/cpuacct.usage: No such file or directory <span class="hljs-comment">#没有这个文件</span><br><br><span class="hljs-comment"># cat /sys/fs/cgroup/memory/docker/5dee9be9afdbab8c2f6c4c5eb0f956c9579efe93110daf638f8fd15f43d961e2/memory.limit_in_bytes</span><br>9223372036854771712<br><span class="hljs-comment"># cat /sys/fs/cgroup/memory/docker/5dee9be9afdbab8c2f6c4c5eb0f956c9579efe93110daf638f8fd15f43d961e2/memory.max_usage_in_bytes</span><br>79278080<br></code></pre></td></tr></table></figure>

<h3 id="1-1-7-容器管理工具"><a href="#1-1-7-容器管理工具" class="headerlink" title="1.1.7 容器管理工具"></a>1.1.7 容器管理工具</h3><p>有了以上的chroot、namespace、cgroups就具备了基础的容器运行环境，但是还需要有相应的容器创建与删除的管理工具、以及怎么样把容器运行起来、容器数据怎么处理、怎么进行启动与关闭等问题需要解决，于是容器管理技术出现了。目前主要是使用docker，早期使用 LXC</p>
<h4 id="1-1-7-1-LXC"><a href="#1-1-7-1-LXC" class="headerlink" title="1.1.7.1 LXC"></a>1.1.7.1 LXC</h4><p>LXC: Linux Container。可以提供轻量级的虚拟化功能,以便隔离进程和资源,包括一系列容器的管理工具软件,如，lxc-create,lxc-start,lxc-attach等,但这技术功能不完善,目前较少使用</p>
<p>官方网站: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://linuxcontainers.org/<br></code></pre></td></tr></table></figure>

<p>案例: Ubuntu安装 和使用 LXC</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># apt install -y lxc lxd</span><br>Reading package lists... Done<br>Building dependency tree <br>Reading state information... Done<br>lxd is already the newest version (3.0.3-0ubuntu1~18.04.1).<br>lxc is already the newest version (3.0.3-0ubuntu1~18.04.1).<br>......<br><br><span class="hljs-comment"># lxc-checkconfig  #检查内核对lcx的支持状况，必须全部为lcx</span><br>Kernel configuration not found at /proc/config.gz; searching...<br>Kernel configuration found at /boot/config-4.15.0-55-generic<br>--- Namespaces ---<br>Namespaces: enabled<br>Utsname namespace: enabled<br>Ipc namespace: enabled<br>Pid namespace: enabled<br>User namespace: enabled<br>Network namespace: enabled<br><br>--- Control groups ---<br>Cgroups: enabled<br><br>Cgroup v1 mount points: <br>/sys/fs/cgroup/systemd<br>/sys/fs/cgroup/rdma<br>/sys/fs/cgroup/pids<br>/sys/fs/cgroup/blkio<br>/sys/fs/cgroup/net_cls,net_prio<br>/sys/fs/cgroup/devices<br>/sys/fs/cgroup/memory<br>/sys/fs/cgroup/cpu,cpuacct<br>/sys/fs/cgroup/perf_event<br>/sys/fs/cgroup/hugetlb<br>/sys/fs/cgroup/freezer<br>/sys/fs/cgroup/cpuset<br><br>Cgroup v2 mount points: <br>/sys/fs/cgroup/unified<br><br>Cgroup v1 clone_children flag: enabled<br>Cgroup device: enabled<br>Cgroup <span class="hljs-built_in">sched</span>: enabled<br>Cgroup cpu account: enabled<br>Cgroup memory controller: enabled<br>Cgroup cpuset: enabled<br><br>--- Misc ---<br>Veth pair device: enabled, loaded<br>Macvlan: enabled, not loaded<br>Vlan: enabled, not loaded<br>Bridges: enabled, loaded<br>Advanced netfilter: enabled, not loaded<br>CONFIG_NF_NAT_IPV4: enabled, loaded<br>CONFIG_NF_NAT_IPV6: enabled, not loaded<br>CONFIG_IP_NF_TARGET_MASQUERADE: enabled, loaded<br>CONFIG_IP6_NF_TARGET_MASQUERADE: enabled, not loaded<br>CONFIG_NETFILTER_XT_TARGET_CHECKSUM: enabled, loaded<br>CONFIG_NETFILTER_XT_MATCH_COMMENT: enabled, not loaded<br>FUSE (<span class="hljs-keyword">for</span> use with lxcfs): enabled, not loaded<br><br>--- Checkpoint/Restore ---<br>checkpoint restore: enabled<br>CONFIG_FHANDLE: enabled<br>CONFIG_EVENTFD: enabled<br>CONFIG_EPOLL: enabled<br>CONFIG_UNIX_DIAG: enabled<br>CONFIG_INET_DIAG: enabled<br>CONFIG_PACKET_DIAG: enabled<br>CONFIG_NETLINK_DIAG: enabled<br>File capabilities: <br><br>Note : Before booting a new kernel, you can check its configuration<br>usage : CONFIG=/path/to/config /usr/bin/lxc-checkconfig<br><br><span class="hljs-comment"># lxc-create -t download --name alpine1 -- --dist alpine --release 3.9 --arch amd64</span><br>Setting up the GPG keyring<br>Downloading the image index<br>Downloading the rootfs<br>Downloading the metadata<br>The image cache is now ready<br>Unpacking the rootfs<br><br>---<br>You just created an Alpinelinux 3.9 x86_64 (20200121_13:00) container.<br><br><span class="hljs-comment"># lxc-start alpine1  #启动lxc容器</span><br><span class="hljs-comment"># lxc-attach alpine1  #进入lxc容器</span><br>~ <span class="hljs-comment"># ifconfig</span><br>eth0   Link encap:Ethernet HWaddr 00:16:3E:DF:9E:45 <br>    inet addr:10.0.1.51 Bcast:10.0.1.255 Mask:255.255.255.0<br>    inet6 addr: fe80::216:3eff:fedf:9e45/64 Scope:Link<br>    UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br>    RX packets:23 errors:0 dropped:0 overruns:0 frame:0<br>    TX packets:12 errors:0 dropped:0 overruns:0 carrier:0<br>    collisions:0 txqueuelen:1000<br>    RX bytes:2484 (2.4 KiB) TX bytes:1726 (1.6 KiB)<br>lo    Link encap:Local Loopback <br>    inet addr:127.0.0.1 Mask:255.0.0.0<br>    inet6 addr: ::1/128 Scope:Host<br>    UP LOOPBACK RUNNING MTU:65536 Metric:1<br>    RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br>    TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br>    collisions:0 txqueuelen:1000<br>    RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)<br>    <br>~ <span class="hljs-comment"># uname -r</span><br>4.15.0-29-generic<br>~ <span class="hljs-comment"># uname -a</span><br>Linux alpine12 4.15.0-29-generic <span class="hljs-comment">#31-Ubuntu SMP Tue Jul 17 15:39:52 UTC 2018</span><br>x86_64 Linux<br>~ <span class="hljs-comment"># cat /etc/issue</span><br>Welcome to Alpine Linux 9<br>Kernel \r on an \m (\l)<br><br>~ <span class="hljs-comment"># exit</span><br></code></pre></td></tr></table></figure>

<p>命令选项说明:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">-t 模板: -t 选项后面跟的是模板，模式可以认为是一个原型，用来说明需要一个什么样的容器(比如容器里面需不需要有vim, apache等软件)．模板实际上就是一个脚本文件(位于/usr/share/lxc/templates目录)，我们这里指定download模板(lxc-create会调用lxc-download脚本，该脚本位于刚说的模板目录中)是说明我们目前没有自己模板，需要下载官方的模板<br><br>--name 容器名称:  为创建的容器命名<br>-- : --用来说明后面的参数是传递给download脚本的，告诉脚本需要下载什么样的模板<br>--dist 操作系统名称: 指定操作系统<br>--release 操作系统: 指定操作系统，可以是各种Linux的变种<br>--arch 架构: 指定架构，是x86还是arm，是32位还是64位<br></code></pre></td></tr></table></figure>

<p>lxc启动容器依赖于模板，但是做模板相对较难，需要手动一步步创构建文件系统、准备基础目录及可执行程序等，而且在大规模使用容器的场景很难横向扩展，另外后期代码升级也需要重新从头构建模板，基于以上种种原因便有了docker。</p>
<p>清华模板源: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://mirrors.tuna.tsinghua.edu.cn/help/lxc-images/<br></code></pre></td></tr></table></figure>

<h4 id="1-1-7-2-docker"><a href="#1-1-7-2-docker" class="headerlink" title="1.1.7.2 docker"></a>1.1.7.2 docker</h4><p>Docker 相当于增强版的LXC,功能更为强大和易用,也是当前最主流的容器前端管理工具</p>
<p>Docker 先启动一个容器也需要一个外部模板，也称为镜像，docke的镜像可以保存在一个公共的地方共享使用，只要把镜像下载下来就可以使用，最主要的是可以在镜像基础之上做自定义配置并且可以再把其提交为一个镜像，一个镜像可以被启动为多个容器。</p>
<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker24.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<p>Docker的镜像是分层的，镜像底层为库文件且只读层即不能写入也不能删除数据，从镜像加载启动为一个容器后会生成一个可写层，其写入的数据会复制到宿主机上对应容器的目录，但是容器内的数据在删除容器后也会被随之删除。</p>
<h4 id="1-1-7-3-pouch"><a href="#1-1-7-3-pouch" class="headerlink" title="1.1.7.3 pouch"></a>1.1.7.3 pouch</h4><p>项目网点: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://github.com/alibaba/pouch<br></code></pre></td></tr></table></figure>

<p>Pouch （小袋子）起源于 2011 年，并于2017年11月19日上午，在中国开源年会现场，阿里巴巴正式开源了基于 Apache 2.0 协议的容器技术 Pouch。Pouch 是一款轻量级的容器技术，拥有快速高效、可移植性高、资源占用少等特性，主要帮助阿里更快的做到内部业务的交付，同时提高超大规模下数据中心的物理资源利用率</p>
<p>目前的容器方案大多基于 Linux 内核提供的 cgroup 和 namespace 来实现隔离，然后这样轻量级方案存在弊端:</p>
<ul>
<li>容器间，容器与宿主间，共享同一个内核</li>
<li>内核实现的隔离资源，维度不足</li>
</ul>
<p>面对如此的内核现状，阿里巴巴采取了三个方面的工作，来解决容器的安全问题:</p>
<ul>
<li> 用户态增强容器的隔离维度，比如网络带宽、磁盘使用量等</li>
<li> 给内核提交 patch，修复容器的资源可见性问题，cgroup 方面的 bug</li>
<li> 实现基于 Hypervisor 的容器，通过创建新内核来实现容器隔离</li>
</ul>
<h4 id="1-1-7-4-Podman"><a href="#1-1-7-4-Podman" class="headerlink" title="1.1.7.4 Podman"></a>1.1.7.4 Podman</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker25.png" srcset="/blog/img/loading.gif"></p>
<p>虽然目前 Docker 是管理 Linux 容器最好的工具，注意没有之一，但是podman的横空出现即将改变这一点</p>
<p>什么是Podman？</p>
<p>Podman即Pod Manager tool，从名称上可以看出和kubernets的pod的密切联系，不过就其功能来说，简而言之: alias docker = podman ,是CentOS 8 新集成的功能，或许不久的未来会代替dockerPodman是一个 为 Kubernetes 而生的开源的容器管理工具，原来是 CRI-O（即容器运行时接口CRI 和开放容器计划OCI） 项目的一部分，后来被分离成一个单独的项目叫 libpod。其可在大多数Linux平台上使用，它是一种无守护程序的容器引擎，用于在Linux系统上开发，管理和运行任何符合OpenContainer Initiative（OCI）标准的容器和容器镜像。</p>
<p>Podman 提供了一个与Docker兼容的命令行前端，Podman 里面87%的指令都和Docker CLI 相同，因此可以简单地为Docker CLI别名，即“ alias docker = podman”，事实上，podman使用的一些库也是docker的一部分。</p>
<blockquote>
<p>CRI-O is an implementation of the Kubernetes CRI (Container Runtime Interface) to enable using OCI (Open Container Initiative) compatible runtimes</p>
</blockquote>
<p>官网地址: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://podman.io/<br></code></pre></td></tr></table></figure>

<p>项目地址: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://github.com/containers/libpod<br></code></pre></td></tr></table></figure>

<p><strong>Podman 和docker不同之处</strong></p>
<ul>
<li>docker 需要在系统上运行一个守护进程(docker daemon)，这会产生一定的开销，而podman 不需要</li>
<li>启动容器的方式不同:<br>docker cli 命令通过API跟 Docker Engine(引擎) 交互告诉它我想创建一个container，然后docker Engine 才会调用 OCI container runtime(runc) 来启动一个container。这代表container的process(进程)不会是 Docker CLI 的 child process(子进程) ，而是 DockerEngine 的 child process 。<br>Podman 是直接给 OCI containner runtime(runc) 进行交互来创建container的，所以container process 直接是 podman 的 child process 。</li>
<li>因为docke有docker daemon，所以docker启动的容器支持 –restart 策略，但是podman不支持</li>
<li>docker需要使用root用户来创建容器。 这可能会产生安全风险，尤其是当用户知道docker run命令的–privileged选项时。podman既可以由root用户运行，也可以由非特权用户运行</li>
<li>docker在Linux上作为守护进程运行扼杀了容器社区的创新。 如果要更改容器的工作方式，则需要更改docker守护程序并将这些更改推送到上游。 没有守护进程，容器基础结构更加模块化，更容易进行更改。 podman的无守护进程架构更加灵活和安全。</li>
</ul>
<h3 id="1-1-8-Docker-的优势"><a href="#1-1-8-Docker-的优势" class="headerlink" title="1.1.8 Docker 的优势"></a>1.1.8 Docker 的优势</h3><ul>
<li>快速部署: 短时间内可以部署成百上千个应用，更快速交付到线上</li>
<li>高效虚拟化: 不需要额外hypervisor支持，基于linux内核实现应用虚拟化，相比虚拟机大幅提高性能和效率</li>
<li>节省开支: 提高服务器利用率，降低IT支出</li>
<li>简化配置: 将运行环境打包保存至容器，使用时直接启动即可</li>
<li>环境统一: 将开发，测试，生产的应用运行环境进行标准化和统一，减少环境不一样带来的各种问题</li>
<li>快速迁移和扩展: 可实现跨平台运行在物理机、虚拟机、公有云等环境，良好的兼容性可以方便将</li>
<li>应用从A宿主机迁移到B宿主机，甚至是A平台迁移到B平台</li>
<li>更好的实现面向服务的架构,推荐一个容器只运行一个应用,实现分布的应用模型,可以方便的进行横向扩展,符合开发中高内聚,低耦合的要求,减少不同服务之间的相互影响</li>
</ul>
<h3 id="1-1-9-Docker-的缺点"><a href="#1-1-9-Docker-的缺点" class="headerlink" title="1.1.9 Docker 的缺点"></a>1.1.9 Docker 的缺点</h3><ul>
<li>多个容器共用宿主机的内核，各应用之间的隔离不如虚拟机彻底（比如：普通用户（前提：普通用户在docker组内）可以删除通过root用户创建的容器）</li>
<li>由于和宿主机之间的进程也是隔离的,需要进入容器查看和调试容器内进程等资源,变得比较困难和繁琐</li>
<li>如果容器内进程需要查看和调试，需要在每个容器内都需要安装相应的工具，这也造成存储空间的重复浪费</li>
</ul>
<h3 id="1-1-10-容器的核心技术"><a href="#1-1-10-容器的核心技术" class="headerlink" title="1.1.10 容器的核心技术"></a>1.1.10 容器的核心技术</h3><h4 id="1-1-10-1-容器规范"><a href="#1-1-10-1-容器规范" class="headerlink" title="1.1.10.1 容器规范"></a>1.1.10.1 容器规范</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker26.png" srcset="/blog/img/loading.gif"></p>
<p>容器技术除了的docker之外，还有coreOS的rkt，还有阿里的Pouch，为了保证容器生态的标准性和健康可持续发展，包括Linux 基金会、Docker、微软、红帽、谷歌和IBM、等公司在2015年6月共同成立了一个叫Open Container Initiative（OCI）的组织，其目的就是制定开放的标准的容器规范，目前OCI一共发布了两个规范，分别是runtime spec和 image format spec，有了这两个规范，不同的容器公司开发的容器只要兼容这两个规范，就可以保证容器的可移植性和相互可操作性。</p>
<h4 id="1-1-10-2-容器-runtime"><a href="#1-1-10-2-容器-runtime" class="headerlink" title="1.1.10.2 容器 runtime"></a>1.1.10.2 容器 runtime</h4><p>runtime是真正运行容器的地方，因此为了运行不同的容器runtime需要和操作系统内核紧密合作相互在支持，以便为容器提供相应的运行环境</p>
<p>runtime 类型:</p>
<ul>
<li>Lxc: linux上早期的runtime，在 2013 年 Docker 刚发布的时候,就是采用lxc作为runtime, Docker把 LXC 复杂的容器创建与使用方式简化为 Docker 自己的一套命令体系。随着Docker的发展，原有的LXC不能满足Docker的需求,比如跨平台功能</li>
<li>Libcontainer: 随着 Docker 的不断发展，重新定义容器的实现标准，将底层实现都抽象化到Libcontainer 的接口。这就意味着，底层容器的实现方式变成了一种可变的方案，无论是使用namespace、cgroups 技术抑或是使用 systemd 等其他方案，只要实现了 Libcontainer 定义的一组接口，Docker 都可以运行。这也为 Docker 实现全面的跨平台带来了可能。</li>
<li><strong>runc</strong>: 早期libcontainer是Docker公司控制的一个开源项目，OCI的成立后,Docker把libcontainer项目移交给了OCI组织,runC就是在libcontainer的基础上进化而来,目前Docker默认的runtime，runc遵守OCI规范</li>
<li>rkt: 是CoreOS开发的容器runtime，也符合OCI规范，所以使用rktruntime也可以运行Docker容器</li>
</ul>
<p>范例: 查看docker的 runtime</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># docker info</span><br>Client:<br>Debug Mode: <span class="hljs-literal">false</span><br><br>Server:<br>Containers: 0<br>Running: 0<br>Paused: 0<br>Stopped: 0<br>Images: 1<br>Server Version: 19.03.5<br>Storage Driver: overlay2<br>Backing Filesystem: extfs<br>Supports d_type: <span class="hljs-literal">true</span><br>Native Overlay Diff: <span class="hljs-literal">true</span><br>Logging Driver: json-file<br>Cgroup Driver: cgroupfs<br>Plugins:<br>Volume: <span class="hljs-built_in">local</span><br>Network: bridge host ipvlan macvlan null overlay<br>Log: awslogs fluentd gcplogs gelf journald json-file <span class="hljs-built_in">local</span> logentries splunk<br>syslog<br>Swarm: inactive<br>Runtimes: runc     <span class="hljs-comment">#Runtimes</span><br>Default Runtime: runc  <span class="hljs-comment">#runtime</span><br>Init Binary: docker-init<br>containerd version: b34a5c8af56e510852c35414db4c1f4fa6172339<br>runc version: 3e425f80a8c931f88e6d94a8c831b9d5aa481657<br>init version: fec3683<br>Security Options:<br>apparmor<br>seccomp<br> Profile: default<br>Kernel Version: 4.15.0-29-generic<br>Operating System: Ubuntu 18.04.1 LTS<br>OSType: linux<br>Architecture: x86_64<br>CPUs: 1<br>Total Memory: 962MiB<br>Name: ubuntu1804.magedu.org<br>ID: G2JQ:M4DG:CW74:EETR:GU5U:OROC:ZN2F:RKSA:YQY2:XJYX:OHG7:SSVE<br>Docker Root Dir: /var/lib/docker<br>Debug Mode: <span class="hljs-literal">false</span><br>Registry: https://index.docker.io/v1/<br>Labels:<br>Experimental: <span class="hljs-literal">false</span><br>Insecure Registries:<br> 127.0.0.0/8<br>Live Restore Enabled: <span class="hljs-literal">false</span><br><br>WARNING: No swap <span class="hljs-built_in">limit</span> support<br></code></pre></td></tr></table></figure>

<h4 id="1-1-10-3-容器管理工具"><a href="#1-1-10-3-容器管理工具" class="headerlink" title="1.1.10.3 容器管理工具"></a>1.1.10.3 容器管理工具</h4><p>管理工具连接runtime与用户，对用户提供图形或命令方式操作，然后管理工具将用户操作传递给runtime执行。</p>
<ul>
<li><p>lxc 是 lxd 的管理工具</p>
</li>
<li><p>Runc的管理工具是docker engine，docker engine包含后台deamon和cli两部分，<strong>大家经常提到的Docker就是指的docker engine</strong></p>
</li>
<li><p>Rkt的管理工具是rkt cli</p>
</li>
</ul>
<p>范例: 查看docker engine</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># docker version</span><br>Client: Docker Engine - Community<br>Version:      19.03.5<br>API version:    1.40<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:       Wed Nov 13 07:29:52 2019<br>OS/Arch:      linux/amd64<br>Experimental:    <span class="hljs-literal">false</span><br><br>Server: Docker Engine - Community<br>Engine:<br>Version:      19.03.5<br>API version:    1.40 (minimum version 1.12)<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:      Wed Nov 13 07:28:22 2019<br>OS/Arch:     linux/amd64<br>Experimental:   <span class="hljs-literal">false</span><br>containerd:<br>Version:      1.2.10<br>GitCommit:    b34a5c8af56e510852c35414db4c1f4fa6172339<br>runc:<br>Version:      1.0.0-rc8+dev<br>GitCommit:    3e425f80a8c931f88e6d94a8c831b9d5aa481657<br>docker-init:<br>Version:      0.18.0<br>GitCommit:    fec3683<br></code></pre></td></tr></table></figure>

<h4 id="1-1-10-4-容器定义工具"><a href="#1-1-10-4-容器定义工具" class="headerlink" title="1.1.10.4 容器定义工具"></a>1.1.10.4 容器定义工具</h4><p>容器定义工具允许用户定义容器的属性和内容，以方便容器能够被保存、共享和重建。</p>
<p>Docker image: 是docker容器的模板，runtime依据docker image创建容器</p>
<p>Dockerfile: 包含N个命令的文本文件，通过dockerfile创建出docker image</p>
<p>ACI(App container image): 与docker image类似，是CoreOS开发的rkt容器的镜像格式</p>
<h4 id="1-1-10-5-镜像仓库-Registry"><a href="#1-1-10-5-镜像仓库-Registry" class="headerlink" title="1.1.10.5 镜像仓库 Registry"></a>1.1.10.5 镜像仓库 Registry</h4><p>统一保存镜像而且是多个不同镜像版本的地方，叫做镜像仓库</p>
<ul>
<li><p>Docker hub: docker官方的公共仓库，已经保存了大量的常用镜像，可以方便大家直接使用</p>
</li>
<li><p>阿里云，网易等第三方镜像的公共仓库</p>
</li>
<li><p>Image registry: docker 官方提供的私有仓库部署工具，无web管理界面，目前使用较少</p>
<p>github地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://github.com/distribution/distribution<br></code></pre></td></tr></table></figure></li>
<li><p>Harbor: vmware 提供的自带web界面自带认证功能的镜像私有仓库，目前有很多公司使用</p>
<p>github地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://github.com/goharbor/harbor<br></code></pre></td></tr></table></figure></li>
</ul>
<p>范例: </p>
<table>
<thead>
<tr>
<th>镜像地址格式（项目名称一般都是开发给的）</th>
</tr>
</thead>
<tbody><tr>
<td>docker.io/library/alpine</td>
</tr>
<tr>
<td>harbor.rlinl.com/project/centos:7.2.1511</td>
</tr>
<tr>
<td>registry.cn-hangzhou.aliyuncs.com/rlin/chan:v1</td>
</tr>
<tr>
<td>172.18.200.101/project/centos: latest</td>
</tr>
<tr>
<td>172.18.200.101/project/java-7.0.59:v1</td>
</tr>
</tbody></table>
<h4 id="1-1-10-6-容器编排工具"><a href="#1-1-10-6-容器编排工具" class="headerlink" title="1.1.10.6 容器编排工具"></a>1.1.10.6 容器编排工具</h4><p>当多个容器在多个主机运行的时候，单独管理容器是相当复杂而且很容易出错，而且也无法实现某一台主机宕机后容器自动迁移到其他主机从而实现高可用的目的，也无法实现动态伸缩的功能，因此需要有一种工具可以实现<strong>统一管理</strong>、<strong>动态伸缩</strong>（例：监控容器的CPU，一般CPU使用率占比为30%左右，一旦超出某个阈值就自动添加容器）、<strong>故障自愈</strong>、<strong>批量执行</strong>等功能。</p>
<p>这就是容器编排引擎容器编排通常包括容器管理、调度、集群定义和服务发现等功能</p>
<ul>
<li><p>Docker compose : docker 官方实现单机的容器的编排工具</p>
</li>
<li><p>Docker swarm: docker 官方开发的容器编排引擎，支持overlay network（小环境的管理工具）</p>
</li>
<li><p>Mesos+Marathon: Mesos是Apache下的开源分布式资源管理框架，它被称为是分布式系统的内核。Mesos最初是由加州大学伯克利分校的AMPLab开发的，后在Twitter得到广泛使用。通用的集群组员调度平台，mesos(资源分配)与marathon(容器编排平台)一起提供容器编排引擎功能</p>
</li>
<li><p>Kubernetes: google领导开发的容器编排引擎，内部项目为Borg，且其同时支持 docker 和CoreOS,当前已成为容器编排工具事实上的标准</p>
</li>
</ul>
<h3 id="1-1-11-docker-容器-的依赖技术"><a href="#1-1-11-docker-容器-的依赖技术" class="headerlink" title="1.1.11 docker(容器)的依赖技术"></a>1.1.11 docker(容器)的依赖技术</h3><p><font color=red>容器落地时需要考虑的事情</font></p>
<p><strong>容器网络:</strong><br>docker自带的网络docker network仅支持管理单机的容器网络，当多主机运行的时候需要使用第三方  开源网络，例如:calico（三层网络，适合私有云）、flannel（偏向二层网络，适合公有云，因为公有云不支持自定义网络）等</p>
<p><strong>服务发现:</strong><br>容器的动态扩容特性决定了容器IP也会随之变化，因此需要有一种机制开源自动识别并将用户请求动态转发到新创建的容器上，kubernetes自带服务发现功能，需要结合kube-dns服务解析内部域名。dns也是容器，也会有瓶颈，所以需要高配置（4C，8G）和使用多台dns</p>
<p>早期dns的更新换代：skydns-&gt;kubedns-&gt;coredns</p>
<p><strong>容器监控:</strong><br>可以通过原生命令docker ps/top/stats 查看容器运行状态，另外也可以使用Prometheus 、heapster 等第三方监控工具监控容器的运行状态</p>
<p><strong>数据管理:</strong><br>容器的动态迁移会导致其在不同的Host之间迁移，因此如何保证与容器相关的数据也能随之迁移或随时访问，可以使用逻辑卷/存储挂载、共享存储（Ceph，NAS，nfs）、第三方存储公司等方式解决</p>
<p><strong>日志收集:</strong><br>docker 原生的日志查看工具docker logs，但是容器内部的日志需要通过ELK等专门的日志收集分析和展示工具进行处理</p>
<h2 id="1-2-Docker安装及基础命令介绍"><a href="#1-2-Docker安装及基础命令介绍" class="headerlink" title="1.2 Docker安装及基础命令介绍"></a>1.2 Docker安装及基础命令介绍</h2><p>官方网址: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://www.docker.com/<br></code></pre></td></tr></table></figure>

<p><strong>OS系统版本选择:</strong><br>Docker 目前已经支持多种操作系统的安装运行，比如Ubuntu、CentOS、Redhat、Debian、Fedora，甚至是还支持了Mac和Windows，在linux系统上需要内核版本在3.10或以上</p>
<p><strong>Docker版本选择:</strong><br>docker版本号之前一直是0.X版本或1.X版本，但是从2017年3月1号开始改为每个季度发布一次稳定版，其版本号规则也统一变更为YY.MM，例如17.09表示是2017年9月份发布的</p>
<p>Docker之前没有区分版本，但是2017年推出(将docker更名为)新的项目Moby，Moby项目属于Docker项目的全新上游，Docker将是一个隶属于的Moby的子产品，而且之后的版本之后开始区分为 CE（Docker Community Edition，社区版本）和EE（Docker Enterprise Edition，企业收费版），CE社区版本和EE企业版本都是每个季度发布一个新版本，但是EE版本提供后期安全维护1年，而CE版本是4个月。</p>
<p>官网网站说明的地址：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://www.docker.com/blog/docker-enterprise-edition/<br></code></pre></td></tr></table></figure>

<p>以下为官方原文:</p>
<blockquote>
<p>Docker CE and EE are released quarterly, and CE also has a monthly “Edge” option. Each Docker EE release is supported and maintained for one year and receives security and critical bugfixes during that period. We are also improving Docker CE maintainability by maintaining each quarterly CE release for4 months. That gets Docker CE users a new 1-month window to update from one version to the next.</p>
</blockquote>
<p>moby github地址: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://github.com/moby/moby<br></code></pre></td></tr></table></figure>

<p>如果要布署到kubernets上，需要查看相关kubernets对docker版本要求的说明，比如:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://github.com/kubernetes/kubernetes/blob/v1.17.2/CHANGELOG-1.17.md<br></code></pre></td></tr></table></figure>

<h3 id="1-2-1-Docker-安装准备"><a href="#1-2-1-Docker-安装准备" class="headerlink" title="1.2.1 Docker 安装准备"></a>1.2.1 Docker 安装准备</h3><h4 id="1-2-1-1-修改limits-conf"><a href="#1-2-1-1-修改limits-conf" class="headerlink" title="1.2.1.1 修改limits.conf"></a>1.2.1.1 修改limits.conf</h4><p><strong>修改文件</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim /etc/security/limits.conf<br>*         soft    core            unlimited<br>*         hard    core            unlimited<br>*	      soft    nproc           1000000<br>*         hard    nproc           1000000<br>*         soft    nofile          1000000<br>*         hard    nofile          1000000<br>*         soft    memlock         32000<br>*         hard    memlock         32000<br>*         soft    msgqueue        8192000<br>*         hard    msgqueue        8192000<br></code></pre></td></tr></table></figure>

<p><strong>文件生效</strong></p>
<p>用户退出重进即可。</p>
<h4 id="1-2-1-2-修改sysctl-conf文件"><a href="#1-2-1-2-修改sysctl-conf文件" class="headerlink" title="1.2.1.2 修改sysctl.conf文件"></a>1.2.1.2 修改sysctl.conf文件</h4><p><strong>修改文件</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim sysctl.conf<br>net.ipv4.ip_forward=1<br>vm.max_map_count=262144<br>kernel.pid_max=4194303<br>fs.file-max=1000000<br>net.ipv4.tcp_max_tw_buckets=6000<br>net.netfilter.nf_conntrack_max=2097152<br>net.bridge.bridge-nf-call-ip6tables = 1<br>net.bridge.bridge-nf-call-iptables = 1<br>vm.swappiness=0<br></code></pre></td></tr></table></figure>

<p><strong>文件生效</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sysctl -p<br></code></pre></td></tr></table></figure>

<h3 id="1-2-2-安装和删除方法"><a href="#1-2-2-安装和删除方法" class="headerlink" title="1.2.2 安装和删除方法"></a>1.2.2 安装和删除方法</h3><p>官方文档 : </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://docs.docker.com/engine/install/<br></code></pre></td></tr></table></figure>

<p>阿里云文档: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://developer.aliyun.com/mirror/docker-ce?spm=a2c6h.13651102.0.0.3e221b11guHCWE<br></code></pre></td></tr></table></figure>

<h4 id="1-2-2-1-Ubuntu-安装和删除Docker"><a href="#1-2-2-1-Ubuntu-安装和删除Docker" class="headerlink" title="1.2.2.1 Ubuntu 安装和删除Docker"></a>1.2.2.1 Ubuntu 安装和删除Docker</h4><p>官方文档: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://docs.docker.com/install/linux/docker-ce/ubuntu/<br></code></pre></td></tr></table></figure>

<p><strong>Ubuntu 14.04/16.04/18.04 安装docker</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># step 1: 安装必要的一些系统工具</span><br>sudo apt-get update<br>sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common<br><span class="hljs-comment"># step 2: 安装GPG证书</span><br>curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -<br><span class="hljs-comment"># Step 3: 写入软件源信息</span><br>sudo add-apt-repository <span class="hljs-string">&quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable&quot;</span><br><span class="hljs-comment"># Step 4: 更新并安装Docker-CE</span><br>sudo apt-get -y update<br>sudo apt-get -y install docker-ce <span class="hljs-comment">#默认按爪最新版docker</span><br><br><span class="hljs-comment"># 安装指定版本的Docker-ce和Docker-ce-cli:</span><br><span class="hljs-comment"># Step 1: 查找Docker-ce的版本:</span><br><span class="hljs-comment"># apt-cache madison docker-ce</span><br> docker-ce | 5:20.10.7~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:20.10.6~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:20.10.5~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:20.10.4~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:20.10.3~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:20.10.2~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:20.10.1~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:20.10.0~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:19.03.15~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:19.03.14~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:19.03.13~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:19.03.12~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:19.03.11~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:19.03.10~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:19.03.9~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:19.03.8~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br> docker-ce | 5:19.03.7~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>......<br><br><span class="hljs-comment"># 查找Docker-ce-cli的版本:</span><br><span class="hljs-comment"># apt-cache madison docker-ce-cli</span><br>docker-ce-cli | 5:20.10.7~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:20.10.6~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:20.10.5~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:20.10.4~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:20.10.3~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:20.10.2~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:20.10.1~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:20.10.0~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:19.03.15~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:19.03.14~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:19.03.13~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:19.03.12~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:19.03.11~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:19.03.10~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:19.03.9~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:19.03.8~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>docker-ce-cli | 5:19.03.7~3-0~ubuntu-bionic | https://mirrors.aliyun.com/docker-ce/linux/ubuntu bionic/stable amd64 Packages<br>...<br><br><span class="hljs-comment"># Step 2: 安装指定版本的Docker-CE: (VERSION例如上面的5:17.03.1~ce-0~ubuntu-xenial)</span><br>sudo apt-get -y install docker-ce=[VERSION] docker-ce-cli=[VERSION]<br><span class="hljs-comment">#示例:指定版本安装</span><br><span class="hljs-comment"># apt-get -y install docker-ce=5:19.03.10~3-0~ubuntu-bionic docker-ce-cli=5:19.03.10~3-0~ubuntu-bionic</span><br>......<br><br><span class="hljs-comment"># docker version </span><br>Client: Docker Engine - Community<br> Version:           19.03.10<br> API version:       1.40<br> Go version:        go1.13.10<br> Git commit:        9424aeaee9<br> Built:             Thu May 28 22:16:49 2020<br> OS/Arch:           linux/amd64<br> Experimental:      <span class="hljs-literal">false</span><br><br>Server: Docker Engine - Community<br> Engine:<br>  Version:          19.03.10<br>  API version:      1.40 (minimum version 1.12)<br>  Go version:       go1.13.10<br>  Git commit:       9424aeaee9<br>  Built:            Thu May 28 22:15:20 2020<br>  OS/Arch:          linux/amd64<br>  Experimental:     <span class="hljs-literal">false</span><br> containerd:<br>  Version:          1.4.6<br>  GitCommit:        d71fcd7d8303cbf684402823e425e9dd2e99285d<br> runc:<br>  Version:          1.0.0-rc95<br>  GitCommit:        b9ee9c6314599f1b4a7f497e1f1f856fe433d3b7<br> docker-init:<br>  Version:          0.18.0<br>  GitCommit:        fec3683<br></code></pre></td></tr></table></figure>

<p><strong>删除docker</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#卸载docker-ce</span><br><span class="hljs-comment"># apt purge docker-ce</span><br><span class="hljs-comment">#删除docker资源存放的相关文件</span><br><span class="hljs-comment"># rm -rf /var/lib/docker</span><br></code></pre></td></tr></table></figure>

<h4 id="1-2-2-2-CentOS-安装和删除Docker"><a href="#1-2-2-2-CentOS-安装和删除Docker" class="headerlink" title="1.2.2.2 CentOS 安装和删除Docker"></a>1.2.2.2 CentOS 安装和删除Docker</h4><p>官方文档: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://docs.docker.com/install/linux/docker-ce/centos/<br></code></pre></td></tr></table></figure>

<p>CentOS 6 因内核太旧，即使支持安装docker，但会有各种问题，不建议安装</p>
<p>CentOS 7 的 extras 源虽然可以安装docker，但包比较旧，建议从官方源或镜像源站点下载安装docker</p>
<p>CentOS 8 有新技术 podman 代替 docker</p>
<p>因此建议在CentOS 7 上安装 docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#extras 源中包名为docker</span><br><span class="hljs-comment"># yum list docker</span><br>Loaded plugins: fastestmirror<br>Repository base is listed more than once <span class="hljs-keyword">in</span> the configuration<br>Repository extras is listed more than once <span class="hljs-keyword">in</span> the configuration<br>Loading mirror speeds from cached hostfile<br>* base: mirrors.tuna.tsinghua.edu.cn<br>* extras: mirrors.tuna.tsinghua.edu.cn<br>* updates: mirrors.tuna.tsinghua.edu.cn<br>Available Packages<br>docker.x86_64    2:1.13.1-103.git7f2769b.el7.centos             extras<br></code></pre></td></tr></table></figure>

<p><strong>下载rpm包安装:</strong><br>官方rpm包下载地址:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://download.docker.com/linux/centos/7/x86_64/stable/Packages/<br></code></pre></td></tr></table></figure>

<p>阿里镜像下载地址:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/Packages/<br></code></pre></td></tr></table></figure>

<p><strong>通过yum源安装:</strong></p>
<p>由于官网的yum源太慢，下面<strong>使用阿里云的Yum源进行安装</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># mkdir /etc/yum.repos.d/backup</span><br><span class="hljs-comment"># mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup</span><br><br><span class="hljs-comment">#CentOS 7 安装docker依赖三个yum源:Base,Extras,docker-ce</span><br>wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo<br>wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo<br>wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br><br><span class="hljs-comment"># yum clean all</span><br><span class="hljs-comment"># yum -y install docker-ce</span><br><span class="hljs-comment"># systemctl enable --now docker</span><br></code></pre></td></tr></table></figure>

<p><strong>使用华为镜像进行安装</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#清除以前的docker</span><br><span class="hljs-comment"># sudo yum remove docker docker-common docker-selinux docker-engine</span><br><span class="hljs-comment">#安装依赖</span><br><span class="hljs-comment"># sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="hljs-comment">#下载repo文件</span><br><span class="hljs-comment"># wget -O /etc/yum.repos.d/docker-ce.repo https://repo.huaweicloud.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="hljs-comment">#替换仓库地址</span><br><span class="hljs-comment"># sudo sed -i &#x27;s+download.docker.com+repo.huaweicloud.com/docker-ce+&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><br><span class="hljs-comment">#安装docker</span><br><span class="hljs-comment"># yum clean all</span><br><span class="hljs-comment"># yum -y install docker-ce</span><br><span class="hljs-comment"># systemctl enable --now docker</span><br></code></pre></td></tr></table></figure>

<p><strong>删除 docker</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#卸载docker-ce</span><br><span class="hljs-comment"># yum remove docker-ce</span><br><span class="hljs-comment">#删除docker资源存放的相关文件</span><br><span class="hljs-comment"># rm -rf /var/lib/docker</span><br></code></pre></td></tr></table></figure>

<p>范例: CentOS 7 基于阿里云的安装docker方法</p>
<p>阿里云说明: <a target="_blank" rel="noopener" href="https://developer.aliyun.com/mirror/docker-ce?spm=a2c6h.13651102.0.0.3e221b11sUMKNV">https://developer.aliyun.com/mirror/docker-ce?spm=a2c6h.13651102.0.0.3e221b11sUMKNV</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#step 1: 安装必要的一些系统工具</span><br><span class="hljs-comment"># yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><br><span class="hljs-comment">#Step 2: 添加软件源信息</span><br><span class="hljs-comment"># yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><br><span class="hljs-comment">#Step 3: 更新并安装Docker-CE</span><br><span class="hljs-comment"># yum makecache fast</span><br><span class="hljs-comment"># yum -y install docker-ce</span><br><br><span class="hljs-comment">#Step 4: 开启Docker服务</span><br><span class="hljs-comment"># service docker start</span><br><br><span class="hljs-comment"># 注意: </span><br><span class="hljs-comment"># 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，您可以通过以下方式开启。同理可以开启各种测试版本等。</span><br><span class="hljs-comment"># vim /etc/yum.repos.d/docker-ee.repo</span><br><span class="hljs-comment">#  将[docker-ce-test]下方的enabled=0修改为enabled=1</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># 安装指定版本的Docker-CE:</span><br><span class="hljs-comment"># Step 1: 查找Docker-CE的版本:</span><br><span class="hljs-comment"># yum list docker-ce.x86_64 --showduplicates | sort -r</span><br><span class="hljs-comment">#  Loading mirror speeds from cached hostfile</span><br><span class="hljs-comment">#  Loaded plugins: branch, fastestmirror, langpacks</span><br><span class="hljs-comment">#  docker-ce.x86_64      17.03.1.ce-1.el7.centos      docker-ce-stable</span><br><span class="hljs-comment">#  docker-ce.x86_64      17.03.1.ce-1.el7.centos      @docker-ce-stable</span><br><span class="hljs-comment">#  docker-ce.x86_64      17.03.0.ce-1.el7.centos      docker-ce-stable</span><br><span class="hljs-comment">#  Available Packages</span><br><span class="hljs-comment"># Step2: 安装指定版本的Docker-CE: (VERSION例如上面的17.03.0.ce.1-1.el7.centos)</span><br><span class="hljs-comment"># yum -y install docker-ce-[VERSION]</span><br><br><span class="hljs-comment">#示例</span><br><span class="hljs-comment"># yum -y install docker-ce-19.03.12-3.el7</span><br></code></pre></td></tr></table></figure>

<p>范例: 在CentOS 7上安装指定版本的docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cat /etc/redhat-release</span><br>CentOS Linux release 7.6.1810 (Core)<br><span class="hljs-comment"># ls /etc/yum.repos.d/</span><br>backup base.repo<br><span class="hljs-comment"># wget -P /etc/yum.repos.d/ https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br>Saving to: ‘/etc/yum.repos.d/docker-ce.repo’<br>100%[====================================================================&gt;]<br>2,640    --.-K/s  <span class="hljs-keyword">in</span> 0s   <br><br>2020-01-23 21:56:21 (505 MB/s) - ‘/etc/yum.repos.d/docker-ce.repo’ saved<br>[2640/2640]<br><br><span class="hljs-comment"># ls /etc/yum.repos.d/</span><br>backup base.repo docker-ce.repo<br><br><span class="hljs-comment"># yum clean all</span><br>Loaded plugins: fastestmirror<br>Cleaning repos: base docker-ce-stable epel extras<br>Cleaning up list of fastest mirrors<br><br><span class="hljs-comment"># yum repolist</span><br>repo id          repo name                     <br>status<br>base            CentOS                       <br>10,019<br>docker-ce-stable/x86_64  Docker CE Stable - x86_64              <br>  63<br>epel/7/x86_64       EPEL                        <br>13,513<br>extras/7/x86_64      extras                       <br>  307<br>repolist: 23,902<br><br><span class="hljs-comment"># yum list docker-ce* --showduplicates | sort -r</span><br>Loading mirror speeds from cached hostfile<br>Loaded plugins: fastestmirror<br>docker-ce.x86_64         3:19.03.5-3.el7         docker-ce-stable<br>docker-ce.x86_64         3:19.03.4-3.el7         docker-ce-stable<br>docker-ce.x86_64         3:19.03.3-3.el7         docker-ce-stable<br>docker-ce.x86_64         3:19.03.2-3.el7         docker-ce-stable<br>docker-ce.x86_64         3:19.03.1-3.el7         docker-ce-stable<br>docker-ce.x86_64         3:19.03.0-3.el7         docker-ce-stable<br>docker-ce.x86_64         3:18.09.9-3.el7         docker-ce-stable<br>docker-ce.x86_64         3:18.09.8-3.el7         docker-ce-stable<br>......<br><br><span class="hljs-comment"># yum -y install docker-ce-18.09.9-3.el7 docker-ce-cli-18.09.9-3.el7</span><br><br><span class="hljs-comment"># docker version</span><br>Client:<br>Version:      18.09.9<br>API version:    1.39<br>Go version:    go1.11.13<br>Git commit:    039a7df9ba<br>Built:       Wed Sep  4 16:51:21 2019<br>OS/Arch:      linux/amd64<br>Experimental:    <span class="hljs-literal">false</span><br>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the<br>docker daemon running?<br><br><span class="hljs-comment"># systemctl enable --now docker</span><br><br><span class="hljs-comment"># docker version</span><br>Client:<br>Version:      18.09.9<br>API version:    1.39<br>Go version:    go1.11.13<br>Git commit:    039a7df9ba<br>Built:       Wed Sep  4 16:51:21 2019<br>OS/Arch:      linux/amd64<br>Experimental:    <span class="hljs-literal">false</span><br><br>Server: Docker Engine - Community<br>Engine:<br>Version:      18.09.9<br>API version:    1.39 (minimum version 1.12)<br>Go version:    go1.11.13<br>Git commit:    039a7df<br>Built:      Wed Sep  4 16:22:32 2019<br>OS/Arch:     linux/amd64<br>Experimental:   <span class="hljs-literal">false</span><br>[root@centos7 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>范例: 在CentOS8安装docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># tee /etc/yum.repos.d/docker.repo &lt;&lt;EOF</span><br>[docker]<br>name=docker<br>gpgcheck=0<br>baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/8/x86_64/stable/<br>EOF<br><br><span class="hljs-comment"># yum list docker-ce* --showduplicates | sort -r</span><br>Last metadata expiration check: 0:02:06 ago on Wed 23 Jun 2021 08:48:20 AM CST.<br>docker-ce.x86_64                             3:20.10.7-3.el8              docker<br>docker-ce.x86_64                             3:20.10.6-3.el8              docker<br>docker-ce.x86_64                             3:20.10.5-3.el8              docker<br>docker-ce.x86_64                             3:20.10.4-3.el8              docker<br>docker-ce.x86_64                             3:20.10.3-3.el8              docker<br>docker-ce.x86_64                             3:20.10.2-3.el8              docker<br>docker-ce.x86_64                             3:20.10.1-3.el8              docker<br>......<br><br><span class="hljs-comment">#查看是否有安装过podam，centos8默认安装podman</span><br><span class="hljs-comment"># rpm -q podman</span><br>podman-2.0.5-5.module_el8.3.0+512+b3b58dca.x86_64<br><br><span class="hljs-comment">#删除podam</span><br><span class="hljs-comment"># yum erase podman buildah -y</span><br><br><span class="hljs-comment">#安装docker-ce</span><br><span class="hljs-comment"># dnf -y install docker-ce</span><br></code></pre></td></tr></table></figure>

<h4 id="1-2-2-3-Linux-二进制安装"><a href="#1-2-2-3-Linux-二进制安装" class="headerlink" title="1.2.2.3 Linux 二进制安装"></a>1.2.2.3 Linux 二进制安装</h4><p>本方法适用于无法上网或无法通过包安装方式安装的主机上安装docker</p>
<p>安装文档: </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://docs.docker.com/install/linux/docker-ce/binaries/<br></code></pre></td></tr></table></figure>

<p><strong>二进制安装下载路径</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">https://download.docker.com/linux/<br>https://mirrors.aliyun.com/docker-ce/linux/static/stable/x86_64/<br></code></pre></td></tr></table></figure>


<p>范例: 在CentOS8上实现二进制安装docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># wget https://download.docker.com/linux/static/stable/x86_64/docker-19.03.5.tgz</span><br>--2020-01-24 18:02:55--<br>https://download.docker.com/linux/static/stable/x86_64/docker-19.03.5.tgz<br>Resolving download.docker.com (download.docker.com)... 143.204.83.37,<br>143.204.83.32, 143.204.83.95, ...<br>Connecting to download.docker.com (download.docker.com)|143.204.83.37|:443...<br>connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 63252595 (60M) [application/x-tar]<br>Saving to: ‘docker-19.03.5.tgz’<br>docker-19.03.5.tgz      100%[=========================================&gt;]<br> 60.32M  11.3MB/s   <span class="hljs-keyword">in</span> 5.6s  <br> <br>2020-01-24 18:03:02 (10.7 MB/s) - ‘docker-19.03.5.tgz’ saved [63252595/63252595]<br><br><span class="hljs-comment"># tar xvf docker-19.03.5.tgz</span><br>docker/<br>docker/docker-init<br>docker/docker<br>docker/dockerd<br>docker/runc<br>docker/ctr<br>docker/docker-proxy<br>docker/containerd<br>docker/containerd-shim<br><br><span class="hljs-comment"># \cp docker/* /usr/bin/</span><br><br><span class="hljs-comment">#启动dockerd服务</span><br><span class="hljs-comment"># dockerd &amp;&gt;/dev/null &amp;</span><br><br><span class="hljs-comment"># docker version</span><br>Client: Docker Engine - Community<br>Version:      19.03.5<br>API version:    1.40<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:       Wed Nov 13 07:22:05 2019<br>OS/Arch:      linux/amd64<br>Experimental:    <span class="hljs-literal">false</span><br><br>Server: Docker Engine - Community<br>Engine:<br>Version:      19.03.5<br>API version:    1.40 (minimum version 1.12)<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:      Wed Nov 13 07:28:45 2019<br>OS/Arch:     linux/amd64<br>Experimental:   <span class="hljs-literal">false</span><br>containerd:<br>Version:     v1.2.10<br>GitCommit:    b34a5c8af56e510852c35414db4c1f4fa6172339<br>runc:<br>Version:      1.0.0-rc8+dev<br>GitCommit:    3e425f80a8c931f88e6d94a8c831b9d5aa481657<br>docker-init:<br>Version:      0.18.0<br>GitCommit:    fec3683<br><br><span class="hljs-comment"># docker run hello-world</span><br>Unable to find image <span class="hljs-string">&#x27;hello-world:latest&#x27;</span> locally<br>latest: Pulling from library/hello-world<br>1b930d010525: Pull complete<br>Digest: sha256:9572f7cdcee8591948c2963463447a53466950b3fc15a247fcad1917ca215a2f<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> hello-world:latest<br><br>Hello from Docker!<br>This message shows that your installation appears to be working correctly.<br><br>To generate this message, Docker took the following steps:<br>1. The Docker client contacted the Docker daemon.<br>2. The Docker daemon pulled the <span class="hljs-string">&quot;hello-world&quot;</span> image from the Docker Hub.<br> (amd64)<br>3. The Docker daemon created a new container from that image <span class="hljs-built_in">which</span> runs the<br> executable that produces the output you are currently reading.<br>4. The Docker daemon streamed that output to the Docker client, <span class="hljs-built_in">which</span> sent it<br> to your terminal.<br> <br>To try something more ambitious, you can run an Ubuntu container with:<br>$ docker run -it ubuntu bash<br><br>Share images, automate workflows, and more with a free Docker ID:<br>https://hub.docker.com/<br><br>For more examples and ideas, visit:<br>https://docs.docker.com/get-started/<br><br><span class="hljs-comment"># pstree -p</span><br>systemd(1)─┬─NetworkManager(660)─┬─&#123;NetworkManager&#125;(669)<br>     │           └─&#123;NetworkManager&#125;(671)<br>     ├─VGAuthService(662)<br>     ├─agetty(718)<br>     ├─atd(712)<br>     ├─auditd(625)───&#123;auditd&#125;(627)<br>     ├─automount(905)─┬─&#123;automount&#125;(912)<br>     │        ├─&#123;automount&#125;(913)<br>     │        ├─&#123;automount&#125;(930)<br>     │        └─&#123;automount&#125;(937)<br>     ├─containerd(679)─┬─&#123;containerd&#125;(693)<br>     │         ├─&#123;containerd&#125;(694)<br>     │         ├─&#123;containerd&#125;(696)<br>     │         ├─&#123;containerd&#125;(704)<br>     │         ├─&#123;containerd&#125;(705)<br>     │         ├─&#123;containerd&#125;(707)<br>     │         └─&#123;containerd&#125;(708)<br>     ├─crond(713)<br>     ├─dbus-daemon(658)<br>     ├─dockerd(908)─┬─&#123;dockerd&#125;(922)<br>     │       ├─&#123;dockerd&#125;(923)<br>     │       ├─&#123;dockerd&#125;(925)<br>     │       ├─&#123;dockerd&#125;(944)<br>     │       ├─&#123;dockerd&#125;(1028)<br>     │       ├─&#123;dockerd&#125;(1100)<br>     │       └─&#123;dockerd&#125;(1114)<br>     ├─polkitd(659)─┬─&#123;polkitd&#125;(670)<br>     │       ├─&#123;polkitd&#125;(672)<br>     │       ├─&#123;polkitd&#125;(677)<br>     │       ├─&#123;polkitd&#125;(678)<br>     │       └─&#123;polkitd&#125;(701)<br>     ├─rngd(664)───&#123;rngd&#125;(666)<br>     ├─rsyslogd(906)─┬─&#123;rsyslogd&#125;(911)<br>     │        └─&#123;rsyslogd&#125;(914)<br>     ├─sshd(675)───sshd(1370)───sshd(1382)───bash(1383)───pstree(1441)<br>     ├─sssd(661)─┬─sssd_be(688)<br>     │      └─sssd_nss(703)<br>     ├─systemd(1373)───(sd-pam)(1376)<br>     ├─systemd-journal(551)<br>     ├─systemd-logind(709)<br>     ├─systemd-udevd(580)<br>     ├─tuned(674)─┬─&#123;tuned&#125;(915)<br>     │      ├─&#123;tuned&#125;(934)<br>     │      └─&#123;tuned&#125;(948)<br>     └─vmtoolsd(663)<br></code></pre></td></tr></table></figure>

<p>范例: 创建相关的service文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#创建相关的service文件,此方式新版有问题</span><br><span class="hljs-comment"># groupadd -r docker</span><br><br><span class="hljs-comment">#将Ubuntu1804或CentOS7基于包方式安装的相关文件复制到相应目录下</span><br><span class="hljs-comment"># ll /lib/systemd/system/docker.*</span><br>-rw-r--r-- 1 root root 1683 Jun 22 23:44 /lib/systemd/system/docker.service<br>-rw-r--r-- 1 root root  197 Jun 22 23:44 /lib/systemd/system/docker.socket<br><span class="hljs-comment"># ll /lib/systemd/system/containerd.service</span><br>-rw-r--r-- 1 root root 1085 May  2  2020 /lib/systemd/system/containerd.service<br><br><span class="hljs-comment"># cat /lib/systemd/system/docker.socket</span><br>[Unit]<br>Description=Docker Socket <span class="hljs-keyword">for</span> the API<br>PartOf=docker.service<br><br>[Socket]<br>ListenStream=/var/run/docker.sock<br>SocketMode=0660<br>SocketUser=root<br>SocketGroup=docker<br><br>[Install]<br>WantedBy=sockets.target<br><br><span class="hljs-comment"># cat /lib/systemd/system/docker.service</span><br>[Unit]<br>Description=Docker Application Container Engine<br>Documentation=https://docs.docker.com<br>BindsTo=containerd.service<br>After=network-online.target firewalld.service containerd.service<br>Wants=network-online.target<br>Requires=docker.socket<br><br>[Service]<br>Type=notify<br><span class="hljs-comment"># the default is not to use systemd for cgroups because the delegate issues</span><br>still<br><span class="hljs-comment"># exists and systemd currently does not support the cgroup feature set required</span><br><span class="hljs-comment"># for containers run by docker</span><br>ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock<br>ExecReload=/bin/<span class="hljs-built_in">kill</span> -s HUP <span class="hljs-variable">$MAINPID</span><br>TimeoutSec=0<br>RestartSec=2<br>Restart=always<br><br><span class="hljs-comment"># Note that StartLimit* options were moved from &quot;Service&quot; to &quot;Unit&quot; in systemd 229.</span><br><span class="hljs-comment"># Both the old, and new location are accepted by systemd 229 and up, so using the old location</span><br><span class="hljs-comment"># to make them work for either version of systemd.</span><br>StartLimitBurst=3<br><br><span class="hljs-comment"># Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.</span><br><span class="hljs-comment"># Both the old, and new name are accepted by systemd 230 and up, so using the old name to make</span><br><span class="hljs-comment"># this option work for either version of systemd.</span><br>StartLimitInterval=60s<br><br><span class="hljs-comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="hljs-comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br>LimitNOFILE=infinity<br>LimitNPROC=infinity<br>LimitCORE=infinity<br><br><span class="hljs-comment"># Comment TasksMax if your systemd version does not support it.</span><br><span class="hljs-comment"># Only systemd 226 and above support this option.</span><br>TasksMax=infinity<br><br><span class="hljs-comment"># set delegate yes so that systemd does not reset the cgroups of docker containers</span><br>Delegate=yes<br><br><span class="hljs-comment"># kill only the docker process, not all processes in the cgroup</span><br>KillMode=process<br><br>[Install]<br>WantedBy=multi-user.target<br><br><span class="hljs-comment"># cat /lib/systemd/system/containerd.service</span><br><span class="hljs-comment">#  Copyright 2018-2020 Docker Inc.</span><br><br><span class="hljs-comment">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment">#  you may not use this file except in compliance with the License.</span><br><span class="hljs-comment">#  You may obtain a copy of the License at</span><br><br><span class="hljs-comment">#    http://www.apache.org/licenses/LICENSE-2.0</span><br><br><span class="hljs-comment">#  Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment">#  See the License for the specific language governing permissions and</span><br><span class="hljs-comment">#  limitations under the License.</span><br><br>[Unit]<br>Description=containerd container runtime<br>Documentation=https://containerd.io<br>After=network.target<br><br>[Service]<br>ExecStartPre=-/sbin/modprobe overlay<br>ExecStart=/usr/bin/containerd<br>KillMode=process<br>Delegate=yes<br>LimitNOFILE=1048576<br><span class="hljs-comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="hljs-comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br>LimitNPROC=infinity<br>LimitCORE=infinity<br>TasksMax=infinity<br><br>[Install]<br>WantedBy=multi-user.target<br><br><span class="hljs-comment"># scp /lib/systemd/system/docker.* /lib/systemd/system/containerd.service 10.0.0.8:/lib/systemd/system/</span><br>The authenticity of host <span class="hljs-string">&#x27;10.0.0.8 (10.0.0.8)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ECDSA key fingerprint is SHA256:8mUO3Wy13Ktt5pRBKaOU40avmw1x0gH5XTPK48CEWoM.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.0.0.8<span class="hljs-string">&#x27; (ECDSA) to the list of known hosts.</span><br><span class="hljs-string">root@10.0.0.8&#x27;</span>s password:<br>docker.service                       100% 1683  650.8KB/s<br> 00:00 docker.socket                        100%  197 <br>303.3KB/s  00:00<br>containerd.service                     100%  487  516.6KB/s<br> 00:00<br> <br><span class="hljs-comment"># systemctl daemon-reload</span><br><span class="hljs-comment"># systemctl enable --now docker</span><br></code></pre></td></tr></table></figure>

<h4 id="1-2-2-4-安装-podman"><a href="#1-2-2-4-安装-podman" class="headerlink" title="1.2.2.4 安装 podman"></a>1.2.2.4 安装 podman</h4><p>范例: 在CentOS8上安装podman</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#在CentOS8上安装docker会自动安装podman,docker工具只是一个脚本，调用了Podman</span><br><span class="hljs-comment"># dnf install docker</span><br><span class="hljs-comment"># rpm -ql podman-docker</span><br>/usr/bin/docker<br>......<br><span class="hljs-comment">#cat /usr/bin/docker</span><br><span class="hljs-comment">#!/bin/sh</span><br>[ -f /etc/containers/nodocker ] || \<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Emulate Docker CLI using podman. Create /etc/containers/nodocker to quiet</span><br><span class="hljs-string">msg.&quot;</span> &gt;&amp;2<br><span class="hljs-built_in">exec</span> /usr/bin/podman <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#podman version</span><br>Version:       1.4.2-stable2<br>RemoteAPI Version:  1<br>Go Version:     go1.12.8<br>OS/Arch:      linux/amd64<br><br><span class="hljs-comment">#修改拉取镜像的地址的顺序，提高速度</span><br><span class="hljs-comment"># vim /etc/containers/registries.conf</span><br>[registries.search]<br>registries = [<span class="hljs-string">&#x27;docker.io&#x27;</span>,<span class="hljs-string">&#x27;quay.io&#x27;</span>,<span class="hljs-string">&#x27;registry.redhat.io&#x27;</span>,<span class="hljs-string">&#x27;registry.access.redhat.com&#x27;</span>] <br></code></pre></td></tr></table></figure>

<h4 id="1-2-2-5-在不同系统上实现一键安装-docker-脚本"><a href="#1-2-2-5-在不同系统上实现一键安装-docker-脚本" class="headerlink" title="1.2.2.5 在不同系统上实现一键安装 docker 脚本"></a>1.2.2.5 在不同系统上实现一键安装 docker 脚本</h4><p>马哥云原生视频Docker40分钟有解释docker一键安装脚本</p>
<h5 id="1-2-2-5-1-基于-ubuntu-1804-的-一键安装-docker-脚本"><a href="#1-2-2-5-1-基于-ubuntu-1804-的-一键安装-docker-脚本" class="headerlink" title="1.2.2.5.1 基于 ubuntu 1804 的 一键安装 docker 脚本"></a>1.2.2.5.1 基于 ubuntu 1804 的 一键安装 docker 脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cat install_docker_ubuntu.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#Description: Install docker on Ubuntu1804</span><br><span class="hljs-comment">#Version:1.0</span><br><span class="hljs-comment">#Date:2020-01-22</span><br><br>COLOR=<span class="hljs-string">&quot;echo -e \\033[1;31m&quot;</span><br>END=<span class="hljs-string">&quot;\033[m&quot;</span><br>DOCKER_VERSION=<span class="hljs-string">&quot;5:19.03.5~3-0~ubuntu-bionic&quot;</span><br><br><span class="hljs-function"><span class="hljs-title">install_docker</span></span>()&#123;<br><span class="hljs-comment">#检查是否有安装过docker</span><br>dpkg -s docker-ce &amp;&gt; /dev/null &amp;&amp; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker已安装，退出&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> &amp;&amp; <span class="hljs-built_in">exit</span><br><span class="hljs-comment">#更新apt</span><br>apt update<br><span class="hljs-comment">#安装依赖</span><br>apt  -y install apt-transport-https ca-certificates curl software-properties-common<br><span class="hljs-comment">#安装gpg</span><br>curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -<br><span class="hljs-comment">#修改apt源</span><br>add-apt-repository <span class="hljs-string">&quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable&quot;</span><br><span class="hljs-comment">#再次更新apt</span><br>apt update<br><br><span class="hljs-comment">#安装docker</span><br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker有以下版本&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>apt-cache madison docker-ce<br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;5秒后即将安装: docker-&quot;</span><span class="hljs-variable">$&#123;DOCKER_VERSION&#125;</span><span class="hljs-string">&quot; 版本.....&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;如果想安装其它Docker版本，请按ctrl+c键退出，修改版本再执行&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>sleep 5<br><br>apt -y install docker-ce=<span class="hljs-variable">$&#123;DOCKER_VERSION&#125;</span> docker-ce-cli=<span class="hljs-variable">$&#123;DOCKER_VERSION&#125;</span><br><br><span class="hljs-comment">#添加阿里云加速</span><br>mkdir -p /etc/docker<br>tee /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>&#123;<br> <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://si7y70hh.mirror.aliyuncs.com&quot;</span>]<br>&#125;<br>EOF<br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> --now docker<br>docker version &amp;&amp; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker 安装成功&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> ||  <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker 安装失败&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>&#125;<br><br>install_docker<br></code></pre></td></tr></table></figure>

<h5 id="1-2-2-5-2-基于-CentOS-8-实现一键安装-docker-脚本"><a href="#1-2-2-5-2-基于-CentOS-8-实现一键安装-docker-脚本" class="headerlink" title="1.2.2.5.2 基于 CentOS 8 实现一键安装 docker 脚本"></a>1.2.2.5.2 基于 CentOS 8 实现一键安装 docker 脚本</h5><h6 id="1-2-2-5-2-1-脚本1"><a href="#1-2-2-5-2-1-脚本1" class="headerlink" title="1.2.2.5.2.1 脚本1"></a>1.2.2.5.2.1 脚本1</h6><p>利用阿里云的基于CentOS8的docker yum源实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">cat install_docker_centos8.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment">#Author: wangxiaochun</span><br><span class="hljs-comment">#QQ: 29308620</span><br><span class="hljs-comment">#Date: 2020-11-13</span><br><span class="hljs-comment">#FileName： install_docker_for_centos8.sh</span><br><span class="hljs-comment">#URL: http://www.wangxiaochun.com</span><br><span class="hljs-comment">#Description： The test script</span><br><span class="hljs-comment">#Copyright (C): 2020 All rights reserved</span><br><span class="hljs-comment">#********************************************************************</span><br><br>. /etc/init.d/<span class="hljs-built_in">functions</span><br>COLOR=<span class="hljs-string">&quot;echo -e \\E[1;32m&quot;</span><br>END=<span class="hljs-string">&quot;\\E[0m&quot;</span><br>DOCKER_VERSION=<span class="hljs-string">&quot;-19.03.13-3.el8&quot;</span><br><br><span class="hljs-function"><span class="hljs-title">install_docker</span></span>() &#123;                               <br>              <br>  <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;开始安装 Docker.....&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>  sleep 1<br>cat &gt; /etc/yum.repos.d/docker.repo &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[docker]</span><br><span class="hljs-string">name=docker</span><br><span class="hljs-string">gpgcheck=0</span><br><span class="hljs-string">baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/8/x86_64/stable/</span><br><span class="hljs-string">EOF</span><br> <br> yum clean all<br> yum -y install docker-ce<span class="hljs-variable">$DOCKER_VERSION</span> docker-ce-cli<span class="hljs-variable">$DOCKER_VERSION</span> \<br>   || &#123; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Base,Extras的yum源失败,请检查yum源配置&quot;</span><span class="hljs-variable">$&#123;END&#125;</span>;<span class="hljs-built_in">exit</span>; &#125;<br>  <br>  mkdir -p /etc/docker<br>  cat &gt; /etc/docker/daemon.json &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">&quot;registry-mirrors&quot;: [&quot;https://si7y70hh.mirror.aliyuncs.com&quot;]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><br> systemctl <span class="hljs-built_in">enable</span> --now docker<br> docker version &amp;&amp; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker安装成功&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> || <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker安装失败&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br><br>&#125;<br><br>rpm -q docker-ce &amp;&gt; /dev/null &amp;&amp; action <span class="hljs-string">&quot;Docker已安装&quot;</span> || install_docker<br></code></pre></td></tr></table></figure>

<h6 id="1-2-2-5-2-2-脚本2"><a href="#1-2-2-5-2-2-脚本2" class="headerlink" title="1.2.2.5.2.2 脚本2"></a>1.2.2.5.2.2 脚本2</h6><p>早期CentOS8无yum仓库,可以利用下面脚本安装docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment">#Author: wangxiaochun</span><br><span class="hljs-comment">#QQ: 29308620</span><br><span class="hljs-comment">#Date: 2020-02-27</span><br><span class="hljs-comment">#FileName: install_docker_for_centos8.sh</span><br><span class="hljs-comment">#URL: http://www.magedu.com</span><br><span class="hljs-comment">#Description: The test script</span><br><span class="hljs-comment">#Copyright (C): 2020 All rights reserved</span><br><span class="hljs-comment">#********************************************************************</span><br>. /etc/init.d/<span class="hljs-built_in">functions</span><br>COLOR=<span class="hljs-string">&quot;echo -e \\E[1;32m&quot;</span><br>END=<span class="hljs-string">&quot;\\E[0m&quot;</span><br>DOCKER_VERSION=<span class="hljs-string">&quot;-19.03.8-3.el7&quot;</span><br><br><span class="hljs-function"><span class="hljs-title">install_docker</span></span>() &#123;                               <br>              <br>  <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;开始安装 Docker.....&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>  sleep 1<br>  <br>  wget -P /etc/yum.repos.d/ https://mirrors.aliyun.com/docker-<br>ce/linux/centos/docker-ce.repo || &#123; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">互联网连接失败，请检查网络配置!&quot;</span><span class="hljs-variable">$&#123;END&#125;</span>;<span class="hljs-built_in">exit</span>; &#125;<br> yum clean all<br> dnf -y install https://mirrors.aliyun.com/docker-<br>ce/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.13-3.1.el7.x86_64.rpm<br> yum -y install docker-ce<span class="hljs-variable">$DOCKER_VERSION</span> docker-ce-cli<span class="hljs-variable">$DOCKER_VERSION</span> \<br>     || &#123; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Base,Extras的yum源失败,请检查yum源配置&quot;</span><span class="hljs-variable">$&#123;END&#125;</span>;<span class="hljs-built_in">exit</span>; &#125;<br>     <br> mkdir -p /etc/docker<br>  cat &gt; /etc/docker/daemon.json &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">&quot;registry-mirrors&quot;: [&quot;https://si7y70hh.mirror.aliyuncs.com&quot;]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><br>systemctl <span class="hljs-built_in">enable</span> --now docker<br> docker version &amp;&amp; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker安装成功&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> || <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker安装失败&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br> <br> &#125;<br> <br>rpm -q docker &amp;&gt; /dev/null &amp;&amp; action <span class="hljs-string">&quot;Docker已安装&quot;</span> || install_docker<br></code></pre></td></tr></table></figure>

<h5 id="1-2-2-5-3-基于-CentOS-7-实现一键安装docker-脚本"><a href="#1-2-2-5-3-基于-CentOS-7-实现一键安装docker-脚本" class="headerlink" title="1.2.2.5.3 基于 CentOS 7 实现一键安装docker 脚本"></a>1.2.2.5.3 基于 CentOS 7 实现一键安装docker 脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#cat install_docker_for_centos7.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment">#Author: wangxiaochun</span><br><span class="hljs-comment">#QQ: 29308620</span><br><span class="hljs-comment">#Date: 2020-01-26</span><br><span class="hljs-comment">#FileName: install_docker_for_centos7.sh</span><br><span class="hljs-comment">#URL: http://www.magedu.com</span><br><span class="hljs-comment">#Description: The test script</span><br><span class="hljs-comment">#Copyright (C): 2020 All rights reserved</span><br><span class="hljs-comment">#********************************************************************</span><br>COLOR=<span class="hljs-string">&quot;echo -e \\033[1;31m&quot;</span><br>END=<span class="hljs-string">&quot;\033[m&quot;</span><br>VERSION=<span class="hljs-string">&quot;19.03.5-3.el7&quot;</span><br><br>wget -P /etc/yum.repos.d/ https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo || &#123; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;互联网连接失败，请检查网络配置!&quot;</span><span class="hljs-variable">$&#123;END&#125;</span>;<span class="hljs-built_in">exit</span>; &#125;<br>yum clean all<br>yum -y install docker-ce-<span class="hljs-variable">$VERSION</span> docker-ce-cli-<span class="hljs-variable">$VERSION</span> || &#123;<span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Base,Extras的yum源失败,请检查yum源配置&quot;</span><span class="hljs-variable">$&#123;END&#125;</span>;<span class="hljs-built_in">exit</span>; &#125;<br><br><span class="hljs-comment">#使用阿里做镜像加速</span><br>mkdir -p /etc/docker<br>cat &gt; /etc/docker/daemon.json &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">&quot;registry-mirrors&quot;: [&quot;https://si7y70hh.mirror.aliyuncs.com&quot;]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><br>systemctl <span class="hljs-built_in">enable</span> --now docker<br>docker version &amp;&amp; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker安装成功&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> || <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker安装失败&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-2-3-docker-程序环境"><a href="#1-2-3-docker-程序环境" class="headerlink" title="1.2.3 docker 程序环境"></a>1.2.3 docker 程序环境</h3><p>环境配置文件:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/etc/</span>sysconfig/docker-network<br><span class="hljs-regexp">/etc/</span>sysconfig/docker-storage<br><span class="hljs-regexp">/etc/</span>sysconfig/docker<br></code></pre></td></tr></table></figure>

<p>Unit File:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">/usr/lib/systemd/system/docker.service<br></code></pre></td></tr></table></figure>

<p>docker-ce 配置文件:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">/etc/docker/daemon.json<br></code></pre></td></tr></table></figure>

<p>Docker Registry配置文件:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">/etc/containers/registries.conf<br></code></pre></td></tr></table></figure>

<p><strong>范例: ubuntu 查看docker相关文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#服务器端相关文件</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#dpkg -L docker-ce</span><br>/.<br>/etc<br>/etc/default<br>/etc/default/docker<br>/etc/init<br>/etc/init/docker.conf<br>/etc/init.d<br>/etc/init.d/docker<br>/lib<br>/lib/systemd<br>/lib/systemd/system<br>/lib/systemd/system/docker.service<br>/lib/systemd/system/docker.socket<br>/usr<br>/usr/bin<br>/usr/bin/docker-init<br>/usr/bin/docker-proxy<br>/usr/bin/dockerd<br>/usr/share<br>/usr/share/doc<br>/usr/share/doc/docker-ce<br>/usr/share/doc/docker-ce/README.md<br>/usr/share/doc/docker-ce/changelog.Debian.gz<br>/var<br>/var/lib<br>/var/lib/docker-engine<br>/var/lib/docker-engine/distribution_based_engine.json<br><br><span class="hljs-comment">#客户端相关文件</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#dpkg -L docker-ce-cli</span><br>/.<br>/usr<br>/usr/bin<br>/usr/bin/docker<br>/usr/libexec<br>/usr/libexec/docker<br>/usr/libexec/docker/cli-plugins<br>/usr/libexec/docker/cli-plugins/docker-app<br>/usr/libexec/docker/cli-plugins/docker-buildx<br>/usr/share<br>/usr/share/bash-completion<br>/usr/share/bash-completion/completions<br>/usr/share/bash-completion/completions/docker<br>/usr/share/doc<br>/usr/share/doc/docker-ce-cli<br>/usr/share/doc/docker-ce-cli/changelog.Debian.gz<br>/usr/share/fish<br>/usr/share/fish/vendor_completions.d<br>/usr/share/fish/vendor_completions.d/docker.fish<br>/usr/share/man<br>/usr/share/man/man1<br>/usr/share/man/man1/docker-attach.1.gz<br>/usr/share/man/man1/docker-build.1.gz<br>/usr/share/man/man1/docker-builder-build.1.gz<br>/usr/share/man/man1/docker-builder-prune.1.gz<br>/usr/share/man/man1/docker-builder.1.gz<br>/usr/share/man/man1/docker-checkpoint-create.1.gz<br>/usr/share/man/man1/docker-checkpoint-ls.1.gz<br>/usr/share/man/man1/docker-checkpoint-rm.1.gz<br>/usr/share/man/man1/docker-checkpoint.1.gz<br>/usr/share/man/man1/docker-commit.1.gz<br>/usr/share/man/man1/docker-config-create.1.gz<br>/usr/share/man/man1/docker-config-inspect.1.gz<br>/usr/share/man/man1/docker-config-ls.1.gz<br>/usr/share/man/man1/docker-config-rm.1.gz<br>/usr/share/man/man1/docker-config.1.gz<br>/usr/share/man/man1/docker-container-attach.1.gz<br>/usr/share/man/man1/docker-container-commit.1.gz<br>/usr/share/man/man1/docker-container-cp.1.gz<br>/usr/share/man/man1/docker-container-create.1.gz<br>/usr/share/man/man1/docker-container-diff.1.gz<br>/usr/share/man/man1/docker-container-exec.1.gz<br>/usr/share/man/man1/docker-container-export.1.gz<br>/usr/share/man/man1/docker-container-inspect.1.gz<br>/usr/share/man/man1/docker-container-kill.1.gz<br>/usr/share/man/man1/docker-container-logs.1.gz<br>/usr/share/man/man1/docker-container-ls.1.gz<br>/usr/share/man/man1/docker-container-pause.1.gz<br>/usr/share/man/man1/docker-container-port.1.gz<br>/usr/share/man/man1/docker-container-prune.1.gz<br>/usr/share/man/man1/docker-container-rename.1.gz<br>/usr/share/man/man1/docker-container-restart.1.gz<br>/usr/share/man/man1/docker-container-rm.1.gz<br>/usr/share/man/man1/docker-container-run.1.gz<br>/usr/share/man/man1/docker-container-start.1.gz<br>/usr/share/man/man1/docker-container-stats.1.gz<br>/usr/share/man/man1/docker-container-stop.1.gz<br>/usr/share/man/man1/docker-container-top.1.gz<br>/usr/share/man/man1/docker-container-unpause.1.gz<br>/usr/share/man/man1/docker-container-update.1.gz<br>/usr/share/man/man1/docker-container-wait.1.gz<br>/usr/share/man/man1/docker-container.1.gz<br>/usr/share/man/man1/docker-context-create.1.gz<br>/usr/share/man/man1/docker-context-export.1.gz<br>/usr/share/man/man1/docker-context-import.1.gz<br>/usr/share/man/man1/docker-context-inspect.1.gz<br>/usr/share/man/man1/docker-context-ls.1.gz<br>/usr/share/man/man1/docker-context-rm.1.gz<br>/usr/share/man/man1/docker-context-update.1.gz<br>/usr/share/man/man1/docker-context-use.1.gz<br>/usr/share/man/man1/docker-context.1.gz<br>/usr/share/man/man1/docker-cp.1.gz<br>/usr/share/man/man1/docker-create.1.gz<br>/usr/share/man/man1/docker-deploy.1.gz<br>/usr/share/man/man1/docker-diff.1.gz<br>/usr/share/man/man1/docker-engine-activate.1.gz<br>/usr/share/man/man1/docker-engine-check.1.gz<br>/usr/share/man/man1/docker-engine-update.1.gz<br>/usr/share/man/man1/docker-engine.1.gz<br>/usr/share/man/man1/docker-events.1.gz<br>/usr/share/man/man1/docker-exec.1.gz<br>/usr/share/man/man1/docker-export.1.gz<br>/usr/share/man/man1/docker-history.1.gz<br>/usr/share/man/man1/docker-image-build.1.gz<br>/usr/share/man/man1/docker-image-history.1.gz<br>/usr/share/man/man1/docker-image-import.1.gz<br>/usr/share/man/man1/docker-image-inspect.1.gz<br>/usr/share/man/man1/docker-image-load.1.gz<br>/usr/share/man/man1/docker-image-ls.1.gz<br>/usr/share/man/man1/docker-image-prune.1.gz<br>/usr/share/man/man1/docker-image-pull.1.gz<br>/usr/share/man/man1/docker-image-push.1.gz<br>/usr/share/man/man1/docker-image-rm.1.gz<br>/usr/share/man/man1/docker-image-save.1.gz<br>/usr/share/man/man1/docker-image-tag.1.gz<br>/usr/share/man/man1/docker-image.1.gz<br>/usr/share/man/man1/docker-images.1.gz<br>/usr/share/man/man1/docker-import.1.gz<br>/usr/share/man/man1/docker-info.1.gz<br>/usr/share/man/man1/docker-inspect.1.gz<br>/usr/share/man/man1/docker-kill.1.gz<br>/usr/share/man/man1/docker-load.1.gz<br>/usr/share/man/man1/docker-login.1.gz<br>/usr/share/man/man1/docker-logout.1.gz<br>/usr/share/man/man1/docker-logs.1.gz<br>/usr/share/man/man1/docker-manifest-annotate.1.gz<br>/usr/share/man/man1/docker-manifest-create.1.gz<br>/usr/share/man/man1/docker-manifest-inspect.1.gz<br>/usr/share/man/man1/docker-manifest-push.1.gz<br>/usr/share/man/man1/docker-manifest.1.gz<br>/usr/share/man/man1/docker-network-connect.1.gz<br>/usr/share/man/man1/docker-network-create.1.gz<br>/usr/share/man/man1/docker-network-disconnect.1.gz<br>/usr/share/man/man1/docker-network-inspect.1.gz<br>/usr/share/man/man1/docker-network-ls.1.gz<br>/usr/share/man/man1/docker-network-prune.1.gz<br>/usr/share/man/man1/docker-network-rm.1.gz<br>/usr/share/man/man1/docker-network.1.gz<br>/usr/share/man/man1/docker-node-demote.1.gz<br>/usr/share/man/man1/docker-node-inspect.1.gz<br>/usr/share/man/man1/docker-node-ls.1.gz<br>/usr/share/man/man1/docker-node-promote.1.gz<br>/usr/share/man/man1/docker-node-ps.1.gz<br>/usr/share/man/man1/docker-node-rm.1.gz<br>/usr/share/man/man1/docker-node-update.1.gz<br>/usr/share/man/man1/docker-node.1.gz<br>/usr/share/man/man1/docker-pause.1.gz<br>/usr/share/man/man1/docker-plugin-create.1.gz<br>/usr/share/man/man1/docker-plugin-disable.1.gz<br>/usr/share/man/man1/docker-plugin-enable.1.gz<br>/usr/share/man/man1/docker-plugin-inspect.1.gz<br>/usr/share/man/man1/docker-plugin-install.1.gz<br>/usr/share/man/man1/docker-plugin-ls.1.gz<br>/usr/share/man/man1/docker-plugin-push.1.gz<br>/usr/share/man/man1/docker-plugin-rm.1.gz<br>/usr/share/man/man1/docker-plugin-set.1.gz<br>/usr/share/man/man1/docker-plugin-upgrade.1.gz<br>/usr/share/man/man1/docker-plugin.1.gz<br>/usr/share/man/man1/docker-port.1.gz<br>/usr/share/man/man1/docker-ps.1.gz<br>/usr/share/man/man1/docker-pull.1.gz<br>/usr/share/man/man1/docker-push.1.gz<br>/usr/share/man/man1/docker-rename.1.gz<br>/usr/share/man/man1/docker-restart.1.gz<br>/usr/share/man/man1/docker-rm.1.gz<br>/usr/share/man/man1/docker-rmi.1.gz<br>/usr/share/man/man1/docker-run.1.gz<br>/usr/share/man/man1/docker-save.1.gz<br>/usr/share/man/man1/docker-search.1.gz<br>/usr/share/man/man1/docker-secret-create.1.gz<br>/usr/share/man/man1/docker-secret-inspect.1.gz<br>/usr/share/man/man1/docker-secret-ls.1.gz<br>/usr/share/man/man1/docker-secret-rm.1.gz<br>/usr/share/man/man1/docker-secret.1.gz<br>/usr/share/man/man1/docker-service-create.1.gz<br>/usr/share/man/man1/docker-service-inspect.1.gz<br>/usr/share/man/man1/docker-service-logs.1.gz<br>/usr/share/man/man1/docker-service-ls.1.gz<br>/usr/share/man/man1/docker-service-ps.1.gz<br>/usr/share/man/man1/docker-service-rm.1.gz<br>/usr/share/man/man1/docker-service-rollback.1.gz<br>/usr/share/man/man1/docker-service-scale.1.gz<br>/usr/share/man/man1/docker-service-update.1.gz<br>/usr/share/man/man1/docker-service.1.gz<br>/usr/share/man/man1/docker-stack-deploy.1.gz<br>/usr/share/man/man1/docker-stack-ls.1.gz<br>/usr/share/man/man1/docker-stack-ps.1.gz<br>/usr/share/man/man1/docker-stack-rm.1.gz<br>/usr/share/man/man1/docker-stack-services.1.gz<br>/usr/share/man/man1/docker-stack.1.gz<br>/usr/share/man/man1/docker-start.1.gz<br>/usr/share/man/man1/docker-stats.1.gz<br>/usr/share/man/man1/docker-stop.1.gz<br>/usr/share/man/man1/docker-swarm-ca.1.gz<br>/usr/share/man/man1/docker-swarm-init.1.gz<br>/usr/share/man/man1/docker-swarm-join-token.1.gz<br>/usr/share/man/man1/docker-swarm-join.1.gz<br>/usr/share/man/man1/docker-swarm-leave.1.gz<br>/usr/share/man/man1/docker-swarm-unlock-key.1.gz<br>/usr/share/man/man1/docker-swarm-unlock.1.gz<br>/usr/share/man/man1/docker-swarm-update.1.gz<br>/usr/share/man/man1/docker-swarm.1.gz<br>/usr/share/man/man1/docker-system-df.1.gz<br>/usr/share/man/man1/docker-system-events.1.gz<br>/usr/share/man/man1/docker-system-info.1.gz<br>/usr/share/man/man1/docker-system-prune.1.gz<br>/usr/share/man/man1/docker-system.1.gz<br>/usr/share/man/man1/docker-tag.1.gz<br>/usr/share/man/man1/docker-top.1.gz<br>/usr/share/man/man1/docker-trust-inspect.1.gz<br>/usr/share/man/man1/docker-trust-key-generate.1.gz<br>/usr/share/man/man1/docker-trust-key-load.1.gz<br>/usr/share/man/man1/docker-trust-key.1.gz<br>/usr/share/man/man1/docker-trust-revoke.1.gz<br>/usr/share/man/man1/docker-trust-sign.1.gz<br>/usr/share/man/man1/docker-trust-signer-add.1.gz<br>/usr/share/man/man1/docker-trust-signer-remove.1.gz<br>/usr/share/man/man1/docker-trust-signer.1.gz<br>/usr/share/man/man1/docker-trust.1.gz<br>/usr/share/man/man1/docker-unpause.1.gz<br>/usr/share/man/man1/docker-update.1.gz<br>/usr/share/man/man1/docker-version.1.gz<br>/usr/share/man/man1/docker-volume-create.1.gz<br>/usr/share/man/man1/docker-volume-inspect.1.gz<br>/usr/share/man/man1/docker-volume-ls.1.gz<br>/usr/share/man/man1/docker-volume-prune.1.gz<br>/usr/share/man/man1/docker-volume-rm.1.gz<br>/usr/share/man/man1/docker-volume.1.gz<br>/usr/share/man/man1/docker-wait.1.gz<br>/usr/share/man/man1/docker.1.gz<br>/usr/share/man/man5<br>/usr/share/man/man5/Dockerfile.5.gz<br>/usr/share/man/man5/docker-config-json.5.gz<br>/usr/share/man/man8<br>/usr/share/man/man8/dockerd.8.gz<br>/usr/share/zsh<br>/usr/share/zsh/vendor-completions<br>/usr/share/zsh/vendor-completions/_docker<br></code></pre></td></tr></table></figure>

<p><strong>范例: CentOS7 查看docker相关文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#rpm -ql docker-ce</span><br>/usr/bin/docker-init<br>/usr/bin/docker-proxy<br>/usr/bin/dockerd<br>/usr/lib/systemd/system/docker.service<br>/usr/lib/systemd/system/docker.socket<br>[root@centos7 ~]<span class="hljs-comment">#rpm -ql docker-ce-cli</span><br>/usr/bin/docker<br>/usr/libexec/docker/cli-plugins/docker-app<br>/usr/libexec/docker/cli-plugins/docker-buildx<br>/usr/share/bash-completion/completions/docker<br>/usr/share/doc/docker-ce-cli-19.03.12<br>/usr/share/doc/docker-ce-cli-19.03.12/LICENSE<br>/usr/share/doc/docker-ce-cli-19.03.12/MAINTAINERS<br>/usr/share/doc/docker-ce-cli-19.03.12/NOTICE<br>/usr/share/doc/docker-ce-cli-19.03.12/README.md<br>/usr/share/fish/vendor_completions.d/docker.fish<br>/usr/share/man/man1/docker-attach.1.gz<br>/usr/share/man/man1/docker-build.1.gz<br>/usr/share/man/man1/docker-builder-build.1.gz<br>/usr/share/man/man1/docker-builder-prune.1.gz<br>/usr/share/man/man1/docker-builder.1.gz<br>/usr/share/man/man1/docker-checkpoint-create.1.gz<br>/usr/share/man/man1/docker-checkpoint-ls.1.gz<br>/usr/share/man/man1/docker-checkpoint-rm.1.gz<br>/usr/share/man/man1/docker-checkpoint.1.gz<br>/usr/share/man/man1/docker-commit.1.gz<br>/usr/share/man/man1/docker-config-create.1.gz<br>/usr/share/man/man1/docker-config-inspect.1.gz<br>/usr/share/man/man1/docker-config-ls.1.gz<br>/usr/share/man/man1/docker-config-rm.1.gz<br>/usr/share/man/man1/docker-config.1.gz<br>/usr/share/man/man1/docker-container-attach.1.gz<br>/usr/share/man/man1/docker-container-commit.1.gz<br>/usr/share/man/man1/docker-container-cp.1.gz<br>/usr/share/man/man1/docker-container-create.1.gz<br>/usr/share/man/man1/docker-container-diff.1.gz<br>/usr/share/man/man1/docker-container-exec.1.gz<br>/usr/share/man/man1/docker-container-export.1.gz<br>/usr/share/man/man1/docker-container-inspect.1.gz<br>/usr/share/man/man1/docker-container-kill.1.gz<br>/usr/share/man/man1/docker-container-logs.1.gz<br>/usr/share/man/man1/docker-container-ls.1.gz<br>/usr/share/man/man1/docker-container-pause.1.gz<br>/usr/share/man/man1/docker-container-port.1.gz<br>/usr/share/man/man1/docker-container-prune.1.gz<br>/usr/share/man/man1/docker-container-rename.1.gz<br>/usr/share/man/man1/docker-container-restart.1.gz<br>/usr/share/man/man1/docker-container-rm.1.gz<br>/usr/share/man/man1/docker-container-run.1.gz<br>/usr/share/man/man1/docker-container-start.1.gz<br>/usr/share/man/man1/docker-container-stats.1.gz<br>/usr/share/man/man1/docker-container-stop.1.gz<br>/usr/share/man/man1/docker-container-top.1.gz<br>/usr/share/man/man1/docker-container-unpause.1.gz<br>/usr/share/man/man1/docker-container-update.1.gz<br>/usr/share/man/man1/docker-container-wait.1.gz<br>/usr/share/man/man1/docker-container.1.gz<br>/usr/share/man/man1/docker-context-create.1.gz<br>/usr/share/man/man1/docker-context-export.1.gz<br>/usr/share/man/man1/docker-context-import.1.gz<br>/usr/share/man/man1/docker-context-inspect.1.gz<br>/usr/share/man/man1/docker-context-ls.1.gz<br>/usr/share/man/man1/docker-context-rm.1.gz<br>/usr/share/man/man1/docker-context-update.1.gz<br>/usr/share/man/man1/docker-context-use.1.gz<br>/usr/share/man/man1/docker-context.1.gz<br>/usr/share/man/man1/docker-cp.1.gz<br>/usr/share/man/man1/docker-create.1.gz<br>/usr/share/man/man1/docker-deploy.1.gz<br>/usr/share/man/man1/docker-diff.1.gz<br>/usr/share/man/man1/docker-engine-activate.1.gz<br>/usr/share/man/man1/docker-engine-check.1.gz<br>/usr/share/man/man1/docker-engine-update.1.gz<br>/usr/share/man/man1/docker-engine.1.gz<br>/usr/share/man/man1/docker-events.1.gz<br>/usr/share/man/man1/docker-exec.1.gz<br>/usr/share/man/man1/docker-export.1.gz<br>/usr/share/man/man1/docker-history.1.gz<br>/usr/share/man/man1/docker-image-build.1.gz<br>/usr/share/man/man1/docker-image-history.1.gz<br>/usr/share/man/man1/docker-image-import.1.gz<br>/usr/share/man/man1/docker-image-inspect.1.gz<br>/usr/share/man/man1/docker-image-load.1.gz<br>/usr/share/man/man1/docker-image-ls.1.gz<br>/usr/share/man/man1/docker-image-prune.1.gz<br>/usr/share/man/man1/docker-image-pull.1.gz<br>/usr/share/man/man1/docker-image-push.1.gz<br>/usr/share/man/man1/docker-image-rm.1.gz<br>/usr/share/man/man1/docker-image-save.1.gz<br>/usr/share/man/man1/docker-image-tag.1.gz<br>/usr/share/man/man1/docker-image.1.gz<br>/usr/share/man/man1/docker-images.1.gz<br>/usr/share/man/man1/docker-import.1.gz<br>/usr/share/man/man1/docker-info.1.gz<br>/usr/share/man/man1/docker-inspect.1.gz<br>/usr/share/man/man1/docker-kill.1.gz<br>/usr/share/man/man1/docker-load.1.gz<br>/usr/share/man/man1/docker-login.1.gz<br>/usr/share/man/man1/docker-logout.1.gz<br>/usr/share/man/man1/docker-logs.1.gz<br>/usr/share/man/man1/docker-manifest-annotate.1.gz<br>/usr/share/man/man1/docker-manifest-create.1.gz<br>/usr/share/man/man1/docker-manifest-inspect.1.gz<br>/usr/share/man/man1/docker-manifest-push.1.gz<br>/usr/share/man/man1/docker-manifest.1.gz<br>/usr/share/man/man1/docker-network-connect.1.gz<br>/usr/share/man/man1/docker-network-create.1.gz<br>/usr/share/man/man1/docker-network-disconnect.1.gz<br>/usr/share/man/man1/docker-network-inspect.1.gz<br>/usr/share/man/man1/docker-network-ls.1.gz<br>/usr/share/man/man1/docker-network-prune.1.gz<br>/usr/share/man/man1/docker-network-rm.1.gz<br>/usr/share/man/man1/docker-network.1.gz<br>/usr/share/man/man1/docker-node-demote.1.gz<br>/usr/share/man/man1/docker-node-inspect.1.gz<br>/usr/share/man/man1/docker-node-ls.1.gz<br>/usr/share/man/man1/docker-node-promote.1.gz<br>/usr/share/man/man1/docker-node-ps.1.gz<br>/usr/share/man/man1/docker-node-rm.1.gz<br>/usr/share/man/man1/docker-node-update.1.gz<br>/usr/share/man/man1/docker-node.1.gz<br>/usr/share/man/man1/docker-pause.1.gz<br>/usr/share/man/man1/docker-plugin-create.1.gz<br>/usr/share/man/man1/docker-plugin-disable.1.gz<br>/usr/share/man/man1/docker-plugin-enable.1.gz<br>/usr/share/man/man1/docker-plugin-inspect.1.gz<br>/usr/share/man/man1/docker-plugin-install.1.gz<br>/usr/share/man/man1/docker-plugin-ls.1.gz<br>/usr/share/man/man1/docker-plugin-push.1.gz<br>/usr/share/man/man1/docker-plugin-rm.1.gz<br>/usr/share/man/man1/docker-plugin-set.1.gz<br>/usr/share/man/man1/docker-plugin-upgrade.1.gz<br>/usr/share/man/man1/docker-plugin.1.gz<br>/usr/share/man/man1/docker-port.1.gz<br>/usr/share/man/man1/docker-ps.1.gz<br>/usr/share/man/man1/docker-pull.1.gz<br>/usr/share/man/man1/docker-push.1.gz<br>/usr/share/man/man1/docker-rename.1.gz<br>/usr/share/man/man1/docker-restart.1.gz<br>/usr/share/man/man1/docker-rm.1.gz<br>/usr/share/man/man1/docker-rmi.1.gz<br>/usr/share/man/man1/docker-run.1.gz<br>/usr/share/man/man1/docker-save.1.gz<br>/usr/share/man/man1/docker-search.1.gz<br>/usr/share/man/man1/docker-secret-create.1.gz<br>/usr/share/man/man1/docker-secret-inspect.1.gz<br>/usr/share/man/man1/docker-secret-ls.1.gz<br>/usr/share/man/man1/docker-secret-rm.1.gz<br>/usr/share/man/man1/docker-secret.1.gz<br>/usr/share/man/man1/docker-service-create.1.gz<br>/usr/share/man/man1/docker-service-inspect.1.gz<br>/usr/share/man/man1/docker-service-logs.1.gz<br>/usr/share/man/man1/docker-service-ls.1.gz<br>/usr/share/man/man1/docker-service-ps.1.gz<br>/usr/share/man/man1/docker-service-rm.1.gz<br>/usr/share/man/man1/docker-service-rollback.1.gz<br>/usr/share/man/man1/docker-service-scale.1.gz<br>/usr/share/man/man1/docker-service-update.1.gz<br>/usr/share/man/man1/docker-service.1.gz<br>/usr/share/man/man1/docker-stack-deploy.1.gz<br>/usr/share/man/man1/docker-stack-ls.1.gz<br>/usr/share/man/man1/docker-stack-ps.1.gz<br>/usr/share/man/man1/docker-stack-rm.1.gz<br>/usr/share/man/man1/docker-stack-services.1.gz<br>/usr/share/man/man1/docker-stack.1.gz<br>/usr/share/man/man1/docker-start.1.gz<br>/usr/share/man/man1/docker-stats.1.gz<br>/usr/share/man/man1/docker-stop.1.gz<br>/usr/share/man/man1/docker-swarm-ca.1.gz<br>/usr/share/man/man1/docker-swarm-init.1.gz<br>/usr/share/man/man1/docker-swarm-join-token.1.gz<br>/usr/share/man/man1/docker-swarm-join.1.gz<br>/usr/share/man/man1/docker-swarm-leave.1.gz<br>/usr/share/man/man1/docker-swarm-unlock-key.1.gz<br>/usr/share/man/man1/docker-swarm-unlock.1.gz<br>/usr/share/man/man1/docker-swarm-update.1.gz<br>/usr/share/man/man1/docker-swarm.1.gz<br>/usr/share/man/man1/docker-system-df.1.gz<br>/usr/share/man/man1/docker-system-events.1.gz<br>/usr/share/man/man1/docker-system-info.1.gz<br>/usr/share/man/man1/docker-system-prune.1.gz<br>/usr/share/man/man1/docker-system.1.gz<br>/usr/share/man/man1/docker-tag.1.gz<br>/usr/share/man/man1/docker-top.1.gz<br>/usr/share/man/man1/docker-trust-inspect.1.gz<br>/usr/share/man/man1/docker-trust-key-generate.1.gz<br>/usr/share/man/man1/docker-trust-key-load.1.gz<br>/usr/share/man/man1/docker-trust-key.1.gz<br>/usr/share/man/man1/docker-trust-revoke.1.gz<br>/usr/share/man/man1/docker-trust-sign.1.gz<br>/usr/share/man/man1/docker-trust-signer-add.1.gz<br>/usr/share/man/man1/docker-trust-signer-remove.1.gz<br>/usr/share/man/man1/docker-trust-signer.1.gz<br>/usr/share/man/man1/docker-trust.1.gz<br>/usr/share/man/man1/docker-unpause.1.gz<br>/usr/share/man/man1/docker-update.1.gz<br>/usr/share/man/man1/docker-version.1.gz<br>/usr/share/man/man1/docker-volume-create.1.gz<br>/usr/share/man/man1/docker-volume-inspect.1.gz<br>/usr/share/man/man1/docker-volume-ls.1.gz<br>/usr/share/man/man1/docker-volume-prune.1.gz<br>/usr/share/man/man1/docker-volume-rm.1.gz<br>/usr/share/man/man1/docker-volume.1.gz<br>/usr/share/man/man1/docker-wait.1.gz<br>/usr/share/man/man1/docker.1.gz<br>/usr/share/man/man5/Dockerfile.5.gz<br>/usr/share/man/man5/docker-config-json.5.gz<br>/usr/share/man/man8/dockerd.8.gz<br>/usr/share/zsh/vendor-completions/_docker<br></code></pre></td></tr></table></figure>

<h3 id="1-2-4-docker-命令帮助"><a href="#1-2-4-docker-命令帮助" class="headerlink" title="1.2.4 docker 命令帮助"></a>1.2.4 docker 命令帮助</h3><p>docker 命令是最常使用的docker 客户端命令，其后面可以加不同的参数以实现不同的功能</p>
<p>docker 命令格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker [OPTIONS] COMMAND<br><br>COMMAND分为<br>Management Commands  <span class="hljs-comment">#指定管理的资源对象类型,较新的命令用法,将命令按资源类型进行分类,方便使用</span><br>Commands <span class="hljs-comment">#对不同资源操作的命令不分类,使用容易产生混乱</span><br></code></pre></td></tr></table></figure>

<p>docker 命令有很多子命令，可以用下面方法查看帮助</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#docker 命令帮助</span><br>man docker<br>docker<br>docker  --<span class="hljs-built_in">help</span><br><br><span class="hljs-comment">#docker 子命令帮助</span><br>man docker-COMMAND<br>docker COMMAND --<span class="hljs-built_in">help</span><br></code></pre></td></tr></table></figure>

<p>官方文档: <a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker27.png" srcset="/blog/img/loading.gif"></p>
<p>范例: 查看docker命令帮助</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ubuntu1804:~<span class="hljs-comment"># docker --help</span><br><br>Usage:	docker [OPTIONS] COMMAND<br><br>A self-sufficient runtime <span class="hljs-keyword">for</span> containers<br><br>Options:<br>      --config string      Location of client config files (default <span class="hljs-string">&quot;/root/.docker&quot;</span>)<br>  -c, --context string     Name of the context to use to connect to the daemon (overrides DOCKER_HOST env var and<br>                           default context <span class="hljs-built_in">set</span> with <span class="hljs-string">&quot;docker context use&quot;</span>)<br>  -D, --debug              Enable debug mode<br>  -H, --host list          Daemon socket(s) to connect to<br>  -l, --log-level string   Set the logging level (<span class="hljs-string">&quot;debug&quot;</span>|<span class="hljs-string">&quot;info&quot;</span>|<span class="hljs-string">&quot;warn&quot;</span>|<span class="hljs-string">&quot;error&quot;</span>|<span class="hljs-string">&quot;fatal&quot;</span>) (default <span class="hljs-string">&quot;info&quot;</span>)<br>      --tls                Use TLS; implied by --tlsverify<br>      --tlscacert string   Trust certs signed only by this CA (default <span class="hljs-string">&quot;/root/.docker/ca.pem&quot;</span>)<br>      --tlscert string     Path to TLS certificate file (default <span class="hljs-string">&quot;/root/.docker/cert.pem&quot;</span>)<br>      --tlskey string      Path to TLS key file (default <span class="hljs-string">&quot;/root/.docker/key.pem&quot;</span>)<br>      --tlsverify          Use TLS and verify the remote<br>  -v, --version            Print version information and quit<br><br>Management Commands:<br>  builder     Manage builds<br>  config      Manage Docker configs<br>  container   Manage containers<br>  context     Manage contexts<br>  engine      Manage the docker engine<br>  image       Manage images<br>  network     Manage networks<br>  node        Manage Swarm nodes<br>  plugin      Manage plugins<br>  secret      Manage Docker secrets<br>  service     Manage services<br>  stack       Manage Docker stacks<br>  swarm       Manage Swarm<br>  system      Manage Docker<br>  trust       Manage trust on Docker images<br>  volume      Manage volumes<br><br>Commands:<br>  attach      Attach <span class="hljs-built_in">local</span> standard input, output, and error streams to a running container<br>  build       Build an image from a Dockerfile<br>  commit      Create a new image from a container<span class="hljs-string">&#x27;s changes</span><br><span class="hljs-string">  cp          Copy files/folders between a container and the local filesystem</span><br><span class="hljs-string">  create      Create a new container</span><br><span class="hljs-string">  deploy      Deploy a new stack or update an existing stack</span><br><span class="hljs-string">  diff        Inspect changes to files or directories on a container&#x27;</span>s filesystem<br>  events      Get real time events from the server<br>  <span class="hljs-built_in">exec</span>        Run a <span class="hljs-built_in">command</span> <span class="hljs-keyword">in</span> a running container<br>  <span class="hljs-built_in">export</span>      Export a container<span class="hljs-string">&#x27;s filesystem as a tar archive</span><br><span class="hljs-string">  history     Show the history of an image</span><br><span class="hljs-string">  images      List images</span><br><span class="hljs-string">  import      Import the contents from a tarball to create a filesystem image</span><br><span class="hljs-string">  info        Display system-wide information</span><br><span class="hljs-string">  inspect     Return low-level information on Docker objects</span><br><span class="hljs-string">  kill        Kill one or more running containers</span><br><span class="hljs-string">  load        Load an image from a tar archive or STDIN</span><br><span class="hljs-string">  login       Log in to a Docker registry</span><br><span class="hljs-string">  logout      Log out from a Docker registry</span><br><span class="hljs-string">  logs        Fetch the logs of a container</span><br><span class="hljs-string">  pause       Pause all processes within one or more containers</span><br><span class="hljs-string">  port        List port mappings or a specific mapping for the container</span><br><span class="hljs-string">  ps          List containers</span><br><span class="hljs-string">  pull        Pull an image or a repository from a registry</span><br><span class="hljs-string">  push        Push an image or a repository to a registry</span><br><span class="hljs-string">  rename      Rename a container</span><br><span class="hljs-string">  restart     Restart one or more containers</span><br><span class="hljs-string">  rm          Remove one or more containers</span><br><span class="hljs-string">  rmi         Remove one or more images</span><br><span class="hljs-string">  run         Run a command in a new container</span><br><span class="hljs-string">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="hljs-string">  search      Search the Docker Hub for images</span><br><span class="hljs-string">  start       Start one or more stopped containers</span><br><span class="hljs-string">  stats       Display a live stream of container(s) resource usage statistics</span><br><span class="hljs-string">  stop        Stop one or more running containers</span><br><span class="hljs-string">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="hljs-string">  top         Display the running processes of a container</span><br><span class="hljs-string">  unpause     Unpause all processes within one or more containers</span><br><span class="hljs-string">  update      Update configuration of one or more containers</span><br><span class="hljs-string">  version     Show the Docker version information</span><br><span class="hljs-string">  wait        Block until one or more containers stop, then print their exit codes</span><br><span class="hljs-string"></span><br><span class="hljs-string">Run &#x27;</span>docker COMMAND --<span class="hljs-built_in">help</span><span class="hljs-string">&#x27; for more information on a command.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@centos7 ~]# docker --help</span><br><span class="hljs-string"></span><br><span class="hljs-string">Usage:	docker [OPTIONS] COMMAND</span><br><span class="hljs-string"></span><br><span class="hljs-string">A self-sufficient runtime for containers</span><br><span class="hljs-string"></span><br><span class="hljs-string">Options:</span><br><span class="hljs-string">      --config string      Location of client config files (default &quot;/root/.docker&quot;)</span><br><span class="hljs-string">  -c, --context string     Name of the context to use to connect to the daemon (overrides DOCKER_HOST env var and</span><br><span class="hljs-string">                           default context set with &quot;docker context use&quot;)</span><br><span class="hljs-string">  -D, --debug              Enable debug mode</span><br><span class="hljs-string">  -H, --host list          Daemon socket(s) to connect to</span><br><span class="hljs-string">  -l, --log-level string   Set the logging level (&quot;debug&quot;|&quot;info&quot;|&quot;warn&quot;|&quot;error&quot;|&quot;fatal&quot;) (default &quot;info&quot;)</span><br><span class="hljs-string">      --tls                Use TLS; implied by --tlsverify</span><br><span class="hljs-string">      --tlscacert string   Trust certs signed only by this CA (default &quot;/root/.docker/ca.pem&quot;)</span><br><span class="hljs-string">      --tlscert string     Path to TLS certificate file (default &quot;/root/.docker/cert.pem&quot;)</span><br><span class="hljs-string">      --tlskey string      Path to TLS key file (default &quot;/root/.docker/key.pem&quot;)</span><br><span class="hljs-string">      --tlsverify          Use TLS and verify the remote</span><br><span class="hljs-string">  -v, --version            Print version information and quit</span><br><span class="hljs-string"></span><br><span class="hljs-string">Management Commands:</span><br><span class="hljs-string">  builder     Manage builds</span><br><span class="hljs-string">  config      Manage Docker configs</span><br><span class="hljs-string">  container   Manage containers</span><br><span class="hljs-string">  context     Manage contexts</span><br><span class="hljs-string">  engine      Manage the docker engine</span><br><span class="hljs-string">  image       Manage images</span><br><span class="hljs-string">  network     Manage networks</span><br><span class="hljs-string">  node        Manage Swarm nodes</span><br><span class="hljs-string">  plugin      Manage plugins</span><br><span class="hljs-string">  secret      Manage Docker secrets</span><br><span class="hljs-string">  service     Manage services</span><br><span class="hljs-string">  stack       Manage Docker stacks</span><br><span class="hljs-string">  swarm       Manage Swarm</span><br><span class="hljs-string">  system      Manage Docker</span><br><span class="hljs-string">  trust       Manage trust on Docker images</span><br><span class="hljs-string">  volume      Manage volumes</span><br><span class="hljs-string"></span><br><span class="hljs-string">Commands:</span><br><span class="hljs-string">  attach      Attach local standard input, output, and error streams to a running container</span><br><span class="hljs-string">  build       Build an image from a Dockerfile</span><br><span class="hljs-string">  commit      Create a new image from a container&#x27;</span>s changes<br>  cp          Copy files/folders between a container and the <span class="hljs-built_in">local</span> filesystem<br>  create      Create a new container<br>  diff        Inspect changes to files or directories on a container<span class="hljs-string">&#x27;s filesystem</span><br><span class="hljs-string">  events      Get real time events from the server</span><br><span class="hljs-string">  exec        Run a command in a running container</span><br><span class="hljs-string">  export      Export a container&#x27;</span>s filesystem as a tar archive<br>  <span class="hljs-built_in">history</span>     Show the <span class="hljs-built_in">history</span> of an image<br>  images      List images<br>  import      Import the contents from a tarball to create a filesystem image<br>  info        Display system-wide information<br>  inspect     Return low-level information on Docker objects<br>  <span class="hljs-built_in">kill</span>        Kill one or more running containers<br>  load        Load an image from a tar archive or STDIN<br>  login       Log <span class="hljs-keyword">in</span> to a Docker registry<br>  <span class="hljs-built_in">logout</span>      Log out from a Docker registry<br>  logs        Fetch the logs of a container<br>  pause       Pause all processes within one or more containers<br>  port        List port mappings or a specific mapping <span class="hljs-keyword">for</span> the container<br>  ps          List containers<br>  pull        Pull an image or a repository from a registry<br>  push        Push an image or a repository to a registry<br>  rename      Rename a container<br>  restart     Restart one or more containers<br>  rm          Remove one or more containers<br>  rmi         Remove one or more images<br>  run         Run a <span class="hljs-built_in">command</span> <span class="hljs-keyword">in</span> a new container<br>  save        Save one or more images to a tar archive (streamed to STDOUT by default)<br>  search      Search the Docker Hub <span class="hljs-keyword">for</span> images<br>  start       Start one or more stopped containers<br>  stats       Display a live stream of container(s) resource usage statistics<br>  stop        Stop one or more running containers<br>  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE<br>  top         Display the running processes of a container<br>  unpause     Unpause all processes within one or more containers<br>  update      Update configuration of one or more containers<br>  version     Show the Docker version information<br>  <span class="hljs-built_in">wait</span>        Block until one or more containers stop, <span class="hljs-keyword">then</span> <span class="hljs-built_in">print</span> their <span class="hljs-built_in">exit</span> codes<br><br>Run <span class="hljs-string">&#x27;docker COMMAND --help&#x27;</span> <span class="hljs-keyword">for</span> more information on a <span class="hljs-built_in">command</span>.<br></code></pre></td></tr></table></figure>

<h3 id="1-2-5-查看-Docker-相关信息"><a href="#1-2-5-查看-Docker-相关信息" class="headerlink" title="1.2.5 查看 Docker 相关信息"></a>1.2.5 查看 Docker 相关信息</h3><h4 id="1-2-5-1-查看-docker-版本"><a href="#1-2-5-1-查看-docker-版本" class="headerlink" title="1.2.5.1 查看 docker 版本"></a>1.2.5.1 查看 docker 版本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker version</span><br>Client: Docker Engine - Community<br>Version:      19.03.5<br>API version:    1.40<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:       Wed Nov 13 07:29:52 2019<br>OS/Arch:      linux/amd64<br>Experimental:    <span class="hljs-literal">false</span><br><br>Server: Docker Engine - Community<br>Engine:<br>Version:      19.03.5<br>API version:    1.40 (minimum version 1.12)<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:      Wed Nov 13 07:28:22 2019<br>OS/Arch:     linux/amd64<br>Experimental:   <span class="hljs-literal">false</span><br>containerd:<br>Version:      1.2.10<br>GitCommit:    b34a5c8af56e510852c35414db4c1f4fa6172339<br>runc:<br>Version:      1.0.0-rc8+dev<br>GitCommit:    3e425f80a8c931f88e6d94a8c831b9d5aa481657<br>docker-init:<br>Version:      0.18.0<br>GitCommit:    fec3683<br></code></pre></td></tr></table></figure>

<h4 id="1-2-5-2-查看-docker-详解信息"><a href="#1-2-5-2-查看-docker-详解信息" class="headerlink" title="1.2.5.2 查看 docker 详解信息"></a>1.2.5.2 查看 docker 详解信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker info</span><br>Client:<br>Debug Mode: <span class="hljs-literal">false</span>   <span class="hljs-comment">#client 端是否开启 debug</span><br><br>Server:<br>Containers: 2  <span class="hljs-comment">#当前主机运行的容器总数</span><br>Running: 0   <span class="hljs-comment">#有几个容器是正在运行的</span><br>Paused: 0    <span class="hljs-comment">#有几个容器是暂停的</span><br>Stopped: 2   <span class="hljs-comment">#有几个容器是停止的</span><br>Images: 4    <span class="hljs-comment">#当前服务器的镜像数</span><br>Server Version: 19.03.5  <span class="hljs-comment">#服务端版本</span><br>Storage Driver: overlay2  <span class="hljs-comment">#正在使用的存储引擎</span><br>Backing Filesystem: extfs  <span class="hljs-comment">#后端文件系统，即服务器的磁盘文件系统</span><br>Supports d_type: <span class="hljs-literal">true</span>  <span class="hljs-comment">#是否支持 d_type</span><br>Native Overlay Diff: <span class="hljs-literal">true</span>  <span class="hljs-comment">#是否支持差异数据存储</span><br>Logging Driver: json-file  <span class="hljs-comment">#日志类型</span><br>Cgroup Driver: cgroupfs  <span class="hljs-comment">#Cgroups 类型</span><br>Plugins:          <span class="hljs-comment">#插件</span><br>Volume: <span class="hljs-built_in">local</span>       <span class="hljs-comment">#卷</span><br>Network: bridge host ipvlan macvlan null overlay <span class="hljs-comment"># overlay 跨主机通信</span><br>Log: awslogs fluentd gcplogs gelf journald json-file <span class="hljs-built_in">local</span> logentries splunk<br>syslog  <span class="hljs-comment"># 日志类型</span><br>Swarm: inactive   <span class="hljs-comment">#是否支持 swarm</span><br>Runtimes: runc   <span class="hljs-comment">#已安装的容器运行时</span><br>Default Runtime: runc  <span class="hljs-comment">#默认使用的容器运行时</span><br>Init Binary: docker-init  <span class="hljs-comment">#初始化容器的守护进程，即 pid 为 1 的进程</span><br>containerd version: b34a5c8af56e510852c35414db4c1f4fa6172339 <span class="hljs-comment">#版本</span><br>runc version: 3e425f80a8c931f88e6d94a8c831b9d5aa481657  <span class="hljs-comment">#runc 版本</span><br>init version: fec3683  <span class="hljs-comment">#init 版本</span><br>Security Options:  <span class="hljs-comment">#安全选项</span><br>apparmor   <span class="hljs-comment">#安全模块，https://docs.docker.com/engine/security/apparmor/</span><br>seccomp  <span class="hljs-comment">#安全计算模块，即制容器操作，</span><br>https://docs.docker.com/engine/security/seccomp/<br> Profile: default  <span class="hljs-comment">#默认的配置文件</span><br>Kernel Version: 4.15.0-29-generic  <span class="hljs-comment">#宿主机内核版本</span><br>Operating System: Ubuntu 18.04.1 LTS  <span class="hljs-comment">#宿主机操作系统</span><br>OSType: linux   <span class="hljs-comment">#宿主机操作系统类型</span><br>Architecture: x86_64  <span class="hljs-comment">#宿主机架构</span><br>CPUs: 1   <span class="hljs-comment">#宿主机 CPU 数量</span><br>Total Memory: 962MiB  <span class="hljs-comment">#宿主机总内存</span><br>Name: ubuntu1804.magedu.org <span class="hljs-comment">#宿主机 hostname</span><br>ID: IZHJ:WPIN:BRMC:XQUI:VVVR:UVGK:NZBM:YQXT:JDWB:33RS:45V7:SQWJ <span class="hljs-comment">#宿主机 ID</span><br>Docker Root Dir: /var/lib/docker  <span class="hljs-comment">#宿主机关于docker数据的保存目录</span><br>Debug Mode: <span class="hljs-literal">false</span>  <span class="hljs-comment">#server 端是否开启 debug</span><br>Registry: https://index.docker.io/v1/  <span class="hljs-comment">#仓库路径</span><br>Labels:<br>Experimental: <span class="hljs-literal">false</span>  <span class="hljs-comment">#是否测试版</span><br>Insecure Registries:<br> 127.0.0.0/8 : <span class="hljs-comment">#非安全的镜像仓库</span><br>Registry Mirrors:<br>https://si7y70hh.mirror.aliyuncs.com/  <span class="hljs-comment">#镜像仓库</span><br>Live Restore Enabled: <span class="hljs-literal">false</span>  <span class="hljs-comment">#是否开启活动重启 (重启docker-daemon 不关闭容器 )</span><br><br>WARNING: No swap <span class="hljs-built_in">limit</span> support  <span class="hljs-comment">#系统警告信息 (没有开启 swap 资源限制 )</span><br></code></pre></td></tr></table></figure>

<p>范例: 解决上述SWAP报警提示</p>
<p>官方文档：<a target="_blank" rel="noopener" href="https://docs.docker.com/install/linux/linux-postinstall/#your-kernel-does-not-support-cgroup-swap-limit-capabilities">https://docs.docker.com/install/linux/linux-postinstall/#your-kernel-does-not-support-cgroup-swap-limit-capabilities</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker info</span><br>......<br>WARNING: No swap <span class="hljs-built_in">limit</span> support<br><br>[root@ubuntu1804 ~]<span class="hljs-comment"># vim /etc/default/grub</span><br>GRUB_DEFAULT=0<br>GRUB_TIMEOUT_STYLE=hidden<br>GRUB_TIMEOUT=2<br>GRUB_DISTRIBUTOR=`lsb_ release -i -s 2&gt; /dev/null || <span class="hljs-built_in">echo</span> Debian`<br>GRUB_CMDLINE_LINUX_DEFAULT=<span class="hljs-string">&quot;&quot;</span><br>GRUB_CMDLINE_LINUX=<span class="hljs-string">&quot;net.ifnames=0 biosdevname=0 swapaccount=1&quot;</span>  <span class="hljs-comment">#修改此行</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment"># update-grub</span><br>[root@ubuntu1804 ~]<span class="hljs-comment"># reboot</span><br><br><span class="hljs-comment">#centos</span><br>grub2-mkconfig -o /boot/grub2/grub.cfg<br>reboot<br></code></pre></td></tr></table></figure>

<h4 id="1-2-5-3-查看-docker0-网卡"><a href="#1-2-5-3-查看-docker0-网卡" class="headerlink" title="1.2.5.3 查看 docker0 网卡"></a>1.2.5.3 查看 docker0 网卡</h4><p>在docker安装启动之后，默认会生成一个名称为docker0的网卡并且默认IP地址为172.17.0.1的网卡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#ubuntu18.04安装docker后网卡配置</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group<br>default qlen 1000<br> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br> inet 127.0.0.1/8 scope host lo<br>   valid_lft forever preferred_lft forever<br> inet6 ::1/128 scope host<br>   valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP<br>group default qlen 1000<br> link/ether 00:0c:29:34:df:91 brd ff:ff:ff:ff:ff:ff<br> inet 10.0.0.100/24 brd 10.0.0.255 scope global eth0<br>   valid_lft forever preferred_lft forever<br> inet6 fe80::20c:29ff:fe34:df91/64 scope link<br>   valid_lft forever preferred_lft forever<br>4: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP<br>group default<br> link/ether 02:42:d3:26:ed:4e brd ff:ff:ff:ff:ff:ff<br> inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0<br>   valid_lft forever preferred_lft forever<br> inet6 fe80::42:d3ff:fe26:ed4e/64 scope link<br>   valid_lft forever preferred_lft forever<br><span class="hljs-comment">#CentOS 7.6 安装docker后网卡配置</span><br>[root@centos7 ~]<span class="hljs-comment">#ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group<br>default qlen 1000<br> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br> inet 127.0.0.1/8 scope host lo<br>   valid_lft forever preferred_lft forever<br> inet6 ::1/128 scope host<br>   valid_lft forever preferred_lft forever<br>   <br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP<br>group default qlen 1000<br> link/ether 00:0c:29:ca:00:e4 brd ff:ff:ff:ff:ff:ff<br> inet 10.0.0.7/24 brd 10.0.0.255 scope global noprefixroute eth0<br>   valid_lft forever preferred_lft forever<br> inet6 fe80::20c:29ff:feca:e4/64 scope link<br>   valid_lft forever preferred_lft forever<br>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state<br>DOWN group default<br> link/ether 02:42:d2:81:c2:e0 brd ff:ff:ff:ff:ff:ff<br> inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0<br>   valid_lft forever preferred_lft forever<br>  <br><span class="hljs-comment">#CentOS 8.1 安装docker后网卡配置 </span><br>[root@centos8 ~]<span class="hljs-comment">#ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group<br>default qlen 1000<br> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br> inet 127.0.0.1/8 scope host lo<br>   valid_lft forever preferred_lft forever<br> inet6 ::1/128 scope host<br>   valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP<br>group default qlen 1000<br> link/ether 00:0c:29:4d:ef:3e brd ff:ff:ff:ff:ff:ff<br> inet 10.0.0.18/24 brd 10.0.0.255 scope global noprefixroute eth0<br>   valid_lft forever preferred_lft forever<br> inet6 fe80::20c:29ff:fe4d:ef3e/64 scope link<br>   valid_lft forever preferred_lft forever<br>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state<br>DOWN group default<br> link/ether 02:42:f5:3e:65:b6 brd ff:ff:ff:ff:ff:ff<br> inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0<br>   valid_lft forever preferred_lft forever<br>[root@centos8 ~]<span class="hljs-comment">#route -n</span><br>Kernel IP routing table<br>Destination   Gateway     Genmask     Flags Metric Ref  Use Iface<br>0.0.0.0     10.0.0.2     0.0.0.0     UG   100   0     0 eth0<br>10.0.0.0     0.0.0.0     255.255.255.0  U   100   0     0 eth0<br>172.17.0.0    0.0.0.0     255.255.0.0   U   0    0     0 docker0<br></code></pre></td></tr></table></figure>

<h4 id="1-2-5-4-docker-存储引擎"><a href="#1-2-5-4-docker-存储引擎" class="headerlink" title="1.2.5.4 docker 存储引擎"></a>1.2.5.4 docker 存储引擎</h4><p>官方文档关于存储引擎的相关文档:</p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/storage/storagedriver/">https://docs.docker.com/storage/storagedriver/</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/storage/storagedriver/select-storage-driver/">https://docs.docker.com/storage/storagedriver/select-storage-driver/</a></p>
<ul>
<li><p>AUFS: （Advanced Mult-Layered Unification Filesystem，版本2之前旧称AnotherUnionFS）是一种 Union FS ，是文件级的存储驱动。Aufs是之前的UnionFS的重新实现，2006年由Junjiro Okajima开发</p>
<p>所谓 UnionFS就是把不同物理位置的目录合并 mount 到同一个目录中。简单来说就是支持将不同目录挂载到一个虚拟文件系统下的。这种可以层层地叠加修改文件。无论底下有多少都是只读的，最上系统可写的。当需要修改一个文件时， AUFS 创建该文件的一个副本，使用 CoW 将文件从只读层复制到可写进行修改，结果也保存在Docker 中，底下的只读层就是 image，可写层就是Container</p>
<p>aufs 被拒绝合并到主线 Linux 。其代码被批评为”dense, unreadable, uncommented 密集、不可读、未注释”。 相反，OverlayFS被合并到 Linux 内核中。在多次尝试将 aufs 合并到主线内核失败后，作者放弃了</p>
<p>AUFS 是 Docker 18.06 及更早版本的首选存储驱动程序，在内核 3.13 上运行 Ubuntu 14.04 时不支持 overlay2</p>
</li>
<li><p>Overlay: 一种 Union FS 文件系统， Linux 内核 3.18 后支持</p>
</li>
<li><p>Overlay2: Overlay 的升级版，到目前为止，所有 Linux 发行版推荐使用的存储类 型，也是docker默认使用的存储引擎为overlay2，需要磁盘分区支持d-type功能，因此需要系统磁盘的额外支持,相对AUFS来说Overlay2 有以下优势: 更简单地设计； 从3.18开始就进入了Linux内核主线；资源消耗更少</p>
</li>
<li><p>devicemapper: 因为CentOS 7.2和RHEL 7.2 的之前版本内核版本不支持 overlay2，默认使用的存储驱动程序，最大数据容量只支持100GB且性能不佳，当前较新版本的CentOS 已经支持overlay2， 因此推荐使用 overlay2,另外此存储引擎已在Docker Engine 18.09中弃用</p>
</li>
<li><p>ZFS(Sun -2005)/btrfs(Oracle-2007): 目前没有广泛使用</p>
</li>
<li><p>vfs: 用于测试环境，适用于无法使用 copy-on -writewrite 时的情况。 此存储驱动程序的性能很差，通常不建议用于生产</p>
</li>
</ul>
<p>修改存储引擎参考文档:<br><a target="_blank" rel="noopener" href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/">https://docs.docker.com/storage/storagedriver/overlayfs-driver/</a><br>范例: 在CentOS7.2修改存储引擎</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#vim /lib/systemd/system/docker.service</span><br>.....<br>ExecStart=/usr/bin/dockerd -s overlay2 -H fd:// --<br>containerd=/run/containerd/containerd.sock<br>......<br><br><span class="hljs-comment">#创建新的xfs分区,添加ftype特性,否则默认无法启动docker服务</span><br>[root@centos7 ~]<span class="hljs-comment">#mkfs.xfs -n ftype=1 /dev/sdb</span><br>[root@centos7 ~]<span class="hljs-comment">#mount /dev/sdb /var/lib/docker</span><br><br>[root@centos7 ~]<span class="hljs-comment">#systemctl daemon-reload</span><br>[root@centos7 ~]<span class="hljs-comment">#systemctl restart docker</span><br></code></pre></td></tr></table></figure>

<p>注意:修改存储引擎会导致所有容器丢失,所以先备份再修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#查看Ubuntu1804的默认存储引擎</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker info |grep Storage</span><br>WARNING: No swap <span class="hljs-built_in">limit</span> support<br>Storage Driver: overlay2<br><br><span class="hljs-comment">#查看CentOS7.6的默认存储引擎</span><br>[root@centos7 ~]<span class="hljs-comment">#docker info |grep Storage</span><br>WARNING: bridge-nf-call-iptables is disabled<br>WARNING: bridge-nf-call-ip6tables is disabled<br>Storage Driver: overlay2<br></code></pre></td></tr></table></figure>

<p>Docker官方推荐首选存储引擎为overlay2，其次为devicemapper，但是devicemapper存在使用空间方面的一些限制，虽然可以通过后期配置解决，但是官方依然推荐使用overlay2，以下是生产故障事例:<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/youruncloud/p/5736718.html">https://www.cnblogs.com/youruncloud/p/5736718.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment"># xfs_info /data</span><br>meta-data=/dev/sda3              isize=512    agcount=4, agsize=6442432 blks<br>         =                       sectsz=512   attr=2, projid32bit=1<br>         =                       crc=1        finobt=0 spinodes=0<br>data     =                       bsize=4096   blocks=25769728, imaxpct=25<br>         =                       sunit=0      swidth=0 blks<br>naming   =version 2              bsize=4096   ascii-ci=0 ftype=1<br><span class="hljs-built_in">log</span>      =internal               bsize=4096   blocks=12582, version=2<br>         =                       sectsz=512   sunit=0 blks, lazy-count=1<br>realtime =none                   extsz=4096   blocks=0, rtextents=0<br><br></code></pre></td></tr></table></figure>

<p>如果docker数据目录是一块单独的磁盘分区而且是xfs格式的，那么需要在格式化的时候加上参数-n ftype=1(启用此功能表示节点文件类型存入在目录结构中）, 示例: mkfs.xfs -n ftype=1 devname ，否则后期在无法启动容器,并会报错不支持 d_type</p>
<p>注意: ext4文件系统无需此d_type特性</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#xfs_info /data</span><br>meta-data=/dev/mapper/centos-root isize=512   agcount=4, agsize=3276800 blks<br>         =                        sectsz=512  attr=2, projid32bit=1<br>         =                        crc=1       finobt=0 spinodes=0<br>data     =                        bsize=4096  blocks=13107200, imaxpct=25<br>         =                        sunit=0     swidth=0 blks<br>naming   =version 2               bsize=4096  ascii-ci=0 ftype=0  <span class="hljs-comment">#CentOS7.2之前版本此特性默认ftype=0</span><br><span class="hljs-built_in">log</span>      =internal                bsize=4096  blocks=6400, version=2<br>         =                        sectsz=512  sunit=0 blks, lazy-count=1<br>realtime =none                    extsz=4096  blocks=0, rtextents=0<br>[root@centos7 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>报错界面:</p>
<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker28.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<p>范例: aufs 实现联合文件系统挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#cat /proc/filesystems</span><br>nodev sysfs<br>nodev rootfs<br>nodev ramfs<br>nodev bdev<br>nodev proc<br>nodev cpuset<br>nodev cgroup<br>nodev cgroup2<br>nodev tmpfs<br>nodev devtmpfs<br>nodev configfs<br>nodev debugfs<br>nodev tracefs<br>nodev securityfs<br>nodev sockfs<br>nodev dax<br>nodev bpf<br>nodev pipefs<br>nodev hugetlbfs<br>nodev devpts<br>ext3<br>ext2<br>ext4<br>squashfs<br>vfat<br>nodev ecryptfs<br>fuseblk<br>nodev fuse<br>nodev fusectl<br>nodev pstore<br>nodev mqueue<br>btrfs<br>nodev autofs<br>nodev rpc_pipefs<br>nodev nfsd<br>nodev overlay<br>nodev aufs<br>[root@ubuntu1804 ~]<span class="hljs-comment">#grep -i aufs /boot/config-4.15.0-29-generic</span><br>CONFIG_AUFS_FS=m<br>CONFIG_AUFS_BRANCH_MAX_127=y<br><span class="hljs-comment"># CONFIG_AUFS_BRANCH_MAX_511 is not set</span><br><span class="hljs-comment"># CONFIG_AUFS_BRANCH_MAX_1023 is not set</span><br><span class="hljs-comment"># CONFIG_AUFS_BRANCH_MAX_32767 is not set</span><br>CONFIG_AUFS_SBILIST=y<br><span class="hljs-comment"># CONFIG_AUFS_HNOTIFY is not set</span><br>CONFIG_AUFS_EXPORT=y<br>CONFIG_AUFS_INO_T_64=y<br>CONFIG_AUFS_XATTR=y<br><span class="hljs-comment"># CONFIG_AUFS_FHSM is not set</span><br><span class="hljs-comment"># CONFIG_AUFS_RDU is not set</span><br>CONFIG_AUFS_DIRREN=y<br><span class="hljs-comment"># CONFIG_AUFS_SHWH is not set</span><br><span class="hljs-comment"># CONFIG_AUFS_BR_RAMFS is not set</span><br><span class="hljs-comment"># CONFIG_AUFS_BR_FUSE is not set</span><br>CONFIG_AUFS_BR_HFSPLUS=y<br>CONFIG_AUFS_BDEV_LOOP=y<br><span class="hljs-comment"># CONFIG_AUFS_DEBUG is not set</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#mkdir dir&#123;1,2&#125;</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo here is dir1 &gt; dir1/file1</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo here is dir2 &gt; dir2/file2</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#mkdir -p /data/aufs</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#mount -t aufs -o br=/root/dir1=ro:/root/dir2=rw none</span><br>/data/aufs<br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll /data/aufs/</span><br>total 16<br>drwxr-xr-x 4 root root 4096 Jan 25 16:22 ./<br>drwxr-xr-x 4 root root 4096 Jan 25 16:22 ../<br>-rw-r--r-- 1 root root  13 Jan 25 16:22 file1<br>-rw-r--r-- 1 root root  13 Jan 25 16:22 file2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /data/aufs/file1</span><br>here is dir1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /data/aufs/file2</span><br>here is dir2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#df -T</span><br>Filesystem   Type   1K-blocks  Used Available Use% Mounted on<br>udev      devtmpfs   462560    0   462560  0% /dev<br>tmpfs     tmpfs     98512  10296   88216  11% /run<br>/dev/sda2   ext4    47799020 2770244  42570972  7% /<br>tmpfs     tmpfs    492552    0   492552  0% /dev/shm<br>tmpfs     tmpfs     5120    0    5120  0% /run/lock<br>tmpfs     tmpfs    492552    0   492552  0% /sys/fs/cgroup<br>/dev/sda3   ext4    19091540  45084  18053588  1% /data<br>/dev/sda1   ext4     944120  77112   801832  9% /boot<br>tmpfs     tmpfs     98508    0   98508  0% /run/user/0<br>none      aufs    47799020 2770244  42570972  7% /data/aufs<br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo write to file1 &gt;&gt; /data/aufs/file1</span><br>-bash: /data/aufs/file1: Read-only file system<br>[root@ubuntu1804 ~]<span class="hljs-comment">#echo write to file2 &gt;&gt; /data/aufs/file2</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /data/aufs/file1</span><br>here is dir1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /data/aufs/file2</span><br>here is dir2<br>write to file2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#umount /data/aufs</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#mv dir1/file1 dir1/file2</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat dir1/file2</span><br>here is dir1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat dir2/file2</span><br>here is dir2<br>write to file2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#mount -t aufs -o br=/root/dir1=ro:/root/dir2=rw none /data/aufs</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls /data/aufs -l</span><br>total 4<br>-rw-r--r-- 1 root root 13 Jan 25 16:22 file2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /data/aufs/file2</span><br>here is dir1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>范例: 修改存储引擎</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>nginx        latest       5ad3bd0e67a9     3 days ago    <br>127MB<br>alpine       latest       e7d92cdc71fe     7 days ago    <br> 5.59MB<br>centos       centos8.1.1911   470671670cac     7 days ago    <br>237MB<br>centos       latest       470671670cac     7 days ago    <br>237MB<br>busybox       latest       6d5fcfe5ff17     4 weeks ago    <br>1.22MB<br>hello-world     latest       fce289e99eb9     12 months ago   <br>1.84kB<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND         CREATED    <br>  STATUS           PORTS        NAMES<br>d4741f815199    busybox       <span class="hljs-string">&quot;sh&quot;</span>           41 hours ago <br>  Exited (137) 23 hours ago            flamboyant_moser<br>5dee9be9afdb    nginx        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  2 days ago  <br>  Exited (0) 23 hours ago             lucid_lichterman<br>  <br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker info |grep &quot;Storage Driver&quot;</span><br>Storage Driver: overlay2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl stop docker</span><br>Warning: Stopping docker.service, but it can still be activated by:<br>docker.socket<br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /etc/docker/daemon.json</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /etc/docker/daemon.json</span><br>&#123;<br> <span class="hljs-string">&quot;storage-driver&quot;</span>: <span class="hljs-string">&quot;aufs&quot;</span><br>&#125;<br>                             <br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl restart docker</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker info |grep aufs</span><br>WARNING: the aufs storage-driver is deprecated, and will be removed <span class="hljs-keyword">in</span> a future<br>release.<br>Storage Driver: aufs<br>Root Dir: /var/lib/docker/aufs<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED      <br>STATUS       PORTS        NAMES<br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /etc/docker/daemon.json</span><br>&#123;<br> <span class="hljs-string">&quot;storage-driver&quot;</span>: <span class="hljs-string">&quot;aufs&quot;</span><br>&#125;<br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls /var/lib/docker</span><br>aufs builder buildkit containers image network overlay2 plugins runtimes<br>swarm tmp trust volumes<br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls /var/lib/docker/aufs/</span><br>diff layers mnt<br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll /var/lib/docker/aufs/</span><br>total 20<br>drwx------  5 root root 4096 Jan 25 16:46 ./<br>drwx--x--x 15 root root 4096 Jan 25 16:46 ../<br>drwx------  2 root root 4096 Jan 25 16:46 diff/<br>drwx------  2 root root 4096 Jan 25 16:46 layers/<br>drwx------  2 root root 4096 Jan 25 16:46 mnt/<br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /etc/docker/daemon.json</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /etc/docker/daemon.json</span><br>&#123;<br> <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://si7y70hh.mirror.aliyuncs.com&quot;</span>]<br>&#125;<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl restart docker</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll /var/lib/docker/aufs/</span><br>total 20<br>drwx------  5 root root 4096 Jan 25 16:46 ./<br>drwx--x--x 15 root root 4096 Jan 25 16:48 ../<br>drwx------  2 root root 4096 Jan 25 16:46 diff/<br>drwx------  2 root root 4096 Jan 25 16:46 layers/<br>drwx------  2 root root 4096 Jan 25 16:46 mnt/<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND         CREATED    <br>  STATUS           PORTS        NAMES<br>d4741f815199    busybox       <span class="hljs-string">&quot;sh&quot;</span>           41 hours ago <br>  Exited (137) 23 hours ago            flamboyant_moser<br>5dee9be9afdb    nginx        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  2 days ago  <br>  Exited (0) 23 hours ago             lucid_lichterman<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>nginx        latest       5ad3bd0e67a9     3 days ago    <br>127MB<br>alpine       latest       e7d92cdc71fe     7 days ago    <br> 5.59MB<br>centos       centos8.1.1911   470671670cac     7 days ago    <br>237MB<br>centos       latest       470671670cac     7 days ago    <br>237MB<br>busybox       latest       6d5fcfe5ff17     4 weeks ago    <br>1.22MB<br>hello-world     latest       fce289e99eb9     12 months ago   <br>1.84kB<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h4 id="1-2-5-5-docker-服务进程"><a href="#1-2-5-5-docker-服务进程" class="headerlink" title="1.2.5.5 docker 服务进程"></a>1.2.5.5 docker 服务进程</h4><p>通过查看docker进程，了解docker的运行及工作方式</p>
<h5 id="1-2-5-5-1-查看宿主机进程树"><a href="#1-2-5-5-1-查看宿主机进程树" class="headerlink" title="1.2.5.5.1 查看宿主机进程树"></a>1.2.5.5.1 查看宿主机进程树</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker version</span><br>Client: Docker Engine - Community<br>Version:      19.03.5<br>API version:    1.40<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:       Wed Nov 13 07:29:52 2019<br>OS/Arch:      linux/amd64<br>Experimental:    <span class="hljs-literal">false</span><br><br>Server: Docker Engine - Community<br>Engine:<br>Version:      19.03.5<br>API version:    1.40 (minimum version 1.12)<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:      Wed Nov 13 07:28:22 2019<br>OS/Arch:     linux/amd64<br>Experimental:   <span class="hljs-literal">false</span><br>containerd:<br>Version:      1.2.10<br>GitCommit:    b34a5c8af56e510852c35414db4c1f4fa6172339<br>runc:<br>Version:      1.0.0-rc8+dev<br>GitCommit:    3e425f80a8c931f88e6d94a8c831b9d5aa481657<br>docker-init:<br>Version:      0.18.0<br>GitCommit:    fec3683<br>[root@ubuntu1804 ~]<span class="hljs-comment">#pstree -p</span><br>systemd(1)─┬─VGAuthService(796)<br>     ├─accounts-daemon(800)─┬─&#123;accounts-daemon&#125;(805)<br>     │           └─&#123;accounts-daemon&#125;(807)<br>     ├─agetty(866)<br>     ├─atd(799)<br>     ├─blkmapd(502)<br>     ├─containerd(801)─┬─containerd-shim(2497)─┬─sh(2520)<br>     │         │            ├─&#123;containerd-shim&#125;(2499)<br>     │         │            ├─&#123;containerd-shim&#125;(2500)<br>     │         │            ├─&#123;containerd-shim&#125;(2501)<br>     │         │            ├─&#123;containerd-shim&#125;(2502)<br>     │         │            ├─&#123;containerd-shim&#125;(2503)<br>     │         │            ├─&#123;containerd-shim&#125;(2504)<br>     │         │            ├─&#123;containerd-shim&#125;(2505)<br>     │         │            ├─&#123;containerd-shim&#125;(2550)<br>     │         │            └─&#123;containerd-shim&#125;(2551)<br>     │         ├─containerd-shim(2627)─┬─nginx(2649)───nginx(2699)<br>     │         │            ├─&#123;containerd-shim&#125;(2628)<br>     │         │            ├─&#123;containerd-shim&#125;(2629)<br>     │         │            ├─&#123;containerd-shim&#125;(2630)<br>     │         │            ├─&#123;containerd-shim&#125;(2631)<br>     │         │            ├─&#123;containerd-shim&#125;(2632)<br>     │         │            ├─&#123;containerd-shim&#125;(2633)<br>     │         │            ├─&#123;containerd-shim&#125;(2634)<br>     │         │            ├─&#123;containerd-shim&#125;(2636)<br>     │         │            └─&#123;containerd-shim&#125;(2678)<br>     │         ├─containerd-shim(2756)─┬─nginx(2776)───nginx(2823)<br>     │         │            ├─&#123;containerd-shim&#125;(2757)<br>     │         │            ├─&#123;containerd-shim&#125;(2758)<br>     │         │            ├─&#123;containerd-shim&#125;(2759)<br>     │         │            ├─&#123;containerd-shim&#125;(2760)<br>     │         │            ├─&#123;containerd-shim&#125;(2761)<br>     │         │            ├─&#123;containerd-shim&#125;(2762)<br>     │         │            ├─&#123;containerd-shim&#125;(2763)<br>     │         │            ├─&#123;containerd-shim&#125;(2765)<br>     │         │            └─&#123;containerd-shim&#125;(2805)<br>     │         ├─&#123;containerd&#125;(906)<br>     │         ├─&#123;containerd&#125;(907)<br>     │         ├─&#123;containerd&#125;(909)<br>     │         ├─&#123;containerd&#125;(930)<br>     │         ├─&#123;containerd&#125;(931)<br>     │         ├─&#123;containerd&#125;(933)<br>     │         ├─&#123;containerd&#125;(934)<br>     │         ├─&#123;containerd&#125;(948)<br>     │         ├─&#123;containerd&#125;(2498)<br>     │         └─&#123;containerd&#125;(2827)<br>     ├─cron(794)<br>     ├─dbus-daemon(781)<br>     ├─dockerd(2207)─┬─docker-proxy(2622)─┬─&#123;docker-proxy&#125;(2623)<br>     │        │          ├─&#123;docker-proxy&#125;(2624)<br>     │        │          ├─&#123;docker-proxy&#125;(2625)<br>     │        │          └─&#123;docker-proxy&#125;(2626)<br>     │        ├─docker-proxy(2750)─┬─&#123;docker-proxy&#125;(2751)<br>     │        │          ├─&#123;docker-proxy&#125;(2752)<br>     │        │          ├─&#123;docker-proxy&#125;(2753)<br>     │        │          ├─&#123;docker-proxy&#125;(2754)<br>     │        │          └─&#123;docker-proxy&#125;(2755)<br>     │        ├─&#123;dockerd&#125;(2209)<br>     │        ├─&#123;dockerd&#125;(2210)<br>     │        ├─&#123;dockerd&#125;(2211)<br>     │        ├─&#123;dockerd&#125;(2215)<br>     │        ├─&#123;dockerd&#125;(2220)<br>     │        ├─&#123;dockerd&#125;(2221)<br>     │        ├─&#123;dockerd&#125;(2222)<br>     │        ├─&#123;dockerd&#125;(2514)<br>     │        └─&#123;dockerd&#125;(2540)<br>     ├─iscsid(837)<br>     ├─iscsid(839)<br>     ├─lvmetad(513)<br>     ├─lxcfs(780)─┬─&#123;lxcfs&#125;(783)<br>     │      ├─&#123;lxcfs&#125;(784)<br>     │      └─&#123;lxcfs&#125;(1512)<br>     ├─networkd-dispat(795)───&#123;networkd-dispat&#125;(925)<br>     ├─polkitd(808)─┬─&#123;polkitd&#125;(809)<br>     │       └─&#123;polkitd&#125;(816)<br>     ├─rpc.idmapd(690)<br>     ├─rpc.mountd(751)<br>     ├─rpcbind(693)<br>     ├─rsyslogd(788)─┬─&#123;rsyslogd&#125;(791)<br>     │        ├─&#123;rsyslogd&#125;(792)<br>     │        └─&#123;rsyslogd&#125;(793)<br>     ├─snapd(798)─┬─&#123;snapd&#125;(823)<br>     │      ├─&#123;snapd&#125;(826)<br>     │      ├─&#123;snapd&#125;(827)<br>     │      ├─&#123;snapd&#125;(828)<br>     │      ├─&#123;snapd&#125;(873)<br>     │      ├─&#123;snapd&#125;(882)<br>     │      └─&#123;snapd&#125;(883)<br>     ├─sshd(881)───sshd(912)───bash(1240)───pstree(2900)<br>     ├─systemd(947)───(sd-pam)(958)<br>     ├─systemd-journal(481)<br>     ├─systemd-logind(797)<br>     ├─systemd-network(700)<br>          ├─systemd-resolve(730)<br>     ├─systemd-timesyn(691)───&#123;systemd-timesyn&#125;(746)<br>     ├─systemd-udevd(508)<br>     └─vmtoolsd(489)<br>     <br>[root@ubuntu1804 ~]<span class="hljs-comment">#ps aux|grep -E &quot;containerd|docker&quot;</span><br>root     801  0.0  4.4 776680 43972 ?    Ssl  12:30  0:03<br>/usr/bin/containerd<br>root    2207  0.0  8.8 839016 86712 ?    Ssl  16:48  0:02<br>/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock<br>root    2497  0.0  0.5 107696  5564 ?    Sl  17:33  0:00 containerd-<br>shim -namespace moby -workdir<br>/var/lib/containerd/io.containerd.runtime.v1.linux/moby/d4741f815199a35c7e802662<br>206160342d56125b47ec46d48a5f580759d86a6e -address<br>/run/containerd/containerd.sock -containerd-binary /usr/bin/containerd -runtime-<br>root /var/run/docker/runtime-runc<br>root    2622  0.0  0.4 405532  4128 ?    Sl  17:34  0:00<br>/usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 8888 -container-ip<br>172.17.0.3 -container-port 80<br>root    2627  0.0  0.6 109104  6196 ?    Sl  17:34  0:00 containerd-<br>shim -namespace moby -workdir<br>/var/lib/containerd/io.containerd.runtime.v1.linux/moby/5dee9be9afdbab8c2f6c4c5e<br>b0f956c9579efe93110daf638f8fd15f43d961e2 -address<br>/run/containerd/containerd.sock -containerd-binary /usr/bin/containerd -runtime-<br>root /var/run/docker/runtime-runc<br>root    2750  0.0  0.4 479264  4148 ?    Sl  17:38  0:00<br>/usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 6666 -container-ip<br>172.17.0.4 -container-port 80<br>root    2756  0.0  0.6 109104  6204 ?    Sl  17:38  0:00 containerd-<br>shim -namespace moby -workdir<br>/var/lib/containerd/io.containerd.runtime.v1.linux/moby/d9e7f75cdb9d7d30f8febae3<br>0d72cdc4b6e96b0408fa998af6deb3937d5271ed -address<br>/run/containerd/containerd.sock -containerd-binary /usr/bin/containerd -runtime-<br>root /var/run/docker/runtime-runc<br>root    2899  0.0  0.1  14428  1100 pts/0  S+  17:51  0:00 grep --<br>color=auto -E containerd|docker<br></code></pre></td></tr></table></figure>

<p><strong>18.06及之前的docker版本，进程关系:</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker29.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker30.png" srcset="/blog/img/loading.gif"></p>
<h5 id="1-2-5-5-2-docker的进程关系"><a href="#1-2-5-5-2-docker的进程关系" class="headerlink" title="1.2.5.5.2 docker的进程关系"></a>1.2.5.5.2 docker的进程关系</h5><p>docker 相关的四个进程:</p>
<ul>
<li><p>dockerd: 服务器程序,被client直接访问，其父进程为宿主机的systemd守护进程。</p>
</li>
<li><p>docker-proxy: 每个进程docker-proxy实现对应一个需要网络通信的容器，管理宿主机和容器之间的端口映射，其父进程为dockerd，如果容器不需要网络则无需启动</p>
</li>
<li><p>containerd: 被dockerd进程调用以实现与runc交互</p>
</li>
<li><p>containerd-shim: 真正运行容器的载体，每个容器对应一个containerd-shim进程，其父进程为containerd</p>
</li>
</ul>
<h5 id="1-2-5-5-3-containerd-shim命令使用"><a href="#1-2-5-5-3-containerd-shim命令使用" class="headerlink" title="1.2.5.5.3 containerd-shim命令使用"></a>1.2.5.5.3 containerd-shim命令使用</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#containerd-shim -h</span><br>Usage of containerd-shim:<br>  -address string<br>    	grpc address back to main containerd<br>  -containerd-binary containerd publish<br>    	path to containerd binary (used <span class="hljs-keyword">for</span> containerd publish) (default <span class="hljs-string">&quot;containerd&quot;</span>)<br>  -criu string<br>    	path to criu binary<br>  -debug<br>    	<span class="hljs-built_in">enable</span> debug output <span class="hljs-keyword">in</span> logs<br>  -namespace string<br>    	namespace that owns the shim<br>  -runtime-root string<br>    	root directory <span class="hljs-keyword">for</span> the runtime (default <span class="hljs-string">&quot;/run/containerd/runc&quot;</span>)<br>  -socket string<br>    	socket path to serve<br>  -systemd-cgroup<br>    	<span class="hljs-built_in">set</span> runtime to use systemd-cgroup<br>  -workdir string<br>    	path used to storge large temporary data<br></code></pre></td></tr></table></figure>

<h5 id="1-2-5-5-4-容器的创建与管理过程"><a href="#1-2-5-5-4-容器的创建与管理过程" class="headerlink" title="1.2.5.5.4 容器的创建与管理过程"></a>1.2.5.5.4 容器的创建与管理过程</h5><p>通信流程:</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker31.png" srcset="/blog/img/loading.gif"></p>
<ol>
<li>dockerd通过grpc和 containerd模块通信，dockerd由libcontainerd负责和containerd进行交换，dockerd和containerd 通信socket文件: /run/containerd/containerd.sock</li>
<li>containerd在dockerd启动时被启动，然后containerd启动grpc请求监听，containerd处理grpc请求，根据请求做相应动作</li>
<li>若是run, start或是exec 容器，containerd 拉起一个container-shim , 并进行相应的操作</li>
<li>container-shim别拉起后，start/exec/create拉起runC进程，通过exit、control文件和containerd通信，通过父子进程关系和SIGCHLD监控容器中进程状态</li>
<li>在整个容器生命周期中，containerd通过 epoll 监控容器文件，监控容器事件</li>
</ol>
<h5 id="1-2-5-5-5-gRPC简介"><a href="#1-2-5-5-5-gRPC简介" class="headerlink" title="1.2.5.5.5 gRPC简介"></a>1.2.5.5.5 gRPC简介</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker32.png" srcset="/blog/img/loading.gif"></p>
<p>gRPC是Google开发的一款高性能、开源和通用的 RPC 框架，支持众多语言客户端<br>官网: <a target="_blank" rel="noopener" href="https://www.grpc.io/">https://www.grpc.io/</a></p>
<h5 id="1-2-5-5-6-podman-的进程结构"><a href="#1-2-5-5-6-podman-的进程结构" class="headerlink" title="1.2.5.5.6 podman 的进程结构"></a>1.2.5.5.6 podman 的进程结构</h5><p>podman没有dockerd服务进程，所以当无容器启动时，无需启动任何进程，而容器启动时，会做为conmon的子进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos8 ~]<span class="hljs-comment">#podman version</span><br>Version:       1.4.2-stable2<br>RemoteAPI Version:  1<br>Go Version:     go1.12.8<br>OS/Arch:      linux/amd64<br><br>[root@centos8 ~]<span class="hljs-comment">#podman run -d -p 80:80 docker.io/library/nginx</span><br>d8877293635c599a82ab5cb82c942cd86baf7c5810dd824154b15b0a88e76be8<br>[root@centos8 ~]<span class="hljs-comment">#ss -tlnp</span><br>State  Recv-Q  Send-Q   Local Address:Port    Peer Address:Port    <br>     LISTEN  0     128        0.0.0.0:80        0.0.0.0:*<br>   users:((<span class="hljs-string">&quot;conmon&quot;</span>,pid=5173,fd=5)) <br>LISTEN  0     128        0.0.0.0:22        0.0.0.0:*   <br>users:((<span class="hljs-string">&quot;sshd&quot;</span>,pid=687,fd=4))   <br>LISTEN  0     128         [::]:22         [::]:*   <br>users:((<span class="hljs-string">&quot;sshd&quot;</span>,pid=687,fd=6)) <br><br>[root@centos8 ~]<span class="hljs-comment">#pstree -p</span><br>systemd(1)─┬─NetworkManager(660)─┬─&#123;NetworkManager&#125;(680)<br>     │           └─&#123;NetworkManager&#125;(682)<br>     ├─VGAuthService(663)<br>     ├─agetty(805)<br>     ├─anacron(2793)<br>     ├─atd(799)<br>     ├─auditd(616)───&#123;auditd&#125;(617)<br>     ├─automount(816)─┬─&#123;automount&#125;(821)<br>     │        ├─&#123;automount&#125;(822)<br>          │        ├─&#123;automount&#125;(829)<br>     │        └─&#123;automount&#125;(837)<br>     ├─conmon(5173)─┬─nginx(5183)───nginx(5194)<br>     │       └─&#123;conmon&#125;(5175)<br>     ├─crond(797)<br>     ├─dbus-daemon(658)<br>     ├─polkitd(665)─┬─&#123;polkitd&#125;(679)<br>     │       ├─&#123;polkitd&#125;(683)<br>     │       ├─&#123;polkitd&#125;(694)<br>     │       ├─&#123;polkitd&#125;(695)<br>     │       └─&#123;polkitd&#125;(750)<br>     ├─rngd(661)───&#123;rngd&#125;(673)<br>     ├─rsyslogd(814)─┬─&#123;rsyslogd&#125;(818)<br>     │        └─&#123;rsyslogd&#125;(820)<br>     ├─sshd(687)─┬─sshd(1166)───sshd(1243)───bash(1244)<br>     │      └─sshd(1306)───sshd(1308)───bash(1309)───pstree(5198)<br>     ├─sssd(659)─┬─sssd_be(722)<br>     │      └─sssd_nss(749)<br>     ├─systemd(1234)───(sd-pam)(1237)<br>     ├─systemd-journal(543)<br>     ├─systemd-logind(794)<br>     ├─systemd-udevd(575)<br>     ├─tuned(692)─┬─&#123;tuned&#125;(1080)<br>     │      ├─&#123;tuned&#125;(1089)<br>     │      └─&#123;tuned&#125;(1097)<br>     └─vmtoolsd(664)───&#123;vmtoolsd&#125;(762)<br>[root@centos8 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h3 id="1-2-6-docker-服务管理"><a href="#1-2-6-docker-服务管理" class="headerlink" title="1.2.6 docker 服务管理"></a>1.2.6 docker 服务管理</h3><p>docker 服务基于C/S 结构,可以实现基于本地和远程方式进行管理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#Dockerd守护进程启动选项</span><br>-H tcp://host:port<br>unix:///path/to/socket,<br>fd://* or fd://socketfd<br><span class="hljs-comment">#守护进程默认配置:</span><br>-H unix:///var/run/docker.sock<br><br><span class="hljs-comment">#使用Docker客户端命令选项</span><br>-H tcp://host:port<br> unix:///path/to/socket,<br> fd://* or fd://socketfd<br><span class="hljs-comment">#客户端默认配置:</span><br>-H unix:///var/run/docker.sock<br><br><span class="hljs-comment">#docker客户端也可以使用环境变量DOCKER_HOST,代替-H选项</span><br><span class="hljs-built_in">export</span> DOCKER_HOST=<span class="hljs-string">&quot;tcp://docker-server:2375&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>范例: 通过UDS访问docker</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#cat /lib/systemd/system/docker.service</span><br>[Unit]<br>Description=Docker Application Container Engine<br>Documentation=https://docs.docker.com<br>BindsTo=containerd.service<br>After=network-online.target firewalld.service containerd.service<br>Wants=network-online.target<br>Requires=docker.socket<br><br>[Service]<br>Type=notify<br><span class="hljs-comment"># the default is not to use systemd for cgroups because the delegate issues</span><br>still<br><span class="hljs-comment"># exists and systemd currently does not support the cgroup feature set required</span><br><span class="hljs-comment"># for containers run by docker</span><br>ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock<br>ExecReload=/bin/<span class="hljs-built_in">kill</span> -s HUP <span class="hljs-variable">$MAINPID</span><br>TimeoutSec=0<br>RestartSec=2<br>Restart=always<br><br><span class="hljs-comment"># Note that StartLimit* options were moved from &quot;Service&quot; to &quot;Unit&quot; in systemd</span><br>229.<br><span class="hljs-comment"># Both the old, and new location are accepted by systemd 229 and up, so using</span><br>the old location<br><span class="hljs-comment"># to make them work for either version of systemd.</span><br>StartLimitBurst=3<br><br><span class="hljs-comment"># Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd</span><br>230.<br><span class="hljs-comment"># Both the old, and new name are accepted by systemd 230 and up, so using the</span><br>old name to make<br><span class="hljs-comment"># this option work for either version of systemd.</span><br>StartLimitInterval=60s<br><br><span class="hljs-comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="hljs-comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br>LimitNOFILE=infinity<br>LimitNPROC=infinity<br>LimitCORE=infinity<br><br><span class="hljs-comment"># Comment TasksMax if your systemd version does not support it.</span><br><span class="hljs-comment"># Only systemd 226 and above support this option.</span><br>TasksMax=infinity<br><br><span class="hljs-comment"># set delegate yes so that systemd does not reset the cgroups of docker</span><br>containers<br>Delegate=yes<br><br><span class="hljs-comment"># kill only the docker process, not all processes in the cgroup</span><br>KillMode=process<br><br>[Install]<br>WantedBy=multi-user.target<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl status docker</span><br>● docker.service - Docker Application Container Engine<br> Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset:<br>enabled)<br> Active: active (running) since Wed 2020-07-22 14:06:46 CST; 5h 50min ago<br>  Docs: https://docs.docker.com<br>  Main PID: 1138 (dockerd)<br> Tasks: 17<br> CGroup: /system.slice/docker.service<br>     └─1138 /usr/bin/dockerd -H fd:// --<br>containerd=/run/containerd/containerd.sock<br><br>Jul 22 15:43:42 ubuntu1804.magedu.org dockerd[1138]: time=<span class="hljs-string">&quot;2020-07-</span><br><span class="hljs-string">22T15:43:42.056506408+08:00&quot;</span> level=info msg=<span class="hljs-string">&quot;</span><br><span class="hljs-string">Jul 22 15:43:42 ubuntu1804.magedu.org dockerd[1138]: time=&quot;</span>2020-07-<br>22T15:43:42.064414577+08:00<span class="hljs-string">&quot; level=info msg=&quot;</span><br>Jul 22 15:53:58 ubuntu1804.magedu.org dockerd[1138]: time=<span class="hljs-string">&quot;2020-07-</span><br><span class="hljs-string">22T15:53:58.938037439+08:00&quot;</span> level=info msg=<span class="hljs-string">&quot;</span><br><span class="hljs-string">Jul 22 15:53:58 ubuntu1804.magedu.org dockerd[1138]: time=&quot;</span>2020-07-<br>22T15:53:58.951842078+08:00<span class="hljs-string">&quot; level=info msg=&quot;</span><br>Jul 22 15:55:33 ubuntu1804.magedu.org dockerd[1138]: time=<span class="hljs-string">&quot;2020-07-</span><br><span class="hljs-string">22T15:55:33.837166628+08:00&quot;</span> level=info msg=<span class="hljs-string">&quot;</span><br><span class="hljs-string">Jul 22 19:47:55 ubuntu1804.magedu.org dockerd[1138]: time=&quot;</span>2020-07-<br>22T19:47:55.212507176+08:00<span class="hljs-string">&quot; level=info msg=&quot;</span><br>Jul 22 19:47:55 ubuntu1804.magedu.org dockerd[1138]: time=<span class="hljs-string">&quot;2020-07-</span><br><span class="hljs-string">22T19:47:55.220542970+08:00&quot;</span> level=info msg=<span class="hljs-string">&quot;</span><br><span class="hljs-string">Jul 22 19:47:55 ubuntu1804.magedu.org dockerd[1138]: time=&quot;</span>2020-07-<br>22T19:47:55.234106123+08:00<span class="hljs-string">&quot; level=info msg=&quot;</span><br>Jul 22 19:47:55 ubuntu1804.magedu.org dockerd[1138]: time=<span class="hljs-string">&quot;2020-07-</span><br><span class="hljs-string">22T19:47:55.237476234+08:00&quot;</span> level=info msg=<span class="hljs-string">&quot;</span><br><span class="hljs-string">Jul 22 19:47:55 ubuntu1804.magedu.org dockerd[1138]: time=&quot;</span>2020-07-<br>22T19:47:55.238167375+08:00<span class="hljs-string">&quot; level=info msg=</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@ubuntu1804 ~]#ll /var/run/docker.sock</span><br><span class="hljs-string">srw-rw---- 1 root docker 0 Jul 22 20:33 /var/run/docker.sock=</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@ubuntu1804 ~]#nc -U /var/run/docker.sock</span><br><span class="hljs-string">GET /info HTTP/1.1</span><br><span class="hljs-string">host: www.magedu.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">HTTP/1.1 200 OK</span><br><span class="hljs-string">Api-Version: 1.40</span><br><span class="hljs-string">Content-Type: application/json</span><br><span class="hljs-string">Docker-Experimental: false</span><br><span class="hljs-string">Ostype: linux</span><br><span class="hljs-string">Server: Docker/19.03.12 (linux)</span><br><span class="hljs-string">Date: Wed, 22 Jul 2020 11:54:12 GMT</span><br><span class="hljs-string">Transfer-Encoding: chunked</span><br><span class="hljs-string"></span><br><span class="hljs-string">947</span><br><span class="hljs-string">&#123;&quot;</span>ID<span class="hljs-string">&quot;:&quot;</span>LVU6:OXD3:TAPB:KDNQ:YRSN:XTAS:3V32:IERB:2DM6:4CDK:CRO6:ZKAW<span class="hljs-string">&quot;,&quot;</span>Containers<span class="hljs-string">&quot;:0,&quot;</span>ContainersRunning<span class="hljs-string">&quot;:0,&quot;</span>ContainersPaused<span class="hljs-string">&quot;:0,&quot;</span>ContainersStopped<span class="hljs-string">&quot;:0,&quot;</span>Images<span class="hljs-string">&quot;:5,&quot;</span>Driver<span class="hljs-string">&quot;:&quot;</span>overlay2<span class="hljs-string">&quot;,&quot;</span>DriverStatus<span class="hljs-string">&quot;:[[&quot;</span>Backing Filesystem<span class="hljs-string">&quot;,&quot;</span>extfs<span class="hljs-string">&quot;],[&quot;</span>Supports<br>d_type<span class="hljs-string">&quot;,&quot;</span><span class="hljs-literal">true</span><span class="hljs-string">&quot;],[&quot;</span>Native Overlay Diff<span class="hljs-string">&quot;,&quot;</span><span class="hljs-literal">true</span><span class="hljs-string">&quot;]],&quot;</span>SystemStatus<span class="hljs-string">&quot;:null,&quot;</span>Plugins<span class="hljs-string">&quot;:</span><br><span class="hljs-string">&#123;&quot;</span>Volume<span class="hljs-string">&quot;:[&quot;</span><span class="hljs-built_in">local</span><span class="hljs-string">&quot;],&quot;</span>Network<span class="hljs-string">&quot;:</span><br><span class="hljs-string">[&quot;</span>bridge<span class="hljs-string">&quot;,&quot;</span>host<span class="hljs-string">&quot;,&quot;</span>ipvlan<span class="hljs-string">&quot;,&quot;</span>macvlan<span class="hljs-string">&quot;,&quot;</span>null<span class="hljs-string">&quot;,&quot;</span>overlay<span class="hljs-string">&quot;],&quot;</span>Authorization<span class="hljs-string">&quot;:null,&quot;</span>Log<span class="hljs-string">&quot;:[&quot;</span>awslogs<span class="hljs-string">&quot;,&quot;</span>fluentd<span class="hljs-string">&quot;,&quot;</span>gcplogs<span class="hljs-string">&quot;,&quot;</span>gelf<span class="hljs-string">&quot;,&quot;</span>journald<span class="hljs-string">&quot;,&quot;</span>json-<br>file<span class="hljs-string">&quot;,&quot;</span><span class="hljs-built_in">local</span><span class="hljs-string">&quot;,&quot;</span>logentries<span class="hljs-string">&quot;,&quot;</span>splunk<span class="hljs-string">&quot;,&quot;</span>syslog<span class="hljs-string">&quot;]&#125;,&quot;</span>MemoryLimit<span class="hljs-string">&quot;:true,&quot;</span>SwapLimit<span class="hljs-string">&quot;:false,&quot;</span>KernelMemory<span class="hljs-string">&quot;:true,&quot;</span>KernelMemoryTCP<span class="hljs-string">&quot;:true,&quot;</span>CpuCfsPeriod<span class="hljs-string">&quot;:true,&quot;</span>CpuCfsQuota<span class="hljs-string">&quot;:true,&quot;</span>CPUShares<span class="hljs-string">&quot;:true,&quot;</span>CPUSet<span class="hljs-string">&quot;:true,&quot;</span>PidsLimit<span class="hljs-string">&quot;:true,&quot;</span>IPv4Forwarding<span class="hljs-string">&quot;:true,&quot;</span>BridgeNfIptables<span class="hljs-string">&quot;:true,&quot;</span>BridgeNfIp6tables<span class="hljs-string">&quot;:true,&quot;</span>Debug<span class="hljs-string">&quot;:false,&quot;</span>NFd<span class="hljs-string">&quot;:21,&quot;</span>OomKillDisable<span class="hljs-string">&quot;:true,&quot;</span>NGoroutines<span class="hljs-string">&quot;:35,&quot;</span>SystemTime<span class="hljs-string">&quot;:&quot;</span>2020-07-<br>22T19:54:12.335572334+08:00<span class="hljs-string">&quot;,&quot;</span>LoggingDriver<span class="hljs-string">&quot;:&quot;</span>json-<br>file<span class="hljs-string">&quot;,&quot;</span>CgroupDriver<span class="hljs-string">&quot;:&quot;</span>cgroupfs<span class="hljs-string">&quot;,&quot;</span>NEventsListener<span class="hljs-string">&quot;:0,&quot;</span>KernelVersion<span class="hljs-string">&quot;:&quot;</span>4.15.0-111-generic<span class="hljs-string">&quot;,&quot;</span>OperatingSystem<span class="hljs-string">&quot;:&quot;</span>Ubuntu 18.04.4<br>LTS<span class="hljs-string">&quot;,&quot;</span>OSType<span class="hljs-string">&quot;:&quot;</span>linux<span class="hljs-string">&quot;,&quot;</span>Architecture<span class="hljs-string">&quot;:&quot;</span>x86_64<span class="hljs-string">&quot;,&quot;</span>IndexServerAddress<span class="hljs-string">&quot;:&quot;</span>https://index.docker.io/v1/<span class="hljs-string">&quot;,&quot;</span>RegistryConfig<span class="hljs-string">&quot;:&#123;&quot;</span>AllowNondistributableArtifactsCIDRs<span class="hljs-string">&quot;:</span><br><span class="hljs-string">[],&quot;</span>AllowNondistributableArtifactsHostnames<span class="hljs-string">&quot;:[],&quot;</span>InsecureRegistryCIDRs<span class="hljs-string">&quot;:</span><br><span class="hljs-string">[&quot;</span>127.0.0.0/8<span class="hljs-string">&quot;],&quot;</span>IndexConfigs<span class="hljs-string">&quot;:&#123;&quot;</span>docker.io<span class="hljs-string">&quot;:&#123;&quot;</span>Name<span class="hljs-string">&quot;:&quot;</span>docker.io<span class="hljs-string">&quot;,&quot;</span>Mirrors<span class="hljs-string">&quot;:</span><br><span class="hljs-string">[&quot;</span>https://si7y70hh.mirror.aliyuncs.com/<span class="hljs-string">&quot;],&quot;</span>Secure<span class="hljs-string">&quot;:true,&quot;</span>Official<span class="hljs-string">&quot;:true&#125;&#125;,&quot;</span>Mirrors<span class="hljs-string">&quot;:</span><br><span class="hljs-string">[&quot;</span>https://si7y70hh.mirror.aliyuncs.com/<span class="hljs-string">&quot;]&#125;,&quot;</span>NCPU<span class="hljs-string">&quot;:4,&quot;</span>MemTotal<span class="hljs-string">&quot;:3122880512,&quot;</span>GenericResources<span class="hljs-string">&quot;:null,&quot;</span>DockerRootDir<span class="hljs-string">&quot;:&quot;</span>/var/lib/docker<span class="hljs-string">&quot;,&quot;</span>HttpProxy<span class="hljs-string">&quot;:&quot;</span><span class="hljs-string">&quot;,&quot;</span>HttpsProxy<span class="hljs-string">&quot;:</span><br><span class="hljs-string">&quot;</span><span class="hljs-string">&quot;,&quot;</span>NoProxy<span class="hljs-string">&quot;:&quot;</span><span class="hljs-string">&quot;,&quot;</span>Name<span class="hljs-string">&quot;:&quot;</span>ubuntu1804.magedu.org<span class="hljs-string">&quot;,&quot;</span>Labels<span class="hljs-string">&quot;:</span><br><span class="hljs-string">[],&quot;</span>ExperimentalBuild<span class="hljs-string">&quot;:false,&quot;</span>ServerVersion<span class="hljs-string">&quot;:&quot;</span>19.03.12<span class="hljs-string">&quot;,&quot;</span>ClusterStore<span class="hljs-string">&quot;:&quot;</span><span class="hljs-string">&quot;,&quot;</span>ClusterAdvertise<span class="hljs-string">&quot;:&quot;</span><span class="hljs-string">&quot;,&quot;</span>Runtimes<span class="hljs-string">&quot;:&#123;&quot;</span>runc<span class="hljs-string">&quot;:</span><br><span class="hljs-string">&#123;&quot;</span>path<span class="hljs-string">&quot;:&quot;</span>runc<span class="hljs-string">&quot;&#125;&#125;,&quot;</span>DefaultRuntime<span class="hljs-string">&quot;:&quot;</span>runc<span class="hljs-string">&quot;,&quot;</span>Swarm<span class="hljs-string">&quot;:</span><br><span class="hljs-string">&#123;&quot;</span>NodeID<span class="hljs-string">&quot;:&quot;</span><span class="hljs-string">&quot;,&quot;</span>NodeAddr<span class="hljs-string">&quot;:&quot;</span><span class="hljs-string">&quot;,&quot;</span>LocalNodeState<span class="hljs-string">&quot;:&quot;</span>inactive<span class="hljs-string">&quot;,&quot;</span>ControlAvailable<span class="hljs-string">&quot;:false,&quot;</span>Error<span class="hljs-string">&quot;:&quot;</span><span class="hljs-string">&quot;,&quot;</span>RemoteManagers<span class="hljs-string">&quot;:null&#125;,&quot;</span>LiveRestoreEnabled<span class="hljs-string">&quot;:false,&quot;</span>Isolation<span class="hljs-string">&quot;:&quot;</span><span class="hljs-string">&quot;,&quot;</span>InitBinary<span class="hljs-string">&quot;:&quot;</span>docker-init<span class="hljs-string">&quot;,&quot;</span>ContainerdCommit<span class="hljs-string">&quot;:</span><br><span class="hljs-string">&#123;&quot;</span>ID<span class="hljs-string">&quot;:&quot;</span>7ad184331fa3e55e52b890ea95e65ba581ae3429<span class="hljs-string">&quot;,&quot;</span>Expected<span class="hljs-string">&quot;:&quot;</span>7ad184331fa3e55e52b890ea95e65ba581ae3429<span class="hljs-string">&quot;&#125;,&quot;</span>RuncCommit<span class="hljs-string">&quot;:</span><br><span class="hljs-string">&#123;&quot;</span>ID<span class="hljs-string">&quot;:&quot;</span>dc9208a3303feef5b3839f4323d9beb36df0a9dd<span class="hljs-string">&quot;,&quot;</span>Expected<span class="hljs-string">&quot;:&quot;</span>dc9208a3303feef5b3839f4323d9beb36df0a9dd<span class="hljs-string">&quot;&#125;,&quot;</span>InitCommit<span class="hljs-string">&quot;:</span><br><span class="hljs-string">&#123;&quot;</span>ID<span class="hljs-string">&quot;:&quot;</span>fec3683<span class="hljs-string">&quot;,&quot;</span>Expected<span class="hljs-string">&quot;:&quot;</span>fec3683<span class="hljs-string">&quot;&#125;,&quot;</span>SecurityOptions<span class="hljs-string">&quot;:</span><br><span class="hljs-string">[&quot;</span>name=apparmor<span class="hljs-string">&quot;,&quot;</span>name=seccomp,profile=default<span class="hljs-string">&quot;],&quot;</span>Warnings<span class="hljs-string">&quot;:[&quot;</span>WARNING: No swap <span class="hljs-built_in">limit</span> support<span class="hljs-string">&quot;]&#125;</span><br></code></pre></td></tr></table></figure>

<p>范例: docker服务添加标签</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#vim /lib/systemd/system/docker.service</span><br><span class="hljs-comment">#修改下面行</span><br>ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock<br>--label=<span class="hljs-string">&quot;name=docker1&quot;</span> <span class="hljs-comment">#名称根据需求修改</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl daemon-reload</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl restart docker</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker info</span><br>Client:<br>Debug Mode: <span class="hljs-literal">false</span><br><br>Server:<br>Containers: 0<br>Running: 0<br>Paused: 0<br>Stopped: 0<br>Images: 5<br>Server Version: 19.03.12<br>Storage Driver: overlay2<br>Backing Filesystem: extfs<br>Supports d_type: <span class="hljs-literal">true</span><br>Native Overlay Diff: <span class="hljs-literal">true</span><br>Logging Driver: json-file<br>Cgroup Driver: cgroupfs<br>Plugins:<br>Volume: <span class="hljs-built_in">local</span><br>Network: bridge host ipvlan macvlan null overlay<br>Log: awslogs fluentd gcplogs gelf journald json-file <span class="hljs-built_in">local</span> logentries splunk<br>syslog<br>Swarm: inactive<br>Runtimes: runc<br>Default Runtime: runc<br>Init Binary: docker-init<br>containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429<br>runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd<br>init version: fec3683<br>Security Options:<br>apparmor<br>seccomp<br> Profile: default<br>Kernel Version: 4.15.0-111-generic<br>Operating System: Ubuntu 18.04.4 LTS<br>OSType: linux<br>Architecture: x86_64<br>CPUs: 4<br>Total Memory: 2.908GiB<br>Name: ubuntu1804.magedu.org<br>ID: LVU6:OXD3:TAPB:KDNQ:YRSN:XTAS:3V32:IERB:2DM6:4CDK:CRO6:ZKAW<br>Docker Root Dir: /var/lib/docker<br>Debug Mode: <span class="hljs-literal">false</span><br>Registry: https://index.docker.io/v1/<br>Labels:<br> name=docker1  <span class="hljs-comment">#此处显示添加的标签</span><br>Experimental: <span class="hljs-literal">false</span><br>Insecure Registries:<br> 127.0.0.0/8<br>Registry Mirrors:<br>https://si7y70hh.mirror.aliyuncs.com/<br>Live Restore Enabled: <span class="hljs-literal">false</span><br><br>WARNING: No swap <span class="hljs-built_in">limit</span> support<br></code></pre></td></tr></table></figure>

<p>范例: 开启docker的远程访问</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#方法1</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /lib/systemd/system/docker.service</span><br><span class="hljs-comment">#修改下面行</span><br>ExecStart=/usr/bin/dockerd -H fd:// -H tcp://0.0.0.0:2375 --<br>containerd=/run/containerd/containerd.sock --label=<span class="hljs-string">&quot;name=docker1&quot;</span><br><br><span class="hljs-comment">#方法2</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /lib/systemd/system/docker.service</span><br>ExecStart=/usr/bin/dockerd  --containerd=/run/containerd/containerd.sock<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /etc/docker/daemon.json</span><br>&#123; <br><span class="hljs-string">&quot;hosts&quot;</span>: [<span class="hljs-string">&quot;tcp://0.0.0.0:2375&quot;</span>, <span class="hljs-string">&quot;fd://&quot;</span>]<br>&#125;<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl daemon-reload</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl restart docker</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ss -tnlp|grep 2375</span><br>LISTEN  0     128            *:2375          *:*   <br>users:((<span class="hljs-string">&quot;dockerd&quot;</span>,pid=9964,fd=3)) <br>[root@ubuntu1804 ~]<span class="hljs-comment">#ps -ef | grep docker</span><br>root    9964    1  0 20:33 ?     00:00:00 /usr/bin/dockerd -H fd:// -H<br>tcp://0.0.0.0:2375 --containerd=/run/containerd/containerd.sock --<br>label=name=docker1<br>root    10187  2854  0 20:37 pts/1   00:00:00 grep --color=auto docker<br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll /var/run/docker.sock</span><br>srw-rw---- 1 root docker 0 Jul 22 20:33 /var/run/docker.sock=<br><br><span class="hljs-comment">#实现远程访问方式1</span><br>[root@centos7 ~]<span class="hljs-comment">#curl http://10.0.0.100:2375/info</span><br>&#123;<span class="hljs-string">&quot;ID&quot;</span>:<span class="hljs-string">&quot;LVU6:OXD3:TAPB:KDNQ:YRSN:XTAS:3V32:IERB:2DM6:4CDK:CRO6:ZKAW&quot;</span>,<span class="hljs-string">&quot;Containers&quot;</span> :0,<span class="hljs-string">&quot;ContainersRunning&quot;</span>:0,<span class="hljs-string">&quot;ContainersPaused&quot;</span>:0,<span class="hljs-string">&quot;ContainersStopped&quot;</span>:0,<span class="hljs-string">&quot;Images&quot;</span>:5,<span class="hljs-string">&quot;Driver&quot;</span>:<span class="hljs-string">&quot;overlay2&quot;</span>,<span class="hljs-string">&quot;DriverStatus&quot;</span>:[[<span class="hljs-string">&quot;Backing Filesystem&quot;</span>,<span class="hljs-string">&quot;extfs&quot;</span>],[<span class="hljs-string">&quot;Supports d_type&quot;</span>,<span class="hljs-string">&quot;true&quot;</span>],[<span class="hljs-string">&quot;Native Overlay Diff&quot;</span>,<span class="hljs-string">&quot;true&quot;</span>]],<span class="hljs-string">&quot;SystemStatus&quot;</span>:null,<span class="hljs-string">&quot;Plugins&quot;</span>:<br>&#123;<span class="hljs-string">&quot;Volume&quot;</span>:[<span class="hljs-string">&quot;local&quot;</span>],<span class="hljs-string">&quot;Network&quot;</span>:<br>[<span class="hljs-string">&quot;bridge&quot;</span>,<span class="hljs-string">&quot;host&quot;</span>,<span class="hljs-string">&quot;ipvlan&quot;</span>,<span class="hljs-string">&quot;macvlan&quot;</span>,<span class="hljs-string">&quot;null&quot;</span>,<span class="hljs-string">&quot;overlay&quot;</span>],<span class="hljs-string">&quot;Authorization&quot;</span>:null,<span class="hljs-string">&quot;Log&quot;</span>:[<span class="hljs-string">&quot;awslogs&quot;</span>,<span class="hljs-string">&quot;fluentd&quot;</span>,<span class="hljs-string">&quot;gcplogs&quot;</span>,<span class="hljs-string">&quot;gelf&quot;</span>,<span class="hljs-string">&quot;journald&quot;</span>,<span class="hljs-string">&quot;json-file&quot;</span>,<span class="hljs-string">&quot;local&quot;</span>,<span class="hljs-string">&quot;logentries&quot;</span>,<span class="hljs-string">&quot;splunk&quot;</span>,<span class="hljs-string">&quot;syslog&quot;</span>]&#125;,<span class="hljs-string">&quot;MemoryLimit&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;SwapLimit&quot;</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;KernelMemory&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;KernelMemoryTCP&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;CpuCfsPeriod&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;CpuCfsQuota&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;CPUShares&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;CPUSet&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;PidsLimit&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;IPv4Forwarding&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;BridgeNfIptables&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;BridgeNfIp6tables&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;Debug&quot;</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;NFd&quot;</span>:22,<span class="hljs-string">&quot;OomKillDisable&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;NGoroutines&quot;</span>:35,<span class="hljs-string">&quot;SystemTime&quot;</span>:<span class="hljs-string">&quot;2020-07-</span><br><span class="hljs-string">22T20:54:42.419355793+08:00&quot;</span>,<span class="hljs-string">&quot;LoggingDriver&quot;</span>:<span class="hljs-string">&quot;json-file&quot;</span>,<span class="hljs-string">&quot;CgroupDriver&quot;</span>:<span class="hljs-string">&quot;cgroupfs&quot;</span>,<span class="hljs-string">&quot;NEventsListener&quot;</span>:0,<span class="hljs-string">&quot;KernelVersion&quot;</span>:<span class="hljs-string">&quot;4.15.0-111-generic&quot;</span>,<span class="hljs-string">&quot;OperatingSystem&quot;</span>:<span class="hljs-string">&quot;Ubuntu 18.04.4</span><br><span class="hljs-string">LTS&quot;</span>,<span class="hljs-string">&quot;OSType&quot;</span>:<span class="hljs-string">&quot;linux&quot;</span>,<span class="hljs-string">&quot;Architecture&quot;</span>:<span class="hljs-string">&quot;x86_64&quot;</span>,<span class="hljs-string">&quot;IndexServerAddress&quot;</span>:<span class="hljs-string">&quot;https://index.docker.io/v1/&quot;</span>,<span class="hljs-string">&quot;RegistryConfig&quot;</span>:&#123;<span class="hljs-string">&quot;AllowNondistributableArtifactsCIDRs&quot;</span>:<br>[],<span class="hljs-string">&quot;AllowNondistributableArtifactsHostnames&quot;</span>:[],<span class="hljs-string">&quot;InsecureRegistryCIDRs&quot;</span>:<br>[<span class="hljs-string">&quot;127.0.0.0/8&quot;</span>],<span class="hljs-string">&quot;IndexConfigs&quot;</span>:&#123;<span class="hljs-string">&quot;docker.io&quot;</span>:&#123;<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-string">&quot;docker.io&quot;</span>,<span class="hljs-string">&quot;Mirrors&quot;</span>:<br>[<span class="hljs-string">&quot;https://si7y70hh.mirror.aliyuncs.com/&quot;</span>],<span class="hljs-string">&quot;Secure&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;Official&quot;</span>:<span class="hljs-literal">true</span>&#125;&#125;,<span class="hljs-string">&quot;Mirrors&quot;</span>:<br>[<span class="hljs-string">&quot;https://si7y70hh.mirror.aliyuncs.com/&quot;</span>]&#125;,<span class="hljs-string">&quot;NCPU&quot;</span>:4,<span class="hljs-string">&quot;MemTotal&quot;</span>:3122880512,<span class="hljs-string">&quot;GenericResources&quot;</span>:null,<span class="hljs-string">&quot;DockerRootDir&quot;</span>:<span class="hljs-string">&quot;/var/lib/docker&quot;</span>,<span class="hljs-string">&quot;HttpProxy&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;HttpsProxy&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;NoProxy&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-string">&quot;ubuntu1804.magedu.org&quot;</span>,<span class="hljs-string">&quot;Labels&quot;</span>:<br>[<span class="hljs-string">&quot;name=docker1&quot;</span>],<span class="hljs-string">&quot;ExperimentalBuild&quot;</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;ServerVersion&quot;</span>:<span class="hljs-string">&quot;19.03.12&quot;</span>,<span class="hljs-string">&quot;ClusterStore&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;ClusterAdvertise&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;Runtimes&quot;</span>:&#123;<span class="hljs-string">&quot;runc&quot;</span>:<br>&#123;<span class="hljs-string">&quot;path&quot;</span>:<span class="hljs-string">&quot;runc&quot;</span>&#125;&#125;,<span class="hljs-string">&quot;DefaultRuntime&quot;</span>:<span class="hljs-string">&quot;runc&quot;</span>,<span class="hljs-string">&quot;Swarm&quot;</span>:<br>&#123;<span class="hljs-string">&quot;NodeID&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;NodeAddr&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;LocalNodeState&quot;</span>:<span class="hljs-string">&quot;inactive&quot;</span>,<span class="hljs-string">&quot;ControlAvailable&quot;</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;Error&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;RemoteManagers&quot;</span>:null&#125;,<span class="hljs-string">&quot;LiveRestoreEnabled&quot;</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;Isolation&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;InitBinary&quot;</span>:<span class="hljs-string">&quot;docker-init&quot;</span>,<span class="hljs-string">&quot;ContainerdCommit&quot;</span>:<br>&#123;<span class="hljs-string">&quot;ID&quot;</span>:<span class="hljs-string">&quot;7ad184331fa3e55e52b890ea95e65ba581ae3429&quot;</span>,<span class="hljs-string">&quot;Expected&quot;</span>:<span class="hljs-string">&quot;7ad184331fa3e55e52b890ea95e65ba581ae3429&quot;</span>&#125;,<span class="hljs-string">&quot;RuncCommit&quot;</span>:<br>&#123;<span class="hljs-string">&quot;ID&quot;</span>:<span class="hljs-string">&quot;dc9208a3303feef5b3839f4323d9beb36df0a9dd&quot;</span>,<span class="hljs-string">&quot;Expected&quot;</span>:<span class="hljs-string">&quot;dc9208a3303feef5b3839f4323d9beb36df0a9dd&quot;</span>&#125;,<span class="hljs-string">&quot;InitCommit&quot;</span>:<br>&#123;<span class="hljs-string">&quot;ID&quot;</span>:<span class="hljs-string">&quot;fec3683&quot;</span>,<span class="hljs-string">&quot;Expected&quot;</span>:<span class="hljs-string">&quot;fec3683&quot;</span>&#125;,<span class="hljs-string">&quot;SecurityOptions&quot;</span>:<br>[<span class="hljs-string">&quot;name=apparmor&quot;</span>,<span class="hljs-string">&quot;name=seccomp,profile=default&quot;</span>],<span class="hljs-string">&quot;Warnings&quot;</span>:[<span class="hljs-string">&quot;WARNING: API is accessible on http://0.0.0.0:2375 without encryption.\n     Access to the remote API is equivalent to root access on the host. Refer\n     to the</span><br><span class="hljs-string">&#x27;Docker daemon attack surface&#x27; section in the documentation for\n     more information: https://docs.docker.com/engine/security/security/#docker-daemon-attack-surface&quot;</span>,<span class="hljs-string">&quot;WARNING: No swap limit support&quot;</span>]&#125;<br><br><span class="hljs-comment">#实现远程访问方式2</span><br>[root@centos7 ~]<span class="hljs-comment">#docker -H tcp://10.0.0.100:2375 info</span><br>Client:<br>Debug Mode: <span class="hljs-literal">false</span><br><br>Server:<br>Containers: 0<br>Running: 0<br>Paused: 0<br>Stopped: 0<br>Images: 5<br>Server Version: 19.03.12<br>Storage Driver: overlay2<br><br>Backing Filesystem: extfs<br>Supports d_type: <span class="hljs-literal">true</span><br>Native Overlay Diff: <span class="hljs-literal">true</span><br>Logging Driver: json-file<br>Cgroup Driver: cgroupfs<br>Plugins:<br>Volume: <span class="hljs-built_in">local</span><br>Network: bridge host ipvlan macvlan null overlay<br>Log: awslogs fluentd gcplogs gelf journald json-file <span class="hljs-built_in">local</span> logentries splunk<br>syslog<br>Swarm: inactive<br>Runtimes: runc<br>Default Runtime: runc<br>Init Binary: docker-init<br>containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429<br>runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd<br>init version: fec3683<br>Security Options:<br>apparmor<br>seccomp<br> Profile: default<br>Kernel Version: 4.15.0-111-generic<br>Operating System: Ubuntu 18.04.4 LTS<br>OSType: linux<br>Architecture: x86_64<br>CPUs: 4<br>Total Memory: 2.908GiB<br>Name: ubuntu1804.magedu.org<br>ID: LVU6:OXD3:TAPB:KDNQ:YRSN:XTAS:3V32:IERB:2DM6:4CDK:CRO6:ZKAW<br>Docker Root Dir: /var/lib/docker<br>Debug Mode: <span class="hljs-literal">false</span><br>Registry: https://index.docker.io/v1/<br>Labels:<br> name=docker1<br>Experimental: <span class="hljs-literal">false</span><br>Insecure Registries:<br> 127.0.0.0/8<br>Registry Mirrors:<br>https://si7y70hh.mirror.aliyuncs.com/<br>Live Restore Enabled: <span class="hljs-literal">false</span><br><br>WARNING: API is accessible on http://0.0.0.0:2375 without encryption.<br>    Access to the remote API is equivalent to root access on the host.<br>Refer<br>    to the <span class="hljs-string">&#x27;Docker daemon attack surface&#x27;</span> section <span class="hljs-keyword">in</span> the documentation <span class="hljs-keyword">for</span><br>    more information:<br>https://docs.docker.com/engine/security/security/<span class="hljs-comment">#docker-daemon-attack-surface</span><br>WARNING: No swap <span class="hljs-built_in">limit</span> support<br>[root@centos7 ~]<span class="hljs-comment">#</span><br><br><span class="hljs-comment">#实现远程访问方式3</span><br>[root@centos7 ~]<span class="hljs-comment">#export DOCKER_HOST=&quot;tcp://10.0.0.100:2375&quot;</span><br>[root@centos7 ~]<span class="hljs-comment">#docker info</span><br>Client:<br>Debug Mode: <span class="hljs-literal">false</span><br><br>Server:<br>Containers: 0<br>Running: 0<br>Paused: 0<br>Stopped: 0<br>Images: 5<br>Server Version: 19.03.12<br>Storage Driver: overlay2<br>Backing Filesystem: extfs<br>Supports d_type: <span class="hljs-literal">true</span><br>Native Overlay Diff: <span class="hljs-literal">true</span><br>Logging Driver: json-file<br>Cgroup Driver: cgroupfs<br>Plugins:<br>Volume: <span class="hljs-built_in">local</span><br>Network: bridge host ipvlan macvlan null overlay<br>Log: awslogs fluentd gcplogs gelf journald json-file <span class="hljs-built_in">local</span> logentries splunk<br>syslog<br>Swarm: inactive<br>Runtimes: runc<br>Default Runtime: runc<br>Init Binary: docker-init<br>containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429<br>runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd<br>init version: fec3683<br>Security Options:<br>apparmor<br>seccomp<br> Profile: default<br>Kernel Version: 4.15.0-111-generic<br>Operating System: Ubuntu 18.04.4 LTS<br>OSType: linux<br>Architecture: x86_64<br>CPUs: 4<br>Total Memory: 2.908GiB<br>Name: ubuntu1804.magedu.org<br>ID: LVU6:OXD3:TAPB:KDNQ:YRSN:XTAS:3V32:IERB:2DM6:4CDK:CRO6:ZKAW<br>Docker Root Dir: /var/lib/docker<br>Debug Mode: <span class="hljs-literal">false</span><br>Registry: https://index.docker.io/v1/<br>Labels:<br> name=docker1<br>Experimental: <span class="hljs-literal">false</span><br>Insecure Registries:<br> 127.0.0.0/8<br>Registry Mirrors:<br>https://si7y70hh.mirror.aliyuncs.com/<br>Live Restore Enabled: <span class="hljs-literal">false</span><br><br>WARNING: API is accessible on http://0.0.0.0:2375 without encryption.<br>    Access to the remote API is equivalent to root access on the host.<br>Refer<br>    to the <span class="hljs-string">&#x27;Docker daemon attack surface&#x27;</span> section <span class="hljs-keyword">in</span> the documentation <span class="hljs-keyword">for</span><br>    more information:<br>https://docs.docker.com/engine/security/security/<span class="hljs-comment">#docker-daemon-attack-surface</span><br>WARNING: No swap <span class="hljs-built_in">limit</span> support<br><br><span class="hljs-comment">#恢复连接本机</span><br>[root@centos7 ~]<span class="hljs-comment">#unset DOCKER_HOST</span><br>[root@centos7 ~]<span class="hljs-comment">#docker info</span><br>Client:<br>Debug Mode: <span class="hljs-literal">false</span><br><br>Server:<br>Containers: 0<br>Running: 0<br>Paused: 0<br>Stopped: 0<br>Images: 0<br>Server Version: 19.03.5<br>Storage Driver: overlay2<br>Backing Filesystem: xfs<br>Supports d_type: <span class="hljs-literal">true</span><br>Native Overlay Diff: <span class="hljs-literal">true</span><br>Logging Driver: json-file<br>Cgroup Driver: cgroupfs<br>Plugins:<br>Volume: <span class="hljs-built_in">local</span><br>Network: bridge host ipvlan macvlan null overlay<br>Log: awslogs fluentd gcplogs gelf journald json-file <span class="hljs-built_in">local</span> logentries splunk<br>syslog<br>Swarm: inactive<br>Runtimes: runc<br>Default Runtime: runc<br>Init Binary: docker-init<br>containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429<br>runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd<br>init version: fec3683<br>Security Options:<br>seccomp<br> Profile: default<br>Kernel Version: 3.10.0-1127.el7.x86_64<br>Operating System: CentOS Linux 7 (Core)<br>OSType: linux<br>Architecture: x86_64<br>CPUs: 1<br>Total Memory: 972.3MiB<br>Name: centos7.wangxiaochun.com<br>ID: USO2:CGRA:LIV3:SWOQ:5AWX:EN6W:4AUZ:XYZ7:LL6K:SUQ5:HANV:TX5L<br>Docker Root Dir: /var/lib/docker<br>Debug Mode: <span class="hljs-literal">false</span><br>Registry: https://index.docker.io/v1/<br>Labels:<br>Experimental: <span class="hljs-literal">false</span><br>Insecure Registries:<br> 127.0.0.0/8<br>Registry Mirrors:<br>https://si7y70hh.mirror.aliyuncs.com/<br>Live Restore Enabled: <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>

<h2 id="1-3-镜像管理"><a href="#1-3-镜像管理" class="headerlink" title="1.3 镜像管理"></a>1.3 镜像管理</h2><h3 id="1-3-1-镜像结构和原理"><a href="#1-3-1-镜像结构和原理" class="headerlink" title="1.3.1 镜像结构和原理"></a>1.3.1 镜像结构和原理</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker33.png" srcset="/blog/img/loading.gif"></p>
<p>镜像即创建容器的模版，含有启动容器所需要的文件系统及所需要的内容，因此镜像主要用于方便和快速的创建并启动容器。<strong>镜像都是一层层摞起来的，所有的镜像开发都是基于前一层的镜像</strong></p>
<p>镜像含里面是一层层的文件系统,叫做 Union FS（联合文件系统）,联合文件系统，可以将几层目录挂载到一起（就像千层饼，洋葱头，俄罗斯套娃一样），形成一个虚拟文件系统,虚拟文件系统的目录结构就像普通 linux 的目录结构一样，镜像通过这些文件再加上宿主机的内核共同提供了一个 linux 的虚拟环境，每一层文件系统叫做一层 layer，联合文件系统可以对每一层文件系统设置三种权限，只读（readonly）、读写（readwrite）和写出（whiteout-able），但是镜像中每一层文件系统都是只读的,构建镜像的时候，从一个最基本的操作系统开始，每个构建提交的操作都相当于做一层的修改，增加了一层文件系统，一层层往上叠加，上层的修改会覆盖底层该位置的可见性，这也很容易理解，就像上层把底层遮住了一样，当使用镜像的时候，我们只会看到一个完全的整体，不知道里面有几层,实际上也不需要知道里面有几层，结构如下:</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker34.png" srcset="/blog/img/loading.gif"></p>
<p>一个典型的 Linux文件系统由 bootfs 和 rootfs 两部分组成</p>
<p>bootfs(boot file system) 主要包含bootloader和kernel，bootloader主要用于引导加载 kernel，Linux刚启动时会加载bootfs文件系统,当boot加载完成后,kernel 被加载到内存中后接管系统的控制权,bootfs会被 umount 掉</p>
<p>rootfs (root file system) 包含的就是典型 Linux 系统中的/dev，/proc，/bin，/etc 等标准目录和文件，不同的 linux 发行版（如 ubuntu 和 CentOS ) 主要在 rootfs 这一层会有所区别。</p>
<p>一般的镜像通常都比较小，官方提供的Ubuntu镜像只有60MB多点，而 CentOS 基础镜像也只有200MB左右，一些其他版本的镜像甚至只有几MB，比如: busybox 才1.22MB，alpine镜像也只有5M左右。镜像直接调用宿主机的内核，镜像中只提供 rootfs，也就是只需要包括最基本的命令,配置文件和程序库等相关文件就可以了。</p>
<p>下图就是有两个不同的镜像在一个宿主机内核上实现不同的rootfs。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker35.png" srcset="/blog/img/loading.gif"></p>
<p><strong>容器、镜像和父镜像关系:</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker36.png" srcset="/blog/img/loading.gif"></p>
<p>范例: 查看镜像的分层结构</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull nginx</span><br>Using default tag: latest<br>latest: Pulling from library/nginx<br>8ec398bc0356: Pull complete<br>a53c868fbde7: Pull complete<br>79daf9dd140d: Pull complete<br>Digest: sha256:70821e443be75ea38bdf52a974fd2271babd5875b2b1964f05025981c75a6717<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> nginx:latest<br>docker.io/library/nginx:latest<br><br><span class="hljs-comment">#查看镜像分层历史</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker image history nginx</span><br>IMAGE          CREATED        CREATED BY                                      SIZE      COMMENT<br>4f380adfc10f   32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop)  CMD [&quot;nginx&quot; &quot;-g&quot; &quot;daemon…   0B        </span><br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop)  STOPSIGNAL SIGQUIT           0B        </span><br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop)  EXPOSE 80                    0B        </span><br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop)  ENTRYPOINT [&quot;/docker-entr…   0B        </span><br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop) COPY file:09a214a3e07c919a…   4.61kB    </span><br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop) COPY file:0fd5fca330dcd6a7…   1.04kB    </span><br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop) COPY file:0b866ff3fc1ef5b0…   1.96kB    </span><br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop) COPY file:65504f71f5855ca0…   1.2kB     </span><br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-built_in">set</span> -x     &amp;&amp; addgroup --system -…   63.9MB    <br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop)  ENV PKG_RELEASE=1~buster     0B        </span><br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop)  ENV NJS_VERSION=0.5.3        0B        </span><br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop)  ENV NGINX_VERSION=1.21.0     0B        </span><br>&lt;missing&gt;      32 hours ago   /bin/sh -c <span class="hljs-comment">#(nop)  LABEL maintainer=NGINX Do…   0B        </span><br>&lt;missing&gt;      38 hours ago   /bin/sh -c <span class="hljs-comment">#(nop)  CMD [&quot;bash&quot;]                 0B        </span><br>&lt;missing&gt;      38 hours ago   /bin/sh -c <span class="hljs-comment">#(nop) ADD file:4903a19c327468b0e…   69.3MB    </span><br><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect nginx</span><br>[<br>    &#123;<br>        <span class="hljs-string">&quot;Id&quot;</span>: <span class="hljs-string">&quot;sha256:4f380adfc10f4cd34f775ae57a17d2835385efd5251d6dfe0f246b0018fb0399&quot;</span>,<br>        <span class="hljs-string">&quot;RepoTags&quot;</span>: [<br>            <span class="hljs-string">&quot;nginx:latest&quot;</span><br>        ],<br>        <span class="hljs-string">&quot;RepoDigests&quot;</span>: [<br>            <span class="hljs-string">&quot;nginx@sha256:47ae43cdfc7064d28800bc42e79a429540c7c80168e8c8952778c0d5af1c09db&quot;</span><br>        ],<br>        <span class="hljs-string">&quot;Parent&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;Comment&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;Created&quot;</span>: <span class="hljs-string">&quot;2021-06-23T07:16:26.291103784Z&quot;</span>,<br>        <span class="hljs-string">&quot;Container&quot;</span>: <span class="hljs-string">&quot;1c3bd13decef5a10e1d1b38f86e46ce54caa491da25fb6a89af1d5a83238069e&quot;</span>,<br>        <span class="hljs-string">&quot;ContainerConfig&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Hostname&quot;</span>: <span class="hljs-string">&quot;1c3bd13decef&quot;</span>,<br>            <span class="hljs-string">&quot;Domainname&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;User&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;AttachStdin&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;AttachStdout&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;AttachStderr&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;ExposedPorts&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;80/tcp&quot;</span>: &#123;&#125;<br>            &#125;,<br>            <span class="hljs-string">&quot;Tty&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;OpenStdin&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;StdinOnce&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;Env&quot;</span>: [<br>                <span class="hljs-string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>,<br>                <span class="hljs-string">&quot;NGINX_VERSION=1.21.0&quot;</span>,<br>                <span class="hljs-string">&quot;NJS_VERSION=0.5.3&quot;</span>,<br>                <span class="hljs-string">&quot;PKG_RELEASE=1~buster&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;Cmd&quot;</span>: [<br>                <span class="hljs-string">&quot;/bin/sh&quot;</span>,<br>                <span class="hljs-string">&quot;-c&quot;</span>,<br>                <span class="hljs-string">&quot;#(nop) &quot;</span>,<br>                <span class="hljs-string">&quot;CMD [\&quot;nginx\&quot; \&quot;-g\&quot; \&quot;daemon off;\&quot;]&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;Image&quot;</span>: <span class="hljs-string">&quot;sha256:9744b368223627a752e61f1f86e59867eecaa50fab1478b7ab8877bcf281d86a&quot;</span>,<br>            <span class="hljs-string">&quot;Volumes&quot;</span>: null,<br>            <span class="hljs-string">&quot;WorkingDir&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;Entrypoint&quot;</span>: [<br>                <span class="hljs-string">&quot;/docker-entrypoint.sh&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;OnBuild&quot;</span>: null,<br>            <span class="hljs-string">&quot;Labels&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;maintainer&quot;</span>: <span class="hljs-string">&quot;NGINX Docker Maintainers &lt;docker-maint@nginx.com&gt;&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;StopSignal&quot;</span>: <span class="hljs-string">&quot;SIGQUIT&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;DockerVersion&quot;</span>: <span class="hljs-string">&quot;19.03.12&quot;</span>,<br>        <span class="hljs-string">&quot;Author&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;Config&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Hostname&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;Domainname&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;User&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;AttachStdin&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;AttachStdout&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;AttachStderr&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;ExposedPorts&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;80/tcp&quot;</span>: &#123;&#125;<br>            &#125;,<br>            <span class="hljs-string">&quot;Tty&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;OpenStdin&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;StdinOnce&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-string">&quot;Env&quot;</span>: [<br>                <span class="hljs-string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>,<br>                <span class="hljs-string">&quot;NGINX_VERSION=1.21.0&quot;</span>,<br>                <span class="hljs-string">&quot;NJS_VERSION=0.5.3&quot;</span>,<br>                <span class="hljs-string">&quot;PKG_RELEASE=1~buster&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;Cmd&quot;</span>: [<br>                <span class="hljs-string">&quot;nginx&quot;</span>,<br>                <span class="hljs-string">&quot;-g&quot;</span>,<br>                <span class="hljs-string">&quot;daemon off;&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;Image&quot;</span>: <span class="hljs-string">&quot;sha256:9744b368223627a752e61f1f86e59867eecaa50fab1478b7ab8877bcf281d86a&quot;</span>,<br>            <span class="hljs-string">&quot;Volumes&quot;</span>: null,<br>            <span class="hljs-string">&quot;WorkingDir&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;Entrypoint&quot;</span>: [<br>                <span class="hljs-string">&quot;/docker-entrypoint.sh&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;OnBuild&quot;</span>: null,<br>            <span class="hljs-string">&quot;Labels&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;maintainer&quot;</span>: <span class="hljs-string">&quot;NGINX Docker Maintainers &lt;docker-maint@nginx.com&gt;&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;StopSignal&quot;</span>: <span class="hljs-string">&quot;SIGQUIT&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;Architecture&quot;</span>: <span class="hljs-string">&quot;amd64&quot;</span>,<br>        <span class="hljs-string">&quot;Os&quot;</span>: <span class="hljs-string">&quot;linux&quot;</span>,<br>        <span class="hljs-string">&quot;Size&quot;</span>: 133121833,<br>        <span class="hljs-string">&quot;VirtualSize&quot;</span>: 133121833,<br>        <span class="hljs-string">&quot;GraphDriver&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Data&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;LowerDir&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/overlay2/b2216ab55f05b765fb671827051e9d23a8b0c6177c8a671750695644815f090a/diff:/var/lib/docker/overlay2/e4ce9fdeeb831f65c411c70582125515d2e3906a1690946f7737a0bf06e1dbcb/diff:/var/lib/docker/overlay2/94b20d1e74228fca6cf1dee157f76e7050d8a6c557e619bc2d6cd9f47b93bfa6/diff:/var/lib/docker/overlay2/db220a802aa9dc57137c41a8bc8b8ccb31d389e7be09d521c7a90ddfe7495783/diff:/var/lib/docker/overlay2/499103bddad0aa901bf34fa874b65b993cafe0007f4af97d6d94a7787997c88d/diff&quot;</span>,<br>                <span class="hljs-string">&quot;MergedDir&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/overlay2/cbb52e3d0120c5666432ce55973f259d6b68103d3739eda379f135fa0dc992fe/merged&quot;</span>,<br>                <span class="hljs-string">&quot;UpperDir&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/overlay2/cbb52e3d0120c5666432ce55973f259d6b68103d3739eda379f135fa0dc992fe/diff&quot;</span>,<br>                <span class="hljs-string">&quot;WorkDir&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/overlay2/cbb52e3d0120c5666432ce55973f259d6b68103d3739eda379f135fa0dc992fe/work&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;overlay2&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;RootFS&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Type&quot;</span>: <span class="hljs-string">&quot;layers&quot;</span>,<br>            <span class="hljs-string">&quot;Layers&quot;</span>: [<br>                <span class="hljs-string">&quot;sha256:764055ebc9a7a290b64d17cf9ea550f1099c202d83795aa967428ebdf335c9f7&quot;</span>,<br>                <span class="hljs-string">&quot;sha256:2418679ca01f484b28bdcd8606d1d5313013cccfbd395123716000c2a25eec09&quot;</span>,<br>                <span class="hljs-string">&quot;sha256:cf388fcf3527352baa4ee5bedafd223b2224b13aac5f2df1ea0be47422789892&quot;</span>,<br>                <span class="hljs-string">&quot;sha256:165eb6c3c0d39f8c99de581f1bf9cc094e7823a838fbe5c51574c7beb3f6c4ee&quot;</span>,<br>                <span class="hljs-string">&quot;sha256:b50a193ebf2e2579b49d30beb9798078e22db0d4490bf51b9b3bb0d8bb7a3833&quot;</span>,<br>                <span class="hljs-string">&quot;sha256:c6d74dcb7fe747fac8e74e9453156380ea3ffddf97ed0e6c71e75400d938216e&quot;</span><br>            ]<br>        &#125;,<br>        <span class="hljs-string">&quot;Metadata&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;LastTagTime&quot;</span>: <span class="hljs-string">&quot;0001-01-01T00:00:00Z&quot;</span><br>        &#125;<br>    &#125;<br>]<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker save nginx -o nginx.tar</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>nginx        latest       0901fa9da894     3 days ago    <br>127MB<br>alpine        3.11.3       e7d92cdc71fe     7 days ago    <br> 5.59MB<br>centos       centos8.1.1911   470671670cac     7 days ago    <br>237MB<br>busybox       latest       6d5fcfe5ff17     4 weeks ago    <br>1.22MB<br>hello-world     latest       fce289e99eb9     12 months ago   <br>1.84kB<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll -h nginx.tar</span><br>-rw------- 1 root root 131M Jul 20 22:33 nginx.tar<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#tar xf nginx.tar -C /data</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll /data</span><br>total 60<br>drwxr-xr-x  8 root root  4096 Jul 20 22:34 ./<br>drwxr-xr-x 24 root root  4096 Jul 20 16:23 ../<br>-rw-r--r--  1 root root  7510 Jul 11 04:26 0901fa9da894a8e9de5cb26d6749eaffb67b373dc1ff8a26c46b23b1175c913a.json<br>drwxr-xr-x  2 root root  4096 Jul 11 04:26 0bb74fcd4b686412f7993916e58c26abd155fa10b10a4dc09a778e7c324c39a2/<br>drwxr-xr-x  2 root root  4096 Jul 11 04:26 517e3239147277447b60191907bc66168963e0ce8707a6a33532f7c63a0d2f12/<br>drwxr-xr-x  2 root root  4096 Jul 11 04:26 68c9e9da52d5a57ee196829ce4a461cc9425b0b920689da9ad547f1da13dbc9d/<br>drwxr-xr-x  2 root root  4096 Jul 11 04:26 d2cf0fc540bb3be33ee7340498c41fd4fc82c6bb02b9955fca2109e599301dbd/<br>drwxr-xr-x  2 root root  4096 Jul 11 04:26 f4bf863ecdbb8bddb4b3bb271bdd97b067dcb6c95c56f720018abec6af190c6e/<br>drwx------  2 root root 16384 Mar 18 09:49 lost+found/<br>-rw-r--r--  1 root root  509 Jan  1  1970 manifest.json<br>-rw-r--r--  1 root root   88 Jan  1  1970 repositories<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /data/manifest.json</span><br>[&#123;<span class="hljs-string">&quot;Config&quot;</span>:<span class="hljs-string">&quot;0901fa9da894a8e9de5cb26d6749eaffb67b373dc1ff8a26c46b23b1175c913a.json&quot;</span>,<span class="hljs-string">&quot;RepoTags&quot;</span>:[<span class="hljs-string">&quot;nginx:latest&quot;</span>],<span class="hljs-string">&quot;Layers&quot;</span>:<br>[<span class="hljs-string">&quot;d2cf0fc540bb3be33ee7340498c41fd4fc82c6bb02b9955fca2109e599301dbd/layer.tar&quot;</span>,<span class="hljs-string">&quot;f4bf863ecdbb8bddb4b3bb271bdd97b067dcb6c95c56f720018abec6af190c6e/layer.tar&quot;</span>,<span class="hljs-string">&quot;517e3239147277447b60191907bc66168963e0ce8707a6a33532f7c63a0d2f12/layer.tar&quot;</span>,<span class="hljs-string">&quot;0bb74fcd4b686412f7993916e58c26abd155fa10b10a4dc09a778e7c324c39a2/layer.tar&quot;</span>,<span class="hljs-string">&quot;68c9e9da52d5a57ee196829ce4a461cc9425b0b920689da9ad547f1da13dbc9d/layer.tar&quot;</span>]&#125;]<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#du -sh /data/*</span><br>8.0K<br>/data/0901fa9da894a8e9de5cb26d6749eaffb67b373dc1ff8a26c46b23b1175c913a.json<br>16K /data/0bb74fcd4b686412f7993916e58c26abd155fa10b10a4dc09a778e7c324c39a2<br>16K /data/517e3239147277447b60191907bc66168963e0ce8707a6a33532f7c63a0d2f12<br>16K /data/68c9e9da52d5a57ee196829ce4a461cc9425b0b920689da9ad547f1da13dbc9d<br>70M /data/d2cf0fc540bb3be33ee7340498c41fd4fc82c6bb02b9955fca2109e599301dbd<br>62M /data/f4bf863ecdbb8bddb4b3bb271bdd97b067dcb6c95c56f720018abec6af190c6e<br>16K /data/lost+found<br>4.0K /data/manifest.json<br>4.0K /data/repositories<br><br><span class="hljs-comment">#分层里所有的文件都是linux的文件</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cd /data/d2cf0fc540bb3be33ee7340498c41fd4fc82c6bb02b9955fca2109e599301dbd/</span><br>[root@ubuntu1804d2cf0fc540bb3be33ee7340498c41fd4fc82c6bb02b9955fca2109e599301dbd]<span class="hljs-comment">#ls</span><br>json layer.tar VERSION<br>[root@ubuntu1804d2cf0fc540bb3be33ee7340498c41fd4fc82c6bb02b9955fca2109e599301dbd]<span class="hljs-comment">#tar xf layer.tar</span><br>[root@ubuntu1804d2cf0fc540bb3be33ee7340498c41fd4fc82c6bb02b9955fca2109e599301dbd]<span class="hljs-comment">#ls</span><br>bin   dev  home  layer.tar  lib64  mnt  proc  run   srv  tmp  var<br>boot  etc  json  lib        media  opt  root  sbin  sys  usr  VERSION<br>[root@ubuntu1804d2cf0fc540bb3be33ee7340498c41fd4fc82c6bb02b9955fca2109e599301dbd]<span class="hljs-comment">#cat /etc/i  #使用tab键补全</span><br>init.d/  issue   issue.net <br>[root@ubuntu1804d2cf0fc540bb3be33ee7340498c41fd4fc82c6bb02b9955fca2109e599301dbd]<span class="hljs-comment">#cat etc/issue</span><br>Debian GNU/Linux 10 \n \l<br></code></pre></td></tr></table></figure>

<h3 id="1-3-2-搜索镜像"><a href="#1-3-2-搜索镜像" class="headerlink" title="1.3.2 搜索镜像"></a>1.3.2 搜索镜像</h3><h4 id="1-3-2-1-搜索镜像"><a href="#1-3-2-1-搜索镜像" class="headerlink" title="1.3.2.1 搜索镜像"></a>1.3.2.1 搜索镜像</h4><h5 id="1-3-2-1-1-官方网站进行镜像的搜索"><a href="#1-3-2-1-1-官方网站进行镜像的搜索" class="headerlink" title="1.3.2.1.1 官方网站进行镜像的搜索"></a>1.3.2.1.1 官方网站进行镜像的搜索</h5><p>官网: <a target="_blank" rel="noopener" href="http://hub.docker.com/">http://hub.docker.com</a></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker37.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker38.png" srcset="/blog/img/loading.gif"></p>
<p>在官方的docker 仓库中搜索指定名称的docker镜像，也会有很多三方镜像。</p>
<h5 id="1-3-2-2-2-执行docker-search命令进行搜索"><a href="#1-3-2-2-2-执行docker-search命令进行搜索" class="headerlink" title="1.3.2.2.2 执行docker search命令进行搜索"></a>1.3.2.2.2 执行docker search命令进行搜索</h5><p>格式如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Usage: docker search [OPTIONS] TERM<br><br>Options:<br> -f, --filter filter  Filter output based on conditions provided<br>   --format string  Pretty-print search using a Go template<br>   --<span class="hljs-built_in">limit</span> int    Max number of search results (default 25)<br>   --no-trunc    Don<span class="hljs-string">&#x27;t truncate output</span><br><span class="hljs-string">   </span><br><span class="hljs-string">说明: </span><br><span class="hljs-string">OFFICIAL: 官方</span><br><span class="hljs-string">AUTOMATED: 使用第三方docker服务来帮助编译镜像，可以在互联网上面直接拉取到镜像，减少了繁琐的编译过程</span><br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker search centos</span><br>NAME                               DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED<br>centos                             The official build of CentOS.                   6611      [OK]       <br>ansible/centos7-ansible            Ansible on Centos7                              134                  [OK]<br>consol/centos-xfce-vnc             Centos container with <span class="hljs-string">&quot;headless&quot;</span> VNC session…   129                  [OK]<br>jdeathe/centos-ssh                 OpenSSH / Supervisor / EPEL/IUS/SCL Repos - …   118                  [OK]<br>centos/systemd                     systemd enabled base container.                 99                   [OK]<br>centos/mysql-57-centos7            MySQL 5.7 SQL database server                   88                   <br>imagine10255/centos6-lnmp-php56    centos6-lnmp-php56                              58                   [OK]<br>tutum/centos                       Simple CentOS docker image with SSH access      48                   <br>kinogmt/centos-ssh                 CentOS with SSH                                 29                   [OK]<br>pivotaldata/centos-gpdb-dev        CentOS image <span class="hljs-keyword">for</span> GPDB development. Tag names…   13                   <br>centos/tools                       Docker image that has systems administration…   7                    [OK]<br>drecom/centos-ruby                 centos ruby                                     6                    [OK]<br>pivotaldata/centos                 Base centos, freshened up a little with a Do…   5                    <br>pivotaldata/centos-gcc-toolchain   CentOS with a toolchain, but unaffiliated wi…   3                    <br>pivotaldata/centos-mingw           Using the mingw toolchain to cross-compile t…   3                    <br>mamohr/centos-java                 Oracle Java 8 Docker image based on Centos 7    3                    [OK]<br>darksheer/centos                   Base Centos Image -- Updated hourly             3                    [OK]<br>indigo/centos-maven                Vanilla CentOS 7 with Oracle Java Developmen…   2                    [OK]<br>dokken/centos-7                    CentOS 7 image <span class="hljs-keyword">for</span> kitchen-dokken               2                    <br>pivotaldata/centos6.8-dev          CentosOS 6.8 image <span class="hljs-keyword">for</span> GPDB development         1                    <br>mcnaughton/centos-base             centos base image                               1                    [OK]<br>blacklabelops/centos               CentOS Base Image! Built and Updates Daily!     1                    [OK]<br>starlabio/centos-native-build      Our CentOS image <span class="hljs-keyword">for</span> native builds              0                    [OK]<br>smartentry/centos                  centos with smartentry                          0                    [OK]<br>pivotaldata/centos7-dev            CentosOS 7 image <span class="hljs-keyword">for</span> GPDB development           0                    <br><br></code></pre></td></tr></table></figure>

<p>范例: 选择性的查找镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#搜索点赞100个以上的镜像</span><br><span class="hljs-comment">#旧语法，注意此方法在20.10版本开始不能使用</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker search -s 100 centos</span><br>Flag --stars has been deprecated, use --filter=stars=3 instead   <br>NAME                      DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED<br>centos                    The official build of CentOS.                   6611                [OK]                <br>ansible/centos7-ansible   Ansible on Centos7                              134                                     [OK]<br>consol/centos-xfce-vnc    Centos container with <span class="hljs-string">&quot;headless&quot;</span> VNC session…   129                                     [OK]<br>jdeathe/centos-ssh        OpenSSH / Supervisor / EPEL/IUS/SCL Repos - …   118                                     [OK]<br><br><span class="hljs-comment">#新语法</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker search --filter=stars=100 centos</span><br>NAME                      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED<br>centos                    The official build of CentOS.                   6611      [OK]       <br>ansible/centos7-ansible   Ansible on Centos7                              134                  [OK]<br>consol/centos-xfce-vnc    Centos container with <span class="hljs-string">&quot;headless&quot;</span> VNC session…   129                  [OK]<br>jdeathe/centos-ssh        OpenSSH / Supervisor / EPEL/IUS/SCL Repos - …   118                  [OK]<br></code></pre></td></tr></table></figure>

<h4 id="1-3-2-2-alpine-介绍"><a href="#1-3-2-2-alpine-介绍" class="headerlink" title="1.3.2.2 alpine 介绍"></a>1.3.2.2 alpine 介绍</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker39.png" srcset="/blog/img/loading.gif"></p>
<p>Alpine 操作系统是一个面向安全的轻型 Linux 发行版。它不同于通常 Linux 发行版，Alpine 采用了musl libc 和 busybox 以减小系统的体积和运行时资源消耗，但功能上比 busybox 又完善的多，因此得到开源社区越来越多的青睐。在保持瘦身的同时，Alpine 还提供了自己的包管理工具 apk，可以通过<a target="_blank" rel="noopener" href="https://pkgs.alpinelinux.org/packages">https://pkgs.alpinelinux.org/packages</a> 网站上查询包信息，也可以直接通过 apk 命令直接查询和安装各种软件。</p>
<p>Alpine 由非商业组织维护的，支持广泛场景的 Linux发行版，它特别为资深/重度Linux用户而优化，关注安全，性能和资源效能。Alpine 镜像可以适用于更多常用场景，并且是一个优秀的可以适用于生产的基础系统/环境。</p>
<p>Alpine Docker 镜像也继承了 Alpine Linux 发行版的这些优势。相比于其他 Docker 镜像，它的容量非常小，仅仅只有 5 MB 左右（对比 Ubuntu 系列镜像接近 200 MB），且拥有非常友好的包管理机制。官方镜像来自 docker-alpine 项目。</p>
<p>目前 Docker 官方已开始推荐使用 Alpine 替代之前的 Ubuntu 做为基础镜像环境。这样会带来多个好处。包括镜像下载速度加快，镜像安全性提高，主机之间的切换更方便，占用更少磁盘空间等。</p>
<p>建议生产环境使用Ubuntu和centos来制作镜像，测试可以用alpine</p>
<p>下表是官方镜像的大小比较:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">REPOSITORY     TAG      IMAGE ID     VIRTUAL SIZE<br>alpine       latest    4e38e38c8ce0    4.799 MB<br>debian       latest    4d6ce913b130    84.98 MB<br>ubuntu       latest    b39b81afc8ca    188.3 MB<br>centos       latest    8efe422e6104    210 MB<br></code></pre></td></tr></table></figure>

<ul>
<li>Alpine 官网: <a target="_blank" rel="noopener" href="https://www.alpinelinux.org/">https://www.alpinelinux.org/</a></li>
<li>Alpine 官方仓库: <a target="_blank" rel="noopener" href="https://github.com/alpinelinux">https://github.com/alpinelinux</a></li>
<li>Alpine 官方镜像: <a target="_blank" rel="noopener" href="https://hub.docker.com/_/alpine/">https://hub.docker.com/_/alpine/</a></li>
<li>Alpine 官方镜像仓库: <a target="_blank" rel="noopener" href="https://github.com/gliderlabs/docker-alpine">https://github.com/gliderlabs/docker-alpine</a></li>
<li>Alpine 阿里云的镜像仓库: <a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/alpine/">https://mirrors.aliyun.com/alpine/</a></li>
</ul>
<p>范例: alpine管理软件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#修改源替换成阿里源，将里面 dl-cdn.alpinelinux.org 的 改成 mirrors.aliyun.com</span><br>vi /etc/apk/repositories<br>http://mirrors.aliyun.com/alpine/v3.8/main/<br>http://mirrors.aliyun.com/alpine/v3.8/community/<br><br><span class="hljs-comment">#更新源</span><br>apk update<br><br><span class="hljs-comment">#安装软件</span><br>apk add vim<br><br><span class="hljs-comment">#删除软件</span><br>apk del openssh openntp vim<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs bash">/ <span class="hljs-comment"># apk --help</span><br>apk-tools 2.10.4, compiled <span class="hljs-keyword">for</span> x86_64.<br><br>Installing and removing packages:<br>add    Add PACKAGEs to <span class="hljs-string">&#x27;world&#x27;</span> and install (or upgrade) them, <span class="hljs-keyword">while</span><br>ensuring that all dependencies are met<br>del    Remove PACKAGEs from <span class="hljs-string">&#x27;world&#x27;</span> and uninstall them<br><br>System maintenance:<br>fix    Repair package or upgrade it without modifying main dependencies<br>update  Update repository indexes from all remote repositories<br>upgrade  Upgrade currently installed packages to match repositories<br>cache   Download missing PACKAGEs to cache and/or delete unneeded files from<br>cache<br><br>Querying information about packages:<br>info   Give detailed information about PACKAGEs or repositories<br>list   List packages by PATTERN and other criteria<br>dot    Generate graphviz graphs<br>policy  Show repository policy <span class="hljs-keyword">for</span> packages<br><br>Repository maintenance:<br>index   Create repository index file from FILEs<br>fetch   Download PACKAGEs from global repositories to a <span class="hljs-built_in">local</span> directory<br>verify  Verify package integrity and signature<br>manifest Show checksums of package contents<br><br>Use apk &lt;<span class="hljs-built_in">command</span>&gt; --<span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> command-specific <span class="hljs-built_in">help</span>.<br>Use apk --<span class="hljs-built_in">help</span> --verbose <span class="hljs-keyword">for</span> a full <span class="hljs-built_in">command</span> listing.<br><br>This apk has coffee making abilities.<br><br>/ <span class="hljs-comment"># apk add nginx</span><br>/ <span class="hljs-comment"># apk info nginx</span><br>nginx-1.16.1-r6 description:<br>HTTP and reverse proxy server (stable version)<br><br>nginx-1.16.1-r6 webpage:<br>https://www.nginx.org/<br><br>nginx-1.16.1-r6 installed size:<br>1126400<br><br>~ <span class="hljs-comment"># apk manifest nginx</span><br>sha1:d21a96358a10b731f8847e6d32799efdc2a7f421 etc/logrotate.d/nginx<br>sha1:50bd6d3b4f3e6b577d852f12cd6939719d2c2db5 etc/init.d/nginx<br>sha1:379c1e2a2a5ffb8c91a07328d4c9be2bc58799fd etc/nginx/scgi_params<br>sha1:da38e2a0dded838afbe0eade6cb837ac30fd8046 etc/nginx/fastcgi_params<br>sha1:cc2fcdb4605dcac23d59f667889ccbdfdc6e3668 etc/nginx/uwsgi_params<br>sha1:cbf596ddb3433a8e0d325f3c188bec9c1bb746b3 etc/nginx/fastcgi.conf<br>sha1:e39dbc36680b717ec902fadc805a302f1cf62245 etc/nginx/mime.types<br>sha1:e9dddf20f1196bb67eef28107438b60c4060f4d3 etc/nginx/nginx.conf<br>sha1:7b2a4da1a14166442c10cbf9e357fa9fb53542ca etc/nginx/conf.d/default.conf<br>sha1:cd7f5dc8ccdc838a2d0107511c90adfe318a81e7 etc/conf.d/nginx<br>sha1:05f050f6ed86c5e6b48c2d2328e81583315431be usr/sbin/nginx<br>sha1:c3f02ca81f7f2c6bde3f878b3176f225c7781c7d var/lib/nginx/modules<br>sha1:0510312d465b86769136983657df98c1854f0b60 var/lib/nginx/run<br>sha1:35db17c18ce0b9f84a3cc113c8a9e94e19f632b1 var/lib/nginx/logs<br>sha1:7dd71afcfb14e105e80b0c0d7fce370a28a41f0a var/lib/nginx/html/index.html<br>sha1:95de71d58b37f9f74bede0e91bc381d6059fc2d7 var/lib/nginx/html/50x.html<br>~ <span class="hljs-comment"># ls -l /bin</span><br>total 824<br>lrwxrwxrwx   1 root   root       12 Jan 16 21:52 arch -&gt; /bin/busybox<br>lrwxrwxrwx   1 root   root       12 Jan 16 21:52 ash -&gt; /bin/busybox<br>lrwxrwxrwx   1 root   root       12 Jan 16 21:52 base64 -&gt; /bin/busybox<br>lrwxrwxrwx   1 root   root       12 Jan 16 21:52 bbconfig -&gt;<br>/bin/busybox<br>-rwxr-xr-x   1 root   root     841288 Jan 15 10:36 busybox<br>lrwxrwxrwx   1 root   root       12 Jan 16 21:52 cat -&gt; /bin/busybox<br>lrwxrwxrwx   1 root   root       12 Jan 16 21:52 chgrp -&gt; /bin/busybox<br>lrwxrwxrwx   1 root   root       12 Jan 16 21:52 chmod -&gt; /bin/busybox<br>lrwxrwxrwx   1 root   root       12 Jan 16 21:52 chown -&gt; /bin/busybox<br></code></pre></td></tr></table></figure>

<h4 id="1-3-2-3-Debian-ubuntu-系统建议安装的基础包"><a href="#1-3-2-3-Debian-ubuntu-系统建议安装的基础包" class="headerlink" title="1.3.2.3 Debian(ubuntu)系统建议安装的基础包"></a>1.3.2.3 Debian(ubuntu)系统建议安装的基础包</h4><p>在很多软件官方提供的镜像都使用的是Debian(ubuntu)的系统,比如:nginx,tomcat,mysql,httpd 等,但镜像内缺少很多常用的调试工具.当需要进入容器内进行调试管理时,可以安装以下常用工具包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># apt update #安装软件前需要先更新索引</span><br><span class="hljs-comment"># apt install procps #提供top,ps,free等命令</span><br><span class="hljs-comment"># apt install psmisc #提供pstree,killall等命令</span><br><span class="hljs-comment"># apt install iputils-ping #提供ping命令</span><br><span class="hljs-comment"># apt install net-tools #提供netstat网络工具等</span><br></code></pre></td></tr></table></figure>

<h3 id="1-3-3-下载镜像"><a href="#1-3-3-下载镜像" class="headerlink" title="1.3.3 下载镜像"></a>1.3.3 下载镜像</h3><p>从 docker 仓库将镜像下载到本地，命令格式如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull [OPTIONS] NAME[:TAG|@DIGEST]<br>Options:<br> -a, --all-tags        Download all tagged images <span class="hljs-keyword">in</span> the repository<br>   --disable-content-trust  Skip image verification (default <span class="hljs-literal">true</span>)<br>   --platform string     Set platform <span class="hljs-keyword">if</span> server is multi-platform capable<br> -q, --quiet          Suppress verbose output<br><br>NAME: 是镜像名,一般的形式 仓库服务器:端口/项目名称/镜像名称<br>:TAG: 即版本号,如果不指定:TAG,则下载最新版镜像<br></code></pre></td></tr></table></figure>

<p><strong>镜像下载说明</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull hello-world</span><br>Using default tag: latest  <span class="hljs-comment">#默认下载最新版本</span><br>latest: Pulling from library/hello-world<br>1b930d010525: Pull complete  <span class="hljs-comment">#分层下载</span><br>Digest: sha256:9572f7cdcee8591948c2963463447a53466950b3fc15a247fcad1917ca215a2f<br><span class="hljs-comment">#摘要</span><br>Status: Downloaded newer image <span class="hljs-keyword">for</span> hello-world:latest<br>docker.io/library/hello-world:latest  <span class="hljs-comment">#下载的完整地址</span><br></code></pre></td></tr></table></figure>

<p>镜像下载保存的路径:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">/var/lib/docker/overlay2/镜像ID<br></code></pre></td></tr></table></figure>

<p>注意: 镜像下载完成后，会自动解压缩，比官网显示的可能会大很多，如: centos8.1.1911下载时只有<br>70MB，下载完后显示237MB</p>
<p>范例: 从docker官网下载镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull hello-world<br>docker pull alpine<br>docker pull busybox<br>docker pull nginx  <br>docker pull centos<br>docker pull centos:centos7.7.1908<br>docker pull docker.io/library/mysql:5.7.29<br>docker pull mysql:5.6.47<br></code></pre></td></tr></table></figure>

<p>范例: 下载镜像 alpine,busybox等镜像,查看下载的存放目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#ls /var/lib/docker/overlay2/</span><br>......<br>[root@ubuntu1804 ~]<span class="hljs-comment">#du -sh /var/lib/docker/overlay2</span><br>8.0K /var/lib/docker/overlay2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls /var/lib/docker/overlay2/</span><br>......<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull hello-world</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull alpine:3.11.3</span><br>3.11.3: Pulling from library/alpine<br>c9b1b535fdd9: Pull complete<br>Digest: sha256:ab00606a42621fb68f2ed6ad3c88be54397f981a7b70a79db3d1172b11c4367d<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> alpine:3.11.3<br>docker.io/library/alpine:3.11.3<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull busybox</span><br>Using default tag: latest<br>latest: Pulling from library/busybox<br>bdbbaa22dec6: Pull complete<br>Digest: sha256:6915be4043561d64e0ab0f8f098dc2ac48e077fe23f488ac24b665166898115a<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> busybox:latest<br>docker.io/library/busybox:latest<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull centos:centos8.1.1911</span><br>centos8.1.1911: Pulling from library/centos<br>8a29a15cefae: Pull complete<br>Digest: sha256:fe8d824220415eed5477b63addf40fb06c3b049404242b31982106ac204f6700<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> centos:centos8.1.1911<br>docker.io/library/centos:centos8.1.1911<br>[root@ubuntu1804 ~]<span class="hljs-comment">#du -sh /var/lib/docker/overlay2/*</span><br>5.9M<br>/var/lib/docker/overlay2/1802616f4c8e0a0b52c839431b6faa8ac21f4bd831548dcbd46943d<br>3f60061fa<br>16K<br>/var/lib/docker/overlay2/5773b92e1351da5e589d0573d9f22d1ec3be1e0e98edbfcddba4b83<br>0f12c7be2<br>1.3M<br>/var/lib/docker/overlay2/de31641b8d2207de7f08eabb5240474a1aaccfef08b6034dcee02b9<br>623f8d9dc<br>252M<br>/var/lib/docker/overlay2/f41df336075611f9e358e5eaf2ebd5089920a90ba68760cdec8da03<br>edff362f7<br>20K /var/lib/docker/overlay2/l<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>alpine        3.11.3       e7d92cdc71fe     7 days ago    <br> 5.59MB<br>centos       centos8.1.1911   470671670cac     7 days ago    <br>237MB<br>busybox       latest       6d5fcfe5ff17     4 weeks ago    <br>1.22MB<br>hello-world     latest       fce289e99eb9     12 months ago   <br>1.84kB<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls -l /var/lib/docker/overlay2/l</span><br>total 16<br>lrwxrwxrwx 1 root root 72 Jan 25 19:51 C5ZTDYHYDTO7BQG6HX36MU6X5K -&gt;<br>../de31641b8d2207de7f08eabb5240474a1aaccfef08b6034dcee02b9623f8d9dc/diff<br>lrwxrwxrwx 1 root root 72 Jan 25 19:57 DEXHVNUGFLFJCSJAKISOHQG7JY -&gt;<br>../f41df336075611f9e358e5eaf2ebd5089920a90ba68760cdec8da03edff362f7/diff<br>lrwxrwxrwx 1 root root 72 Jan 25 19:51 KJ5IA5AUHFUEQXFKJA7UDUIA7A -&gt;<br>../1802616f4c8e0a0b52c839431b6faa8ac21f4bd831548dcbd46943d3f60061fa/diff<br>lrwxrwxrwx 1 root root 72 Jan 25 19:51 ZM3U4WDNHGJJX5DXHA5M4ZWAIW -&gt;<br>../5773b92e1351da5e589d0573d9f22d1ec3be1e0e98edbfcddba4b830f12c7be2/diff<br><br></code></pre></td></tr></table></figure>

<p>范例: 指定 TAG下载特定版本的镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull docker.io/library/mysql:5.7.29</span><br>5.7.29: Pulling from library/mysql<br>804555ee0376: Pull complete<br>c53bab458734: Pull complete<br>ca9d72777f90: Pull complete<br>2d7aad6cb96e: Pull complete<br>8d6ca35c7908: Pull complete<br>6ddae009e760: Pull complete<br>327ae67bbe7b: Pull complete<br>9e05241b7707: Pull complete<br>e822978df8f0: Pull complete<br>14ca71ed53be: Pull complete<br>026afe6fd35e: Pull complete<br>Digest: sha256:2ca675966612f34b4036bbcfa68cb049c03e34b561fba0f88954b03931823d29<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> mysql:5.7.29<br>docker.io/library/mysql:5.7.29<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull mysql:5.6.47</span><br></code></pre></td></tr></table></figure>

<p>范例: 指定DIGEST下载特定版本的镜像<br>先到 hub.docker.com查到指定版本的DIGEST</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker40.png" srcset="/blog/img/loading.gif"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull alpine@sha256:156f59dc1cbe233827642e09ed06e259ef6fa1ca9b2e29d52ae14d5e7b79d7f0</span><br>sha256:156f59dc1cbe233827642e09ed06e259ef6fa1ca9b2e29d52ae14d5e7b79d7f0: Pulling<br>from library/alpine<br>5d2415897100: Pull complete<br>Digest: sha256:156f59dc1cbe233827642e09ed06e259ef6fa1ca9b2e29d52ae14d5e7b79d7f0<br>Status: Downloaded newer image <span class="hljs-keyword">for</span><br>alpine@sha256:156f59dc1cbe233827642e09ed06e259ef6fa1ca9b2e29d52ae14d5e7b79d7f0<br>docker.io/library/alpine@sha256:156f59dc1cbe233827642e09ed06e259ef6fa1ca9b2e29d52ae14d5e7b79d7f0<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>alpine       &lt;none&gt;       3c791e92a856     3 weeks ago    <br>5.57MB<br></code></pre></td></tr></table></figure>

<h3 id="1-3-4-docker-镜像加速配置"><a href="#1-3-4-docker-镜像加速配置" class="headerlink" title="1.3.4 docker 镜像加速配置"></a>1.3.4 docker 镜像加速配置</h3><p>docker 镜像官方的下载站点是: <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker41.png" srcset="/blog/img/loading.gif"></p>
<p>从国内下载官方的镜像站点有时候会很慢，因此可以更改docker配置文件添加一个加速器，可以通过加速器达到加速下载镜像的目的国内有许多公司都提供了docker 加速镜像，比如: 阿里云，腾讯云，网易云，以下以阿里云为例</p>
<h4 id="1-3-4-1-阿里云获取加速地址"><a href="#1-3-4-1-阿里云获取加速地址" class="headerlink" title="1.3.4.1 阿里云获取加速地址"></a>1.3.4.1 阿里云获取加速地址</h4><p>浏览器打开<a target="_blank" rel="noopener" href="http://cr.console.aliyun.com,注册或登录阿里云账号,点击左侧的镜像加速器,将会得到一个专属的加速地址,而且下面有使用配置说明/">http://cr.console.aliyun.com，注册或登录阿里云账号，点击左侧的镜像加速器，将会得到一个专属的加速地址，而且下面有使用配置说明</a>:</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker42.png" srcset="/blog/img/loading.gif"></p>
<h4 id="1-3-4-2-docker-镜像加速配置"><a href="#1-3-4-2-docker-镜像加速配置" class="headerlink" title="1.3.4.2 docker 镜像加速配置"></a>1.3.4.2 docker 镜像加速配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">1. 安装／升级Docker客户端<br>推荐安装1.10.0以上版本的Docker客户端，参考文档 docker-ce<br> <br>2. 配置镜像加速器<br>修改daemon配置文件/etc/docker/daemon.json来使用加速器<br><br>mkdir -p /etc/docker<br>tee /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>&#123;<br><span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://si7y70hh.mirror.aliyuncs.com&quot;</span>]<br>&#125;<br>EOF<br><span class="hljs-comment">#网易云: http://hub-mirror.c.163.com/</span><br><span class="hljs-comment">#腾讯云: https://mirror.ccs.tencentyun.com</span><br><br>systemctl daemon-reload<br>systemctl restart docker<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker info |tail</span><br>WARNING: the overlay storage-driver is deprecated, and will be removed <span class="hljs-keyword">in</span> a future release.<br>ID: IZHJ:WPIN:BRMC:XQUI:VVVR:UVGK:NZBM:YQXT:JDWB:33RS:45V7:SQWJ<br>Docker Root Dir: /var/lib/docker<br>Debug Mode: <span class="hljs-literal">false</span><br>Registry: https://index.docker.io/v1/<br>Labels:<br>Experimental: <span class="hljs-literal">false</span><br>Insecure Registries:<br> 127.0.0.0/8<br>Live Restore Enabled: <span class="hljs-literal">false</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /etc/docker/daemon.json</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /etc/docker/daemon.json</span><br>&#123;<br> <span class="hljs-string">&quot;storage-driver&quot;</span>: <span class="hljs-string">&quot;overlay&quot;</span>, <span class="hljs-comment">#更改存储驱动</span><br> <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://si7y70hh.mirror.aliyuncs.com&quot;</span>]<br>&#125;<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl daemon-reload</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl restart docker</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker info |tail</span><br>WARNING: the overlay storage-driver is deprecated, and will be removed <span class="hljs-keyword">in</span> a future release.<br>Debug Mode: <span class="hljs-literal">false</span><br>Registry: https://index.docker.io/v1/<br>Labels:<br>Experimental: <span class="hljs-literal">false</span><br>Insecure Registries:<br> 127.0.0.0/8<br>Registry Mirrors:<br>https://si7y70hh.mirror.aliyuncs.com/<br>Live Restore Enabled: <span class="hljs-literal">false</span><br><br>[root@ubuntu1804 ~]<br></code></pre></td></tr></table></figure>

<h3 id="1-3-5-查看本地镜像"><a href="#1-3-5-查看本地镜像" class="headerlink" title="1.3.5 查看本地镜像"></a>1.3.5 查看本地镜像</h3><p>docker images 可以查看下载至本地的镜像<br>格式:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker images [OPTIONS] [REPOSITORY[:TAG]]<br>docker image ls [OPTIONS] [REPOSITORY[:TAG]]<br><br><span class="hljs-comment">#常用选项: </span><br>-q, --quiet   Only show numeric IDs<br>-a, --all Show all images (default hides intermediate images)<br>  --digests    Show digests<br>  --no-trunc   Don<span class="hljs-string">&#x27;t truncate output</span><br><span class="hljs-string">-f, --filter filter  Filter output based on conditions provided</span><br><span class="hljs-string">  --format string  Pretty-print images using a Go template</span><br></code></pre></td></tr></table></figure>

<p>执行结果的显示信息说明:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">REPOSITORY    <span class="hljs-comment">#镜像所属的仓库名称</span><br>TAG     <span class="hljs-comment">#镜像版本号（标识符），默认为latest</span><br>IMAGE ID    <span class="hljs-comment">#镜像唯一ID标识,如果ID相同,说明是同一个镜像有多个名称</span><br>CREATED    <span class="hljs-comment">#镜像在仓库中被创建时间</span><br>VIRTUAL SIZE   <span class="hljs-comment">#镜像的大小</span><br></code></pre></td></tr></table></figure>

<p>Repository仓库</p>
<ul>
<li>由某特定的docker镜像的所有迭代版本组成的镜像仓库</li>
<li>一个Registry中可以存在多个RepositoryRepository可分为“顶层仓库”和“用户仓库”</li>
<li>Repository用户仓库名称一般格式为“用户名/仓库名”</li>
<li>每个Repository仓库可以包含多个Tag(标签),每个标签对应一个镜像</li>
</ul>
<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY    TAG              IMAGE ID       CREATED         SIZE<br>nginx         latest           4f380adfc10f   43 hours ago    133MB<br>ubuntu        latest           9873176a8ff5   7 days ago      72.7MB<br>alpine        latest           d4ff818577bc   9 days ago      5.6MB<br>busybox       latest           69593048aa3a   2 weeks ago     1.24MB<br>hello-world   latest           d1165f221234   3 months ago    13.3kB<br>centos        latest           300e315adb2f   6 months ago    209MB<br>mysql         5.6.47           43f75a12e7ba   14 months ago   302MB<br>mysql         5.7.29           5d9483f9a7b2   14 months ago   455MB<br>centos        centos7.7.1908   08d05d1d5859   19 months ago   204MB<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images -q</span><br>4f380adfc10f<br>9873176a8ff5<br>d4ff818577bc<br>69593048aa3a<br>d1165f221234<br>300e315adb2f<br>43f75a12e7ba<br>5d9483f9a7b2<br>08d05d1d5859<br><br><span class="hljs-comment">#显示完整的ImageID</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images --no-trunc</span><br>REPOSITORY    TAG              IMAGE ID                                                                  CREATED         SIZE<br>nginx         latest           sha256:4f380adfc10f4cd34f775ae57a17d2835385efd5251d6dfe0f246b0018fb0399   43 hours ago    133MB<br>ubuntu        latest           sha256:9873176a8ff5ac192ce4d7df8a403787558b9f3981a4c4d74afb3edceeda451c   7 days ago      72.7MB<br>alpine        latest           sha256:d4ff818577bc193b309b355b02ebc9220427090057b54a59e73b79bdfe139b83   9 days ago      5.6MB<br>busybox       latest           sha256:69593048aa3acfee0f75f20b77acb549de2472063053f6730c4091b53f2dfb02   2 weeks ago     1.24MB<br>hello-world   latest           sha256:d1165f2212346b2bab48cb01c1e39ee8ad1be46b87873d9ca7a4e434980a7726   3 months ago    13.3kB<br>centos        latest           sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55   6 months ago    209MB<br>mysql         5.6.47           sha256:43f75a12e7bae4f49a91d5c5c39bae41e0492f42eab91a54a4ba437b7093dcbf   14 months ago   302MB<br>mysql         5.7.29           sha256:5d9483f9a7b21c87e0f5b9776c3e06567603c28c0062013eda127c968175f5e8   14 months ago   455MB<br>centos        centos7.7.1908   sha256:08d05d1d5859ebcfb3312d246e2082e46cb307f0e896c9ac097185f0b0b19e56   19 months ago   204MB<br><br><br><span class="hljs-comment">#只查看指定REPOSITORY的镜像</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images tomcat</span><br>REPOSITORY   TAG       IMAGE ID       CREATED        SIZE<br>tomcat       latest    6654503f1940   21 hours ago   667MB<br></code></pre></td></tr></table></figure>

<p>范例: 查看指定镜像的详细信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos8 ~]<span class="hljs-comment">#podman image inspect alpine</span><br>[<br> &#123;<br>    <span class="hljs-string">&quot;Id&quot;</span>:<br><span class="hljs-string">&quot;e7d92cdc71feacf90708cb59182d0df1b911f8ae022d29e8e95d75ca6a99776a&quot;</span>,<br>    <span class="hljs-string">&quot;Digest&quot;</span>:<br><span class="hljs-string">&quot;sha256:ddba4d27a7ffc3f86dd6c2f92041af252a1f23a8e742c90e6e1297bfa1bc0c45&quot;</span>,<br>    <span class="hljs-string">&quot;RepoTags&quot;</span>: [<br>      <span class="hljs-string">&quot;docker.io/library/alpine:latest&quot;</span><br>   ],<br>    <span class="hljs-string">&quot;RepoDigests&quot;</span>: [<br>    <br> <span class="hljs-string">&quot;docker.io/library/alpine@sha256:ddba4d27a7ffc3f86dd6c2f92041af252a1f23a8e742c9</span><br><span class="hljs-string">0e6e1297bfa1bc0c45&quot;</span><br>   ],<br>    <span class="hljs-string">&quot;Parent&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;Comment&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;Created&quot;</span>: <span class="hljs-string">&quot;2020-01-18T01:19:37.187497623Z&quot;</span>,<br>    <span class="hljs-string">&quot;Config&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;Env&quot;</span>: [<br>      <br> <span class="hljs-string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br>     ],<br>      <span class="hljs-string">&quot;Cmd&quot;</span>: [<br>        <span class="hljs-string">&quot;/bin/sh&quot;</span><br>     ]<br>   &#125;,<br>    <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;18.06.1-ce&quot;</span>,<br>    <span class="hljs-string">&quot;Author&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;Architecture&quot;</span>: <span class="hljs-string">&quot;amd64&quot;</span>,<br>    <span class="hljs-string">&quot;Os&quot;</span>: <span class="hljs-string">&quot;linux&quot;</span>,<br>    <span class="hljs-string">&quot;Size&quot;</span>: 5859847,<br>    <span class="hljs-string">&quot;VirtualSize&quot;</span>: 5859847,<br>    <span class="hljs-string">&quot;GraphDriver&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;overlay&quot;</span>,<br>      <span class="hljs-string">&quot;Data&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;MergedDir&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/containers/storage/overlay/5216338b40a7b96416b8b9858974bbe4acc3096ee60</span><br><span class="hljs-string">acbc4dfb1ee02aecceb10/merged&quot;</span>,<br>        <span class="hljs-string">&quot;UpperDir&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/containers/storage/overlay/5216338b40a7b96416b8b9858974bbe4acc3096ee60</span><br><span class="hljs-string">acbc4dfb1ee02aecceb10/diff&quot;</span>,<br>        <span class="hljs-string">&quot;WorkDir&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/containers/storage/overlay/5216338b40a7b96416b8b9858974bbe4acc3096ee60</span><br><span class="hljs-string">acbc4dfb1ee02aecceb10/work&quot;</span><br>     &#125;<br>   &#125;,<br>    <span class="hljs-string">&quot;RootFS&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;Type&quot;</span>: <span class="hljs-string">&quot;layers&quot;</span>,<br>      <span class="hljs-string">&quot;Layers&quot;</span>: [<br>      <br> <span class="hljs-string">&quot;sha256:5216338b40a7b96416b8b9858974bbe4acc3096ee60acbc4dfb1ee02aecceb10&quot;</span><br>     ]<br>   &#125;,<br>    <span class="hljs-string">&quot;Labels&quot;</span>: null,<br>    <span class="hljs-string">&quot;Annotations&quot;</span>: &#123;&#125;,<br>    <span class="hljs-string">&quot;ManifestType&quot;</span>: <span class="hljs-string">&quot;application/vnd.docker.distribution.manifest.v2+json&quot;</span>,<br>    <span class="hljs-string">&quot;User&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;History&quot;</span>: [<br>     &#123;<br>        <span class="hljs-string">&quot;created&quot;</span>: <span class="hljs-string">&quot;2020-01-18T01:19:37.02673981Z&quot;</span>,<br>        <span class="hljs-string">&quot;created_by&quot;</span>: <span class="hljs-string">&quot;/bin/sh -c #(nop) ADD</span><br><span class="hljs-string">file:e69d441d729412d24675dcd33e04580885df99981cec43de8c9b24015313ff8e in / &quot;</span><br>     &#125;,<br>     &#123;<br>        <span class="hljs-string">&quot;created&quot;</span>: <span class="hljs-string">&quot;2020-01-18T01:19:37.187497623Z&quot;</span>,<br>        <span class="hljs-string">&quot;created_by&quot;</span>: <span class="hljs-string">&quot;/bin/sh -c #(nop) CMD [\&quot;/bin/sh\&quot;]&quot;</span>,<br>        <span class="hljs-string">&quot;empty_layer&quot;</span>: <span class="hljs-literal">true</span><br>     &#125;<br>   ]<br> &#125;<br>]<br></code></pre></td></tr></table></figure>

<h3 id="1-3-6-镜像导出"><a href="#1-3-6-镜像导出" class="headerlink" title="1.3.6 镜像导出"></a>1.3.6 镜像导出</h3><p>利用docker save命令可以将从本地镜像导出为一个打包 tar文件，然后复制到其他服务器进行导入使用</p>
<p>格式:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker save [OPTIONS] IMAGE [IMAGE...]<br>选项: <br>-o, --output string  Write to a file, instead of STDOUT<br></code></pre></td></tr></table></figure>

<p>常见用法:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker save -o /path/file.tar IMAGE1 IMAGE2 ...<br>docker save IMAGE1 IMAGE2 ... &gt; /path/file.tar<br></code></pre></td></tr></table></figure>

<p>范例: 镜像导出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG               IMAGE ID        CREATED       SIZE<br>nginx         latest           5ad3bd0e67a9     3 days ago     127MB<br>alpine        3.11.3           e7d92cdc71fe     7 days ago     5.59MB<br>centos        centos8.1.1911   470671670cac     7 days ago     237MB<br>centos        latest           470671670cac     7 days ago     237MB<br>mysql         5.6.47           742f7d5a4104     10 days ago    302MB<br>mysql         5.7.29           b598110d0fff     10 days ago    435MB<br>busybox       latest           6d5fcfe5ff17     4 weeks ago    1.22MB<br>hello-world   latest           fce289e99eb9     12 months ago  1.84kB<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker save mysql:5.7.29 alpine:3.11.3 -o /data/myimages.tar</span><br><span class="hljs-comment">#或者</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker save mysql:5.7.29 alpine:3.11.3 &gt; /data/myimages.tar</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#scp /data/myimages.tar  10.0.0.7:/data </span><br></code></pre></td></tr></table></figure>

<h3 id="1-3-7-镜像导入"><a href="#1-3-7-镜像导入" class="headerlink" title="1.3.7 镜像导入"></a>1.3.7 镜像导入</h3><p>利用docker load命令可以将镜像导出的压缩文件再导入</p>
<p>格式:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker load [OPTIONS]<br><br><span class="hljs-comment">#选项</span><br>-i, --input string  Read from tar archive file, instead of STDIN<br>-q, --quiet     Suppress the load output<br></code></pre></td></tr></table></figure>

<p>范例: 镜像导入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>[root@centos7 ~]<span class="hljs-comment">#docker load -i /data/myimages.tar</span><br><br><span class="hljs-comment">#或者</span><br>[root@centos7 ~]<span class="hljs-comment">#docker load &lt; /data/myimages.tar </span><br><br>[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG           IMAGE ID        CREATED        SIZE<br>alpine        3.11.3       e7d92cdc71fe     7 days ago     5.59MB<br>mysql         5.7.29       b598110d0fff     10 days ago    435MB<br></code></pre></td></tr></table></figure>

<p>范例: 一次导出多个镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG           IMAGE ID         CREATED       SIZE<br>alpine        latest       e7d92cdc71fe     7 days ago     5.59MB<br>busybox       latest       6d5fcfe5ff17     4 weeks ago    1.22MB<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker save busybox alpine &gt; /all.tar</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ll -h /opt/all.tar</span><br>-rw-r--r-- 1 root root 7.0M Jan 25 22:12 /opt/all.tar<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rmi -f `docker images -q`</span><br>Untagged: alpine:latest<br>Deleted: sha256:e7d92cdc71feacf90708cb59182d0df1b911f8ae022d29e8e95d75ca6a99776a<br>Deleted: sha256:5216338b40a7b96416b8b9858974bbe4acc3096ee60acbc4dfb1ee02aecceb10<br>Untagged: busybox:latest<br>Deleted: sha256:6d5fcfe5ff170471fcc3c8b47631d6d71202a1fd44cf3c147e50c8de21cf0648<br>Deleted: sha256:195be5f8be1df6709dafbba7ce48f2eee785ab7775b88e0c115d8205407265c5<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker load -i /opt/all.tar</span><br>5216338b40a7: Loading layer<br>[==================================================&gt;]  5.857MB/5.857MB<br>Loaded image: alpine:latest<br>195be5f8be1d: Loading layer<br>[==================================================&gt;]  1.437MB/1.437MB<br>Loaded image: busybox:latest<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG           IMAGE ID         CREATED      SIZE<br>alpine        latest       e7d92cdc71fe     7 days ago     5.59MB<br>busybox       latest       6d5fcfe5ff17     4 weeks ago    1.22MB<br></code></pre></td></tr></table></figure>

<h3 id="1-3-8-删除镜像"><a href="#1-3-8-删除镜像" class="headerlink" title="1.3.8 删除镜像"></a>1.3.8 删除镜像</h3><p>docker rmi 命令可以删除本地镜像</p>
<p>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker rmi [OPTIONS] IMAGE [IMAGE...]<br>docker image rm [OPTIONS] IMAGE [IMAGE...]<br><br><span class="hljs-comment">#选项:</span><br>-f, --force   Force removal of the image<br>  --no-prune  Do not delete untagged parents<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG           IMAGE ID         CREATED       SIZE<br>alpine        3.11.3       e7d92cdc71fe     7 days ago     5.59MB<br>mysql         5.7.29       b598110d0fff     10 days ago    435MB<br>[root@centos7 ~]<span class="hljs-comment">#docker rmi b59811</span><br>Untagged: mysql:5.7.29<br>Deleted: sha256:b598110d0fffc42862269a25d8767dd95764d0740f318fd6c0a097f8a22de5bf<br>Deleted: sha256:908aaab4c4b8d0cbbc68c96a0e3820aa74fd1dee5499e2ca326bc8fd7312f689<br>Deleted: sha256:e2f2e83f295186b00e3c0d119ef3204b509d552972694e34cee7c1675d157b8a<br>Deleted: sha256:99b4e48b1be76f50741db02a38c783bf698b1b76808cc6bb5e3fdd65ee2897c6<br>Deleted: sha256:79c1efa7bde3ac754af64779452ca913fa1f281b44c9dbad25cc322a51ac69b1<br>Deleted: sha256:5f7c68324b959d2c806db18d02f153bc810f9842722415e077351bc834cc8578<br>Deleted: sha256:338fc0cd3fb4b87a2b83d274e8fbf475fbde19947c4ac5c5eb6e981a6fb0e8f0<br>Deleted: sha256:f7a4ccab931f1d1e861961eb951a7806d91ccb375e737fe1f84282f6bbafd2be<br>Deleted: sha256:f388e1092f8fb931a3cd07a7381bd9707d19526ff81f8b624e932f4919c27a3e<br>Deleted: sha256:e209b7a884b4d2e9d56bbac40ced48f2caa6a19e7ad6eb6dd20ff754f3af2c5d<br>Deleted: sha256:2401cf11c5455d505ef49657afcc709197ffcdfc9bd732508e9b62578a30b3a5<br>Deleted: sha256:814c70fdae62bc26c603bfae861f00fb1c77fc0b1ee8d565717846f4df24ae5d<br>[root@centos7 ~]<span class="hljs-comment">#docker rmi alpine:3.11.3</span><br>Untagged: alpine:3.11.3<br>Deleted: sha256:e7d92cdc71feacf90708cb59182d0df1b911f8ae022d29e8e95d75ca6a99776a<br>Deleted: sha256:5216338b40a7b96416b8b9858974bbe4acc3096ee60acbc4dfb1ee02aecceb10<br>[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      SIZE<br></code></pre></td></tr></table></figure>

<p>范例: 删除多个镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker rmi nginx tomcat</span><br></code></pre></td></tr></table></figure>

<p>范例: 强制删除正在使用的镜像，也会删除对应的容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE                  COMMAND         CREATED         STATUS            PORTS            NAMES<br>b5a0d2e1e1d0    centos:centos8.1.1911  <span class="hljs-string">&quot;bash&quot;</span>          41 minutesago   Up 41 minutes                      jolly_burnell<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rmi centos:centos8.1.1911</span><br>Error response from daemon: conflict: unable to remove repository reference<br><span class="hljs-string">&quot;centos:centos8.1.1911&quot;</span> (must force) - container b5a0d2e1e1d0 is using its<br>referenced image 470671670cac<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rmi -f centos:centos8.1.1911</span><br>Untagged: centos:centos8.1.1911<br>Untagged:<br>centos@sha256:fe8d824220415eed5477b63addf40fb06c3b049404242b31982106ac204f6700<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND         CREATED      STATUS            PORTS           NAMES<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>范例: 删除所有镜像方法一</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID          CREATED      SIZE<br>&lt;none&gt;       &lt;none&gt;       470671670cac     7 days ago     237MB<br>mysql        5.6.47       742f7d5a4104     10 days ago    302MB<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rmi -f `docker images -q`</span><br>Deleted: sha256:470671670cac686c7cf0081e0b37da2e9f4f768ddc5f6a26102ccd1c6954c1ee<br>Deleted: sha256:0683de2821778aa9546bf3d3e6944df779daba1582631b7ea3517bb36f9e4007<br>Untagged: mysql:5.6.47<br>Untagged:<br>mysql@sha256:9527bae58991a173ad7d41c8309887a69cb8bd178234386acb28b51169d0b30e<br>Deleted: sha256:742f7d5a4104969fcac8054cf9201f5656096f0a58d10947a4a41a8e1d7d9f91<br>Deleted: sha256:62530ddc9fe5f85609da4397d9e0a88b422d15dbc42664d7477d1deccb51a0d9<br>Deleted: sha256:41309d62590858b6375bd3c4e9d07bd73e4ea5062343a81641453033424e7aba<br>Deleted: sha256:43cb5cbfcce71f7fdd80b121aa4d0c5eea9ed0bfcf4a2a0e55a8c5ddb78d4368<br>Deleted: sha256:56806995b55c0e80ee0daec20f32f8293a3d8ccf151895cd1767a1d27eab1977<br>Deleted: sha256:7dab204c1f667de5090d809019fab7d6e2323e371407b38e8d311ba458009234<br>Deleted: sha256:1a7c2d06fdee90c4b06a55793f9e45120a82ff476e0fea5618efd8a268f7d303<br>Deleted: sha256:f7a4ccab931f1d1e861961eb951a7806d91ccb375e737fe1f84282f6bbafd2be<br>Deleted: sha256:f388e1092f8fb931a3cd07a7381bd9707d19526ff81f8b624e932f4919c27a3e<br>Deleted: sha256:e209b7a884b4d2e9d56bbac40ced48f2caa6a19e7ad6eb6dd20ff754f3af2c5d<br>Deleted: sha256:2401cf11c5455d505ef49657afcc709197ffcdfc9bd732508e9b62578a30b3a5<br>Deleted: sha256:814c70fdae62bc26c603bfae861f00fb1c77fc0b1ee8d565717846f4df24ae5d<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      SIZE<br></code></pre></td></tr></table></figure>

<p>范例: 删除所有镜像方法二</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID          CREATED      SIZE<br>&lt;none&gt;       &lt;none&gt;       470671670cac     7 days ago     237MB<br>mysql        5.6.47       742f7d5a4104     10 days ago    302MB<br>root@ubuntu1804:~<span class="hljs-comment"># docker images -q | xargs docker rmi</span><br>Untagged: nginx:latest<br>Untagged: nginx@sha256:47ae43cdfc7064d28800bc42e79a429540c7c80168e8c8952778c0d5af1c09db<br>Deleted: sha256:4f380adfc10f4cd34f775ae57a17d2835385efd5251d6dfe0f246b0018fb0399<br>Deleted: sha256:2855bbcefcf95050e64049447e99e77efa2bff32374e586982d69be4612467ce<br>Deleted: sha256:bad169ad8b30eab551acbb8cd8fbdcd824528189e3dd0cc52dd88a37bbf121cd<br>Deleted: sha256:36d83ebf5fec7ae1be4c431f0945f2dbe6828ecdc936c604daa48f17c0b50ed7<br>Deleted: sha256:b4c9a251dc81d52dd1cca9b4c69ca9e4db602a9a7974019f212846577f739699<br>Deleted: sha256:038ca5b801cea48e9f40f6ffb4cda61a2fe0b6b0f378a7434a0d39d2575a4082<br>Untagged: httpd:latest<br>Untagged: httpd@sha256:3b85095d8cac6a62357b4944497ca8ea4198e210425fa7a3ccfe144089f1b12d<br>Deleted: sha256:30287d8996563077ca1aeb138cb8d7b6b80d8c50b2cc6f3422b950c9f280277b<br>Deleted: sha256:9091725bc9f201a9a3c7f8e5d66fa46fffb0c95d9e8d0a6aaab47b362a2b0237<br>Deleted: sha256:b340508c21f16922e46a2904197c7eafc6fcfc6c031d6cf5b3eb7514afc66848<br>Deleted: sha256:356e3acf71a1a4ccc94a250fa7e6351f7b1691b7dc0ee48be96c97709cd1b7b8<br>Deleted: sha256:43c41c92588e603f75963bab3a334a02109a6381002f784223bdeec5f46ba7a3<br>Deleted: sha256:764055ebc9a7a290b64d17cf9ea550f1099c202d83795aa967428ebdf335c9f7<br>Untagged: busybox:latest<br>Untagged: busybox@sha256:930490f97e5b921535c153e0e7110d251134cc4b72bbb8133c6a5065cc68580d<br>Deleted: sha256:69593048aa3acfee0f75f20b77acb549de2472063053f6730c4091b53f2dfb02<br>Deleted: sha256:5b8c72934dfc08c7d2bd707e93197550f06c0751023dabb3a045b723c5e7b373<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY   TAG       IMAGE ID   CREATED   SIZE<br></code></pre></td></tr></table></figure>

<h3 id="1-3-9-镜像打标签"><a href="#1-3-9-镜像打标签" class="headerlink" title="1.3.9 镜像打标签"></a>1.3.9 镜像打标签</h3><p>docker tag 可以给镜像打标签，类似于起别名,但通常要遵守一定的命名规范,才可以上传到指定的仓库</p>
<p>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]<br><br><span class="hljs-comment">#TARGET_IMAGE[:TAG]格式一般形式</span><br>仓库主机FQDN或IP[:端口]/项目名(或用户名)/image名字:版本<br></code></pre></td></tr></table></figure>

<p>TAG默认为latest</p>
<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG              IMAGE ID         CREATED        SIZE<br>alpine         latest           e7d92cdc71fe     11 days ago    5.59MB<br>centos         centos7.7.1908   08d05d1d5859     2 months ago   204MB<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag alpine alpine:3.11</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG              IMAGE ID         CREATED        SIZE<br>alpine         3.11             e7d92cdc71fe     11 days ago    5.59MB<br>alpine         latest           e7d92cdc71fe     11 days ago    5.59MB<br>centos         centos7.7.1908   08d05d1d5859     2 months ago   204MB<br></code></pre></td></tr></table></figure>

<p><strong>总结: 企业使用镜像及常见操作: 搜索、下载、导出、导入、删除</strong><br><strong>命令总结:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker search centos <span class="hljs-comment">#搜索镜像</span><br>docker pull alpine <span class="hljs-comment">#下载镜像</span><br>docker images <span class="hljs-comment">#查看镜像</span><br>docker save &gt; /opt/centos.tar <span class="hljs-comment">#centos #导出镜像</span><br>docker load -i centos-latest.tar.xz  <span class="hljs-comment">#导入本地镜像</span><br>docker rmi 镜像ID/镜像名称  <span class="hljs-comment">#删除指定ID的镜像，此镜像对应容器正启动镜像不能被删除，除非将容器全部关闭</span><br></code></pre></td></tr></table></figure>

<h2 id="1-4-容器操作基础命令"><a href="#1-4-容器操作基础命令" class="headerlink" title="1.4 容器操作基础命令"></a>1.4 容器操作基础命令</h2><p><strong>容器生命周期</strong></p>
<img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker43.png" srcset="/blog/img/loading.gif" style="zoom:150%;" />

<p>容器相关命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker container</span><br><br>Usage: docker container COMMAND<br><br>Manage containers<br><br>Commands:<br>attach   Attach <span class="hljs-built_in">local</span> standard input, output, and error streams to a<br>running container<br>commit   Create a new image from a container<span class="hljs-string">&#x27;s changes</span><br><span class="hljs-string"> cp     Copy files/folders between a container and the local filesystem</span><br><span class="hljs-string">create   Create a new container</span><br><span class="hljs-string"> diff    Inspect changes to files or directories on a container&#x27;</span>s<br>filesystem<br><span class="hljs-built_in">exec</span>    Run a <span class="hljs-built_in">command</span> <span class="hljs-keyword">in</span> a running container<br> <span class="hljs-built_in">export</span>   Export a container<span class="hljs-string">&#x27;s filesystem as a tar archive</span><br><span class="hljs-string">inspect   Display detailed information on one or more containers</span><br><span class="hljs-string"> kill    Kill one or more running containers</span><br><span class="hljs-string">logs    Fetch the logs of a container</span><br><span class="hljs-string"> ls     List containers</span><br><span class="hljs-string">pause    Pause all processes within one or more containers</span><br><span class="hljs-string">port    List port mappings or a specific mapping for the container</span><br><span class="hljs-string">prune    Remove all stopped containers</span><br><span class="hljs-string">rename   Rename a container</span><br><span class="hljs-string"> restart   Restart one or more containers</span><br><span class="hljs-string"> rm     Remove one or more containers</span><br><span class="hljs-string">run     Run a command in a new container</span><br><span class="hljs-string"> start    Start one or more stopped containers</span><br><span class="hljs-string">stats    Display a live stream of container(s) resource usage statistics</span><br><span class="hljs-string"> stop    Stop one or more running containers</span><br><span class="hljs-string"> top     Display the running processes of a container</span><br><span class="hljs-string">unpause   Unpause all processes within one or more containers</span><br><span class="hljs-string">update   Update configuration of one or more containers</span><br><span class="hljs-string">wait    Block until one or more containers stop, then print their exit</span><br><span class="hljs-string">codes</span><br><span class="hljs-string"></span><br><span class="hljs-string">Run &#x27;</span>docker container COMMAND --<span class="hljs-built_in">help</span><span class="hljs-string">&#x27; for more information on a command.</span><br></code></pre></td></tr></table></figure>

<h3 id="1-4-1-启动容器"><a href="#1-4-1-启动容器" class="headerlink" title="1.4.1 启动容器"></a>1.4.1 启动容器</h3><p>docker run 可以启动容器，进入到容器，并随机生成容器ID和名称</p>
<h4 id="1-4-1-1-启动第一个容器"><a href="#1-4-1-1-启动第一个容器" class="headerlink" title="1.4.1.1 启动第一个容器"></a>1.4.1.1 启动第一个容器</h4><p>范例: 运行docker 的 hello world</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos8 ~]<span class="hljs-comment"># docker run hello-world</span><br>Unable to find image <span class="hljs-string">&#x27;hello-world:latest&#x27;</span> locally<br>latest: Pulling from library/hello-world<br>1b930d010525: Pull complete<br>Digest: sha256:9572f7cdcee8591948c2963463447a53466950b3fc15a247fcad1917ca215a2f<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> hello-world:latest<br><br>Hello from Docker!<br>This message shows that your installation appears to be working correctly.<br><br>To generate this message, Docker took the following steps:<br>1. The Docker client contacted the Docker daemon.<br>2. The Docker daemon pulled the <span class="hljs-string">&quot;hello-world&quot;</span> image from the Docker Hub.<br> (amd64)<br>3. The Docker daemon created a new container from that image <span class="hljs-built_in">which</span> runs the<br> executable that produces the output you are currently reading.<br>4. The Docker daemon streamed that output to the Docker client, <span class="hljs-built_in">which</span> sent it<br> to your terminal.<br> <br>To try something more ambitious, you can run an Ubuntu container with:<br>$ docker run -it ubuntu bash<br><br>Share images, automate workflows, and more with a free Docker ID:<br>https://hub.docker.com/<br><br>For more examples and ideas, visit:<br>https://docs.docker.com/get-started/<br><br>[root@centos8 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY      TAG          IMAGE ID         CREATED         SIZE<br>hello-world     latest       fce289e99eb9     12 months ago   1.84kB<br>[root@centos8 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE           COMMAND        CREATED         STATUS                      PORTS     NAMES<br>7f53a2a74edc    hello-world     <span class="hljs-string">&quot;/hello&quot;</span>       21 seconds ago  Exited (0) 19 seconds ago             nifty_yalow<br></code></pre></td></tr></table></figure>

<h4 id="1-4-1-2-启动容器的流程"><a href="#1-4-1-2-启动容器的流程" class="headerlink" title="1.4.1.2 启动容器的流程"></a>1.4.1.2 启动容器的流程</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker44.png" srcset="/blog/img/loading.gif"></p>
<h4 id="1-4-1-3-启动容器用法"><a href="#1-4-1-3-启动容器用法" class="headerlink" title="1.4.1.3 启动容器用法"></a>1.4.1.3 启动容器用法</h4><p>帮助: man docker-run</p>
<p>命令格式:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run [选项] [镜像名] [shell命令] [参数]<br><br><span class="hljs-comment">#选项: </span><br>-i, --interactive  Keep STDIN open even <span class="hljs-keyword">if</span> not attached，通常和-t一起使用<br>-t, --tty      分配pseudo-TTY，通常和-i一起使用,注意对应的容器必须运行shell才支持进入<br>-d, --detach     Run container <span class="hljs-keyword">in</span> background and <span class="hljs-built_in">print</span> container ID,台后运行，默认前台<br>--name string    Assign a name to the container <span class="hljs-comment">#给容器标记一个名字</span><br>--h, --hostname string Container host name <span class="hljs-comment">#给容器一个hostname</span><br>--rm         Automatically remove the container when it exits <span class="hljs-comment">#推出容器自动删除，多用于测试容器</span><br>-p, --publish list  Publish a container<span class="hljs-string">&#x27;s port(s) to the host</span><br><span class="hljs-string">-P, --publish-all  Publish all exposed ports to random ports</span><br><span class="hljs-string">--dns list      Set custom DNS servers</span><br><span class="hljs-string">--entrypoint string Overwrite the default ENTRYPOINT of the image</span><br><span class="hljs-string">--restart policy </span><br><span class="hljs-string">--privileged     Give extended privileges to container</span><br><span class="hljs-string">-e, --env=[] Set environment variables</span><br><span class="hljs-string">--env-file=[]    Read in a line delimited file of environment variables</span><br></code></pre></td></tr></table></figure>

<p><strong>–restart 可以指定四种不同的policy</strong></p>
<table>
<thead>
<tr>
<th align="center">policy</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">no</td>
<td>Default is no，Do not automatically restart the container when it exits.</td>
</tr>
<tr>
<td align="center">on-failure[:max-retries]</td>
<td>on-failure[:max-retries] Restart only if the container exits with a non-zeroexit status. Optionally, limit the number of restart retries the Docker daemon attempts.</td>
</tr>
<tr>
<td align="center">always</td>
<td>Always restart the container regardless of the exit status. When you specify always, the Docker daemon will try to restart the container indefinitely. The container will also always start on daemon startup, regardless of the current state of the container.</td>
</tr>
<tr>
<td align="center">unless-stopped</td>
<td>Always restart the container regardless of the exit status, but do not start it on daemon startup if the container has been put to a stopped state before.</td>
</tr>
</tbody></table>
<p><strong>注意: 容器启动后,如果容器内没有前台运行的进程,将自动退出停止</strong><br>从容器内退出,并停止容器</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure>

<p>从容器内退出,且容器不停止</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">同时按三个键，ctrl+<span class="hljs-selector-tag">p</span>+<span class="hljs-selector-tag">q</span><br></code></pre></td></tr></table></figure>

<p>范例: 运行容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#启动容器时会自动随机字符作为容器名</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run alpine</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED      <br>STATUS           PORTS        NAMES<br>95967eaefd6a    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      8 seconds ago   <br>Exited (0) 6 seconds ago            confident_elion<br></code></pre></td></tr></table></figure>

<p>范例: 一次性运行容器中命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#启动的容器在执行完shell命令就退出，用于测试</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run busybox echo &quot;Hello laowang&quot;</span><br>Unable to find image <span class="hljs-string">&#x27;busybox:latest&#x27;</span> locally<br>latest: Pulling from library/busybox<br>91f30d776fb2: Pull complete<br>Digest: sha256:9ddee63a712cea977267342e8750ecbc60d3aab25f04ceacfa795e6fce341793<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> busybox:latest<br>Hello laowang<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED      STATUS       PORTS        NAMES<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE         COMMAND                 CREATED         STATUS                   PORTS        NAMES<br>7873aed1b5dd    busybox       <span class="hljs-string">&quot;echo &#x27;Hello laowang&#x27;&quot;</span>  19 seconds ago  Exited (0) 18 seconds ago            pedantic_varahamihira<br></code></pre></td></tr></table></figure>

<p>范例: 指定容器名称</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#注意每个容器的名称要唯一</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run --name a1 alpine</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE         COMMAND        CREATED         STATUS                   PORTS        NAMES<br>dd06368a4f56    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      2 minutes ago   Exited (0) 8 seconds ago              a1<br></code></pre></td></tr></table></figure>

<p>范例: 运行交互式容器并退出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it docker.io/busybox sh</span><br>Unable to find image <span class="hljs-string">&#x27;busybox:latest&#x27;</span> locally<br>latest: Pulling from library/busybox<br>bdbbaa22dec6: Pull complete<br>Digest: sha256:6915be4043561d64e0ab0f8f098dc2ac48e077fe23f488ac24b665166898115a<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> busybox:latest<br>/ <span class="hljs-comment"># exit</span><br><br><span class="hljs-comment">#用exit退出后容器也停止</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -l</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED         STATUS                  PORTS        NAMES<br>cd8c2a7f39d5    busybox       <span class="hljs-string">&quot;sh&quot;</span>         8 seconds ago   Exited (0) 1 second ago              vigorous_leakey<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it docker.io/busybox sh</span><br>Unable to find image <span class="hljs-string">&#x27;busybox:latest&#x27;</span> locally<br>latest: Pulling from library/busybox<br>bdbbaa22dec6: Pull complete<br>Digest: sha256:6915be4043561d64e0ab0f8f098dc2ac48e077fe23f488ac24b665166898115a<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> busybox:latest<br>/ <span class="hljs-comment">#同时按三个键:ctrl+p+q</span><br><br><span class="hljs-comment">#用同时按三个键ctrl+p+q退出后容器不会停止</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -l</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED         STATUS          PORTS        NAMES<br>cd8c2a7f39d5    busybox       <span class="hljs-string">&quot;sh&quot;</span>         8 seconds ago   Up 10 seconds                silly_villani<br></code></pre></td></tr></table></figure>

<p>范例: 设置容器内的主机名（hostname）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --name a1 -h a1.magedu.org alpine</span><br>/ <span class="hljs-comment"># hostname</span><br>a1.magedu.org<br>/ <span class="hljs-comment"># cat /etc/hosts</span><br>127.0.0.1 localhost<br>::1 localhost ip6-localhost ip6-loopback<br>fe00::0 ip6-localnet<br>ff00::0 ip6-mcastprefix<br>ff02::1 ip6-allnodes<br>ff02::2 ip6-allrouters<br>172.17.0.2 a1.magedu.org a1<br>/ <span class="hljs-comment"># cat /etc/resolv.conf</span><br><span class="hljs-comment"># This file is managed by man:systemd-resolved(8). Do not edit.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># This is a dynamic resolv.conf file for connecting local clients directly to</span><br><span class="hljs-comment"># all known uplink DNS servers. This file lists all configured search domains.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Third party programs must not access this file directly, but only through the</span><br><span class="hljs-comment"># symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,</span><br><span class="hljs-comment"># replace this symlink by a static file or a different symlink.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># See man:systemd-resolved.service(8) for details about the supported modes of</span><br><span class="hljs-comment"># operation for /etc/resolv.conf.</span><br><br>nameserver 180.76.76.76<br>nameserver 223.6.6.6<br>search magedu.com magedu.org<br></code></pre></td></tr></table></figure>

<p>范例: 一次性运行容器，退出后立即删除，用于测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run --rm alpine cat /etc/issue</span><br>Welcome to Alpine Linux 3.11<br>Kernel \r on an \m (\l)<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED      STATUS       PORTS        NAMES<br></code></pre></td></tr></table></figure>

<p>范例: 创建容器后直接进入并退出<br>退出两种方式:</p>
<ul>
<li>exit 容器也停止</li>
<li>按ctrl+p+q 容器不停止</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#，执行exit退出后容器关闭</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --name alpine2 alpine</span><br>/ <span class="hljs-comment"># cat /etc/issue</span><br>Welcome to Alpine Linux 3.11<br>Kernel \r on an \m (\l)<br><br>/ <span class="hljs-comment"># exit #退出容器,容器也停止运行</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE         COMMAND        CREATED         STATUS                   PORTS        NAMES<br>6d64f47a83e6    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      13 seconds ago  Exited (0) 6 seconds ago              alpine2<br>edd2ac2690e6    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      52 seconds ago  Exited (0) 51 seconds ago             alpine1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --name alpine3 alpine</span><br><span class="hljs-comment">#同时按ctrl+p+q 三个键退出后,容器不停止</span><br>/ <span class="hljs-comment"># [root@ubuntu1804 ~]#docker ps -a</span><br>CONTAINER ID    IMAGE         COMMAND        CREATED             STATUS                        PORTS        NAMES<br>df428caf7128    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      8 seconds ago       Up 7 seconds                               alpine3<br>6d64f47a83e6    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      26 seconds ago      Exited (0) 20 seconds ago                  alpine2<br>edd2ac2690e6    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      About a minute ago  Exited (0) About a minute ago              alpine1<br></code></pre></td></tr></table></figure>

<p>什么是守护式容器:</p>
<ul>
<li>能够长期运行</li>
<li>无需交互式会话</li>
<li>适合运行应用程序和服务</li>
</ul>
<p>范例: 启动前台守护式容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run nginx</span><br>Unable to find image <span class="hljs-string">&#x27;nginx:latest&#x27;</span> locally<br>latest: Pulling from library/nginx<br>b4d181a07f80: Pull complete <br>edb81c9bc1f5: Pull complete <br>b21fed559b9f: Pull complete <br>03e6a2452751: Pull complete <br>b82f7f888feb: Pull complete <br>5430e98eba64: Pull complete <br>Digest: sha256:47ae43cdfc7064d28800bc42e79a429540c7c80168e8c8952778c0d5af1c09db<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> nginx:latest<br>/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration<br>/docker-entrypoint.sh: Looking <span class="hljs-keyword">for</span> shell scripts <span class="hljs-keyword">in</span> /docker-entrypoint.d/<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh<br>10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf<br>10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 <span class="hljs-keyword">in</span> /etc/nginx/conf.d/default.conf<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh<br>/docker-entrypoint.sh: Configuration complete; ready <span class="hljs-keyword">for</span> start up<br>2021/06/25 03:07:23 [notice] 1<span class="hljs-comment">#1: using the &quot;epoll&quot; event method</span><br>2021/06/25 03:07:23 [notice] 1<span class="hljs-comment">#1: nginx/1.21.0</span><br>2021/06/25 03:07:23 [notice] 1<span class="hljs-comment">#1: built by gcc 8.3.0 (Debian 8.3.0-6) </span><br>2021/06/25 03:07:23 [notice] 1<span class="hljs-comment">#1: OS: Linux 4.15.0-55-generic</span><br>2021/06/25 03:07:23 [notice] 1<span class="hljs-comment">#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br>2021/06/25 03:07:23 [notice] 1<span class="hljs-comment">#1: start worker processes</span><br>2021/06/25 03:07:23 [notice] 1<span class="hljs-comment">#1: start worker process 33</span><br>2021/06/25 03:07:23 [notice] 1<span class="hljs-comment">#1: start worker process 34</span><br>2021/06/25 03:07:23 [notice] 1<span class="hljs-comment">#1: start worker process 35</span><br>2021/06/25 03:07:23 [notice] 1<span class="hljs-comment">#1: start worker process 36</span><br>172.17.0.4 - - [25/Jun/2021:03:10:14 +0000] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 612 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Wget&quot;</span> <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-comment">#此纪录是下面使用wget访问nginx</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run --rm --name b1 busybox wget -qO - 172.17.0.3</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br>&lt;style&gt;<br>    body &#123;<br>        width: 35em;<br>        margin: 0 auto;<br>        font-family: Tahoma, Verdana, Arial, sans-serif;<br>    &#125;<br>&lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;<br>&lt;p&gt;If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.&lt;/p&gt;<br><br>&lt;p&gt;For online documentation and support please refer to<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;<br>Commercial support is available at<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;<br><br>&lt;p&gt;&lt;em&gt;Thank you <span class="hljs-keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>范例: 启动后台守护式容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d nginx</span><br>40f92a0d1eb086773e2de81f1e0265b7accedc2ff2cec5e051886f67243c126f<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -l</span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES<br>40f92a0d1eb0   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   27 seconds ago   Up 26 seconds   80/tcp    kind_snyder<br>  <br><br><span class="hljs-comment">#有些容器后台启动不会持续运行</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name alpine4 alpine</span><br>3a05bbf66dac8a6ac9829c876bdb5fcb70832bf4a2898d68f6979cd8e8c517cb<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE      COMMAND       CREATED              STATUS                        PORTS        NAMES<br>3a05bbf66dac    alpine     <span class="hljs-string">&quot;/bin/sh&quot;</span>     3 seconds ago        Exited (0) 2 seconds ago                   alpine4<br>df428caf7128    alpine     <span class="hljs-string">&quot;/bin/sh&quot;</span>     30 seconds ago       Up 28 seconds                              alpine3<br>6d64f47a83e6    alpine     <span class="hljs-string">&quot;/bin/sh&quot;</span>     48 seconds ago       Exited (0) 41 seconds ago                  alpine2<br>edd2ac2690e6    alpine     <span class="hljs-string">&quot;/bin/sh&quot;</span>     About a minute ago   Exited (0) About a minute ago              alpine1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -td --name alpine5 alpine</span><br>868b33da850cfcc7db8b84150fb9c7686b577889f10425bb4c5e17f28cf68a29<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED             STATUS                        PORTS        NAMES<br>868b33da850c    alpine       <span class="hljs-string">&quot;/bin/sh&quot;</span>     2 seconds ago       Up 1 second                                alpine5<br>3a05bbf66dac    alpine       <span class="hljs-string">&quot;/bin/sh&quot;</span>     23 seconds ago       Exited (0) 23 seconds ago                 alpine4<br>df428caf7128    alpine       <span class="hljs-string">&quot;/bin/sh&quot;</span>     50 seconds ago       Up 49 seconds                             alpine3<br>6d64f47a83e6    alpine       <span class="hljs-string">&quot;/bin/sh&quot;</span>     About a minute ago   Exited (0) About a minute ago             alpine2<br>edd2ac2690e6    alpine       <span class="hljs-string">&quot;/bin/sh&quot;</span>     About a minute ago   Exited (0) About a minute ago             alpine1<br></code></pre></td></tr></table></figure>

<p>范例: 开机自动运行容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#默认容器不会自动启动</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name nginx -p 80:80 nginx</span><br>bce473b8b1d2f728847cdc32b664cca1bd7578bf7bdac850b501e2e5557a718a<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID    IMAGE      COMMAND                 CREATED         STATUS           PORTS                      NAMES<br>bce473b8b1d2    nginx      <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  3 seconds ago   Up 2 seconds     0.0.0.0:80-&gt;80/tcp <br>[root@ubuntu1804 ~]<span class="hljs-comment">#reboot</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID    IMAGE    COMMAND   CREATED  STATUS    PORTS    NAMES<br> <br><span class="hljs-comment">#设置容器总是运行</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name nginx --restart=always -p 80:80 nginx</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#reboot</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED    STATUS                    PORTS               NAMES<br>dbdba90076e1   nginx     <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>   About      a minute agoUp 49seconds  0.0.0.0:80-&gt;80/tcp  nginx<br></code></pre></td></tr></table></figure>

<p><strong>–privileged 选项</strong><br>大约在0.6版，–privileged 选项被引入docker。使用该参数，container内的root拥有真正的root权限。<br>否则，container内的root只是外部的一个普通用户权限。privileged启动的容器，可以看到很多host上的设备，并且可以执行mount。甚至允许你在docker容器中启动docker容器。<br>范例: 使用–privileged 让容器获取 root 权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos8 ~]<span class="hljs-comment">#podman run -it  centos</span><br>[root@382ab09932a7 /]<span class="hljs-comment">#cat /etc/redhat-release</span><br>CentOS Linux release 8.1.1911 (Core)<br>[root@382ab09932a7 /]<span class="hljs-comment"># lsblk</span><br>NAME  MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br>sda    8:0   0 200G  0 disk<br>|-sda1  8:1   0  1G  0 part<br>|-sda2  8:2   0 100G  0 part<br>|-sda3  8:3   0  50G  0 part<br>|-sda4  8:4   0  1K  0 part<br>`-sda5  8:5  0  2G 0 part [SWAP]<br>sr0   11:0   1  7G  0 rom <br>[root@382ab09932a7 /]<span class="hljs-comment"># mount /dev/sda3 /mnt</span><br>mount: /mnt: permission denied.<br>[root@382ab09932a7 /]<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br><br><span class="hljs-comment">#利用--privileged 选项运行容器</span><br>[root@centos8 ~]<span class="hljs-comment">#podman run -it --privileged  centos</span><br><span class="hljs-comment">#可以看到宿主机的设备</span><br>[root@a6391a8f82e3 /]<span class="hljs-comment"># lsblk</span><br>NAME  MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br>sda    8:0   0 200G  0 disk<br>|-sda1  8:1   0  1G  0 part<br>|-sda2  8:2   0 100G  0 part<br>|-sda3  8:3   0  50G  0 part<br>|-sda4  8:4   0  1K  0 part<br>`-sda5  8:5  0  2G 0 part [SWAP]<br>sr0   11:0   1  7G  0 rom <br>[root@a6391a8f82e3 /]<span class="hljs-comment"># df</span><br>Filesystem   1K-blocks  Used Available Use% Mounted on<br>overlay     104806400 2754832 102051568  3% /<br>tmpfs        65536    0   65536  0% /dev<br>tmpfs       408092   5892   402200  2% /etc/hosts<br>shm         64000    0   64000  0% /dev/shm<br>tmpfs       408092    0   408092  0% /sys/fs/cgroup<br><br>[root@a6391a8f82e3 /]<span class="hljs-comment"># mount /dev/sda3 /mnt</span><br>[root@a6391a8f82e3 /]<span class="hljs-comment"># df</span><br>Filesystem   1K-blocks  Used Available Use% Mounted on<br>overlay     104806400 2754632 102051768  3% /<br>tmpfs        65536    0   65536  0% /dev<br>tmpfs       408092   5892   402200  2% /etc/hosts<br>shm         64000    0   64000  0% /dev/shm<br>tmpfs       408092    0   408092  0% /sys/fs/cgroup<br>/dev/sda3    52403200  619068  51784132  2% /mnt<br>[root@a6391a8f82e3 /]<span class="hljs-comment"># touch /mnt/containter.txt</span><br>[root@a6391a8f82e3 /]<span class="hljs-comment"># echo container data &gt; /mnt/containter.txt</span><br>[root@a6391a8f82e3 /]<span class="hljs-comment"># cat /mnt/containter.txt</span><br>container data<br>[root@a6391a8f82e3 /]<span class="hljs-comment">#</span><br><br><span class="hljs-comment">#在宿主机查看是否生成文件</span><br>[root@centos8 ~]<span class="hljs-comment">#lsblk</span><br>NAME  MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br>sda    8:0   0 200G  0 disk<br>├─sda1  8:1   0  1G  0 part /boot<br>├─sda2  8:2   0 100G  0 part /<br>├─sda3  8:3   0  50G  0 part /data<br>├─sda4  8:4   0  1K  0 part<br>└─sda5  8:5   0  2G  0 part [SWAP]<br>sr0   11:0   1  7G  0 rom<br>[root@centos8 ~]<span class="hljs-comment">#ll /data/containter.txt</span><br>-rw-r--r-- 1 root root 25 Feb 29 12:26 /data/containter.txt<br>[root@centos8 ~]<span class="hljs-comment">#cat /data/containter.txt</span><br>container data<br>[root@centos8 ~]<span class="hljs-comment">#echo host data &gt;&gt; /data/containter.txt</span><br>[root@centos8 ~]<span class="hljs-comment">#cat /data/containter.txt</span><br>container data<br>host data<br><br><span class="hljs-comment">#在容器内可看文件是否发生变化</span><br>[root@a6391a8f82e3 /]<span class="hljs-comment"># cat /mnt/containter.txt</span><br>container data<br>host data<br></code></pre></td></tr></table></figure>

<p>范例: 运行docker官方文档容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos8 ~]<span class="hljs-comment">#podman run -it -d -p 4000:4000 docs/docker.github.io:latest</span><br>[root@centos8 ~]<span class="hljs-comment">#podman images docs/docker.github.io</span><br>REPOSITORY            TAG   IMAGE ID    CREATED   SIZE<br>docker.io/docs/docker.github.io  latest  ffd9131eeee7  2 days ago  1.99 GB<br><span class="hljs-comment">#用浏览器访问http://localhost:4000/可以看到下面docker文档资料</span><br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker45.png" srcset="/blog/img/loading.gif"></p>
<h3 id="1-4-2-查看容器信息"><a href="#1-4-2-查看容器信息" class="headerlink" title="1.4.2 查看容器信息"></a>1.4.2 查看容器信息</h3><h4 id="1-4-2-1-显示当前存在容器"><a href="#1-4-2-1-显示当前存在容器" class="headerlink" title="1.4.2.1 显示当前存在容器"></a>1.4.2.1 显示当前存在容器</h4><p>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker ps [OPTIONS]<br>docker container ls [OPTIONS]<br>选项: <br>-a, --all       Show all containers (default shows just running)<br>-q, --quiet      Only display numeric IDs<br>-s, --size      Display total file sizes<br>-f, --filter filter  Filter output based on conditions provided<br>-l, --latest     Show the latest created container (includes all states)<br>-n, --last int    Show n last created containers (includes all states)<br>(default -1)<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#显示运行的容器</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps </span><br>CONTAINER ID    IMAGE        COMMAND         CREATED           STATUS            PORTS        NAMES<br>d7ece7f62532    centos       <span class="hljs-string">&quot;/bin/bash&quot;</span>     23 seconds ago    Up 22 seconds                  ecstatic_franklin<br><br><span class="hljs-comment">#显示全部容器，包括退出状态的容器</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND                 CREATED         STATUS                   PORTS        NAMES<br>d7ece7f62532    centos       <span class="hljs-string">&quot;/bin/bash&quot;</span>             27 seconds ago  Up 26 seconds                         ecstatic_franklin<br>dcdf71d17177    busybox      <span class="hljs-string">&quot;/bin/echo &#x27;hello wo…&quot;</span>  8 minutes ago   Exited (0) 8 minutes ago              cool_jepsen<br>  <br><span class="hljs-comment">#只显示容器ID</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a -q</span><br>d7ece7f62532<br>dcdf71d17177<br><br><span class="hljs-comment">#显示容器大小</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a -s</span><br>CONTAINER ID   IMAGE                          COMMAND                  CREATED          STATUS                      PORTS                                               NAMES             SIZE<br>c22237168192   centos                         <span class="hljs-string">&quot;/bin/bash&quot;</span>              18 seconds ago   Exited (0) 12 seconds ago                                                       romantic_carson   0B (virtual 209MB)<br>03a7466517b4   busybox                        <span class="hljs-string">&quot;sh&quot;</span>                     40 seconds ago   Exited (0) 38 seconds ago                                                       pensive_dirac     0B (virtual 1.24MB)<br><br><br><span class="hljs-comment">#显示最新创建的容器(停止的容器也能显示)</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -l</span><br></code></pre></td></tr></table></figure>

<p>范例: 显示指定状态的容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE     COMMAND                 CREATED         STATUS                       PORTS        NAMES<br>dd002f947cbe    nginx     <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  19 minutes ago  Exited (137) 11 minutes ago               nginx2<br>1f3f82995e05    nginx     <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  19 minutes ago  Up 2 minutes                 80/tcp       nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID    IMAGE        COMMAND                 CREATED         STATUS           PORTS        NAMES<br>1f3f82995e05    nginx        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  19 minutes ago  Up 2 minutes     80/tcp       nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -f &#x27;status=exited&#x27;</span><br>CONTAINER ID    IMAGE    COMMAND                 CREATED         STATUS                         PORTS        NAMES<br>dd002f947cbe    nginx    <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  19 minutes ago  Exited (137) 11 minutes ago                 nginx2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h4 id="1-4-2-2-查看容器内的进程"><a href="#1-4-2-2-查看容器内的进程" class="headerlink" title="1.4.2.2 查看容器内的进程"></a>1.4.2.2 查看容器内的进程</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker top CONTAINER [ps OPTIONS]<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d httpd</span><br>c9c3c5bd173c16f2ea5b3a60a481d64afac3382b25c3be526afbdecd1380ddbb<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker top db144f19</span><br>UID      PID     PPID     C     STIME     TTY     TIME         CMD<br>root     9821    9797     3     22:02     ?       00:00:00     httpd -DFOREGROUND<br>daemon   9872    9821     0     22:02     ?       00:00:00     httpd -DFOREGROUND<br>daemon   9873    9821     0     22:02     ?       00:00:00     httpd -DFOREGROUND<br>daemon   9874    9821     0     22:02     ?       00:00:00     httpd -DFOREGROUND<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d alpine /bin/sh -c &#x27;i=1;while true;do echo hello$i;let i++;sleep 1;done&#x27;</span><br>9997053f9766d4adf709d46161d7ec6739eacafbe8d4721133874b89112ad1a6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker top 9997</span><br>UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD<br>root                2977                2946                0                   15:00               ?                   00:00:00            /bin/sh -c i=1;<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>;<span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> hello<span class="hljs-variable">$i</span>;<span class="hljs-built_in">let</span> i++;sleep 1;<span class="hljs-keyword">done</span><br>root                3186                2977                0                   15:03               ?                   00:00:00            sleep 1<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h4 id="1-4-2-3-查看容器资源使用情况"><a href="#1-4-2-3-查看容器资源使用情况" class="headerlink" title="1.4.2.3 查看容器资源使用情况"></a>1.4.2.3 查看容器资源使用情况</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker stats [OPTIONS] [CONTAINER...]<br><br>Display a live stream of container(s) resource usage statistics<br><br>Options:<br>-a, --all       Show all containers (default shows just running)<br>  --format string  Pretty-print images using a Go template<br>  --no-stream    Disable streaming stats and only pull the first result<br>  --no-trunc    Do not truncate output<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker stats 251c7c7cf2aa</span><br>CONTAINER ID NAME    CPU %   MEM USAGE / LIMIT     MEM %      NETI/O     BLOCK I/O     PIDS<br>251c7c7cf2aa busy_l  0.00%   3.742MiB /  1.924GiB  0.19%  1.29kB / 0B    0B / 8.19kB   2<br>CONTAINER ID NAME    CPU %   MEM USAGE / LIMIT     MEM %      NET I/O    BLOCK I/O     PIDS<br>251c7c7cf2aa busy_l  0.00%   3.742MiB / 1.924GiB   0.19%   1.29kB / 0B   0B / 8.19kB   2<br> <br><span class="hljs-comment">#默认启动elasticsearch会使用较多的内存</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 10.0.0.100:9200</span><br>&#123;<br> <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;29282e91d773&quot;</span>,<br> <span class="hljs-string">&quot;cluster_name&quot;</span> : <span class="hljs-string">&quot;docker-cluster&quot;</span>,<br> <span class="hljs-string">&quot;cluster_uuid&quot;</span> : <span class="hljs-string">&quot;w5lp_XmITliWa2Yc-XwJFw&quot;</span>,<br> <span class="hljs-string">&quot;version&quot;</span> : &#123;<br>  <span class="hljs-string">&quot;number&quot;</span> : <span class="hljs-string">&quot;7.6.2&quot;</span>,<br>  <span class="hljs-string">&quot;build_flavor&quot;</span> : <span class="hljs-string">&quot;default&quot;</span>,<br>  <span class="hljs-string">&quot;build_type&quot;</span> : <span class="hljs-string">&quot;docker&quot;</span>,<br>  <span class="hljs-string">&quot;build_hash&quot;</span> : <span class="hljs-string">&quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;</span>,<br>  <span class="hljs-string">&quot;build_date&quot;</span> : <span class="hljs-string">&quot;2020-03-26T06:34:37.794943Z&quot;</span>,<br>  <span class="hljs-string">&quot;build_snapshot&quot;</span> : <span class="hljs-literal">false</span>,<br>  <span class="hljs-string">&quot;lucene_version&quot;</span> : <span class="hljs-string">&quot;8.4.0&quot;</span>,<br>  <span class="hljs-string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="hljs-string">&quot;6.8.0&quot;</span>,<br>  <span class="hljs-string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="hljs-string">&quot;6.0.0-beta1&quot;</span><br>&#125;,<br> <span class="hljs-string">&quot;tagline&quot;</span> : <span class="hljs-string">&quot;You Know, for Search&quot;</span><br>&#125;<br><br><span class="hljs-comment">#查看所有容器</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker stats</span><br>CONTAINER ID NAME   CPU %  MEM USAGE / LIMIT   MEM %    NET I/O     BLOCK I/O        PIDS<br>5e470e7970f6 suspi  0.00%  3.992MiB / 1.924Gi  0.20%    656B / 0B   9.2MB / 8.19kB   2<br>829bcebbc9f6 elast  0.58%  1.24GiB / 1.924GiB  64.43%   2.97kB /    512kB / 729kB    47<br><br><span class="hljs-comment">#限制内存使用大小</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx128m&quot; elasticsearch:7.6.2</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker stats</span><br>CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT    MEM %     NET I/O     BLOCK I/O    PIDS<br>d60f30d5f0d8   elasticsearch   0.24%     378.1MiB / 3.83GiB   9.64%     976B / 0B   0B / 729kB   47<br></code></pre></td></tr></table></figure>

<h4 id="1-4-2-4-查看容器的详细信息"><a href="#1-4-2-4-查看容器的详细信息" class="headerlink" title="1.4.2.4 查看容器的详细信息"></a>1.4.2.4 查看容器的详细信息</h4><p>docker inspect 可以查看docker各种对象的详细信息,包括:镜像,容器,网络等</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker inspect [OPTIONS] NAME|ID [NAME|ID...]<br>Options:<br>-f, --format    string  Format the output using the given Go template<br>-s, --size      Display total file sizes <span class="hljs-keyword">if</span> the <span class="hljs-built_in">type</span> is container<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect 9997</span><br>[<br> &#123;<br>    <span class="hljs-string">&quot;Id&quot;</span>:<br><span class="hljs-string">&quot;9997053f9766d4adf709d46161d7ec6739eacafbe8d4721133874b89112ad1a6&quot;</span>,<br>    <span class="hljs-string">&quot;Created&quot;</span>: <span class="hljs-string">&quot;2020-02-25T14:03:00.790597711Z&quot;</span>,<br>    <span class="hljs-string">&quot;Path&quot;</span>: <span class="hljs-string">&quot;/bin/sh&quot;</span>,<br>    <span class="hljs-string">&quot;Args&quot;</span>: [<br>      <span class="hljs-string">&quot;-c&quot;</span>,<br>      <span class="hljs-string">&quot;i=1;while true;do echo hello<span class="hljs-variable">$i</span>;let i++;sleep 1;done&quot;</span><br>   ],<br>    <span class="hljs-string">&quot;State&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;Status&quot;</span>: <span class="hljs-string">&quot;running&quot;</span>,<br>      <span class="hljs-string">&quot;Running&quot;</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-string">&quot;Paused&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;Restarting&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;OOMKilled&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;Dead&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;Pid&quot;</span>: 10023,<br>      <span class="hljs-string">&quot;ExitCode&quot;</span>: 0,<br>      <span class="hljs-string">&quot;Error&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;StartedAt&quot;</span>: <span class="hljs-string">&quot;2020-02-25T14:03:01.407282144Z&quot;</span>,<br>      <span class="hljs-string">&quot;FinishedAt&quot;</span>: <span class="hljs-string">&quot;0001-01-01T00:00:00Z&quot;</span><br>   &#125;,<br>    <span class="hljs-string">&quot;Image&quot;</span>:<br><span class="hljs-string">&quot;sha256:e7d92cdc71feacf90708cb59182d0df1b911f8ae022d29e8e95d75ca6a99776a&quot;</span>,<br>    <span class="hljs-string">&quot;ResolvConfPath&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/docker/containers/9997053f9766d4adf709d46161d7ec6739eacafbe8d4721133874b89112ad1a6/resolv.conf&quot;</span>,<br>    <span class="hljs-string">&quot;HostnamePath&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/docker/containers/9997053f9766d4adf709d46161d7ec6739eacafbe8d4721133874b89112ad1a6/hostname&quot;</span>,<br>    <span class="hljs-string">&quot;HostsPath&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/docker/containers/9997053f9766d4adf709d46161d7ec6739eacafbe8d4721133874b89112ad1a6/hosts&quot;</span>,<br>    <span class="hljs-string">&quot;LogPath&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/docker/containers/9997053f9766d4adf709d46161d7ec6739eacafbe8d4721133874b89112ad1a6/9997053f9766d4adf709d46161d7ec6739eacafbe8d4721133874b89112ad1a6-json.log&quot;</span>,<br>    <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;/gracious_wescoff&quot;</span>,<br>    <span class="hljs-string">&quot;RestartCount&quot;</span>: 0,<br>    <span class="hljs-string">&quot;Driver&quot;</span>: <span class="hljs-string">&quot;overlay2&quot;</span>,<br>    <span class="hljs-string">&quot;Platform&quot;</span>: <span class="hljs-string">&quot;linux&quot;</span>,<br>    <span class="hljs-string">&quot;MountLabel&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;ProcessLabel&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;AppArmorProfile&quot;</span>: <span class="hljs-string">&quot;docker-default&quot;</span>,<br>    <span class="hljs-string">&quot;ExecIDs&quot;</span>: null,<br>    <span class="hljs-string">&quot;HostConfig&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;Binds&quot;</span>: null,<br>      <span class="hljs-string">&quot;ContainerIDFile&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;LogConfig&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;Type&quot;</span>: <span class="hljs-string">&quot;json-file&quot;</span>,<br>        <span class="hljs-string">&quot;Config&quot;</span>: &#123;&#125;<br>     &#125;,<br>      <span class="hljs-string">&quot;NetworkMode&quot;</span>: <span class="hljs-string">&quot;default&quot;</span>,<br>      <span class="hljs-string">&quot;PortBindings&quot;</span>: &#123;&#125;,<br>      <span class="hljs-string">&quot;RestartPolicy&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;no&quot;</span>,<br>        <span class="hljs-string">&quot;MaximumRetryCount&quot;</span>: 0<br>     &#125;,<br>      <span class="hljs-string">&quot;AutoRemove&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;VolumeDriver&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;VolumesFrom&quot;</span>: null,<br>      <span class="hljs-string">&quot;CapAdd&quot;</span>: null,<br>      <span class="hljs-string">&quot;CapDrop&quot;</span>: null,<br>      <span class="hljs-string">&quot;Capabilities&quot;</span>: null,<br>      <span class="hljs-string">&quot;Dns&quot;</span>: [],<br>      <span class="hljs-string">&quot;DnsOptions&quot;</span>: [],<br>      <span class="hljs-string">&quot;DnsSearch&quot;</span>: [],<br>      <span class="hljs-string">&quot;ExtraHosts&quot;</span>: null,<br>      <span class="hljs-string">&quot;GroupAdd&quot;</span>: null,<br>      <span class="hljs-string">&quot;IpcMode&quot;</span>: <span class="hljs-string">&quot;private&quot;</span>,<br>      <span class="hljs-string">&quot;Cgroup&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;Links&quot;</span>: null,<br>      <span class="hljs-string">&quot;OomScoreAdj&quot;</span>: 0,<br>      <span class="hljs-string">&quot;PidMode&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;Privileged&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;PublishAllPorts&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;ReadonlyRootfs&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;SecurityOpt&quot;</span>: null,<br>      <span class="hljs-string">&quot;UTSMode&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;UsernsMode&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;ShmSize&quot;</span>: 67108864,<br>      <span class="hljs-string">&quot;Runtime&quot;</span>: <span class="hljs-string">&quot;runc&quot;</span>,<br>      <span class="hljs-string">&quot;ConsoleSize&quot;</span>: [<br>        0,<br>        0<br>     ],<br>      <span class="hljs-string">&quot;Isolation&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;CpuShares&quot;</span>: 0,<br>      <span class="hljs-string">&quot;Memory&quot;</span>: 0,<br>      <span class="hljs-string">&quot;NanoCpus&quot;</span>: 0,<br>      <span class="hljs-string">&quot;CgroupParent&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;BlkioWeight&quot;</span>: 0,<br>      <span class="hljs-string">&quot;BlkioWeightDevice&quot;</span>: [],<br>      <span class="hljs-string">&quot;BlkioDeviceReadBps&quot;</span>: null,<br>      <span class="hljs-string">&quot;BlkioDeviceWriteBps&quot;</span>: null,<br>      <span class="hljs-string">&quot;BlkioDeviceReadIOps&quot;</span>: null,<br>      <span class="hljs-string">&quot;BlkioDeviceWriteIOps&quot;</span>: null,<br>      <span class="hljs-string">&quot;CpuPeriod&quot;</span>: 0,<br>      <span class="hljs-string">&quot;CpuQuota&quot;</span>: 0,<br>      <span class="hljs-string">&quot;CpuRealtimePeriod&quot;</span>: 0,<br>      <span class="hljs-string">&quot;CpuRealtimeRuntime&quot;</span>: 0,<br>      <span class="hljs-string">&quot;CpusetCpus&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;CpusetMems&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;Devices&quot;</span>: [],<br>      <span class="hljs-string">&quot;DeviceCgroupRules&quot;</span>: null,<br>      <span class="hljs-string">&quot;DeviceRequests&quot;</span>: null,<br>      <span class="hljs-string">&quot;KernelMemory&quot;</span>: 0,<br>      <span class="hljs-string">&quot;KernelMemoryTCP&quot;</span>: 0,<br>      <span class="hljs-string">&quot;MemoryReservation&quot;</span>: 0,<br>      <span class="hljs-string">&quot;MemorySwap&quot;</span>: 0,<br>      <span class="hljs-string">&quot;MemorySwappiness&quot;</span>: null,<br>      <span class="hljs-string">&quot;OomKillDisable&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;PidsLimit&quot;</span>: null,<br>      <span class="hljs-string">&quot;Ulimits&quot;</span>: null,<br>      <span class="hljs-string">&quot;CpuCount&quot;</span>: 0,<br>      <span class="hljs-string">&quot;CpuPercent&quot;</span>: 0,<br>      <span class="hljs-string">&quot;IOMaximumIOps&quot;</span>: 0,<br>      <span class="hljs-string">&quot;IOMaximumBandwidth&quot;</span>: 0,<br>      <span class="hljs-string">&quot;MaskedPaths&quot;</span>: [<br>        <span class="hljs-string">&quot;/proc/asound&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/acpi&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/kcore&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/keys&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/latency_stats&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/timer_list&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/timer_stats&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/sched_debug&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/scsi&quot;</span>,<br>        <span class="hljs-string">&quot;/sys/firmware&quot;</span><br>     ],<br>      <span class="hljs-string">&quot;ReadonlyPaths&quot;</span>: [<br>        <span class="hljs-string">&quot;/proc/bus&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/fs&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/irq&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/sys&quot;</span>,<br>        <span class="hljs-string">&quot;/proc/sysrq-trigger&quot;</span><br>     ]<br>   &#125;,<br>    <span class="hljs-string">&quot;GraphDriver&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;Data&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;LowerDir&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/docker/overlay2/27f7bf9c29a0303e2526bd7fa7d61fcc3a2ef400e6948b5d9487b5b30f506853-init/diff:/var/lib/docker/overlay2/cb3f60a3d09e0555d06525b70cc30975a3cb70e23c87e7e46bd44b6cfffbcda0/diff&quot;</span>,<br>        <span class="hljs-string">&quot;MergedDir&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/docker/overlay2/27f7bf9c29a0303e2526bd7fa7d61fcc3a2ef400e6948b5d9487b5b30f506853/merged&quot;</span>,<br>        <span class="hljs-string">&quot;UpperDir&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/docker/overlay2/27f7bf9c29a0303e2526bd7fa7d61fcc3a2ef400e6948b5d9487b5b30f506853/diff&quot;</span>,<br>        <span class="hljs-string">&quot;WorkDir&quot;</span>:<br><span class="hljs-string">&quot;/var/lib/docker/overlay2/27f7bf9c29a0303e2526bd7fa7d61fcc3a2ef400e6948b5d9487b5b30f506853/work&quot;</span><br>     &#125;,<br>      <span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;overlay2&quot;</span><br>   &#125;,<br>    <span class="hljs-string">&quot;Mounts&quot;</span>: [],<br>    <span class="hljs-string">&quot;Config&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;Hostname&quot;</span>: <span class="hljs-string">&quot;9997053f9766&quot;</span>,<br>      <span class="hljs-string">&quot;Domainname&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;User&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;AttachStdin&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;AttachStdout&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;AttachStderr&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;Tty&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;OpenStdin&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;StdinOnce&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;Env&quot;</span>: [<br>      <br> <span class="hljs-string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br>     ],<br>      <span class="hljs-string">&quot;Cmd&quot;</span>: [<br>        <span class="hljs-string">&quot;/bin/sh&quot;</span>,<br>        <span class="hljs-string">&quot;-c&quot;</span>,<br>        <span class="hljs-string">&quot;i=1;while true;do echo hello<span class="hljs-variable">$i</span>;let i++;sleep 1;done&quot;</span><br>     ],<br>      <span class="hljs-string">&quot;Image&quot;</span>: <span class="hljs-string">&quot;alpine&quot;</span>,<br>      <span class="hljs-string">&quot;Volumes&quot;</span>: null,<br>      <span class="hljs-string">&quot;WorkingDir&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;Entrypoint&quot;</span>: null,<br>      <span class="hljs-string">&quot;OnBuild&quot;</span>: null,<br>      <span class="hljs-string">&quot;Labels&quot;</span>: &#123;&#125;<br>   &#125;,<br>    <span class="hljs-string">&quot;NetworkSettings&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;Bridge&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;SandboxID&quot;</span>:<br><span class="hljs-string">&quot;4823297a262eaad3b63778c2fe04a74e38ce401c22404f05f3cf54ab7dc188e2&quot;</span>,<br>      <span class="hljs-string">&quot;HairpinMode&quot;</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-string">&quot;LinkLocalIPv6Address&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;LinkLocalIPv6PrefixLen&quot;</span>: 0,<br>      <span class="hljs-string">&quot;Ports&quot;</span>: &#123;&#125;,<br>      <span class="hljs-string">&quot;SandboxKey&quot;</span>: <span class="hljs-string">&quot;/var/run/docker/netns/4823297a262e&quot;</span>,<br>      <span class="hljs-string">&quot;SecondaryIPAddresses&quot;</span>: null,<br>      <span class="hljs-string">&quot;SecondaryIPv6Addresses&quot;</span>: null,<br>      <span class="hljs-string">&quot;EndpointID&quot;</span>:<br><span class="hljs-string">&quot;019896bd99c9e158ef9f97b1617f1638fee94c7f92c9250e1ac1bfe58c97c911&quot;</span>,<br>      <span class="hljs-string">&quot;Gateway&quot;</span>: <span class="hljs-string">&quot;172.17.0.1&quot;</span>,<br>      <span class="hljs-string">&quot;GlobalIPv6Address&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,<br>      <span class="hljs-string">&quot;IPAddress&quot;</span>: <span class="hljs-string">&quot;172.17.0.3&quot;</span>,<br>      <span class="hljs-string">&quot;IPPrefixLen&quot;</span>: 16,<br>      <span class="hljs-string">&quot;IPv6Gateway&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>      <span class="hljs-string">&quot;MacAddress&quot;</span>: <span class="hljs-string">&quot;02:42:ac:11:00:03&quot;</span>,<br>      <span class="hljs-string">&quot;Networks&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;bridge&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;IPAMConfig&quot;</span>: null,<br>          <span class="hljs-string">&quot;Links&quot;</span>: null,<br>          <span class="hljs-string">&quot;Aliases&quot;</span>: null,<br>          <span class="hljs-string">&quot;NetworkID&quot;</span>:<br><span class="hljs-string">&quot;d407310ec8ff57a6623ae2fa01ba860ab0615135585a00b19f0751561c99ab16&quot;</span>,<br>          <span class="hljs-string">&quot;EndpointID&quot;</span>:<br><span class="hljs-string">&quot;019896bd99c9e158ef9f97b1617f1638fee94c7f92c9250e1ac1bfe58c97c911&quot;</span>,<br>          <span class="hljs-string">&quot;Gateway&quot;</span>: <span class="hljs-string">&quot;172.17.0.1&quot;</span>,<br>          <span class="hljs-string">&quot;IPAddress&quot;</span>: <span class="hljs-string">&quot;172.17.0.3&quot;</span>,<br>          <span class="hljs-string">&quot;IPPrefixLen&quot;</span>: 16,<br>          <span class="hljs-string">&quot;IPv6Gateway&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>          <span class="hljs-string">&quot;GlobalIPv6Address&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>          <span class="hljs-string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,<br>          <span class="hljs-string">&quot;MacAddress&quot;</span>: <span class="hljs-string">&quot;02:42:ac:11:00:03&quot;</span>,<br>          <span class="hljs-string">&quot;DriverOpts&quot;</span>: null<br>       &#125;<br>     &#125;<br>   &#125;<br> &#125;<br>]<br><br><span class="hljs-comment">#选择性查看</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect -f &quot;&#123;&#123;.Metadata&#125;&#125;&quot; test:v1.0 </span><br>&#123;2020-07-24 21:56:42.247448035 +0800 CST&#125;<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect -f &quot;&#123;&#123;.Created&#125;&#125;&quot; c1</span><br>2020-07-24T13:37:11.006574248Z<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect --format &quot;&#123;&#123;.Created&#125;&#125;&quot; c1</span><br>2020-07-24T13:37:11.006574248Z<br></code></pre></td></tr></table></figure>

<h3 id="1-4-3-删除容器"><a href="#1-4-3-删除容器" class="headerlink" title="1.4.3 删除容器"></a>1.4.3 删除容器</h3><p>docker rm 可以删除容器，即使容器正在运行当中，也可以被强制删除掉</p>
<p>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker rm [OPTIONS] CONTAINER [CONTAINER...]<br>docker container rm [OPTIONS] CONTAINER [CONTAINER...]<br><br><span class="hljs-comment">#选项: </span><br>-f, --force    Force the removal of a running container (uses SIGKILL)<br>-v, --volumes  Remove the volumes associated with the container<br><br><span class="hljs-comment">#删除停止的容器</span><br>docker container prune [OPTIONS]<br>Options:<br>     --filter     filter  Provide filter values (e.g. <span class="hljs-string">&#x27;until=&lt;timestamp&gt;&#x27;</span>)<br> -f, --force      Do not prompt <span class="hljs-keyword">for</span> confirmation<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE         COMMAND        CREATED         STATUS           PORTS        NAMES<br>868b33da850c    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      2 minutes ago   Up 2 minutes                  alpine5<br>3a05bbf66dac    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      3 minutes ago   Exited (0) 3 minutes ago            alpine4<br>df428caf7128    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      3 minutes ago   Up 3 minutes                  alpine3<br>6d64f47a83e6    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      3 minutes ago   Exited (0) 3 minutes ago            alpine2<br>edd2ac2690e6    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      4 minutes ago   Exited (0) 4 minutes ago            alpine1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm 3a05bbf66dac</span><br>3a05bbf66dac<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm alpine5</span><br>Error response from daemon: You cannot remove a running container<br>868b33da850cfcc7db8b84150fb9c7686b577889f10425bb4c5e17f28cf68a29. Stop the<br>container before attempting removal or force remove<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm -f alpine5</span><br>alpine5<br></code></pre></td></tr></table></figure>

<p>范例: 删除所有容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED      <br>STATUS           PORTS        NAMES<br>df428caf7128    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      4 minutes ago   <br>Up 4 minutes                  alpine3<br>6d64f47a83e6    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      4 minutes ago   <br>Exited (0) 4 minutes ago            alpine2<br>edd2ac2690e6    alpine        <span class="hljs-string">&quot;/bin/sh&quot;</span>      5 minutes ago   <br>Exited (0) 5 minutes ago            alpine1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm -f `docker ps -a -q`</span><br>df428caf7128<br>6d64f47a83e6<br>edd2ac2690e6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED     <br>STATUS       PORTS        NAMES<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a -q | xargs docker rm -f</span><br></code></pre></td></tr></table></figure>

<p>范例: 删除指定状态的容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE     COMMAND                 CREATED         STATUS                PORTS        NAMES<br>dd002f947cbe    nginx     <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  22 minutes ago  Exited (137) 14 minutes ago        nginx2<br>1f3f82995e05    nginx     <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  22 minutes ago  Up 4 minutes          80/tcp       nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm `docker ps -aqf status=exited`</span><br>dd002f947cbe<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE      COMMAND                 CREATED         STATUS           PORTS        NAMES<br>1f3f82995e05    nginx      <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  22 minutes ago  Up 4 minutes     80/tcp       nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>范例: 删除所有停止的容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ubuntu1804:~<span class="hljs-comment"># docker ps -a</span><br>CONTAINER ID   IMAGE          COMMAND                  CREATED              STATUS                            PORTS      NAMES<br>506cdccf09d7   httpd          <span class="hljs-string">&quot;httpd-foreground&quot;</span>       13 seconds ago       Up 9 seconds                      80/tcp     sharp_robinson<br>f91cdabcc088   tomcat         <span class="hljs-string">&quot;catalina.sh run&quot;</span>        31 seconds ago       Up 29 seconds                     8080/tcp   modest_bartik<br>4042d8014dd7   tomcat         <span class="hljs-string">&quot;catalina.sh run&quot;</span>        About a minute ago   Exited (130) About a minute ago              elegant_keldysh<br>7288cc821fa6   centos         <span class="hljs-string">&quot;/bin/bash&quot;</span>              2 minutes ago        Exited (0) 2 minutes ago                     sweet_agnesi<br>430fbfe8c1e2   alpine         <span class="hljs-string">&quot;/bin/sh&quot;</span>                3 minutes ago        Exited (0) 3 minutes ago                     nervous_euclid<br>d60f30d5f0d8   f29a1ee41030   <span class="hljs-string">&quot;/usr/local/bin/dock…&quot;</span>   16 minutes ago       Exited (143) 6 minutes ago                   elasticsearch<br>root@ubuntu1804:~<span class="hljs-comment"># docker container prune -f</span><br>Deleted Containers:<br>4042d8014dd774c624cbc48ac051584569414e8a8f7b869f9bdc849ae58b8b00<br>7288cc821fa6d5406835eb02391514dd445de475d83c8e7fd41dc0b98b844362<br>430fbfe8c1e2169f66c3e00a57bea113ac16faebd44bfa2e0c27aac2d03f5313<br>d60f30d5f0d88de9f68a324ca2b1929d63a879118fd3aef251971992b3174554<br><br>Total reclaimed space: 246.8kB<br>root@ubuntu1804:~<span class="hljs-comment"># docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND              CREATED              STATUS              PORTS      NAMES<br>506cdccf09d7   httpd     <span class="hljs-string">&quot;httpd-foreground&quot;</span>   About a minute ago   Up About a minute   80/tcp     sharp_robinson<br>f91cdabcc088   tomcat    <span class="hljs-string">&quot;catalina.sh run&quot;</span>    2 minutes ago        Up 2 minutes        8080/tcp   modest_bartik<br><br></code></pre></td></tr></table></figure>

<h3 id="1-4-4-容器的启动和停止"><a href="#1-4-4-容器的启动和停止" class="headerlink" title="1.4.4 容器的启动和停止"></a>1.4.4 容器的启动和停止</h3><p>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">docker start|stop|restart|pause|unpause 容器ID<br></code></pre></td></tr></table></figure>

<p>批量正常启动或关闭所有容器</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">docker start $(docker ps -a -q) <br>docker stop $(docker ps -a -q) <br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name nginx1 nginx</span><br>8d9342b35589b72c3f7f01f4d9fe8797e974cda8ba28d2bac69ee578aa592ca2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND         CREATED      STATUS       PORTS        NAMES<br>8d9342b35589    nginx        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  5 seconds ago   Up 4 seconds     80/tcp       nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker stop nginx1</span><br>nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND                 CREATED         STATUS                      PORTS        NAMES<br>8d9342b35589    nginx        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  15 seconds ago  Exited (0) 2 seconds ago                 nginx1<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker start nginx1</span><br>nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND                 CREATED         STATUS          PORTS        NAMES<br>8d9342b35589    nginx        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  21 seconds ago  Up 1 second     80/tcp       nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker restart nginx1</span><br>nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND                 CREATED         STATUS          PORTS        NAMES<br>8d9342b35589    nginx        <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>  30 seconds ago  Up 1 second     80/tcp       nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>范例: 启动并进入容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run --name=c1 -it ubuntu bash</span><br>root@539722b55b76:/<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -l</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED         STATUS                     PORTS        NAMES<br>539722b55b76    ubuntu       <span class="hljs-string">&quot;bash&quot;</span>        4 seconds ago   Exited (0) 1 second ago                 c1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker start c1</span><br>c1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -l</span><br>CONTAINER ID    IMAGE        COMMAND         CREATED         STATUS             PORTS        NAMES<br>539722b55b76    ubuntu       <span class="hljs-string">&quot;bash&quot;</span>          18 seconds ago  Up 2 seconds                    c1<br>  <br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker stop c1</span><br>c1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -l</span><br>CONTAINER ID    IMAGE        COMMAND         CREATED         STATUS                   PORTS        NAMES<br>539722b55b76    ubuntu       <span class="hljs-string">&quot;bash&quot;</span>          43 seconds ago  Exited (0) 1 second ago               c1<br><br><span class="hljs-comment">#启动并进入容器</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker start -i c1</span><br>root@539722b55b76:/<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -l</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED      <br>STATUS           PORTS        NAMES<br>539722b55b76    ubuntu        <span class="hljs-string">&quot;bash&quot;</span>        4 minutes ago   <br>Exited (0) 5 seconds ago            c1<br></code></pre></td></tr></table></figure>

<p>范例: 启动和停止所有容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker rm -f `docker ps -a -q`</span><br>b722c745406c<br>8d9342b35589<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name nginx1 nginx </span><br>1f3f82995e052647678fd27bfa27a5b5615efc129270698cbaac3120544d6609<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name nginx2 nginx </span><br>dd002f947cbe786ac0e834e06744337556f82d5850f4b16e01f12b9b3759f83e<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES<br>1f3f82995e05   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   5 seconds ago    Up 4 seconds    80/tcp    nginx2<br>dd002f947cbe   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   14 seconds ago   Up 12 seconds   80/tcp    nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker stop `docker ps -a -q`</span><br>dd002f947cbe<br>1f3f82995e05<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a  </span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS                     PORTS     NAMES<br>dd002f947cbe   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   2 minutes ago   Exited (0) 7 seconds ago             nginx2<br>1f3f82995e05   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   2 minutes ago   Exited (0) 7 seconds ago             nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker start `docker ps -a -q`</span><br>dd002f947cbe<br>1f3f82995e05<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES<br>dd002f947cbe   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   3 minutes ago   Up 6 seconds   80/tcp    nginx2<br>3856440d7c21   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   3 minutes ago   Up 6 seconds   80/tcp    nginx1<br></code></pre></td></tr></table></figure>

<p>范例: 暂停和恢复容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d --name n1 nginx</span><br>48a8278f5df1d0b0c2c42c01d4e53d335df7e3e866fc7b68563cc2ac545fc07d<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker top n1</span><br>UID       PID       PPID      C         STIME     TTY       TIME      CMD<br>root      4122      4092      2         11:08     ?         00:00:00  nginx: master process nginx -g daemon off;<br>systemd+  4191      4122      0         11:08     ?         00:00:00  nginx: worker process<br>systemd+  4192      4122      0         11:08     ?         00:00:00  nginx: worker process<br>systemd+  4193      4122      0         11:08     ?         00:00:00  nginx: worker process<br>systemd+  4194      4122      0         11:08     ?         00:00:00  nginx: worker process<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ps aux|grep nginx</span><br>root       4122  0.0  0.1  10652  5964 ?        Ss   11:08   0:00 nginx: master process nginx -g daemon off;<br>systemd+   4191  0.0  0.0  11088  2552 ?        S    11:08   0:00 nginx: worker process<br>systemd+   4192  0.0  0.0  11088  2544 ?        S    11:08   0:00 nginx: worker process<br>systemd+   4193  0.0  0.0  11088  2544 ?        S    11:08   0:00 nginx: worker process<br>systemd+   4194  0.0  0.0  11088  2552 ?        S    11:08   0:00 nginx: worker process<br>root       4233  0.0  0.0  14436  1008 pts/0    S+   11:12   0:00 grep --color=auto nginx<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker pause n1</span><br>n1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID    IMAGE    COMMAND                 CREATED         STATUS                 PORTS        NAMES<br>48a8278f5df1    nginx    <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>  3 minutes ago   Up 3 minutes (Paused)  80/tcp       n1<br>  <br>[root@ubuntu1804 ~]<span class="hljs-comment">#ps aux|grep nginx</span><br>root       4122  0.0  0.1  10652  5964 ?        Ds   11:08   0:00 nginx: master process nginx -g daemon off;<br>systemd+   4191  0.0  0.0  11088  2552 ?        D    11:08   0:00 nginx: worker process<br>systemd+   4192  0.0  0.0  11088  2544 ?        D    11:08   0:00 nginx: worker process<br>systemd+   4193  0.0  0.0  11088  2544 ?        D    11:08   0:00 nginx: worker process<br>systemd+   4194  0.0  0.0  11088  2552 ?        D    11:08   0:00 nginx: worker process<br>root       4259  0.0  0.0  14436  1044 pts/0    S+   11:13   0:00 grep --color=auto nginx<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker unpause n1</span><br>n1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#ps aux|grep nginx</span><br>root       4122  0.0  0.1  10652  5964 ?        Ss   11:08   0:00 nginx: master process nginx -g daemon off;<br>systemd+   4191  0.0  0.0  11088  2552 ?        S    11:08   0:00 nginx: worker process<br>systemd+   4192  0.0  0.0  11088  2544 ?        S    11:08   0:00 nginx: worker process<br>systemd+   4193  0.0  0.0  11088  2544 ?        S    11:08   0:00 nginx: worker process<br>systemd+   4194  0.0  0.0  11088  2552 ?        S    11:08   0:00 nginx: worker process<br>root       4301  0.0  0.0  14436  1120 pts/0    S+   11:13   0:00 grep --color=auto nginx<br></code></pre></td></tr></table></figure>

<p>范例: 容器的暂停和恢复</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -itd centos</span><br>708bedcbd31be0ecac11aa21a7d15718d440e4bf65e3e6a8670f7391de21f301<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a      </span><br>CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES<br>708bedcbd31b   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>   5 seconds ago   Up 4 seconds             blissful_payne<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker pause  blissful_payne</span><br>blissful_payne<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a #在STATUS里会表明是暂停</span><br>CONTAINER ID   IMAGE     COMMAND       CREATED              STATUS                       PORTS     NAMES<br>708bedcbd31b   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>   About a minute ago   Up About a minute (Paused)             blissful_payne<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker unpause blissful_payne</span><br>blissful_payne<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES<br>708bedcbd31b   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>   5 seconds ago   Up 4 seconds             blissful_payne<br></code></pre></td></tr></table></figure>

<h3 id="1-4-5-给正在运行的容器发信号"><a href="#1-4-5-给正在运行的容器发信号" class="headerlink" title="1.4.5 给正在运行的容器发信号"></a>1.4.5 给正在运行的容器发信号</h3><p>docker kill 可以给容器发信号,默认号SIGKILL,即9信号</p>
<p>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">kill</span> [OPTIONS] CONTAINER [CONTAINER...]<br><br><span class="hljs-comment">#选项:</span><br>-s, --signal string  Signal to send to the container (default <span class="hljs-string">&quot;KILL&quot;</span>)<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES<br>b26878082682   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   39 seconds ago   Up 38 seconds   80/tcp    nginx2<br>dc480f7768ce   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   46 seconds ago   Up 45 seconds   80/tcp    nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker kill nginx1</span><br>nginx1<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED              STATUS                       PORTS     NAMES<br>b26878082682   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   58 seconds ago       Up 57 seconds                80/tcp    nginx2<br>dc480f7768ce   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   About a minute ago   Exited (137) 3 seconds ago             nginx1<br></code></pre></td></tr></table></figure>

<p>范例: 关闭所有容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED              STATUS              PORTS     NAMES<br>b26878082682   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   About a minute ago   Up About a minute   80/tcp    nginx2<br>dc480f7768ce   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   About a minute ago   Up 3 seconds        80/tcp    nginx1<br><br><span class="hljs-comment">#强制关闭所有运行中的容器</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker kill `docker ps -a -q`</span><br>dd002f947cbe<br>1f3f82995e05<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS                       PORTS     NAMES<br>b26878082682   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   2 minutes ago   Exited (137) 4 seconds ago             nginx2<br>dc480f7768ce   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   2 minutes ago   Exited (137) 4 seconds ago             nginx1<br></code></pre></td></tr></table></figure>

<h3 id="1-4-6-进入正在运行的容器"><a href="#1-4-6-进入正在运行的容器" class="headerlink" title="1.4.6 进入正在运行的容器"></a>1.4.6 进入正在运行的容器</h3><h4 id="1-4-6-1-使用attach命令"><a href="#1-4-6-1-使用attach命令" class="headerlink" title="1.4.6.1 使用attach命令"></a>1.4.6.1 使用attach命令</h4><p>docker attach 容器名，attach 类似于vnc，<strong>操作会在同一个容器的多个会话界面同步显示，所有使用此方式进入容器的操作都是同步显示的，且使用exit退出后容器自动关闭</strong>，不推荐使用，需要进入到有shell环境的容器</p>
<p>格式:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http">docker attach [OPTIONS] CONTAINER<br><br><span class="hljs-attribute">Usage</span><span class="hljs-punctuation">: </span> docker attach [OPTIONS] CONTAINER<br><br>Attach local standard input, output, and error streams to a running container<br><br><span class="hljs-attribute">Options</span>:<br>      --detach-keys string   Override the key sequence for detaching a container<br>      --no-stdin             Do not attach STDIN<br>      --sig-proxy            Proxy all received signals to the process (default true)<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ubuntu1804:~<span class="hljs-comment"># docker run -it centos</span><br>[root@2e3e6cff3aad /]<span class="hljs-comment"># cat /etc/redhat-release </span><br>CentOS Linux release 8.3.2011<br>[root@2e3e6cff3aad /]<span class="hljs-comment"># cat /etc/redhat-release root@ubuntu1804:~# docker ps </span><br>CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES<br>2e3e6cff3aad   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>   23 seconds ago   Up 22 seconds             admiring_lewin<br>root@ubuntu1804:~<span class="hljs-comment"># docker attach 2e3e</span><br>[root@2e3e6cff3aad /]<span class="hljs-comment"># cat /etc/redhat-release cat /etc/redhat-release </span><br>CentOS Linux release 8.3.2011<br><br><span class="hljs-comment">#同时在第二个终端attach到同一个容器，执行命令，可以在前一终端看到显示图面是同步的</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker attach 94a5</span><br>[root@2e3e6cff3aad /]<span class="hljs-comment"># cat /etc/redhat-release </span><br>CentOS Linux release 8.3.2011<br>[root@92a8279611a9 /]<span class="hljs-comment"># exit #两个终端都同时退出</span><br><span class="hljs-built_in">exit</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND       CREATED              STATUS                      PORTS     NAMES<br>2e3e6cff3aad   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>   About a minute ago   Exited (0) 17 seconds ago             admiring_lewin<br></code></pre></td></tr></table></figure>

<h4 id="1-4-6-2-使用exec命令"><a href="#1-4-6-2-使用exec命令" class="headerlink" title="1.4.6.2 使用exec命令"></a>1.4.6.2 使用exec命令</h4><p>在运行中的容器启动新进程,可以执行单次命令，以及进入容器测试环境使用此方式，使用exit退出,但容器还在运行，此为推荐方式</p>
<p>格式:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> [OPTIONS] CONTAINER COMMAND [ARG...]<br>常用选项: <br>-d, --detach        Detached mode: run <span class="hljs-built_in">command</span> <span class="hljs-keyword">in</span> the background<br>-e, --env list       Set environment variables<br>-i, --interactive     Keep STDIN open even <span class="hljs-keyword">if</span> not attached<br>-t, --tty         Allocate a pseudo-TTY<br><br><span class="hljs-comment">#常见用法</span><br>docker <span class="hljs-built_in">exec</span> -it 容器ID sh|bash<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -itd centos</span><br>90f3bbc24fc428d0eb0bd6742ad64aadb45b852aa9c75841274046cf72f7fde2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES<br>90f3bbc24fc4   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>   15 seconds ago   Up 13 seconds             angry_jang<br><span class="hljs-comment">#执行一次性命令</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec 90f3 cat /etc/redhat-release</span><br>CentOS Linux release 8.3.2011<br><br><span class="hljs-comment">#进入容器，执行命令，exit退出但容器不停止</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it 90f3 bash</span><br>[root@90f3bbc24fc4 /]<span class="hljs-comment"># cat /etc/redhat-release </span><br>CentOS Linux release 8.3.2011<br>[root@90f3bbc24fc4 /]<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES<br>90f3bbc24fc4   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>   2 minutes ago   Up 2 minutes             angry_jang<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h4 id="1-4-6-3-使用nsenter命令"><a href="#1-4-6-3-使用nsenter命令" class="headerlink" title="1.4.6.3 使用nsenter命令"></a>1.4.6.3 使用nsenter命令</h4><p>nsenter命令需要通过PID进入到容器内部，且退出后仍然正常运行: 不过需要事先使用docker inspect获取到容器的PID， 目前此方式使用较少，此工具来自于util-linux包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#安装nsenter命令</span><br>yum -y install util-linux <span class="hljs-comment">#CentOS</span><br>apt -y install util-linux <span class="hljs-comment">#Ubuntu</span><br><br><span class="hljs-comment">#获取容器的IP</span><br>docker inspect -f <span class="hljs-string">&quot;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&quot;</span> 容器ID<br><br><span class="hljs-comment">#获取到某个docker容器的PID，可以通过PID进入到容器内</span><br>docker inspect -f <span class="hljs-string">&quot;&#123;&#123;.State.Pid&#125;&#125;&quot;</span> 容器ID<br>nsenter -t PID -m -u -i -n -p<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES<br>790e105a71bd   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>   5 seconds ago   Up 4 seconds             condescending_feynman<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect -f &#123;&#123;.State&#125;&#125; 790e105a71bd</span><br>&#123;running <span class="hljs-literal">true</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> 3008 0  2021-06-27T08:38:03.034015678Z 0001-01-01T00:00:00Z &lt;nil&gt;&#125;<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect -f &#123;&#123;.State.Status&#125;&#125; 790e105a71bd</span><br>running<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker inspect -f &#123;&#123;.State.Pid&#125;&#125; 790e105a71bd</span><br>3008<br>[root@ubuntu1804 ~]<span class="hljs-comment">#nsenter -t 3008 -m -u -i -n -p</span><br>[root@790e105a71bd /]<span class="hljs-comment"># ps aux</span><br>USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND<br>root          1  0.1  0.0  12024  3152 pts/0    Ss+  08:38   0:00 /bin/bash<br>root         17  0.0  0.0  12024  3220 pts/0    S    08:40   0:00 -bash<br>root         30  0.0  0.0  44632  3340 pts/0    R+   08:40   0:00 ps aux<br>[root@ba792a7e0747 /]<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">logout</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES<br>790e105a71bd   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>   2 minutes ago   Up 2 minutes             condescending_feynman<br></code></pre></td></tr></table></figure>

<h4 id="1-4-6-4-脚本方式"><a href="#1-4-6-4-脚本方式" class="headerlink" title="1.4.6.4 脚本方式"></a>1.4.6.4 脚本方式</h4><p>将nsenter命令写入到脚本进行调用，方便进入容器看日志或排错</p>
<p>如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">cat docker-in.sh<br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-function"><span class="hljs-title">docker_in</span></span>()&#123;<br> NAME_ID=<span class="hljs-variable">$1</span><br> PID=$(docker inspect -f <span class="hljs-string">&quot;&#123;&#123;.State.Pid&#125;&#125;&quot;</span> <span class="hljs-variable">$&#123;NAME_ID&#125;</span>)<br> nsenter -t <span class="hljs-variable">$&#123;PID&#125;</span> -m -u -i -n -p<br>&#125;<br><br>docker_in <span class="hljs-variable">$1</span><br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#vim docker-in.sh</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat docker-in.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-function"><span class="hljs-title">docker_in</span></span>()&#123;<br> NAME_ID=<span class="hljs-variable">$1</span><br> PID=$(docker inspect -f <span class="hljs-string">&quot;&#123;&#123;.State.Pid&#125;&#125;&quot;</span> <span class="hljs-variable">$&#123;NAME_ID&#125;</span>)<br> nsenter -t <span class="hljs-variable">$&#123;PID&#125;</span> -m -u -i -n -p<br>&#125;<br><br>docker_in <span class="hljs-variable">$1</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#chmod +x docker-in.sh</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES<br>790e105a71bd   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>   4 minutes ago   Up 4 minutes             condescending_feynman<br>[root@ubuntu1804 ~]<span class="hljs-comment">#./docker-in.sh 790e105a71bd</span><br>[root@790e105a71bd /]<span class="hljs-comment"># cat /etc/redhat-release </span><br>CentOS Linux release 8.3.2011<br>[root@790e105a71bd /]<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">logout</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES<br>790e105a71bd   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>   6 minutes ago   Up 6 minutes             condescending_feynman<br></code></pre></td></tr></table></figure>

<h3 id="1-4-7-暴露所有容器端口"><a href="#1-4-7-暴露所有容器端口" class="headerlink" title="1.4.7 暴露所有容器端口"></a>1.4.7 暴露所有容器端口</h3><p>容器启动后,默认处于预定义的NAT网络中,所以外部网络的主机无法直接访问容器中网络服务<strong>docker run -P</strong> 可以将事先容器预定义的所有端口映射宿主机的网卡的随机端口，默认从32768开始</p>
<p>使用随机端口时,当停止容器后再启动可能会导致端口发生变化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">-P , --publish-all= <span class="hljs-literal">true</span> | <span class="hljs-literal">false</span>默认为<span class="hljs-literal">false</span><br><br><span class="hljs-comment">#示例:</span><br>docker run -P docker.io/nginx  <span class="hljs-comment">#映射容器所有暴露端口至随机本地端口</span><br></code></pre></td></tr></table></figure>

<p><strong>docker port</strong> 可以查看容器的端口映射关系<br>格式</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">docker port CONTAINER [PRIVATE_PORT[/PROTO]]<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#docker port nginx-c1</span><br>443/tcp -&gt; 0.0.0.0:8443<br>53/udp -&gt; 0.0.0.0:8053<br>80/tcp -&gt; 0.0.0.0:8080<br>[root@centos7 ~]<span class="hljs-comment">#docker port nginx-c1 53/udp</span><br>0.0.0.0:8053<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#docker pull nginx</span><br>Using default tag: latest<br>latest: Pulling from library/nginx<br>8ec398bc0356: Pull complete<br>a53c868fbde7: Pull complete<br>79daf9dd140d: Pull complete<br>Digest: sha256:70821e443be75ea38bdf52a974fd2271babd5875b2b1964f05025981c75a6717<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> nginx:latest<br>docker.io/library/nginx:latest<br>[root@centos7 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES<br>[root@centos7 ~]<span class="hljs-comment">#ss -ntl</span><br>State          Recv-Q          Send-Q                    Local Address:Port                      Peer Address:Port<br>LISTEN         0               128                             0.0.0.0:111                            0.0.0.0:*             <br>LISTEN         0               128                             0.0.0.0:40080                          0.0.0.0:*             <br>LISTEN         0               128                       127.0.0.53%lo:53                             0.0.0.0:*             <br>LISTEN         0               128                             0.0.0.0:22                             0.0.0.0:*             <br>LISTEN         0               128                             0.0.0.0:33080                          0.0.0.0:*             <br>LISTEN         0               128                             0.0.0.0:56958                          0.0.0.0:*             <br>LISTEN         0               64                              0.0.0.0:2049                           0.0.0.0:*             <br>LISTEN         0               64                              0.0.0.0:31780                          0.0.0.0:*             <br>LISTEN         0               128                                [::]:20942                             [::]:*             <br>LISTEN         0               128                                [::]:111                               [::]:*             <br>LISTEN         0               128                                [::]:22                                [::]:*             <br>LISTEN         0               128                                [::]:51768                             [::]:*             <br>LISTEN         0               64                                 [::]:19550                             [::]:*             <br>LISTEN         0               64                                 [::]:2049                              [::]:*             <br>LISTEN         0               128                                [::]:53636                             [::]:*<br><br><span class="hljs-comment">#前台启动的会话窗口无法进行其他操作，除非退出，但是退出后容器也会退出</span><br>[root@centos7 ~]<span class="hljs-comment">#docker run -P nginx</span><br>172.17.0.1 - - [26/Jan/2020:06:44:56 +0000] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 612 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;curl/7.29.0&quot;</span> <span class="hljs-string">&quot;-&quot;</span><br><br><span class="hljs-comment">#另开一个窗口执行下面命令</span><br>[root@centos7 ~]<span class="hljs-comment">#ss -ntl</span><br>State          Recv-Q          Send-Q                    Local Address:Port                      Peer Address:Port          <br>LISTEN         0               128                             0.0.0.0:111                            0.0.0.0:*             <br>LISTEN         0               128                             0.0.0.0:40080                          0.0.0.0:*             <br>LISTEN         0               128                       127.0.0.53%lo:53                             0.0.0.0:*             <br>LISTEN         0               128                             0.0.0.0:22                             0.0.0.0:*             <br>LISTEN         0               128                             0.0.0.0:33080                          0.0.0.0:*             <br>LISTEN         0               128                             0.0.0.0:56958                          0.0.0.0:*             <br>LISTEN         0               64                              0.0.0.0:2049                           0.0.0.0:*             <br>LISTEN         0               20480                           0.0.0.0:49154                          0.0.0.0:*             <br>LISTEN         0               64                              0.0.0.0:31780                          0.0.0.0:*             <br>LISTEN         0               128                                [::]:20942                             [::]:*             <br>LISTEN         0               128                                [::]:111                               [::]:*             <br>LISTEN         0               128                                [::]:22                                [::]:*             <br>LISTEN         0               128                                [::]:51768                             [::]:*             <br>LISTEN         0               64                                 [::]:19550                             [::]:*             <br>LISTEN         0               64                                 [::]:2049                              [::]:*             <br>LISTEN         0               20480                              [::]:49154                             [::]:*             <br>LISTEN         0               128                                [::]:53636                             [::]:*<br>[root@centos7 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                                     NAMES<br>76bbdd2d7c06   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   59 seconds ago   Up 58 seconds   0.0.0.0:49154-&gt;80/tcp, :::49154-&gt;80/tcp   recursing_wozniak<br>[root@centos7 ~]<span class="hljs-comment">#curl curl 127.0.0.1:49154</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br>&lt;style&gt;<br>    body &#123;<br>        width: 35em;<br>        margin: 0 auto;<br>        font-family: Tahoma, Verdana, Arial, sans-serif;<br>    &#125;<br>&lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;<br>&lt;p&gt;If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.&lt;/p&gt;<br><br>&lt;p&gt;For online documentation and support please refer to<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;<br>Commercial support is available at<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;<br><br>&lt;p&gt;&lt;em&gt;Thank you <span class="hljs-keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br><span class="hljs-comment">#自动生成Iptables规则</span><br>[root@centos7 ~]<span class="hljs-comment">#iptables -vnL -t nat</span><br>Chain PREROUTING (policy ACCEPT 0 packets, 0 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    2   104 DOCKER     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ADDRTYPE match dst-type LOCAL<br><br>Chain INPUT (policy ACCEPT 0 packets, 0 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br><br>Chain OUTPUT (policy ACCEPT 5 packets, 308 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    0     0 DOCKER     all  --  *      *       0.0.0.0/0           !127.0.0.0/8          ADDRTYPE match dst-type LOCAL<br><br>Chain POSTROUTING (policy ACCEPT 5 packets, 308 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    0     0 MASQUERADE  all  --  *      !docker0  172.17.0.0/16        0.0.0.0/0           <br>    0     0 MASQUERADE  tcp  --  *      *       172.17.0.2           172.17.0.2           tcp dpt:80<br><br>Chain DOCKER (2 references)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    0     0 RETURN     all  --  docker0 *       0.0.0.0/0            0.0.0.0/0           <br>    0     0 DNAT       tcp  --  !docker0 *       0.0.0.0/0            0.0.0.0/0            tcp dpt:49154 to:172.17.0.2:80<br><span class="hljs-comment">#回到之前的会话窗口，同时按两个键 ctrl+c 退出容器</span><br>[root@centos7 ~]<span class="hljs-comment">#docker run -P nginx</span><br>172.17.0.1 - - [27/Jun/2021:08:52:27 +0000] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 612 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;curl/7.58.0&quot;</span> <span class="hljs-string">&quot;-&quot;</span><br>^C2021/06/27 08:55:05 [notice] 1<span class="hljs-comment">#1: signal 2 (SIGINT) received, exiting</span><br>[root@centos7 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS                      PORTS     NAMES<br>76bbdd2d7c06   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   5 minutes ago   Exited (0) 24 seconds ago             recursing_wozniak<br></code></pre></td></tr></table></figure>

<p><strong>端口映射的本质就是利用NAT技术实现的</strong><br>范例: 端口映射和iptables</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#端口映射前的iptables规则</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#iptables -S</span><br>-P INPUT ACCEPT<br>-P FORWARD DROP<br>-P OUTPUT ACCEPT<br>-N DOCKER<br>-N DOCKER-ISOLATION-STAGE-1<br>-N DOCKER-ISOLATION-STAGE-2<br>-N DOCKER-USER<br>-A FORWARD -j DOCKER-USER<br>-A FORWARD -j DOCKER-ISOLATION-STAGE-1<br>-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT<br>-A FORWARD -o docker0 -j DOCKER<br>-A FORWARD -i docker0 ! -o docker0 -j ACCEPT<br>-A FORWARD -i docker0 -o docker0 -j ACCEPT<br>-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2<br>-A DOCKER-ISOLATION-STAGE-1 -j RETURN<br>-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP<br>-A DOCKER-ISOLATION-STAGE-2 -j RETURN<br>-A DOCKER-USER -j RETURN<br>[root@ubuntu1804 ~]<span class="hljs-comment">#iptables -S -t nat</span><br>-P PREROUTING ACCEPT<br>-P INPUT ACCEPT<br>-P OUTPUT ACCEPT<br>-P POSTROUTING ACCEPT<br>-N DOCKER<br>-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER<br>-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER<br>-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE<br>-A DOCKER -i docker0 -j RETURN<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#iptables -S &gt; pre.filter</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#iptables -S -t nat &gt; pre.nat</span><br><br><span class="hljs-comment">#实现端口映射</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -P --name nginx1 nginx</span><br>fba9a937a0199c1671237b3b68df4e9d1147900742401310cc4686613bbe283c<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it nginx1 hostname -i</span><br>172.17.0.2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker port nginx1</span><br>80/tcp -&gt; 0.0.0.0:49156<br>80/tcp -&gt; :::49156<br><br><span class="hljs-comment">#端口映射后的iptables规则</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#iptables -S</span><br>-P INPUT ACCEPT<br>-P FORWARD ACCEPT<br>-P OUTPUT ACCEPT<br>-N DOCKER<br>-N DOCKER-ISOLATION-STAGE-1<br>-N DOCKER-ISOLATION-STAGE-2<br>-N DOCKER-USER<br>-A FORWARD -j DOCKER-USER<br>-A FORWARD -j DOCKER-ISOLATION-STAGE-1<br>-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT<br>-A FORWARD -o docker0 -j DOCKER<br>-A FORWARD -i docker0 ! -o docker0 -j ACCEPT<br>-A FORWARD -i docker0 -o docker0 -j ACCEPT<br>-A DOCKER -d 172.17.0.2/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 80 -j ACCEPT<br>-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2<br>-A DOCKER-ISOLATION-STAGE-1 -j RETURN<br>-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP<br>-A DOCKER-ISOLATION-STAGE-2 -j RETURN<br>-A DOCKER-USER -j RETURN<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#iptables -S -t nat</span><br>-P PREROUTING ACCEPT<br>-P INPUT ACCEPT<br>-P OUTPUT ACCEPT<br>-P POSTROUTING ACCEPT<br>-N DOCKER<br>-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER<br>-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER<br>-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE<br>-A POSTROUTING -s 172.17.0.2/32 -d 172.17.0.2/32 -p tcp -m tcp --dport 80 -j MASQUERADE<br>-A DOCKER -i docker0 -j RETURN<br>-A DOCKER ! -i docker0 -p tcp -m tcp --dport 49156 -j DNAT --to-destination 172.17.0.2:80<br><br><span class="hljs-comment">#对比端口映射前后的变化</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#iptables -S &gt; post.filter</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#iptables -S -t nat &gt; post.nat</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#diff pre.filter post.filter</span><br>13a14<br>&gt; -A DOCKER -d 172.17.0.2/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 80 -j ACCEPT<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#diff pre.nat post.nat</span><br>a9<br>&gt; -A POSTROUTING -s 172.17.0.2/32 -d 172.17.0.2/32 -p tcp -m tcp --dport 80 -j MASQUERADE<br>9a11<br>&gt; -A DOCKER ! -i docker0 -p tcp -m tcp --dport 49156 -j DNAT --to-destination 172.17.0.2:80<br><br><span class="hljs-comment">#本地和选程都可以访问</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl 127.0.0.1:49156</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br>&lt;style&gt;<br>    body &#123;<br>        width: 35em;<br>        margin: 0 auto;<br>        font-family: Tahoma, Verdana, Arial, sans-serif;<br>    &#125;<br>&lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;<br>&lt;p&gt;If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.&lt;/p&gt;<br><br>&lt;p&gt;For online documentation and support please refer to<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;<br>Commercial support is available at<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;<br><br>&lt;p&gt;&lt;em&gt;Thank you <span class="hljs-keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br>[root@centos7 ~]<span class="hljs-comment"># curl 10.0.0.101:49156</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br>&lt;style&gt;<br>    body &#123;<br>        width: 35em;<br>        margin: 0 auto;<br>        font-family: Tahoma, Verdana, Arial, sans-serif;<br>    &#125;<br>&lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;<br>&lt;p&gt;If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.&lt;/p&gt;<br><br>&lt;p&gt;For online documentation and support please refer to<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;<br>Commercial support is available at<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;<br><br>&lt;p&gt;&lt;em&gt;Thank you <span class="hljs-keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br><span class="hljs-comment">#利用iptables 阻止同一个宿主机的其它容器CentOS8的访问</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#iptables -I DOCKER -s 10.0.0.8 -d 172.17.0.2 -p tcp --dport 80 -j REJECT</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#iptables -S</span><br>-P INPUT ACCEPT<br>-P FORWARD ACCEPT<br>-P OUTPUT ACCEPT<br>-N DOCKER<br>-N DOCKER-ISOLATION-STAGE-1<br>-N DOCKER-ISOLATION-STAGE-2<br>-N DOCKER-USER<br>-A FORWARD -j DOCKER-USER<br>-A FORWARD -j DOCKER-ISOLATION-STAGE-1<br>-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT<br>-A FORWARD -o docker0 -j DOCKER<br>-A FORWARD -i docker0 ! -o docker0 -j ACCEPT<br>-A FORWARD -i docker0 -o docker0 -j ACCEPT<br>-A DOCKER -s 10.0.0.7/32 -d 172.17.0.2/32 -p tcp -m tcp --dport 80 -j REJECT --reject-with icmp-port-unreachable<br>-A DOCKER -d 172.17.0.2/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 80 -j ACCEPT<br>-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2<br>-A DOCKER-ISOLATION-STAGE-1 -j RETURN<br>-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP<br>-A DOCKER-ISOLATION-STAGE-2 -j RETURN<br>-A DOCKER-USER -j RETURN<br><br><span class="hljs-comment">#测试访问</span><br>[root@centos7 ~]<span class="hljs-comment"># curl 10.0.0.101:49156</span><br>curl: (7) Failed connect to 10.0.0.101:49156; Connection refused<br><br>[root@centos7 ~]<span class="hljs-comment"># curl -I 10.0.0.101:49156</span><br>HTTP/1.1 200 OK<br>Server: nginx/1.21.0<br>Date: Sun, 27 Jun 2021 09:06:47 GMT<br>Content-Type: text/html<br>Content-Length: 612<br>Last-Modified: Tue, 25 May 2021 12:28:56 GMT<br>Connection: keep-alive<br>ETag: <span class="hljs-string">&quot;60aced88-264&quot;</span><br>Accept-Ranges: bytes<br></code></pre></td></tr></table></figure>

<h3 id="1-4-8-指定端口映射"><a href="#1-4-8-指定端口映射" class="headerlink" title="1.4.8 指定端口映射"></a>1.4.8 指定端口映射</h3><p>docker run -p 可以将容器的预定义的指定端口映射到宿主机的相应端口</p>
<p>注意: 多个容器映射到宿主机的端口不能冲突，但容器内使用的端口可以相同</p>
<p>方式1: 容器80端口映射宿主机本地随机端口（容器指定端口映射宿主机本地随机端口）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run  -p 80 --name nginx-test-port1 nginx<br></code></pre></td></tr></table></figure>

<p>方式2: 容器80端口映射到宿主机本地端口81（容器指定端口映射宿主机本地指定端口）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run  -p 81:80 --name nginx-test-port2 nginx<br></code></pre></td></tr></table></figure>

<p>方式3: 宿主机本地IP:宿主机本地端口:容器端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run  -p 10.0.0.100:82:80 --name nginx-test-port3 docker.io/nginx<br></code></pre></td></tr></table></figure>

<p>方式4: 宿主机本地IP:宿主机本地随机端口:容器端口，默认从32768开始</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -p 10.0.0.100::80 --name nginx-test-port4 docker.io/nginx<br></code></pre></td></tr></table></figure>

<p>方式5: 宿主机本机ip:宿主机本地端口:容器端口/协议，默认为tcp协议</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run  -p 10.0.0.100:83:80/udp --name nginx-test-port5 docker.io/nginx<br></code></pre></td></tr></table></figure>

<p>方式6: 一次性映射多个端口+协议</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run  -p 8080:80/tcp -p 8443:443/tcp -p 53:53/udp --name nginx-test-port6 nginx<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#docker run -d -p 8080:80 -p 8443:443 -p 8053:53/udp nginx</span><br>2664d66a3f3a11dddccc9d431695b514a6b1cfbf4a78f5dc96b3fba0dba674e9<br>[root@centos7 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                               NAMES<br>2664d66a3f3a        nginx               <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   5 minutes ago       Up 5 minutes        0.0.0.0:8053-&gt;53/udp, 0.0.0.0:8080-&gt;80/tcp, 0.0.0.0:8443-&gt;443/tcp   inspiring_knuth<br>[root@centos7 ~]<span class="hljs-comment">#ss -ntpul</span><br>Netid  State      Recv-Q Send-Q                                                                                       Local Address:Port                                                                                                      Peer Address:Port              <br>udp    UNCONN     0      0                                                                                                       :::8053                                                                                                                :::*                   users:((<span class="hljs-string">&quot;docker-proxy&quot;</span>,pid=1100,fd=4))<br>tcp    LISTEN     0      128                                                                                                      *:22                                                                                                                   *:*                   users:((<span class="hljs-string">&quot;sshd&quot;</span>,pid=750,fd=3))<br>tcp    LISTEN     0      128                                                                                                     :::8080                                                                                                                :::*                   users:((<span class="hljs-string">&quot;docker-proxy&quot;</span>,pid=1089,fd=4))<br>tcp    LISTEN     0      128                                                                                                     :::22                                                                                                                  :::*                   users:((<span class="hljs-string">&quot;sshd&quot;</span>,pid=750,fd=4))<br>tcp    LISTEN     0      128                                                                                                     :::8443                                                                                                                :::*                   users:((<span class="hljs-string">&quot;docker-proxy&quot;</span>,pid=1078,fd=4))<br><br>[root@centos7 ~]<span class="hljs-comment">#iptables -vnL -t nat</span><br>Chain PREROUTING (policy ACCEPT 1 packets, 229 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    1    52 DOCKER     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ADDRTYPE match dst-type LOCAL<br><br>Chain INPUT (policy ACCEPT 1 packets, 229 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br><br>Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    0     0 DOCKER     all  --  *      *       0.0.0.0/0           !127.0.0.0/8          ADDRTYPE match dst-type LOCAL<br><br>Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    0     0 MASQUERADE  all  --  *      !docker0  172.17.0.0/16        0.0.0.0/0           <br>    0     0 MASQUERADE  tcp  --  *      *       172.17.0.2           172.17.0.2           tcp dpt:443<br>    0     0 MASQUERADE  tcp  --  *      *       172.17.0.2           172.17.0.2           tcp dpt:80<br>    0     0 MASQUERADE  udp  --  *      *       172.17.0.2           172.17.0.2           udp dpt:53<br><br>Chain DOCKER (2 references)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    0     0 RETURN     all  --  docker0 *       0.0.0.0/0            0.0.0.0/0           <br>    0     0 DNAT       tcp  --  !docker0 *       0.0.0.0/0            0.0.0.0/0            tcp dpt:8443 to:172.17.0.2:443<br>    0     0 DNAT       tcp  --  !docker0 *       0.0.0.0/0            0.0.0.0/0            tcp dpt:8080 to:172.17.0.2:80<br>    0     0 DNAT       udp  --  !docker0 *       0.0.0.0/0            0.0.0.0/0            udp dpt:8053 to:172.17.0.2:53<br>     <br><span class="hljs-comment">#杀死nginx进程，nginx将关闭，相应端口也会关闭</span><br>[root@centos7 ~]<span class="hljs-comment">#kill &lt;NGINXPID&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>实战案例: 修改已经创建的容器的端口映射关系</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -p 80:80 --name nginx01 nginx</span><br>5ba667a937e5b0c7fdbd7504f86cc0bc8e10561028afa567e2c52d6ecaede6bd<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker port nginx01</span><br>80/tcp -&gt; 0.0.0.0:80<br>80/tcp -&gt; :::80<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#lsof -i:80</span><br>COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME<br>docker-pr 4709 root    4u  IPv4  39666      0t0  TCP *:http (LISTEN)<br>docker-pr 4715 root    4u  IPv6  42566      0t0  TCP *:http (LISTEN)<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ls /var/lib/docker/containers/5ba667a937e5b0c7fdbd7504f86cc0bc8e10561028afa567e2c52d6ecaede6bd</span><br>5ba667a937e5b0c7fdbd7504f86cc0bc8e10561028afa567e2c52d6ecaede6bd-json.log  hostconfig.json  mounts<br>checkpoints                                                                hostname         resolv.conf<br>config.v2.json <br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl stop docker</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /var/lib/docker/containers/dc5d7c1029e582a3e05890fd18565367482232c151bba09ca27e195d39dbcc24/hostconfig.json</span><br><span class="hljs-string">&quot;PortBindings&quot;</span>:&#123;<span class="hljs-string">&quot;80/tcp&quot;</span>:[&#123;<span class="hljs-string">&quot;HostIp&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;HostPort&quot;</span>:<span class="hljs-string">&quot;80&quot;</span>&#125;]&#125;<br><span class="hljs-comment">#PortBindings后80/tcp对应的是容器内部的80端口，HostPort对应的是映射到宿主机的端口80 修改此处为8000</span><br><span class="hljs-string">&quot;PortBindings&quot;</span>:&#123;<span class="hljs-string">&quot;80/tcp&quot;</span>:[&#123;<span class="hljs-string">&quot;HostIp&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;HostPort&quot;</span>:<span class="hljs-string">&quot;8000&quot;</span>&#125;]&#125;<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl start docker</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker start nginx01</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker port nginx01</span><br>80/tcp -&gt; 0.0.0.0:8000<br>80/tcp -&gt; :::8000<br></code></pre></td></tr></table></figure>

<h3 id="1-4-9-查看容器的日志"><a href="#1-4-9-查看容器的日志" class="headerlink" title="1.4.9 查看容器的日志"></a>1.4.9 查看容器的日志</h3><p>docker logs 可以查看容器中运行的进程在控制台输出的日志信息</p>
<p>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker logs [OPTIONS] CONTAINER<br><br>选项:<br>Fetch the logs of a container<br><br>Options:<br>      --details        Show extra details provided to logs<br>  -f, --follow         Follow <span class="hljs-built_in">log</span> output<br>      --since string   Show logs since timestamp (e.g. 2013-01-02T13:23:37Z) or relative (e.g. 42m <span class="hljs-keyword">for</span> 42 minutes)<br>  -n, --tail string    Number of lines to show from the end of the logs (default <span class="hljs-string">&quot;all&quot;</span>)<br>  -t, --timestamps     Show timestamps<br>      --until string   Show logs before a timestamp (e.g. 2013-01-02T13:23:37Z) or relative (e.g. 42m <span class="hljs-keyword">for</span> 42 minutes)<br></code></pre></td></tr></table></figure>

<p>范例: 查看容器日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run alpine /bin/sh -c &#x27;&#x27;i=1;while true;do echo hello$i;let i++;sleep 2;done</span><br>hello<span class="hljs-variable">$i</span>;<span class="hljs-built_in">let</span> i++;sleep 2;<span class="hljs-keyword">done</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">Unable to find image &#x27;</span>alpine:latest<span class="hljs-string">&#x27; locally</span><br><span class="hljs-string">latest: Pulling from library/alpine</span><br><span class="hljs-string">188c0c94c7c5: Pull complete</span><br><span class="hljs-string">Digest: sha256:c0e9560cda118f9ec63ddefb4a173a2b2a0347082d7dff7dc14272e7841a5b5a</span><br><span class="hljs-string">Status: Downloaded newer image for alpine:latest</span><br><span class="hljs-string">hello1</span><br><span class="hljs-string">hello2</span><br><span class="hljs-string">hello3</span><br><span class="hljs-string">hello4</span><br><span class="hljs-string">hello5</span><br><span class="hljs-string">^C[root@ubuntu1804 ~]#</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@ubuntu1804 ~]#docker run -d alpine /bin/sh -c &#x27;</span>i=1;<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>;<span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> hello<span class="hljs-variable">$i</span>;<span class="hljs-built_in">let</span> i++;sleep 2;<span class="hljs-keyword">done</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">11c162aefea398d76c60b3b87c1a8df31b4cae0968195a5224ae0090028e584f</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@ubuntu1804 ~]#docker logs 11c1</span><br><span class="hljs-string">hello1</span><br><span class="hljs-string">hello2</span><br><span class="hljs-string">hello3</span><br><span class="hljs-string">hello4</span><br><span class="hljs-string">hello5</span><br><span class="hljs-string">hello6</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@ubuntu1804 ~]#docker logs --tail 3 11c1</span><br><span class="hljs-string">hello8</span><br><span class="hljs-string">hello9</span><br><span class="hljs-string">hello10</span><br><span class="hljs-string"></span><br><span class="hljs-string">#显示时间</span><br><span class="hljs-string">[root@ubuntu1804 ~]#docker logs --tail 0 -t 11c1</span><br><span class="hljs-string">2021-06-27T11:46:31.735597742Z hello45</span><br><span class="hljs-string"></span><br><span class="hljs-string">#持续跟踪</span><br><span class="hljs-string">[root@ubuntu1804 ~]#docker logs -f 11c1</span><br><span class="hljs-string">hello1</span><br><span class="hljs-string">hello2</span><br><span class="hljs-string">hello3</span><br><span class="hljs-string">hello4</span><br><span class="hljs-string">hello5</span><br><span class="hljs-string">hello6</span><br><span class="hljs-string">hello7</span><br><span class="hljs-string">hello8</span><br><span class="hljs-string">hello9</span><br><span class="hljs-string">hello10</span><br><span class="hljs-string">hello11</span><br><span class="hljs-string">hello12</span><br><span class="hljs-string">hello13</span><br><span class="hljs-string">hello14</span><br><span class="hljs-string">hello15</span><br><span class="hljs-string">hello16</span><br><span class="hljs-string">hello17</span><br><span class="hljs-string">hello18</span><br><span class="hljs-string">.....</span><br></code></pre></td></tr></table></figure>

<p>范例: 查看httpd服务日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull httpd</span><br>Using default tag: latest<br>latest: Pulling from library/httpd<br>bb79b6b2107f: Pull complete<br>26694ef5449a: Pull complete<br>7b85101950dd: Pull complete<br>da919f2696f2: Pull complete<br>3ae86ea9f1b9: Pull complete<br>Digest: sha256:b82fb56847fcbcca9f8f162a3232acb4a302af96b1b2af1c4c3ac45ef0c9b968<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> httpd:latest<br>docker.io/library/httpd:latest<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d -p 80:80 --name web1 httpd</span><br>808e46b3160f27e3775f1f7ab4fb16f057f024335a0b9f90bdf1b5d668661e73<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker logs web1</span><br>AH00558: httpd: Could not reliably determine the server<span class="hljs-string">&#x27;s fully qualified domain name, using 172.17.0.3. Set the &#x27;</span>ServerName<span class="hljs-string">&#x27; directive globally to suppress this message</span><br><span class="hljs-string">AH00558: httpd: Could not reliably determine the server&#x27;</span>s fully qualified domain name, using 172.17.0.3. Set the <span class="hljs-string">&#x27;ServerName&#x27;</span> directive globally to suppress this message<br>[Sun Jun 27 11:49:02.056410 2021] [mpm_event:notice] [pid 1:tid 139747342247040] AH00489: Apache/2.4.48 (Unix) configured -- resuming normal operations<br>[Sun Jun 27 11:49:02.079233 2021] [core:notice] [pid 1:tid 139747342247040] AH00094: Command line: <span class="hljs-string">&#x27;httpd -D FOREGROUND&#x27;</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker logs -f web1</span><br>AH00558: httpd: Could not reliably determine the server<span class="hljs-string">&#x27;s fully qualified domain name, using 172.17.0.3. Set the &#x27;</span>ServerName<span class="hljs-string">&#x27; directive globally to suppress this message</span><br><span class="hljs-string">AH00558: httpd: Could not reliably determine the server&#x27;</span>s fully qualified domain name, using 172.17.0.3. Set the <span class="hljs-string">&#x27;ServerName&#x27;</span> directive globally to suppress this message<br>[Sun Jun 27 11:49:02.056410 2021] [mpm_event:notice] [pid 1:tid 139747342247040] AH00489: Apache/2.4.48 (Unix) configured -- resuming normal operations<br>[Sun Jun 27 11:49:02.079233 2021] [core:notice] [pid 1:tid 139747342247040] AH00094: Command line: <span class="hljs-string">&#x27;httpd -D FOREGROUND&#x27;</span><br>172.17.0.1 - - [27/Jun/2021:11:50:17 +0000] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 45<br></code></pre></td></tr></table></figure>

<p>范例: 查看nginx服务访问日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#查看一次</span><br>[root@centos7 ~]<span class="hljs-comment">#docker logs nginx-test-port1</span><br>docker logs nginx-test-port1<br>/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration<br>/docker-entrypoint.sh: Looking <span class="hljs-keyword">for</span> shell scripts <span class="hljs-keyword">in</span> /docker-entrypoint.d/<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh<br>10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf<br>10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 <span class="hljs-keyword">in</span> /etc/nginx/conf.d/default.conf<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh<br>/docker-entrypoint.sh: Configuration complete; ready <span class="hljs-keyword">for</span> start up<br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: using the &quot;epoll&quot; event method</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: nginx/1.21.0</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: built by gcc 8.3.0 (Debian 8.3.0-6) </span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: OS: Linux 4.15.0-55-generic</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: start worker processes</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: start worker process 32</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: start worker process 33</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: start worker process 34</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: start worker process 35</span><br><span class="hljs-comment">#持续查看</span><br>[root@centos7 ~]<span class="hljs-comment">#docker logs -f nginx-test-port1</span><br>/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration<br>/docker-entrypoint.sh: Looking <span class="hljs-keyword">for</span> shell scripts <span class="hljs-keyword">in</span> /docker-entrypoint.d/<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh<br>10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf<br>10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 <span class="hljs-keyword">in</span> /etc/nginx/conf.d/default.conf<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh<br>/docker-entrypoint.sh: Configuration complete; ready <span class="hljs-keyword">for</span> start up<br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: using the &quot;epoll&quot; event method</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: nginx/1.21.0</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: built by gcc 8.3.0 (Debian 8.3.0-6) </span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: OS: Linux 4.15.0-55-generic</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: start worker processes</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: start worker process 32</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: start worker process 33</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: start worker process 34</span><br>2021/06/27 11:51:35 [notice] 1<span class="hljs-comment">#1: start worker process 35</span><br>172.17.0.1 - - [27/Jun/2021:11:54:13 +0000] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 612 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;curl/7.58.0&quot;</span> <span class="hljs-string">&quot;-&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-4-10-传递运行命令"><a href="#1-4-10-传递运行命令" class="headerlink" title="1.4.10 传递运行命令"></a>1.4.10 传递运行命令</h3><p>容器需要有一个前台运行的进程才能保持容器的运行，通过传递运行参数是一种方式，另外也可以在构建镜像的时候指定容器启动时运行的前台命令</p>
<p>容器里的PID为1的守护进程的实现方式</p>
<ul>
<li>服务类: 如: Nginx，Tomcat，Apache ，但服务不能停</li>
<li>命令类: 如: tail -f /etc/hosts ，主要用于测试环境，注意: 不要tail -f &lt;服务访问日志&gt; 会产生不<br>必要的磁盘IO</li>
</ul>
<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d alpine</span><br>abf192d256397d0edadcdbacf8726016a481b726e02008facd6a0bccad6ba2bd<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND     CREATED          STATUS                      PORTS     NAMES<br>abf192d25639   alpine    <span class="hljs-string">&quot;/bin/sh&quot;</span>   19 seconds ago   Exited (0) 18 seconds ago             ecstatic_nightingale<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -d alpine tail -f /etc/hosts</span><br>5339c029d612876d1b0fe38a48e019e440bff4848192da1138e6b7a8815758ea<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND                CREATED          STATUS                      PORTS     NAMES<br>5339c029d612   alpine    <span class="hljs-string">&quot;tail -f /etc/hosts&quot;</span>   9 seconds ago    Up 9 seconds                          hardcore_poincare<br>abf192d25639   alpine    <span class="hljs-string">&quot;/bin/sh&quot;</span>              49 seconds ago   Exited (0) 48 seconds ago             ecstatic_nightingale<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec -it 5339c029d612 sh</span><br>/ <span class="hljs-comment"># ps axu</span><br>PID   USER     TIME  COMMAND<br>    1 root      0:00 tail -f /etc/hosts<br>    7 root      0:00 sh<br>   13 root      0:00 ps axu<br>/ <span class="hljs-comment"># exit</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID   IMAGE     COMMAND                CREATED         STATUS                     PORTS     NAMES<br>5339c029d612   alpine    <span class="hljs-string">&quot;tail -f /etc/hosts&quot;</span>   5 minutes ago   Up 5 minutes                         hardcore_poincare<br>abf192d25639   alpine    <span class="hljs-string">&quot;/bin/sh&quot;</span>              6 minutes ago   Exited (0) 6 minutes ago             ecstatic_nightingale<br><br></code></pre></td></tr></table></figure>

<h3 id="1-4-11-容器内部的hosts文件"><a href="#1-4-11-容器内部的hosts文件" class="headerlink" title="1.4.11 容器内部的hosts文件"></a>1.4.11 容器内部的hosts文件</h3><p>容器会自动将容器的ID加入自已的/etc/hosts文件中，并解析成容器的IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it centos /bin/bash</span><br>[root@98f51a552019 /]<span class="hljs-comment"># [root@98f51a552019 /]# cat /etc/hosts</span><br>127.0.0.1	localhost<br>::1	localhost ip6-localhost ip6-loopback<br>fe00::0	ip6-localnet<br>ff00::0	ip6-mcastprefix<br>ff02::1	ip6-allnodes<br>ff02::2	ip6-allrouters<br>172.17.0.3	98f51a552019  <span class="hljs-comment">#默认会将实例的ID 添加到自己的hosts文件</span><br>[root@98f51a552019 /]<span class="hljs-comment"># hostname</span><br>98f51a552019<br>[root@98f51a552019 /]<span class="hljs-comment"># ping 98f51a552019</span><br>PING 98f51a552019 (172.17.0.3) 56(84) bytes of data.<br>64 bytes from 98f51a552019 (172.17.0.3): icmp_seq=1 ttl=64 time=0.017 ms<br>64 bytes from 98f51a552019 (172.17.0.3): icmp_seq=2 ttl=64 time=0.036 ms<br>64 bytes from 98f51a552019 (172.17.0.3): icmp_seq=3 ttl=64 time=0.036 ms<br>^C<br>--- 98f51a552019 ping statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 20ms<br>rtt min/avg/max/mdev = 0.017/0.029/0.036/0.010 ms<br><span class="hljs-comment">#在另一个会话执行</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID   IMAGE     COMMAND                CREATED              STATUS              PORTS     NAMES<br>98f51a552019   centos    <span class="hljs-string">&quot;/bin/bash&quot;</span>            About a minute ago   Up About a minute             epic_hertz<br></code></pre></td></tr></table></figure>

<p>范例: 修改容器的 hosts文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --rm --add-host www.rlin.com:6.6.6.6 --add-host www.rlin.org:8.8.8.8 busybox</span><br>/ <span class="hljs-comment"># cat /etc/hosts</span><br>127.0.0.1	localhost<br>::1	localhost ip6-localhost ip6-loopback<br>fe00::0	ip6-localnet<br>ff00::0	ip6-mcastprefix<br>ff02::1	ip6-allnodes<br>ff02::2	ip6-allrouters<br>6.6.6.6	www.rlin.com<br>8.8.8.8	www.rlin.org<br>172.17.0.2	76c1686c1ff0<br>/ <span class="hljs-comment"># </span><br><br></code></pre></td></tr></table></figure>

<h3 id="1-4-12-指定容器DNS"><a href="#1-4-12-指定容器DNS" class="headerlink" title="1.4.12 指定容器DNS"></a>1.4.12 指定容器DNS</h3><p>容器的dns服务器，默认采用宿主机的dns 地址，可以用下面方式指定其它的DNS地址</p>
<ul>
<li>将dns地址配置在宿主机</li>
<li>在容器启动时加选项 –dns=x.x.x.x</li>
<li>在/etc/docker/daemon.json 文件中指定</li>
</ul>
<p>范例: 容器的DNS默认从宿主机的DNS获取</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#systemd-resolve --status|grep -A1 -i &quot;DNS Servers&quot;</span><br>DNS Servers: 223.6.6.6<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --rm  centos bash</span><br>docker run -it --rm centos bash<br>[root@5c1f9607b71e /]<span class="hljs-comment"># cat /etc/resolv.conf </span><br><span class="hljs-comment"># This file is managed by man:systemd-resolved(8). Do not edit.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># This is a dynamic resolv.conf file for connecting local clients directly to</span><br><span class="hljs-comment"># all known uplink DNS servers. This file lists all configured search domains.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Third party programs must not access this file directly, but only through the</span><br><span class="hljs-comment"># symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,</span><br><span class="hljs-comment"># replace this symlink by a static file or a different symlink.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># See man:systemd-resolved.service(8) for details about the supported modes of</span><br><span class="hljs-comment"># operation for /etc/resolv.conf.</span><br><br>nameserver 223.6.6.6<br>[root@5c1f9607b71e /]<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>

<p>范例: 指定DNS地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --rm --dns 1.1.1.1 --dns 8.8.8.8 centos bash</span><br>[root@baffb9121b03 /]<span class="hljs-comment"># cat /etc/resolv.conf </span><br>nameserver 1.1.1.1<br>nameserver 8.8.8.8<br>[root@baffb9121b03 /]<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>范例: 指定domain名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --rm --dns 1.1.1.1 --dns 8.8.8.8 --dns-search a.com --dns-search b.com busybox</span><br>/ <span class="hljs-comment"># cat /etc/resolv.conf </span><br>search a.com b.com<br>nameserver 1.1.1.1<br>nameserver 8.8.8.8<br>/ <span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>

<p>范例: 配置文件指定DNS和搜索domain名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#vim /etc/docker/daemon.json</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /etc/docker/daemon.json</span><br>&#123;<br> <span class="hljs-string">&quot;storage-driver&quot;</span>: <span class="hljs-string">&quot;overlay2&quot;</span>,<br> <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://si7y70hh.mirror.aliyuncs.com&quot;</span>],<br> <span class="hljs-string">&quot;dns&quot;</span> : [  <span class="hljs-string">&quot;114.114.114.114&quot;</span>, <span class="hljs-string">&quot;119.29.29.29&quot;</span>],<br> <span class="hljs-string">&quot;dns-search&quot;</span>: [ <span class="hljs-string">&quot;magedu.com&quot;</span>, <span class="hljs-string">&quot;magedu.org&quot;</span>]<br>&#125;<br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl restart docker</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --rm  centos bash</span><br>[root@7a2d8fac6f6b /]<span class="hljs-comment"># cat /etc/resolv.conf</span><br>search magedu.com magedu.org<br>nameserver 114.114.114.114<br>nameserver 119.29.29.29<br>[root@7a2d8fac6f6b /]<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br><br><span class="hljs-comment">#用--dns指定优先级更高</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --rm --dns 8.8.8.8 --dns 8.8.4.4 centos bash</span><br>[root@80ffe3547b87 /]<span class="hljs-comment"># cat /etc/resolv.conf</span><br>search magedu.com magedu.org<br>nameserver 8.8.8.8<br>nameserver 8.8.4.4<br>[root@80ffe3547b87 /]<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>

<h3 id="1-4-13-容器内和宿主机之间复制文件"><a href="#1-4-13-容器内和宿主机之间复制文件" class="headerlink" title="1.4.13 容器内和宿主机之间复制文件"></a>1.4.13 容器内和宿主机之间复制文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-<br>docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH<br>Options:<br> -a, --archive    Archive mode (copy all uid/gid information)<br> -L, --follow-link  Always follow symbol link <span class="hljs-keyword">in</span> SRC_PATH<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -itd centos</span><br>3e6407b473d5249b1ca1594106a03d023e6ee9609582806fe62575d2b6c593c0<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>ONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES<br>3e6407b473d5        centos              <span class="hljs-string">&quot;/bin/bash&quot;</span>         About a minute ago   Up About a minute                       eloquent_swanson<br><br><span class="hljs-comment">#将容器内文件复制到宿主机</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker cp -a 3e64:/etc/centos-release .</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat centos-release</span><br>CentOS Linux release 8.1.1911 (Core)<br><br><span class="hljs-comment">#将宿主机文件复制到容器内</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker cp /etc/issue 3e64:/root/</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker exec 3e64 cat /root/issue</span><br>Ubuntu 18.04.1 LTS \n \l<br></code></pre></td></tr></table></figure>

<h3 id="1-4-14-使用-systemd-控制容器运行"><a href="#1-4-14-使用-systemd-控制容器运行" class="headerlink" title="1.4.14 使用 systemd 控制容器运行"></a>1.4.14 使用 systemd 控制容器运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#cat /lib/systemd/system/hello.service</span><br>[Unit]<br>Description=Hello World<br>After=docker.service<br>Requires=docker.service<br>[Service]<br>TimeoutStartSec=0<br>ExecStartPre=-/usr/bin/docker <span class="hljs-built_in">kill</span> busybox-hello<br>ExecStartPre=-/usr/bin/docker rm busybox-hello<br>ExecStartPre=/usr/bin/docker pull busybox<br>ExecStart=/usr/bin/docker run --name busybox-hello busybox /bin/sh -c <span class="hljs-string">&quot;while</span><br><span class="hljs-string">true; do echo Hello World; sleep 1; done&quot;</span><br>ExecStop=/usr/bin/docker <span class="hljs-built_in">kill</span> busybox-hello<br>[Install]<br>WantedBy=multi-user.target<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl daemon-reload</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl enable --now hello.service</span><br></code></pre></td></tr></table></figure>

<h3 id="1-4-15-传递环境变量"><a href="#1-4-15-传递环境变量" class="headerlink" title="1.4.15 传递环境变量"></a>1.4.15 传递环境变量</h3><p>有些容器运行时，需要传递变量，可以使用 -e &lt;参数&gt; 或 –env-file &lt;参数文件&gt; 实现</p>
<p>范例: 传递变量创建MySQL</p>
<p>变量参考链接: <a target="_blank" rel="noopener" href="https://hub.docker.com/_/mysql">https://hub.docker.com/_/mysql</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#MySQL容器运行时需要指定root的口令</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run --name mysql01 mysql:5.7.32</span><br>Unable to find image <span class="hljs-string">&#x27;mysql:5.7.32&#x27;</span> locally<br>5.7.32: Pulling from library/mysql<br>a076a628af6f: Pull complete <br>f6c208f3f991: Pull complete <br>88a9455a9165: Pull complete <br>406c9b8427c6: Pull complete <br>7c88599c0b25: Pull complete <br>25b5c6debdaf: Pull complete <br>43a5816f1617: Pull complete <br>7065aaa2655f: Pull complete <br>b4bc531db40f: Pull complete <br>8c3e9d7c9815: Pull complete <br>fadfb9734ed2: Pull complete <br>Digest: sha256:e08834258fcc0efd01df358222333919df53d4a0d9b2a54da05b204b822e3b7b<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> mysql:5.7.32<br>2021-06-27 13:37:51+00:00 [Note] [Entrypoint]: Entrypoint script <span class="hljs-keyword">for</span> MySQL Server 5.7.32-1debian10 started.<br>2021-06-27 13:37:51+00:00 [Note] [Entrypoint]: Switching to dedicated user <span class="hljs-string">&#x27;mysql&#x27;</span><br>2021-06-27 13:37:52+00:00 [Note] [Entrypoint]: Entrypoint script <span class="hljs-keyword">for</span> MySQL Server 5.7.32-1debian10 started.<br>2021-06-27 13:37:52+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified<br>	You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run --name mysql-test1 -v /data/mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=wordpress -e MYSQL_USER=wpuser -e MYSQL_PASSWORD=123456 -d -p 3306:3306 mysql:5.7.30</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#apt install -y mysql-client-core-5.7</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#mysql -uroot -p123456 -h127.0.0.1</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 2<br>Server version: 5.7.30 MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2021, Oracle and/or its affiliates.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>| wordpress          |<br>+--------------------+<br>5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.03 sec)<br><br>mysql&gt; select user,host from mysql.user;<br>+---------------+-----------+<br>| user          | host      |<br>+---------------+-----------+<br>| root          | %         |<br>| wpuser        | %         |<br>| mysql.session | localhost |<br>| mysql.sys     | localhost |<br>| root          | localhost |<br>+---------------+-----------+<br>5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ysql -uwpuser -p123456 -h127.0.0.1</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 3<br>Server version: 5.7.30 MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2021, Oracle and/or its affiliates.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| wordpress          |<br>+--------------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim env.list</span><br>MYSQL_ROOT_PASSWORD=123456<br>MYSQL_DATABASE=discuz<br>MYSQL_USER=rlin<br>MYSQL_PASSWORD=123456<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run --name mysql-test2 -v /root/mysql/:/etc/mysql/conf.d -v /data/mysql2:/var/lib/mysql --env-file=env.list -d -p 3307:3306 mysql:5.7.30</span><br>689acf05f39af172c310568ab0e6deda26d19763face3c22b0e1e0e72d848edc<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker port mysql-test2</span><br>3306/tcp -&gt; 0.0.0.0:3307<br>[root@ubuntu1804 ~]<span class="hljs-comment">#mysql -urlin -p123456 -h127.0.0.1 -P3307</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 2<br>Server version: 5.7.30 MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2021, Oracle and/or its affiliates.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| discuz             |<br>+--------------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run --name mysql-test2 --env-file=env.list -d -p 3307:3306 mysql:5.7.30</span><br>b60ef23d713943e4dbccc48f8c6573a568d0b76c7e2369da14a5ebaed5f109b2<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker port mysql-test2</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#mysql -urlin -p123456 -h127.0.0.1 -P3307</span><br>3306/tcp -&gt; 0.0.0.0:3307<br>[root@ubuntu1804 ~]<span class="hljs-comment">#mysql -urlin -p123456 -h127.0.0.1 -P3307</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 2<br>Server version: 5.7.30 MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2021, Oracle and/or its affiliates.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| discuz             |<br>+--------------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat mysql/mysql-test.cnf</span><br>[mysqld]<br>server-id=100<br>log-bin=mysql-bin<br><br><br></code></pre></td></tr></table></figure>

<h3 id="1-4-16-podman-管理容器"><a href="#1-4-16-podman-管理容器" class="headerlink" title="1.4.16 podman 管理容器"></a>1.4.16 podman 管理容器</h3><p>范例: podman管理容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#安装httpd</span><br>[root@centos8 ~]<span class="hljs-comment">#podman pull httpd</span><br>[root@centos8 ~]<span class="hljs-comment">#podman run -d --name web -p 80:80 httpd</span><br>91786e5b8865bc0e7ee21f42b7792135b14645b6196cfdd6fcfdd04c5c9e923c<br>[root@centos8 ~]<span class="hljs-comment">#curl 127.0.0.1</span><br>&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;<br>[root@centos8 ~]<span class="hljs-comment">#podman exec -it web /bin/sh</span><br><span class="hljs-comment"># ls  </span><br>bin build cgi-bin conf error htdocs icons include logs modules<br><span class="hljs-comment"># cd htdocs    </span><br><span class="hljs-comment"># cat index.html</span><br>&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;<br><span class="hljs-comment"># echo welcone  &gt; index.html</span><br><span class="hljs-comment"># exit</span><br>[root@centos8 yum.repos.d]<span class="hljs-comment"># curl 127.0.0.1</span><br>welcone<br><br><span class="hljs-comment">#安装nginx</span><br>[root@centos8 ~]<span class="hljs-comment">#podman run -dt -p 80:80 --name nginx -v /data:/data -e NGINX_VERSION=1.16 nginx:1.16.0</span><br>[root@centos8 ~]<span class="hljs-comment">#podman stop nginx</span><br><br><span class="hljs-comment">#将容器设为开机启动</span><br>[root@centos8 ~]<span class="hljs-comment">#vim /lib/systemd/system/nginx_podman.service</span><br>[root@centos8 ~]<span class="hljs-comment">#cat  /lib/systemd/system/nginx_podman.service</span><br>[Unit]<br>Description=Podman Nginx Service<br>After=network.target<br>After=network-online.target<br><br>[Service]<br>Type=simple<br>ExecStart=/usr/bin/podman start -a nginx  <span class="hljs-comment"># -a, --attach Attach container&#x27;s</span><br>STDOUT and STDERR<br>ExecStop=/usr/bin/podman stop -t 10 nginx<br>Restart=always<br><br>[Install]<br>WantedBy=multi-user.target<br><br>[root@centos8 ~]<span class="hljs-comment">#systemctl daemon-reload</span><br>[root@centos8 ~]<span class="hljs-comment">#systemctl enable --now nginx_podman.service</span><br>[root@centos8 ~]<span class="hljs-comment">#curl 127.0.0.1</span><br><br><span class="hljs-comment">#podman 查看日志</span><br>[root@centos8 ~]<span class="hljs-comment">#podman logs  nginx</span><br>10.0.0.8 - - [24/Feb/2020:14:19:45 +0000] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 612 <span class="hljs-string">&quot;-&quot;</span><br><span class="hljs-string">&quot;curl/7.61.1&quot;</span> <span class="hljs-string">&quot;-&quot;</span><br>10.0.0.1 - - [24/Feb/2020:14:25:54 +0000] <span class="hljs-string">&quot;GET / HTTP/1.1&quot;</span> 200 612 <span class="hljs-string">&quot;-&quot;</span><br><span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like</span><br><span class="hljs-string">Gecko) Chrome/79.0.3945.117 Safari/537.36&quot;</span> <span class="hljs-string">&quot;-&quot;</span><br>[root@centos8 ~]<span class="hljs-comment">#podman port nginx</span><br>80/tcp -&gt; 0.0.0.0:80<br>[root@centos8 ~]<span class="hljs-comment">#ss -ntl</span><br>State    Recv-Q    Send-Q  Local Address:Port  Peer Address:Port  <br> <br>LISTEN    0       128       0.0.0.0:80      0.0.0.0:*    <br>LISTEN    0       128       0.0.0.0:22      0.0.0.0:*    <br>LISTEN    0       128        [::]:22       [::]:*    <br>  <br>[root@centos8 ~]<span class="hljs-comment">#systemctl stop nginx_podman.service</span><br>[root@centos8 ~]<span class="hljs-comment">#ss -ntl</span><br>State    Recv-Q    Send-Q   Local Address:Port   Peer Address:Port <br>  <br>LISTEN    0       128        0.0.0.0:22       0.0.0.0:*  <br>  <br>LISTEN    0       128         [::]:22        [::]:*<br><br><span class="hljs-comment">#查看进程信息</span><br>[root@centos8 ~]<span class="hljs-comment">#systemctl start nginx_podman.service</span><br>[root@centos8 ~]<span class="hljs-comment">#pstree -p</span><br>systemd(1)─┬─NetworkManager(664)─┬─&#123;NetworkManager&#125;(698)<br>     │           └─&#123;NetworkManager&#125;(699)<br>     ├─VGAuthService(659)<br>     ├─agetty(766)<br>     ├─atd(763)<br>     ├─auditd(626)───&#123;auditd&#125;(627)<br>     ├─automount(789)─┬─&#123;automount&#125;(796)<br>     │        ├─&#123;automount&#125;(797)<br>     │        ├─&#123;automount&#125;(805)<br>     │        └─&#123;automount&#125;(822)<br>     ├─conmon(2378)─┬─nginx(2388)───nginx(2401)<br>     │       └─&#123;conmon&#125;(2380)<br>     ├─crond(762)<br>     ├─dbus-daemon(661)<br>     ├─podman(2308)─┬─&#123;podman&#125;(2309)<br>     │       ├─&#123;podman&#125;(2310)<br>     │       ├─&#123;podman&#125;(2311)<br>     │       ├─&#123;podman&#125;(2312)<br>     │       ├─&#123;podman&#125;(2313)<br>     │       ├─&#123;podman&#125;(2316)<br>     │       ├─&#123;podman&#125;(2321)<br>     │       ├─&#123;podman&#125;(2326)<br>     │       └─&#123;podman&#125;(2399)<br>     ├─polkitd(668)─┬─&#123;polkitd&#125;(697)<br>     │       ├─&#123;polkitd&#125;(700)<br>     │       ├─&#123;polkitd&#125;(703)<br>     │       ├─&#123;polkitd&#125;(704)<br>     │       └─&#123;polkitd&#125;(754)<br>     ├─rngd(667)───&#123;rngd&#125;(677)<br>     ├─rsyslogd(788)─┬─&#123;rsyslogd&#125;(795)<br>     │        └─&#123;rsyslogd&#125;(798)<br>     ├─sshd(711)─┬─sshd(1361)───sshd(1375)───bash(1377)<br>     │      └─sshd(1362)───sshd(1376)───bash(1380)───pstree(2504)<br>     ├─sssd(658)─┬─sssd_be(730)<br>     │      └─sssd_nss(758)<br>     ├─systemd(1366)───(sd-pam)(1369)<br>     ├─systemd-journal(553)<br>     ├─systemd-logind(760)<br>     ├─systemd-udevd(586)<br>     ├─tuned(702)─┬─&#123;tuned&#125;(1073)<br>     │      ├─&#123;tuned&#125;(1076)<br>     │      └─&#123;tuned&#125;(1088)<br>     └─vmtoolsd(660)<br>     <br><span class="hljs-comment">#nginx进程杀死后还会自动启动</span><br>[root@centos8 ~]<span class="hljs-comment">#kill 2388</span><br>[root@centos8 ~]<span class="hljs-comment">#ps aux|grep nginx</span><br>root    2939  1.1  8.4 908244 69240 ?    Ssl  22:45  0:00<br>/usr/bin/podman start -a nginx<br>root    3009  0.0  0.3 142832  2652 ?    Ssl  22:45  0:00<br>/usr/libexec/podman/conmon -s -c<br>9198c59a8a3db50801c52ceaa39521b4381ac46ab7c16907130244d2a328e823 -u<br>9198c59a8a3db50801c52ceaa39521b4381ac46ab7c16907130244d2a328e823 -n nginx -r<br>/usr/bin/runc -b /var/lib/containers/storage/overlay-containers/9198c59a8a3db50801c52ceaa39521b4381ac46ab7c16907130244d2a328e823/user<br>data -p /var/run/containers/storage/overlay-<br>containers/9198c59a8a3db50801c52ceaa39521b4381ac46ab7c16907130244d2a328e823/user<br>data/pidfile --exit-dir /var/run/libpod/exits --exit-command /usr/bin/podman --<br>exit-command-arg --root --exit-command-arg /var/lib/containers/storage --<span class="hljs-built_in">exit</span>-<br>command-arg --runroot --exit-command-arg /var/run/containers/storage --<span class="hljs-built_in">exit</span>-<br>command-arg --log-level --exit-command-arg error --exit-command-arg --cgroup-<br>manager --exit-command-arg systemd --exit-command-arg --tmpdir --exit-command-<br>arg /var/run/libpod --exit-command-arg --runtime --exit-command-arg runc --<span class="hljs-built_in">exit</span>-<br>command-arg --storage-driver --exit-command-arg overlay --exit-command-arg --<br>events-backend --exit-command-arg journald --exit-command-arg container --<span class="hljs-built_in">exit</span>-<br>command-arg cleanup --exit-command-arg<br>9198c59a8a3db50801c52ceaa39521b4381ac46ab7c16907130244d2a328e823 --socket-dir-<br>path /var/run/libpod/socket -t -l k8s-file:/var/lib/containers/storage/overlay-<br>containers/9198c59a8a3db50801c52ceaa39521b4381ac46ab7c16907130244d2a328e823/userdata/ctr.log --log-level error<br>root    3019  2.5  0.6  32656  5364 pts/0  Ss+  22:45  0:00 nginx: master process nginx -g daemon off;<br>101     3031  0.0  0.3  33144  2636 pts/0  S+  22:45  0:00 nginx: worker process<br>root    3034  0.0  0.1  12108  1072 pts/1  S+  22:45  0:00 grep -- color=auto nginx<br><br>[root@centos8 ~]<span class="hljs-comment">#podman top nginx</span><br>USER  PID  PPID  %CPU  ELAPSED      TTY   TIME  COMMAND<br>root   1   0    0.000  4m38.979412738s  pts/0  0s   nginx: master process nginx -g daemon off;<br>nginx  6   1    0.000  4m37.979473913s  pts/0  0s   nginx: worker process<br>[root@centos8 ~]<span class="hljs-comment">#podman stats nginx</span><br>ID       NAME  CPU %  MEM USAGE / LIMIT  MEM %  NET IO     BLOCK IO  PIDS<br>9198c59a8a3d  nginx  --    2.474MB / 835.8MB  0.30%  2.25kB / 1.742kB  -- / --   2<br></code></pre></td></tr></table></figure>

<h2 id="1-5-修改存储引擎"><a href="#1-5-修改存储引擎" class="headerlink" title="1.5 修改存储引擎"></a>1.5 修改存储引擎</h2><p><font color=red>注意：修改存储引擎前需要备份镜像和容器里的数据</font></p>
<h3 id="1-5-1-方法一：修改service文件"><a href="#1-5-1-方法一：修改service文件" class="headerlink" title="1.5.1 方法一：修改service文件"></a>1.5.1 方法一：修改service文件</h3><ol>
<li>通过dockerd -h查看<code>--storage-driver</code>的格式</li>
<li>在docker.servece里dockerd那一行添加<code>--storage-driver engine</code></li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /path/.../docker.service</span><br>......<br>ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --storage-driver <span class="hljs-string">&quot;engine&quot;</span><br>......<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>重启docker</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># systemctl daemon-reload</span><br><span class="hljs-comment"># systemctl restart docker</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>查看docker信息</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># docker info</span><br></code></pre></td></tr></table></figure>

<h3 id="1-5-2-方法二：修改damon-json文件"><a href="#1-5-2-方法二：修改damon-json文件" class="headerlink" title="1.5.2 方法二：修改damon.json文件"></a>1.5.2 方法二：修改damon.json文件</h3><ol>
<li>通过dockerd -h查看<code>--storage-driver</code>的格式</li>
<li>在<code>/etc/docker/daemon.json</code>文件中添加<code>storage-drive string</code></li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json">vim /etc/docker/daemon.json<br>&#123;<br>    <span class="hljs-attr">&quot;stroage-driver&quot;</span>:<span class="hljs-string">&quot;aufs&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>重启docker</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># systemctl daemon-reload</span><br><span class="hljs-comment"># systemctl restart docker</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>查看docker信息</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># docker info</span><br></code></pre></td></tr></table></figure>

<h2 id="1-6-修改存储目录"><a href="#1-6-修改存储目录" class="headerlink" title="1.6 修改存储目录"></a>1.6 修改存储目录</h2><h3 id="1-6-1-修改service文件"><a href="#1-6-1-修改service文件" class="headerlink" title="1.6.1 修改service文件"></a>1.6.1 修改service文件</h3><ol>
<li>通过dockerd -h查看``–data-root`的格式</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">dockerd -h | grep data-root<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>在docker.servece里dockerd那一行添加<code>--data-root string</code>的格式</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># vim /path/.../docker.service</span><br>......<br>ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --data-root <span class="hljs-string">&quot;string&quot;</span><br>......<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>重启docker</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># systemctl daemon-reload</span><br><span class="hljs-comment"># systemctl restart docker</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>查看docker信息</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># docker info</span><br></code></pre></td></tr></table></figure>

<h3 id="1-6-2-修改daemon-json文件"><a href="#1-6-2-修改daemon-json文件" class="headerlink" title="1.6.2 修改daemon.json文件"></a>1.6.2 修改daemon.json文件</h3><ol>
<li>通过dockerd -h查看<code>date-root</code>的语法</li>
<li>修改daemon.json</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json">vim /etc/docker/daemon.json<br>&#123;<br>    <span class="hljs-attr">&quot;data-root&quot;</span>:<span class="hljs-string">&quot;/data/docker&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>重启docker</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># systemctl daemon-reload</span><br><span class="hljs-comment"># systemctl restart docker</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>查看docker信息</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># docker info</span><br></code></pre></td></tr></table></figure>

<h2 id="1-7-总结"><a href="#1-7-总结" class="headerlink" title="1.7 总结"></a>1.7 总结</h2><p>掌握以下知识</p>
<ol>
<li><p>namespace和cgroup是什么。</p>
</li>
<li><p>docker各种安装法师。</p>
</li>
<li><p>docker镜像操作命令。</p>
</li>
<li><p>docker容器的进程对应关系。</p>
</li>
<li><p>docker的存储引擎。</p>
<p>在centos 7.2 是使用的存储引擎是devicemapper，磁盘空间只有100G，可以调大。但是不建议在低版本的CentOS系统运行docker。</p>
<p>推荐使用<code>overlay2</code>存储引擎</p>
</li>
<li><p>知道联合文件系统挂载（Union File System）</p>
</li>
<li><p>只要是修改dockerd里的配置，都可以通过修改service文件和damon.json，使修改的配置生效。</p>
</li>
</ol>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/linux-docker/">linux docker</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2021/09/02/%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AFdocker%EF%BC%88%E4%BA%94%EF%BC%89docker%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">企业级容器技术docker（五）docker仓库管理</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2021/09/02/%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E6%9C%8D%E5%8A%A1Zabbix/">
                        <span class="hidden-mobile">企业级监控服务Zabbix</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/blog/js/debouncer.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/blog/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/blog/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/blog/js/boot.js" ></script>



</body>
</html>
