

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="rlin">
  <meta name="keywords" content="">
  <title>企业级监控服务Zabbix - rlin的运维笔记</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/blog/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/blog/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"rintime.gitee.io","root":"/blog/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>rlin的运维笔记</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="企业级监控服务Zabbix">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-09-02 14:25" pubdate>
        2021年9月2日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      30.4k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      473
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">企业级监控服务Zabbix</h1>
            
            <div class="markdown-body">
              <h1 id="企业级监控服务Zabbix"><a href="#企业级监控服务Zabbix" class="headerlink" title="企业级监控服务Zabbix"></a>企业级监控服务Zabbix</h1><h1 id="一、监控服务介绍"><a href="#一、监控服务介绍" class="headerlink" title="一、监控服务介绍"></a>一、监控服务介绍</h1><h2 id="1-1-监控布局"><a href="#1-1-监控布局" class="headerlink" title="1.1 监控布局"></a>1.1 监控布局</h2><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix1.png" srcset="/blog/img/loading.gif"></p>
<h2 id="1-2-整体布局"><a href="#1-2-整体布局" class="headerlink" title="1.2 整体布局"></a>1.2 整体布局</h2><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix2.png" srcset="/blog/img/loading.gif"></p>
<h2 id="1-3-常见的监控方案"><a href="#1-3-常见的监控方案" class="headerlink" title="1.3 常见的监控方案"></a>1.3 常见的监控方案</h2><p>开源监控软件：cacti、nagios、zabbix、smokeping、open-falcon等</p>
<h3 id="1-3-1-Cacti"><a href="#1-3-1-Cacti" class="headerlink" title="1.3.1 Cacti"></a>1.3.1 Cacti</h3><p><a target="_blank" rel="noopener" href="https://www.cacti.net/">https://www.cacti.net/</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Cacti/cacti">https://github.com/Cacti/cacti</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">Cacti是基于LAMP平台展现的网络流量监测及分析工具，通过SNMP技术或自定义脚本从目标设备/主机获取监控指标信息；其次进行数据存储，调用模板将数据存到数据库，使用rrdtool存储和更新数据，通过rrdtool绘制结果图形；最后进行数据展现，通过Web方式将监控结果呈现出来，常用于在数据中心监控网络设备。<br></code></pre></td></tr></table></figure>

<h3 id="1-3-2-Nagios"><a href="#1-3-2-Nagios" class="headerlink" title="1.3.2 Nagios"></a>1.3.2 Nagios</h3><p><a target="_blank" rel="noopener" href="https://www.nagios.org/">https://www.nagios.org/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nagios用来监视系统和网络的开源应用软件，利用其众多的插件实现对本机和远端服务的监控，当被监控对象发生异常时，会及时向管理员告警，提供一批预设好的监控插件，用户可以之间调用，也可以自定义Shell脚本来监控服务，适合各企业的业务监控，可通过Web页面显示对象状态、日志、告警信息，分层告警机制及自定义监控相对薄弱。<br></code></pre></td></tr></table></figure>

<h3 id="1-3-3-SmokePing"><a href="#1-3-3-SmokePing" class="headerlink" title="1.3.3 SmokePing"></a>1.3.3 SmokePing</h3><p><a target="_blank" rel="noopener" href="https://oss.oetiker.ch/smokeping/">https://oss.oetiker.ch/smokeping/</a></p>
<p><a target="_blank" rel="noopener" href="http://blogs.studylinux.net/?p=794">http://blogs.studylinux.net/?p=794</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">Smokeping是一款用于网络性能监测的开源监控软件，主要用于对IDC的网络状况，网络质量，稳定性等做检测，通过rrdtool制图方式，图形化地展示网络的时延情况，进而能够清楚的判断出网络的即时通信情况。<br></code></pre></td></tr></table></figure>

<h3 id="1-3-4-Open-falcon"><a href="#1-3-4-Open-falcon" class="headerlink" title="1.3.4 Open-falcon"></a>1.3.4 Open-falcon</h3><p><a target="_blank" rel="noopener" href="https://www.open-falcon.org/">https://www.open-falcon.org/</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/XiaoMi/open-falcon">https://github.com/XiaoMi/open-falcon</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">小米公司开源出来的监控软件open-falcon(猎鹰)，监控能力和性能较强。<br></code></pre></td></tr></table></figure>

<h3 id="1-3-5-夜莺"><a href="#1-3-5-夜莺" class="headerlink" title="1.3.5 夜莺"></a>1.3.5 夜莺</h3><p><a target="_blank" rel="noopener" href="https://n9e.didiyun.com/">https://n9e.didiyun.com/</a><br>一款经过大规模生产环境验证的、分布式高性能的运维监控系统，有滴滴基于open-falcon二次开发后开源出来的分布式监控系统。</p>
<h3 id="1-3-6-Zabbix"><a href="#1-3-6-Zabbix" class="headerlink" title="1.3.6 Zabbix"></a>1.3.6 Zabbix</h3><p><a target="_blank" rel="noopener" href="https://www.zabbix.com/cn/">https://www.zabbix.com/cn/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">目前使用较多的开源监控软件，可横向扩展、自定义监控项、支持多种监控方式、可监控网络与服务等。<br></code></pre></td></tr></table></figure>

<h3 id="1-3-7-Prometheus"><a href="#1-3-7-Prometheus" class="headerlink" title="1.3.7 Prometheus"></a>1.3.7 Prometheus</h3><p>针对容器环境的开源监控软件</p>
<h3 id="1-3-8-商业监控解决方案"><a href="#1-3-8-商业监控解决方案" class="headerlink" title="1.3.8 商业监控解决方案"></a>1.3.8 商业监控解决方案</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">监控宝(https://www.jiankongbao.com/)<br>听云(https://www.tingyun.com/)<br></code></pre></td></tr></table></figure>

<h2 id="1-4-Zabbix使用场景及系统概述"><a href="#1-4-Zabbix使用场景及系统概述" class="headerlink" title="1.4 Zabbix使用场景及系统概述"></a>1.4 Zabbix使用场景及系统概述</h2><p><a target="_blank" rel="noopener" href="https://www.zabbix.com/cn/features">https://www.zabbix.com/cn/features</a></p>
<p>Zabbix是一个企业级解决方案，支持实时监控数千台服务器，虚拟机和网络设备，采集百万级监控指标，适用于任何IT基础架构、服务、应用程序和资源的解决方案</p>
<h3 id="1-4-1-zabbix使用场景"><a href="#1-4-1-zabbix使用场景" class="headerlink" title="1.4.1 zabbix使用场景"></a>1.4.1 zabbix使用场景</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix3.png" srcset="/blog/img/loading.gif"></p>
<h3 id="1-4-2-zabbix系统概述"><a href="#1-4-2-zabbix系统概述" class="headerlink" title="1.4.2 zabbix系统概述"></a>1.4.2 zabbix系统概述</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix4.png" srcset="/blog/img/loading.gif"></p>
<h4 id="1-4-2-1-数据采集"><a href="#1-4-2-1-数据采集" class="headerlink" title="1.4.2.1 数据采集"></a>1.4.2.1 数据采集</h4><p>周期性时序数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">主机/对象：服务器、路由器、交换机、存储、防火墙、IP、PORT、URL、自定义监控对象...<br>采集目标：监控项，指标数据（metrics data）<br></code></pre></td></tr></table></figure>

<h4 id="1-4-2-2-数据存储"><a href="#1-4-2-2-数据存储" class="headerlink" title="1.4.2.2 数据存储"></a>1.4.2.2 数据存储</h4><p>监控数据存储系统</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">SQL</span>: <span class="hljs-variable">MySQL</span>/<span class="hljs-function"><span class="hljs-title">MariaDB</span>(<span class="hljs-variable">Zabbix</span>)</span><br><span class="hljs-variable">NoSQL</span>：<span class="hljs-function"><span class="hljs-title">Redis</span>(<span class="hljs-variable">Open</span>-<span class="hljs-variable">falcon</span>)</span><br><span class="hljs-variable">rrd</span>: <span class="hljs-variable">Round</span> <span class="hljs-variable">Robin</span> <span class="hljs-function"><span class="hljs-title">Database</span>(<span class="hljs-variable">Cacti</span>)</span><br></code></pre></td></tr></table></figure>

<h4 id="1-4-2-3-数据类型"><a href="#1-4-2-3-数据类型" class="headerlink" title="1.4.2.3 数据类型"></a>1.4.2.3 数据类型</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">历史数据: 每个监控项采集到的每个监控值<br>趋势数据: 趋势表里主要保留某个监控项一个小时内历史数据的最大值、最小值和平均值以及该监控项一个小时内所采集到的数据个数。<br></code></pre></td></tr></table></figure>

<h4 id="1-4-2-4-阈值"><a href="#1-4-2-4-阈值" class="headerlink" title="1.4.2.4 阈值"></a>1.4.2.4 阈值</h4><p>可按照预定义的阈值等级实现分层报警</p>
<h4 id="1-4-2-5-告警机制"><a href="#1-4-2-5-告警机制" class="headerlink" title="1.4.2.5 告警机制"></a>1.4.2.5 告警机制</h4><p>email,短信,微信,语音,故障自治愈</p>
<h3 id="1-4-3-zabbix-核心任务"><a href="#1-4-3-zabbix-核心任务" class="headerlink" title="1.4.3 zabbix 核心任务"></a>1.4.3 zabbix 核心任务</h3><h3 id="1-4-1-数据采集"><a href="#1-4-1-数据采集" class="headerlink" title="1.4.1 数据采集"></a>1.4.1 数据采集</h3><p>数据采集方式：zabbix-server，zabbix-proxy，zabbix-agent</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Agentless：SNMP,Telnet,ssh, IPMI, JMX,<br>Agent：zabbix agent<br></code></pre></td></tr></table></figure>

<h3 id="1-4-2-数据存储"><a href="#1-4-2-数据存储" class="headerlink" title="1.4.2 数据存储"></a>1.4.2 数据存储</h3><p>zabbix database</p>
<h3 id="1-4-3-数据展示"><a href="#1-4-3-数据展示" class="headerlink" title="1.4.3 数据展示"></a>1.4.3 数据展示</h3><p>zabbix web：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">graph -&gt; screen -&gt; slideshow(将多个screen以幻灯片的方式进行轮流展示)<br></code></pre></td></tr></table></figure>

<p>grafana：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">以zabbix为数据源展示更绚丽的界面<br></code></pre></td></tr></table></figure>

<h3 id="1-4-4-告警通知"><a href="#1-4-4-告警通知" class="headerlink" title="1.4.4 告警通知"></a>1.4.4 告警通知</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">host (host groups) &lt;- templates <span class="hljs-comment">#从模板继承告警配置</span><br>host -&gt; items -&gt; triggers -&gt; action (条件-conditions, 操作-operations) <span class="hljs-comment">#自定义告警配置</span><br></code></pre></td></tr></table></figure>



<h1 id="二、Zabbix-规划及部署"><a href="#二、Zabbix-规划及部署" class="headerlink" title="二、Zabbix 规划及部署"></a>二、Zabbix 规划及部署</h1><p>部署环境：</p>
<p>服务器系统：ubuntu 18.04.3/Centos 7.x</p>
<table>
<thead>
<tr>
<th>主机类型</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>zabbix-server</td>
<td>172.31.0.101</td>
</tr>
<tr>
<td>zabbix-active</td>
<td>172.31.0.102</td>
</tr>
<tr>
<td>zabbix-passive</td>
<td>172.31.0.103</td>
</tr>
<tr>
<td>mysql-master</td>
<td>172.31.0.104</td>
</tr>
<tr>
<td>mysql-slave</td>
<td>172.31.0.105</td>
</tr>
<tr>
<td>web-server1</td>
<td>172.31.0.106</td>
</tr>
<tr>
<td>web-server2</td>
<td>172.31.0.107</td>
</tr>
</tbody></table>
<h2 id="2-1-系统环境"><a href="#2-1-系统环境" class="headerlink" title="2.1 系统环境"></a>2.1 系统环境</h2><p>最小化安装操作系统，然后安装常用依赖包：</p>
<h3 id="2-1-1-Centos-7-x"><a href="#2-1-1-Centos-7-x" class="headerlink" title="2.1.1 Centos 7.x"></a>2.1.1 Centos 7.x</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># yum install vim iotop bc gcc gcc-c++ glibc glibc-devel pcre pcre-devel openssl openssl-devel zip unzip zlib-devel  net-tools lrzsz tree ntpdate telnet lsof tcpdump wget libevent libevent-devel</span><br></code></pre></td></tr></table></figure>

<h3 id="2-1-2-Ubuntu-18-04"><a href="#2-1-2-Ubuntu-18-04" class="headerlink" title="2.1.2 Ubuntu 18.04"></a>2.1.2 Ubuntu 18.04</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># apt install iproute2 ntpdate tcpdump telnet traceroute nfs-kernel-server nfs-common lrzsz tree openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute gcc openssh-server lrzsz tree openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute iotop unzip zip</span><br></code></pre></td></tr></table></figure>

<h2 id="2-2-apt-yum安装-zabbix"><a href="#2-2-apt-yum安装-zabbix" class="headerlink" title="2.2 apt/yum安装 zabbix"></a>2.2 apt/yum安装 zabbix</h2><p><a target="_blank" rel="noopener" href="https://www.zabbix.com/documentation/4.0/zh/manual">https://www.zabbix.com/documentation/4.0/zh/manual</a> #产品手册</p>
<h3 id="2-2-1-apt安装zabbix"><a href="#2-2-1-apt安装zabbix" class="headerlink" title="2.2.1 apt安装zabbix"></a>2.2.1 apt安装zabbix</h3><p>使用apt在ubuntu安装zabbix 4.0.x版本</p>
<h3 id="2-2-1-1-安装zabbix-server"><a href="#2-2-1-1-安装zabbix-server" class="headerlink" title="2.2.1.1 安装zabbix server"></a>2.2.1.1 安装zabbix server</h3><p><a target="_blank" rel="noopener" href="https://www.zabbix.com/cn/download?zabbix=4.0&amp;os_distribution=ubuntu&amp;os_version=18.04_bionic&amp;db=mysql&amp;ws=apache">https://www.zabbix.com/cn/download?zabbix=4.0&amp;os_distribution=ubuntu&amp;os_version=18.04_bionic&amp;db=mysql&amp;ws=apache</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ubuntu 安装zabbix server</span><br><span class="hljs-comment">#下载安装包</span><br>root@zabbix-server:~<span class="hljs-comment"># wget https://repo.zabbix.com/zabbix/4.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_4.0-3+bionic_all.deb</span><br><span class="hljs-comment">#查看安装包内容</span><br>root@zabbix-server:~<span class="hljs-comment"># dpkg -c zabbix-release_4.0-3+bionic_all.deb </span><br>drwxr-xr-x root/root         0 2019-07-31 00:34 ./<br>drwxr-xr-x root/root         0 2019-07-31 00:34 ./etc/<br>drwxr-xr-x root/root         0 2019-07-31 00:34 ./etc/apt/<br>drwxr-xr-x root/root         0 2019-07-31 00:34 ./etc/apt/sources.list.d/<br>-rw-r--r-- root/root       118 2019-07-31 00:34 ./etc/apt/sources.list.d/zabbix.list<br>drwxr-xr-x root/root         0 2019-07-31 00:34 ./etc/apt/trusted.gpg.d/<br>-rwxr-xr-x root/root      2083 2019-07-31 00:34 ./etc/apt/trusted.gpg.d/zabbix-official-repo.gpg<br>drwxr-xr-x root/root         0 2019-07-31 00:34 ./usr/<br>drwxr-xr-x root/root         0 2019-07-31 00:34 ./usr/share/<br>drwxr-xr-x root/root         0 2019-07-31 00:34 ./usr/share/doc/<br>drwxr-xr-x root/root         0 2019-07-31 00:34 ./usr/share/doc/zabbix-release/<br>-rw-r--r-- root/root       267 2019-07-31 00:17 ./usr/share/doc/zabbix-release/README.Debian<br>-rw-r--r-- root/root      1665 2019-07-31 00:34 ./usr/share/doc/zabbix-release/changelog.Debian<br>-rw-r--r-- root/root       561 2019-07-31 00:17 ./usr/share/doc/zabbix-release/copyright<br><span class="hljs-comment">#安装</span><br>root@zabbix-server:~<span class="hljs-comment"># dpkg -i zabbix-release_4.0-3+bionic_all.deb</span><br><span class="hljs-comment">#新添加了zabbix源</span><br>root@zabbix-server:~<span class="hljs-comment"># cat /etc/apt/sources.list.d/zabbix.list </span><br>deb http://repo.zabbix.com/zabbix/4.0/ubuntu bionic main<br>deb-src http://repo.zabbix.com/zabbix/4.0/ubuntu bionic main<br><span class="hljs-comment">#更新源</span><br>root@zabbix-server:~<span class="hljs-comment"># apt update</span><br>root@zabbix-server:~<span class="hljs-comment"># apt -y install zabbix-server-mysql zabbix-frontend-php zabbix-agent</span><br></code></pre></td></tr></table></figure>

<h4 id="2-2-1-2-准备数据库"><a href="#2-2-1-2-准备数据库" class="headerlink" title="2.2.1.2 准备数据库"></a>2.2.1.2 准备数据库</h4><p>在mysql maser安装数据库并授权zabbix使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-mysql-master:~<span class="hljs-comment"># apt update</span><br>root@zabbix-mysql-master:~<span class="hljs-comment"># apt -y install mysql-server mysql-client #或者安装 mariadb-server mariadb-client</span><br>root@zabbix-mysql-master:~<span class="hljs-comment"># vim /etc/mysql/mysql.conf.d/mysqld.cnf #修改监听地址</span><br>bind-address       = 0.0.0.0<br>root@zabbix-mysql-master:~<span class="hljs-comment"># systemctl restart mysql</span><br><br>root@zabbix-mysql-master:~<span class="hljs-comment"># mysql #进入数据库创建账户并授权</span><br>Welcome to the MySQL monitor. Commands end with ; or \g.<br>Your MySQL connection id is 2<br>Server version: 5.7.28-0ubuntu0.18.04.4 (Ubuntu)<br><br>Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.<br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; create database zabbix_server2 character <span class="hljs-built_in">set</span> utf8 collate utf8_bin;<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; grant all privileges on zabbix_server2.* to zabbix@<span class="hljs-string">&quot;172.31.0.%&quot;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>;<br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure>

<h4 id="2-2-1-3-导入数据库"><a href="#2-2-1-3-导入数据库" class="headerlink" title="2.2.1.3 导入数据库"></a>2.2.1.3 导入数据库</h4><p>在zabbix server初始化数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-server:~<span class="hljs-comment"># mysql -uzabbix -p123456 -h172.31.0.104 #测试账户权限</span><br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 3<br>Server version: 5.7.35-0ubuntu0.18.04.1 (Ubuntu)<br><br>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>MySQL [(none)]&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| zabbix_server2     |<br>+--------------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br>mysql&gt; <span class="hljs-built_in">exit</span><br><br><span class="hljs-comment">#初始化数据库</span><br>root@zabbix-server:~<span class="hljs-comment"># zcat /usr/share/doc/zabbix-server-mysql/create.sql.gz | mysql -uzabbix -p123456 -h172.31.0.104 zabbix_server2</span><br><br><span class="hljs-comment">#在数据库服务器查看zabbix_server2是否有导入到数据</span><br>mysql&gt; use zabbix_server2;<br>Database changed<br>mysql&gt; show tables;<br>+----------------------------+<br>| Tables_in_zabbix_server2   |<br>+----------------------------+<br>| acknowledges               |<br>| actions                    |<br>| alerts                     |<br>| application_discovery      |<br>......<br></code></pre></td></tr></table></figure>

<h4 id="2-2-1-4-数据库验证数据"><a href="#2-2-1-4-数据库验证数据" class="headerlink" title="2.2.1.4 数据库验证数据"></a>2.2.1.4 数据库验证数据</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix5.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-2-1-5-编辑zabbix-server配置文件"><a href="#2-2-1-5-编辑zabbix-server配置文件" class="headerlink" title="2.2.1.5 编辑zabbix server配置文件"></a>2.2.1.5 编辑zabbix server配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-server:~<span class="hljs-comment"># vim /etc/zabbix/zabbix_server.conf</span><br>DBHost=172.31.0.104<br>DBName=zabbix_server2<br>DBUser=zabbix<br>DBPassword=123456<br>DBPort=3306<br></code></pre></td></tr></table></figure>

<h4 id="2-2-1-6-重启zabbix服务并"><a href="#2-2-1-6-重启zabbix服务并" class="headerlink" title="2.2.1.6 重启zabbix服务并"></a>2.2.1.6 重启zabbix服务并</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-server:~<span class="hljs-comment"># systemctl restart zabbix-server zabbix-agent apache2 #可以先把下面的配置做完再重启</span><br></code></pre></td></tr></table></figure>

<h4 id="2-2-1-7-访问web界面"><a href="#2-2-1-7-访问web界面" class="headerlink" title="2.2.1.7 访问web界面"></a>2.2.1.7 访问web界面</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs sh">root@zabbix-server:~<span class="hljs-comment"># grep zabbix /etc/apache2/ -R</span><br>/etc/apache2/conf-available/zabbix.conf:<span class="hljs-comment"># Define /zabbix alias, this is the default</span><br>/etc/apache2/conf-available/zabbix.conf:    Alias /zabbix /usr/share/zabbix<br>/etc/apache2/conf-available/zabbix.conf:&lt;Directory <span class="hljs-string">&quot;/usr/share/zabbix&quot;</span>&gt;<br>/etc/apache2/conf-available/zabbix.conf:&lt;Directory <span class="hljs-string">&quot;/usr/share/zabbix/conf&quot;</span>&gt;<br>/etc/apache2/conf-available/zabbix.conf:&lt;Directory <span class="hljs-string">&quot;/usr/share/zabbix/app&quot;</span>&gt;<br>/etc/apache2/conf-available/zabbix.conf:&lt;Directory <span class="hljs-string">&quot;/usr/share/zabbix/include&quot;</span>&gt;<br>/etc/apache2/conf-available/zabbix.conf:&lt;Directory <span class="hljs-string">&quot;/usr/share/zabbix/local&quot;</span>&gt;<br>/etc/apache2/conf-enabled/zabbix.conf:<span class="hljs-comment"># Define /zabbix alias, this is the default</span><br>/etc/apache2/conf-enabled/zabbix.conf:    Alias /zabbix /usr/share/zabbix<br>/etc/apache2/conf-enabled/zabbix.conf:&lt;Directory <span class="hljs-string">&quot;/usr/share/zabbix&quot;</span>&gt;<br>/etc/apache2/conf-enabled/zabbix.conf:&lt;Directory <span class="hljs-string">&quot;/usr/share/zabbix/conf&quot;</span>&gt;<br>/etc/apache2/conf-enabled/zabbix.conf:&lt;Directory <span class="hljs-string">&quot;/usr/share/zabbix/app&quot;</span>&gt;<br>/etc/apache2/conf-enabled/zabbix.conf:&lt;Directory <span class="hljs-string">&quot;/usr/share/zabbix/include&quot;</span>&gt;<br>/etc/apache2/conf-enabled/zabbix.conf:&lt;Directory <span class="hljs-string">&quot;/usr/share/zabbix/local&quot;</span>&gt;<br><br>root@zabbix-server:~<span class="hljs-comment"># cat /etc/apache2/conf-available/zabbix.conf</span><br><span class="hljs-comment"># Define /zabbix alias, this is the default</span><br>&lt;IfModule mod_alias.c&gt;<br>    Alias /zabbix /usr/share/zabbix <span class="hljs-comment">#访问网页 ip/zabbix 的时候几句会传到/usr/share/zabbix里</span><br>&lt;/IfModule&gt;<br><br>root@zabbix-server:~<span class="hljs-comment"># ll /usr/share/zabbix/</span><br>total 1064<br>drwxr-xr-x  11 root root  4096 Aug 15 08:34 ./<br>drwxr-xr-x 131 root root  4096 Aug 15 08:34 ../<br>-rw-r--r--   1 root root 31683 Jun 11 19:01 actionconf.php<br>-rw-r--r--   1 root root  3565 Jun 11 19:01 adm.gui.php<br>-rw-r--r--   1 root root  7018 Jun 11 19:01 adm.housekeeper.php<br>-rw-r--r--   1 root root  4331 Jun 11 19:01 adm.iconmapping.php<br>-rw-r--r--   1 root root  4451 Jun 11 19:01 adm.images.php<br>-rw-r--r--   1 root root  3361 Jun 11 19:01 adm.macros.php<br>-rw-r--r--   1 root root  3637 Jun 11 19:01 adm.other.php<br>-rw-r--r--   1 root root  7990 Jun 11 19:01 adm.regexps.php<br>-rw-r--r--   1 root root  5054 Jun 11 19:01 adm.triggerdisplayoptions.php<br>-rw-r--r--   1 root root  5089 Jun 11 19:01 adm.triggerseverities.php<br>-rw-r--r--   1 root root  5947 Jun 11 19:01 adm.valuemapping.php<br>-rw-r--r--   1 root root  1882 Jun 11 19:01 adm.workingtime.php<br>-rw-r--r--   1 root root  2326 Jun 11 19:01 api_jsonrpc.php<br>drwxr-xr-x   4 root root  4096 Aug 15 08:34 app/<br>-rw-r--r--   1 root root 10407 Jun 11 19:01 applications.php<br>drwxr-xr-x   5 root root  4096 Aug 15 08:34 assets/<br>drwxr-xr-x   2 root root  4096 Aug 15 08:34 audio/<br>-rw-r--r--   1 root root  4743 Jun 11 19:01 auditacts.php<br>-rw-r--r--   1 root root  6285 Jun 11 19:01 auditlogs.php<br>-rw-r--r--   1 root root  1411 Jun 11 19:01 browserwarning.php<br>-rw-r--r--   1 root root  5095 Jun 11 19:01 chart2.php<br>-rw-r--r--   1 root root  6972 Jun 11 19:01 chart3.php<br>-rw-r--r--   1 root root  5591 Jun 11 19:01 chart4.php<br>-rw-r--r--   1 root root  5709 Jun 11 19:01 chart5.php<br>-rw-r--r--   1 root root  3596 Jun 11 19:01 chart6.php<br>-rw-r--r--   1 root root  3901 Jun 11 19:01 chart7.php<br>-rw-r--r--   1 root root  4505 Jun 11 19:01 chart.php<br>-rw-r--r--   1 root root  3439 Jun 11 19:01 charts.php<br>drwxr-xr-x   2 root root  4096 Aug 15 08:34 conf/<br>-rw-r--r--   1 root root  6991 Jun 11 19:01 conf.import.php<br>-rw-r--r--   1 root root 17420 Jun 11 19:01 correlation.php<br>-rw-r--r--   1 root root 12372 Jun 11 19:01 discoveryconf.php<br>-rw-r--r--   1 root root 32274 Jun 11 19:01 disc_prototypes.php<br>-rw-r--r--   1 root root 32988 Jun 11 19:01 favicon.ico<br>drwxr-xr-x   2 root root  4096 Jun 11 19:01 fonts/<br>-rw-r--r--   1 root root 22529 Jun 11 19:01 graphs.php<br>-rw-r--r--   1 root root  4490 Jun 11 19:01 history.php<br>-rw-r--r--   1 root root 25250 Jun 11 19:01 host_discovery.php<br>-rw-r--r--   1 root root  9084 Jun 11 19:01 hostgroups.php<br>-rw-r--r--   1 root root  5178 Jun 11 19:01 hostinventoriesoverview.php<br>-rw-r--r--   1 root root  8594 Jun 11 19:01 hostinventories.php<br>-rw-r--r--   1 root root 15470 Jun 11 19:01 host_prototypes.php<br>-rw-r--r--   1 root root  3953 Jun 11 19:01 host_screen.php<br>-rw-r--r--   1 root root 43419 Jun 11 19:01 hosts.php<br>-rw-r--r--   1 root root 27905 Jun 11 19:01 httpconf.php<br>-rw-r--r--   1 root root  6592 Jun 11 19:01 httpdetails.php<br>-rw-r--r--   1 root root  1856 Jun 11 19:01 image.php<br>-rw-r--r--   1 root root  3314 Jun 11 19:01 imgstore.php<br>drwxr-xr-x   4 root root  4096 Aug 15 08:34 include/<br>-rw-r--r--   1 root root  2865 Jun 11 19:01 index_http.php<br>-rw-r--r--   1 root root  3546 Jun 11 19:01 index.php<br>-rw-r--r--   1 root root 79185 Jun 11 19:01 items.php<br>drwxr-xr-x   5 root root  4096 Aug 15 08:34 js/<br>-rw-r--r--   1 root root 14763 Jun 11 19:01 jsLoader.php<br>-rw-r--r--   1 root root 12708 Jun 11 19:01 jsrpc.php<br>-rw-r--r--   1 root root 25422 Jun 11 19:01 latest.php<br>drwxr-xr-x   4 root root  4096 Aug 15 08:34 <span class="hljs-built_in">local</span>/<br>drwxr-xr-x  35 root root  4096 Aug 15 08:34 locale/<br>-rw-r--r--   1 root root 19923 Jun 11 19:01 maintenance.php<br>-rw-r--r--   1 root root  6989 Jun 11 19:01 map.import.php<br>-rw-r--r--   1 root root  2142 Jun 11 19:01 map.php<br>-rw-r--r--   1 root root  8606 Jun 11 19:01 overview.php<br>-rw-r--r--   1 root root  6707 Jun 11 19:01 profile.php<br>-rw-r--r--   1 root root  8430 Jun 11 19:01 queue.php<br>-rw-r--r--   1 root root 15596 Jun 11 19:01 report2.php<br>-rw-r--r--   1 root root  8337 Jun 11 19:01 report4.php<br>-rw-r--r--   1 root root   974 Jun 11 19:01 robots.txt<br>-rw-r--r--   1 root root 13147 Jun 11 19:01 screenconf.php<br>-rw-r--r--   1 root root 10448 Jun 11 19:01 screenedit.php<br>-rw-r--r--   1 root root  6993 Jun 11 19:01 screen.import.php<br>-rw-r--r--   1 root root  4339 Jun 11 19:01 screens.php<br>-rw-r--r--   1 root root 13392 Jun 11 19:01 search.php<br>-rw-r--r--   1 root root 12290 Jun 11 19:01 services.php<br>-rw-r--r--   1 root root  4335 Jun 11 19:01 setup.php<br>-rw-r--r--   1 root root 12757 Jun 11 19:01 slideconf.php<br>-rw-r--r--   1 root root  6486 Jun 11 19:01 slides.php<br>-rw-r--r--   1 root root  5413 Jun 11 19:01 srv_status.php<br>-rw-r--r--   1 root root  9242 Jun 11 19:01 sysmap.php<br>-rw-r--r--   1 root root 16188 Jun 11 19:01 sysmaps.php<br>-rw-r--r--   1 root root 19407 Jun 11 19:01 templates.php<br>-rw-r--r--   1 root root  6418 Jun 11 19:01 toptriggers.php<br>-rw-r--r--   1 root root  5466 Jun 11 19:01 tr_events.php<br>-rw-r--r--   1 root root 23536 Jun 11 19:01 trigger_prototypes.php<br>-rw-r--r--   1 root root 31372 Jun 11 19:01 triggers.php<br>-rw-r--r--   1 root root 15475 Jun 11 19:01 usergrps.php<br>-rw-r--r--   1 root root 13245 Jun 11 19:01 users.php<br>-rw-r--r--   1 root root   841 Jun 11 19:01 zabbix.php<br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix6.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-2-1-8-解决时区问题"><a href="#2-2-1-8-解决时区问题" class="headerlink" title="2.2.1.8 解决时区问题"></a>2.2.1.8 解决时区问题</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#不解决时区问题，就会在zabbix-web的初始化中出现问题</span><br>root@zabbix-server:~<span class="hljs-comment"># vim /etc/zabbix/apache.conf</span><br>......<br>&lt;IfModule mod_php5.c&gt;<br>......<br>php_value date.timezone Asia/Shanghai <span class="hljs-comment">#添加这行</span><br>&lt;/IfModule&gt;<br>&lt;IfModule mod_php7.c&gt;<br>......<br>php_value date.timezone Asia/Shanghai <span class="hljs-comment">#添加这行</span><br>&lt;/IfModule&gt;<br>root@zabbix-server:~<span class="hljs-comment"># systemctl restart zabbix-server zabbix-agent apache2</span><br>root@zabbix-server:~<span class="hljs-comment"># systemctl enable zabbix-server zabbix-agent apache2</span><br></code></pre></td></tr></table></figure>

<p>报错的界面</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix7.png" srcset="/blog/img/loading.gif"></p>
<p>正常的界面</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix8.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-2-1-9-数据库配置"><a href="#2-2-1-9-数据库配置" class="headerlink" title="2.2.1.9 数据库配置"></a>2.2.1.9 数据库配置</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix9.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-2-1-10-zabbix-server配置"><a href="#2-2-1-10-zabbix-server配置" class="headerlink" title="2.2.1.10 zabbix server配置"></a>2.2.1.10 zabbix server配置</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix10.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-2-1-11-信息确认"><a href="#2-2-1-11-信息确认" class="headerlink" title="2.2.1.11 信息确认"></a>2.2.1.11 信息确认</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix11.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-2-1-12-配置完成"><a href="#2-2-1-12-配置完成" class="headerlink" title="2.2.1.12 配置完成"></a>2.2.1.12 配置完成</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix12.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-2-1-13-登录界面"><a href="#2-2-1-13-登录界面" class="headerlink" title="2.2.1.13 登录界面"></a>2.2.1.13 登录界面</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix13.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-2-1-14-zabbix登录后的监控图形界面"><a href="#2-2-1-14-zabbix登录后的监控图形界面" class="headerlink" title="2.2.1.14 zabbix登录后的监控图形界面"></a>2.2.1.14 zabbix登录后的监控图形界面</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix14.png" srcset="/blog/img/loading.gif"></p>
<h3 id="2-2-2-yum安装zabbix"><a href="#2-2-2-yum安装zabbix" class="headerlink" title="2.2.2 yum安装zabbix"></a>2.2.2 yum安装zabbix</h3><h2 id="2-3-编译安装zabbix"><a href="#2-3-编译安装zabbix" class="headerlink" title="2.3 编译安装zabbix"></a>2.3 编译安装zabbix</h2><p>编译安装zabbix server与agent</p>
<h3 id="2-3-1-下载源码包"><a href="#2-3-1-下载源码包" class="headerlink" title="2.3.1 下载源码包"></a>2.3.1 下载源码包</h3><p><a target="_blank" rel="noopener" href="https://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable">https://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable</a> #下载地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># pwd</span><br>/usr/<span class="hljs-built_in">local</span>/src<br>方法一：<br><span class="hljs-comment"># groupadd -g 1001 zabbix #创建zabbix用户和组</span><br><span class="hljs-comment"># useradd -u 1001 -g 1001 zabbix</span><br><span class="hljs-comment"># useradd -u 1001 -g 1001 zabbix #验证用户id</span><br>方法二<br><span class="hljs-comment"># groupadd zabbix</span><br><span class="hljs-comment"># useradd -g zabbix zabbix</span><br><br><span class="hljs-comment"># wget https://cdn.zabbix.com/zabbix/sources/stable/4.0/zabbix-4.0.32.tar.gz</span><br><span class="hljs-comment"># tar xf zabbix-4.0.32.tar.gz</span><br><span class="hljs-comment"># cd zabbix-4.0.32/</span><br></code></pre></td></tr></table></figure>

<h3 id="2-3-2-解决依赖关系"><a href="#2-3-2-解决依赖关系" class="headerlink" title="2.3.2 解决依赖关系"></a>2.3.2 解决依赖关系</h3><p>Centos :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># yum install gcc libxml2-devel  net-snmp net-snmp-devel  curl curl-devel php php-bcmath php-mbstring mariadb mariadb-devel -y</span><br></code></pre></td></tr></table></figure>

<p>Ubuntu：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># apt update</span><br><span class="hljs-comment"># apt-get install apache2 apache2-bin apache2-data apache2-utils fontconfig-config fonts-dejavu-core fping libapache2-mod-php libapache2-mod-php7.2 libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap libfontconfig1 libgd3 libiksemel3 libjbig0 libjpeg-turbo8 libjpeg8 liblua5.2-0 libodbc1 libopenipmi0 libsensors4 libsnmp-base libsnmp30 libsodium23 libssh2-1 libtiff5 libwebp6 libxpm4 php-bcmath php-common php-gd php-ldap php-mbstring php-mysql php-xml php7.2-bcmath php7.2-cli php7.2-common php7.2-gd php7.2-json php7.2-ldap php7.2-mbstring php7.2-mysql php7.2-opcache php7.2-xml php7.2-readline snmpd ssl-cert ttf-dejavu-core libmysqlclient-dev libxml2-dev libxml2 snmp libsnmp-dev libevent-dev openjdk-8-jdk curl libcurl4-openssl-dev</span><br></code></pre></td></tr></table></figure>

<h3 id="2-3-3-编译安装Zabbix"><a href="#2-3-3-编译安装Zabbix" class="headerlink" title="2.3.3 编译安装Zabbix"></a>2.3.3 编译安装Zabbix</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ./configure --help</span><br><br><span class="hljs-comment"># ./configure --prefix=/apps/zabbix_server --enable-server --enable-agent --with-mysql --with-net-snmp --with-libcurl --with-libxml2 --enable-java</span><br><br><span class="hljs-comment"># make install</span><br><br><span class="hljs-comment"># tree /apps/zabbix_server/</span><br>/apps/zabbix_server/<br>├── bin<br>│   ├── zabbix_get<br>│   └── zabbix_sender<br>├── etc<br>│   ├── zabbix_agentd.conf<br>│   ├── zabbix_agentd.conf.d<br>│   ├── zabbix_server.conf<br>│   └── zabbix_server.conf.d<br>├── lib<br>│   └── modules<br>├── sbin<br>│   ├── zabbix_agentd<br>│   ├── zabbix_java<br>│   │   ├── bin<br>│   │   │   └── zabbix-java-gateway-4.0.32.jar<br>│   │   ├── lib<br>│   │   │   ├── android-json-4.3_r3.1.jar<br>│   │   │   ├── logback-classic-1.2.3.jar<br>│   │   │   ├── logback-console.xml<br>│   │   │   ├── logback-core-1.2.3.jar<br>│   │   │   ├── logback.xml<br>│   │   │   └── slf4j-api-1.7.30.jar<br>│   │   ├── settings.sh<br>│   │   ├── shutdown.sh<br>│   │   └── startup.sh<br>│   └── zabbix_server<br>└── share<br>    ├── man<br>    │   ├── man1<br>    │   │   ├── zabbix_get.1<br>    │   │   └── zabbix_sender.1<br>    │   └── man8<br>    │       ├── zabbix_agentd.8<br>    │       └── zabbix_server.8<br>    └── zabbix<br>        ├── alertscripts<br>        └── externalscripts<br><br>17 directories, 20 files<br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix15.png" srcset="/blog/img/loading.gif"></p>
<h3 id="2-3-4-准备数据库"><a href="#2-3-4-准备数据库" class="headerlink" title="2.3.4 准备数据库"></a>2.3.4 准备数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># apt update</span><br><span class="hljs-comment"># apt install -y mysql-server mysql-client</span><br><span class="hljs-comment"># vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br>bind-address       = 0.0.0.0<br><span class="hljs-comment"># systemctl restart mysql</span><br><span class="hljs-comment"># systemctl enable mysql</span><br><br>root@zabbix-mysql-master:~<span class="hljs-comment"># mysql #进入数据库创建账户并授权</span><br>Welcome to the MySQL monitor. Commands end with ; or \g.<br>Your MySQL connection id is 2<br>Server version: 5.7.28-0ubuntu0.18.04.4 (Ubuntu)<br><br>Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; create database zabbix_server character <span class="hljs-built_in">set</span> utf8 collate utf8_bin;<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; grant all privileges on zabbix_server.* to rlin@<span class="hljs-string">&quot;172.31.0.%&quot;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>;<br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br>mysql&gt; flush privileges;<br>Query OK, 0 rows affected (0.00 sec)<br></code></pre></td></tr></table></figure>

<h3 id="2-3-5-导入数据库"><a href="#2-3-5-导入数据库" class="headerlink" title="2.3.5 导入数据库"></a>2.3.5 导入数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># zabbix server</span><br><span class="hljs-comment"># apt install -y mysql-client #安装mysql客户端命令，用于测试zabbix 数据库账号权限</span><br><span class="hljs-comment"># mysql -urlin -p123456 -h172.31.0.104 #测试权限</span><br>mysql&gt; show databases; <span class="hljs-comment">#查看数据库</span><br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| zabbix_server      |<br>+--------------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br><span class="hljs-comment">#注意账号密码！！！</span><br><span class="hljs-comment"># cd /usr/local/src/zabbix-4.0.32/database/mysql</span><br><span class="hljs-comment">#例子：</span><br><span class="hljs-comment"># mysql -uusername -ppassword -hhost DBname &lt; filename.sql</span><br><span class="hljs-comment"># mysql -urlin -p123456 -h172.31.0.104 zabbix_server &lt; schema.sql</span><br><span class="hljs-comment"># mysql -urlin -p123456 -h172.31.0.104 zabbix_server &lt; images.sql</span><br><span class="hljs-comment"># mysql -urlin -p123456 -h172.31.0.104 zabbix_server &lt; data.sql</span><br></code></pre></td></tr></table></figure>

<h3 id="2-3-6-数据库验证数据"><a href="#2-3-6-数据库验证数据" class="headerlink" title="2.3.6 数据库验证数据"></a>2.3.6 数据库验证数据</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># mysql -urlin -p123456 -h172.31.0.104</span><br>mysql&gt; use zabbix_server;<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>mysql&gt; show tables;<br>+----------------------------+<br>| Tables_in_zabbix_server    |<br>+----------------------------+<br>| acknowledges               |<br>| actions                    |<br>| alerts                     |<br>| ......                     |<br>| valuemaps                  |<br>| widget                     |<br>| widget_field               |<br>+----------------------------+<br>144 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix16.png" srcset="/blog/img/loading.gif"></p>
<h3 id="2-3-7-编辑zabbix-server配置文件"><a href="#2-3-7-编辑zabbix-server配置文件" class="headerlink" title="2.3.7 编辑zabbix server配置文件"></a>2.3.7 编辑zabbix server配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /apps/zabbix_server/etc/zabbix_server.conf</span><br><span class="hljs-comment"># grep &quot;^[a-Z]&quot; /apps/zabbix_server/etc/zabbix_server.conf</span><br>LogFile=/apps/zabbix_server/<span class="hljs-built_in">log</span>/zabbix_server.log<br>DBHost=172.31.0.104<br>DBName=zabbix_server<br>DBUser=rlin<br>DBPassword=123456<br>DBPort=3306<br>Timeout=30<br>LogSlowQueries=3000<br><br><span class="hljs-comment"># mkdir /apps/zabbix_server/log/</span><br><span class="hljs-comment"># chown -R zabbix.zabbix /apps/zabbix_server</span><br></code></pre></td></tr></table></figure>

<h3 id="2-3-8-启动zabbix-server"><a href="#2-3-8-启动zabbix-server" class="headerlink" title="2.3.8 启动zabbix server"></a>2.3.8 启动zabbix server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># /apps/zabbix_server/sbin/zabbix_server -c /apps/zabbix_server/etc/zabbix_server.conf</span><br><br><span class="hljs-comment"># /apps/zabbix_server/sbin/zabbix_agentd</span><br><br>ss -tnl<br>State          Recv-Q          Send-Q                    Local Address:Port                      Peer Address:Port<br>......<br>LISTEN         0               128                             0.0.0.0:10050                          0.0.0.0:* <span class="hljs-comment">#zabbix-agent</span><br>LISTEN         0               128                             0.0.0.0:10051                          0.0.0.0:* <span class="hljs-comment">#zabbix-server</span><br>......<br><br><br><span class="hljs-comment"># tail /tmp/zabbix_server.log</span><br>54340:20191213:182423.876 server <span class="hljs-comment">#32 started [preprocessing worker #2]</span><br>54341:20191213:182423.876 server <span class="hljs-comment">#33 started [preprocessing worker #3]</span><br>54339:20191213:182423.976 server <span class="hljs-comment">#31 started [preprocessing worker #1]</span><br></code></pre></td></tr></table></figure>

<h3 id="2-3-9-配置web界面"><a href="#2-3-9-配置web界面" class="headerlink" title="2.3.9 配置web界面"></a>2.3.9 配置web界面</h3><h4 id="2-3-9-1-拷贝web界面程序"><a href="#2-3-9-1-拷贝web界面程序" class="headerlink" title="2.3.9.1 拷贝web界面程序"></a>2.3.9.1 拷贝web界面程序</h4><p><a target="_blank" rel="noopener" href="https://www.zabbix.com/documentation/4.0/zh/manual/installation/install">https://www.zabbix.com/documentation/4.0/zh/manual/installation/install</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># mkdir /var/www/html/zabbix</span><br><span class="hljs-comment"># cd /usr/local/src/zabbix-4.0.32</span><br><span class="hljs-comment"># pwd</span><br>/usr/<span class="hljs-built_in">local</span>/src/zabbix-4.0.32<br><span class="hljs-comment"># cd frontends/php/</span><br><span class="hljs-comment"># cp -a . /var/www/html/zabbix/</span><br><span class="hljs-comment"># systemctl start apache2</span><br><span class="hljs-comment"># systemctl enable apache2</span><br></code></pre></td></tr></table></figure>

<h4 id="2-3-9-2-访问web界面"><a href="#2-3-9-2-访问web界面" class="headerlink" title="2.3.9.2 访问web界面"></a>2.3.9.2 访问web界面</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix17.png" srcset="/blog/img/loading.gif" alt="本机ip/zabbix"></p>
<h4 id="2-3-9-3-当前报错界面"><a href="#2-3-9-3-当前报错界面" class="headerlink" title="2.3.9.3 当前报错界面"></a>2.3.9.3 当前报错界面</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix18.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-3-9-4-解决报错"><a href="#2-3-9-4-解决报错" class="headerlink" title="2.3.9.4 解决报错"></a>2.3.9.4 解决报错</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># apt-get install -y php-gettext php-xml php-net-socket php-gd php-mysql</span><br><span class="hljs-comment"># systemctl restart apache2</span><br><br><span class="hljs-comment">#一般是根据网页里fail提示来修改</span><br><span class="hljs-comment"># vim /etc/php/7.2/apache2/php.ini</span><br>post_max_size = 16M<br>max_execution_time = 300<br>max_input_time = 300<br>date.timezone = Asia/Shanghai<br><span class="hljs-comment"># systemctl restart apache2</span><br></code></pre></td></tr></table></figure>

<h4 id="2-3-9-5-验证当前界面"><a href="#2-3-9-5-验证当前界面" class="headerlink" title="2.3.9.5 验证当前界面"></a>2.3.9.5 验证当前界面</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix19.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-3-9-6-数据库配置"><a href="#2-3-9-6-数据库配置" class="headerlink" title="2.3.9.6 数据库配置"></a>2.3.9.6 数据库配置</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix20.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-3-9-7-zabbix-server配置"><a href="#2-3-9-7-zabbix-server配置" class="headerlink" title="2.3.9.7 zabbix server配置"></a>2.3.9.7 zabbix server配置</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix21.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-3-9-8-信息确认"><a href="#2-3-9-8-信息确认" class="headerlink" title="2.3.9.8 信息确认"></a>2.3.9.8 信息确认</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix22.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-3-9-9-创建配置文件："><a href="#2-3-9-9-创建配置文件：" class="headerlink" title="2.3.9.9 创建配置文件："></a>2.3.9.9 创建配置文件：</h4><p>需要手动下载配置文件并上传至zabbix server的/var/www/html/zabbix/conf/zabbix.conf.php路径</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix23.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-3-9-10-验证zabbix-server配置文件"><a href="#2-3-9-10-验证zabbix-server配置文件" class="headerlink" title="2.3.9.10 验证zabbix server配置文件"></a>2.3.9.10 验证zabbix server配置文件</h4><p>手动上传到服务器指定路径并验证文件内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cat /var/www/html/zabbix/conf/zabbix.conf.php</span><br>&lt;?php<br>// Zabbix GUI configuration file.<br>global <span class="hljs-variable">$DB</span>;<br><br><span class="hljs-variable">$DB</span>[<span class="hljs-string">&#x27;TYPE&#x27;</span>]     = <span class="hljs-string">&#x27;MYSQL&#x27;</span>;<br><span class="hljs-variable">$DB</span>[<span class="hljs-string">&#x27;SERVER&#x27;</span>]   = <span class="hljs-string">&#x27;172.31.0.104&#x27;</span>;<br><span class="hljs-variable">$DB</span>[<span class="hljs-string">&#x27;PORT&#x27;</span>]     = <span class="hljs-string">&#x27;3306&#x27;</span>;<br><span class="hljs-variable">$DB</span>[<span class="hljs-string">&#x27;DATABASE&#x27;</span>] = <span class="hljs-string">&#x27;zabbix_server&#x27;</span>;<br><span class="hljs-variable">$DB</span>[<span class="hljs-string">&#x27;USER&#x27;</span>]     = <span class="hljs-string">&#x27;rlin&#x27;</span>;<br><span class="hljs-variable">$DB</span>[<span class="hljs-string">&#x27;PASSWORD&#x27;</span>] = <span class="hljs-string">&#x27;123456&#x27;</span>;<br><br>// Schema name. Used <span class="hljs-keyword">for</span> IBM DB2 and PostgreSQL.<br><span class="hljs-variable">$DB</span>[<span class="hljs-string">&#x27;SCHEMA&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><br><span class="hljs-variable">$ZBX_SERVER</span>      = <span class="hljs-string">&#x27;172.31.0.101&#x27;</span>;<br><span class="hljs-variable">$ZBX_SERVER_PORT</span> = <span class="hljs-string">&#x27;10051&#x27;</span>;<br><span class="hljs-variable">$ZBX_SERVER_NAME</span> = <span class="hljs-string">&#x27;rlin-zabbix-server-1&#x27;</span>;<br><br><span class="hljs-variable">$IMAGE_FORMAT_DEFAULT</span> = IMAGE_FORMAT_PNG;<br></code></pre></td></tr></table></figure>

<h4 id="2-3-9-11-刷新页面"><a href="#2-3-9-11-刷新页面" class="headerlink" title="2.3.9.11 刷新页面"></a>2.3.9.11 刷新页面</h4><p>配置文件上传成功后刷新web页面验证是否生效，然后在生效后点finish即可完成zabbix server 的初始化。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix24.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-3-9-12-登录界面"><a href="#2-3-9-12-登录界面" class="headerlink" title="2.3.9.12 登录界面"></a>2.3.9.12 登录界面</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix25.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-3-9-13-zabbix-首页"><a href="#2-3-9-13-zabbix-首页" class="headerlink" title="2.3.9.13 zabbix 首页"></a>2.3.9.13 zabbix 首页</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix26.png" srcset="/blog/img/loading.gif"></p>
<h3 id="2-3-10-启动zabbix-agent"><a href="#2-3-10-启动zabbix-agent" class="headerlink" title="2.3.10 启动zabbix agent"></a>2.3.10 启动zabbix agent</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># /apps/zabbix_server/sbin/zabbix_agentd</span><br></code></pre></td></tr></table></figure>

<h3 id="2-3-11-验证zabbix-监控数据"><a href="#2-3-11-验证zabbix-监控数据" class="headerlink" title="2.3.11 验证zabbix 监控数据"></a>2.3.11 验证zabbix 监控数据</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix27.png" srcset="/blog/img/loading.gif"></p>
<h3 id="2-3-12-zabbix-server与agent启动文件"><a href="#2-3-12-zabbix-server与agent启动文件" class="headerlink" title="2.3.12 zabbix server与agent启动文件"></a>2.3.12 zabbix server与agent启动文件</h3><p>通过service启动文件启动zabbix server与zabbix agent。</p>
<h4 id="2-3-12-1-zabbix-server启动脚本"><a href="#2-3-12-1-zabbix-server启动脚本" class="headerlink" title="2.3.12.1 zabbix server启动脚本"></a>2.3.12.1 zabbix server启动脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#先停止当前zabbix server进程</span><br><span class="hljs-comment"># pkill zabbix_server</span><br><span class="hljs-comment"># pkill zabbix_agent</span><br><span class="hljs-comment"># ps -ef | grep zabbix</span><br><br><span class="hljs-comment"># cat /etc/systemd/system/zabbix-server.service</span><br>[Unit]<br>Description=Zabbix Server<br>After=syslog.target<br>After=network.target<br><br>[Service]<br>Environment=<span class="hljs-string">&quot;CONFFILE=/apps/zabbix_server/etc/zabbix_server.conf&quot;</span><br>EnvironmentFile=-/etc/default/zabbix-server<br>Type=forking<br>Restart=on-failure<br>PIDFile=/apps/zabbix_server/run/zabbix_server.pid<br>KillMode=control-group<br>ExecStart=/apps/zabbix_server/sbin/zabbix_server -c <span class="hljs-variable">$CONFFILE</span><br>ExecStop=/bin/<span class="hljs-built_in">kill</span> -SIGTERM <span class="hljs-variable">$MAINPID</span><br>RestartSec=10s<br>TimeoutSec=infinity<br><br>[Install]<br>WantedBy=multi-user.target<br><br><span class="hljs-comment"># vim /apps/zabbix_server/etc/zabbix_server.conf</span><br>PidFile=/apps/zabbix_server/run/zabbix_server.pid <span class="hljs-comment">#pid文件最好放一块</span><br><br><span class="hljs-comment"># mkdir /apps/zabbix_server/run</span><br><br><span class="hljs-comment"># systemctl daemon-reload</span><br><br><span class="hljs-comment"># chown -R zabbix.zabbix /apps/zabbix_server</span><br><br><span class="hljs-comment"># systemctl start zabbix-server &amp;&amp; systemctl enable zabbix-server</span><br><br><span class="hljs-comment"># ps -ef | grep zabbix</span><br><br><span class="hljs-comment"># ss -tnl #出现10051端口即可</span><br></code></pre></td></tr></table></figure>

<h4 id="2-3-12-2-zabbix-agent启动脚本"><a href="#2-3-12-2-zabbix-agent启动脚本" class="headerlink" title="2.3.12.2 zabbix agent启动脚本"></a>2.3.12.2 zabbix agent启动脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#先停止当前zabbix_agent进程</span><br><span class="hljs-comment"># pkill zabbix_agentd</span><br><br><span class="hljs-comment"># cat /etc/systemd/system/zabbix-agent.service</span><br>[Unit]<br>Description=Zabbix Agent<br>After=syslog.target<br>After=network.target<br><br>[Service]<br>Environment=<span class="hljs-string">&quot;CONFFILE=apps/zabbix_server/etc/zabbix_agentd.conf&quot;</span><br>EnvironmentFile=-/etc/default/zabbix-agent<br>Type=forking<br>Restart=on-failure<br>PIDFile=/apps/zabbix_server/run/zabbix_agentd.pid<br>KillMode=control-group<br>ExecStart=/apps/zabbix_server/sbin/zabbix_agentd -c <span class="hljs-variable">$CONFFILE</span><br>ExecStop=/bin/<span class="hljs-built_in">kill</span> -SIGTERM <span class="hljs-variable">$MAINPID</span><br>RestartSec=10s<br>User=zabbix<br>Group=zabbix<br><br>[Install]<br>WantedBy=multi-user.target<br><br><span class="hljs-comment"># vim /apps/zabbix_server/etc/zabbix_agentd.conf</span><br>PidFile=/apps/zabbix_server/run/zabbix_agentd.pid<br><br><span class="hljs-comment"># grep &quot;^[a-Z]&quot; /apps/zabbix_server/etc/zabbix_agentd.conf</span><br>PidFile=/apps/zabbix_server/run/zabbix_agentd.pid<br>LogFile=/apps/zabbix_server/<span class="hljs-built_in">log</span>/zabbix_agentd.log<br>Server=127.0.0.1<br>ServerActive=127.0.0.1<br>Hostname=Zabbix server<br><br><span class="hljs-comment"># systemctl daemon-reload</span><br><br><span class="hljs-comment"># systemctl start zabbix-agent &amp;&amp; systemctl enable zabbix-agent</span><br><br><span class="hljs-comment"># ss -tnl #出现10050端口即可</span><br></code></pre></td></tr></table></figure>

<h2 id="2-4-Web界面中文菜单环境"><a href="#2-4-Web界面中文菜单环境" class="headerlink" title="2.4 Web界面中文菜单环境"></a>2.4 Web界面中文菜单环境</h2><h3 id="2-4-1-中文选项无法选择"><a href="#2-4-1-中文选项无法选择" class="headerlink" title="2.4.1 中文选项无法选择"></a>2.4.1 中文选项无法选择</h3><p>由于ubuntu系统目前未安装中文语言环境所以无法选择中文显示，如下：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix28.png" srcset="/blog/img/loading.gif"></p>
<h3 id="2-4-2-ubuntu系统安装中文语言环境"><a href="#2-4-2-ubuntu系统安装中文语言环境" class="headerlink" title="2.4.2 ubuntu系统安装中文语言环境"></a>2.4.2 ubuntu系统安装中文语言环境</h3><p>安装并设置中文简体语言环境</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#安装简体中文语言环境</span><br>root@zabbix-server:~<span class="hljs-comment"># sudo apt-get install -y language-pack-zh*</span><br><br><span class="hljs-comment">#增加中文语言环境变量</span><br>root@zabbix-server:~<span class="hljs-comment"># sudo vim /etc/environment</span><br>PATH=<span class="hljs-string">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games&quot;</span><br>LANG=<span class="hljs-string">&quot;zh_CN.UTF-8&quot;</span><br><br><span class="hljs-comment">#重新设置本地配置</span><br>sudo dpkg-reconfigure locales<br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix29.png" srcset="/blog/img/loading.gif" alt="空格选中，tab键移动到ok按钮"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix30.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix31.png" srcset="/blog/img/loading.gif"></p>
<h3 id="2-4-3-验证web界面"><a href="#2-4-3-验证web界面" class="headerlink" title="2.4.3 验证web界面"></a>2.4.3 验证web界面</h3><p>重启apache并验证wen页面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># systemctl restart apache2</span><br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix32.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix33.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix34.png" srcset="/blog/img/loading.gif"></p>
<h2 id="2-5-监控项与乱码"><a href="#2-5-监控项与乱码" class="headerlink" title="2.5 监控项与乱码"></a>2.5 监控项与乱码</h2><h3 id="2-5-1-图形乱码"><a href="#2-5-1-图形乱码" class="headerlink" title="2.5.1 图形乱码"></a>2.5.1 图形乱码</h3><p>当前系统有些监控项部分显示有乱码，使由于web界面显示为中文但是系统没有相关字体支持，因此需要相关字体的支持才能正常显示，如下:</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix35.png" srcset="/blog/img/loading.gif"></p>
<h3 id="2-5-2-上传字体文件"><a href="#2-5-2-上传字体文件" class="headerlink" title="2.5.2 上传字体文件"></a>2.5.2 上传字体文件</h3><h4 id="2-5-2-1-在windows拷贝字体"><a href="#2-5-2-1-在windows拷贝字体" class="headerlink" title="2.5.2.1 在windows拷贝字体"></a>2.5.2.1 在windows拷贝字体</h4><p>在Windows上找到控制面板–&gt;字体–&gt;楷体(或者其他个人喜欢的中文字体)，然后将字体拷贝到windows系统其他目录，比如拷贝至windows当前用户的桌面。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix36.png" srcset="/blog/img/loading.gif"></p>
<h4 id="2-5-2-2-上传字体到zabbix-web目录"><a href="#2-5-2-2-上传字体到zabbix-web目录" class="headerlink" title="2.5.2.2 上传字体到zabbix web目录"></a>2.5.2.2 上传字体到zabbix web目录</h4><p>将windows 字体文件上传至zabbix web目录，具体路径为/ZABBIX/WEB/PATH/assets/fonts/，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># pwd</span><br>/var/www/html/zabbix/assets/fonts <span class="hljs-comment">#上传楷体字体文件到这里</span><br><br><span class="hljs-comment"># chown zabbix.zabbix ./* #更改权限为zabbix用户和组</span><br><span class="hljs-comment"># ll</span><br>total 12260<br>drwxr-xr-x 2 rlin   rlin       4096 Aug 16 09:54 ./<br>drwxr-xr-x 5 rlin   rlin       4096 Jun 28 15:53 ../<br>-rw-r--r-- 1 zabbix zabbix   756072 Jun 28 15:53 DejaVuSans.ttf<br>-rw-r--r-- 1 zabbix zabbix 11787328 Mar  2  2019 simkai.ttf<br></code></pre></td></tr></table></figure>

<h4 id="2-5-2-3-修改zabbix文件调用新字体"><a href="#2-5-2-3-修改zabbix文件调用新字体" class="headerlink" title="2.5.2.3 修改zabbix文件调用新字体"></a>2.5.2.3 修改zabbix文件调用新字体</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># pwd</span><br>/var/www/html/zabbix<br><br><span class="hljs-comment"># grep DejaVuSans ./* -R</span><br>Binary file ./assets/fonts/DejaVuSans.ttf matches<br>./include/defines.inc.php:define(<span class="hljs-string">&#x27;ZBX_GRAPH_FONT_NAME&#x27;</span>,		<span class="hljs-string">&#x27;DejaVuSans&#x27;</span>); // font file name<br>./include/defines.inc.php:define(<span class="hljs-string">&#x27;ZBX_FONT_NAME&#x27;</span>, <span class="hljs-string">&#x27;DejaVuSans&#x27;</span>);<br><br><span class="hljs-comment"># vim include/defines.inc.php</span><br><span class="hljs-comment">#70 define(&#x27;ZBX_GRAPH_FONT_NAME&#x27;,     &#x27;DejaVuSans&#x27;); // font file name</span><br>70 define(<span class="hljs-string">&#x27;ZBX_GRAPH_FONT_NAME&#x27;</span>,      <span class="hljs-string">&#x27;simkai&#x27;</span>); // font file name<br><br><span class="hljs-comment">#111 define(&#x27;ZBX_FONT_NAME&#x27;, &#x27;DejaVuSans&#x27;);</span><br>111 define(<span class="hljs-string">&#x27;ZBX_FONT_NAME&#x27;</span>, <span class="hljs-string">&#x27;simkai&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h4 id="2-5-2-4-验证字体是否生效："><a href="#2-5-2-4-验证字体是否生效：" class="headerlink" title="2.5.2.4 验证字体是否生效："></a>2.5.2.4 验证字体是否生效：</h4><p>通常不需要重启zabbix及apache，修改后的字体文件即可直接生效。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix37.png" srcset="/blog/img/loading.gif"></p>
<h2 id="2-6-zabbix-server配置文件详解"><a href="#2-6-zabbix-server配置文件详解" class="headerlink" title="2.6 zabbix server配置文件详解"></a>2.6 zabbix server配置文件详解</h2><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># cat  /apps/zabbix_server/etc/zabbix_server.conf</span><br><span class="hljs-meta"># This is a configuration file for Zabbix server daemon</span><br><span class="hljs-meta"># To get more information about Zabbix, visit http://www.zabbix.com</span><br><br><span class="hljs-meta">############ GENERAL PARAMETERS #################</span><br><br><span class="hljs-meta">### Option: ListenPort</span><br><span class="hljs-meta">#	Listen port for trapper.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1024-32767</span><br><span class="hljs-meta"># Default:</span><br>ListenPort=<span class="hljs-number">10051</span> #监听端口<br><br><span class="hljs-meta">### Option: SourceIP</span><br><span class="hljs-meta">#	Source IP address for outgoing connections.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># SourceIP= #多IP地址情况下，与其他服务器通信使用的源IP地址</span><br><br><span class="hljs-meta">### Option: LogType</span><br><span class="hljs-meta">#	Specifies where log messages are written to:</span><br><span class="hljs-meta">#		system  - syslog</span><br><span class="hljs-meta">#		file    - file specified with LogFile parameter</span><br><span class="hljs-meta">#		console - standard output</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># LogType=file #日志类型，支持system、file和console</span><br><br><span class="hljs-meta">### Option: LogFile</span><br><span class="hljs-meta">#	Log file name for LogType &#x27;file&#x27; parameter.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: yes, if LogType is set to file, otherwise no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># LogFile=</span><br><br>LogFile=/tmp/zabbix_server.log  #日志路径，/tmp是一个临时目录，会存在定时清理的可能。<br>                                #apt/yum安装最好是放在/<span class="hljs-keyword">var</span>/log/zabbix里。编译安装就放在编译的文件夹里<br>                                # mkdir /<span class="hljs-keyword">var</span>/log/zabbix<br>                                # chown -R /<span class="hljs-keyword">var</span>/log/zabbix<br><br><span class="hljs-meta">### Option: LogFileSize</span><br><span class="hljs-meta">#	Maximum size of log file in MB.</span><br><span class="hljs-meta">#	0 - disable automatic log rotation.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-1024</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># LogFileSize=1 #指定日志滚动写入大小，当达到指定大小时，会删除就日志重新从头写入新日志</span><br><br><span class="hljs-meta">### Option: DebugLevel</span><br><span class="hljs-meta">#	Specifies debug level:</span><br><span class="hljs-meta">#	0 - basic information about starting and stopping of Zabbix processes</span><br><span class="hljs-meta">#	1 - critical information</span><br><span class="hljs-meta">#	2 - error information</span><br><span class="hljs-meta">#	3 - warnings</span><br><span class="hljs-meta">#	4 - for debugging (produces lots of information)</span><br><span class="hljs-meta">#	5 - extended debugging (produces even more information)</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-5</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># DebugLevel=3 #自定义日志级别</span><br><br><span class="hljs-meta">### Option: PidFile</span><br><span class="hljs-meta">#	Name of PID file.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># PidFile=/tmp/zabbix_server.pid #PID文件路径</span><br><br><span class="hljs-meta">### Option: SocketDir</span><br><span class="hljs-meta">#	IPC socket directory.</span><br><span class="hljs-meta">#       Directory to store IPC sockets used by internal Zabbix services.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># SocketDir=/tmp #socket文件路径，同样也不要放在/tmp下</span><br><br><span class="hljs-meta">### Option: DBHost</span><br><span class="hljs-meta">#	Database host name.</span><br><span class="hljs-meta">#	If set to localhost, socket is used for MySQL.</span><br><span class="hljs-meta">#	If set to empty string, socket is used for PostgreSQL.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br>DBHost=<span class="hljs-number">192.168</span><span class="hljs-number">.7</span><span class="hljs-number">.104</span> #数据库地址<br><br><span class="hljs-meta">### Option: DBName</span><br><span class="hljs-meta">#	Database name.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: yes</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># DBName=</span><br><br>DBName=zabbix_server #数据库名称<br><br><span class="hljs-meta">### Option: DBSchema</span><br><span class="hljs-meta">#	Schema name. Used for IBM DB2 and PostgreSQL.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># DBSchema= #数据库访问协议</span><br><br><span class="hljs-meta">### Option: DBUser</span><br><span class="hljs-meta">#	Database user.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># DBUser=</span><br><br>DBUser=zabbix #数据库用户名称<br><br><span class="hljs-meta">### Option: DBPassword</span><br><span class="hljs-meta">#	Database password.</span><br><span class="hljs-meta">#	Comment this line if no password is used.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br>DBPassword=<span class="hljs-number">123456</span> #数据库用户密码<br><br><span class="hljs-meta">### Option: DBSocket</span><br><span class="hljs-meta">#	Path to MySQL socket.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># DBSocket= #数据库socket文件</span><br><br><span class="hljs-meta">### Option: DBPort</span><br><span class="hljs-meta">#	Database port when not using local socket.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1024-65535</span><br><span class="hljs-meta"># Default:</span><br>DBPort=<span class="hljs-number">3306</span> #数据库端口<br><br><span class="hljs-meta">### Option: HistoryStorageURL</span><br><span class="hljs-meta">#	History storage HTTP[S] URL.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># HistoryStorageURL= #elasticsearch服务器地址，保存zabbix历史数据到ES里面，优化zabbix性能，新版本zabbix的才支持</span><br><br><span class="hljs-meta">### Option: HistoryStorageTypes</span><br><span class="hljs-meta">#	Comma separated list of value types to be sent to the history storage.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># HistoryStorageTypes=uint,dbl,str,log,text #elasticsearch索引类型</span><br><br><span class="hljs-meta">### Option: HistoryStorageDateIndex</span><br><span class="hljs-meta">#	Enable preprocessing of history values in history storage to store values in different indices based on date.</span><br><span class="hljs-meta">#	0 - disable</span><br><span class="hljs-meta">#	1 - enable</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># HistoryStorageDateIndex=0 #将历史数据保存到不同的elasticsearch索引</span><br><br><span class="hljs-meta">### Option: ExportDir</span><br><span class="hljs-meta">#	Directory for real time export of events, history and trends in newline delimited JSON format.</span><br><span class="hljs-meta">#	If set, enables real time export.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># ExportDir=  #定义实时导出触发器事件，监控项采集值，趋势数据的目录</span><br><br><span class="hljs-meta">### Option: ExportFileSize</span><br><span class="hljs-meta">#	Maximum size per export file in bytes.</span><br><span class="hljs-meta">#	Only used for rotation if ExportDir is set.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1M-1G</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># ExportFileSize=1G #定义每个导出文件的最大大小</span><br><br><span class="hljs-meta">############ ADVANCED PARAMETERS ################</span><br><br><span class="hljs-meta">### Option: StartPollers</span><br><span class="hljs-meta">#	Number of pre-forked instances of pollers.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-1000</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartPollers=5 #预启动多少个实例数量，一般会修改。</span><br><br><span class="hljs-meta">### Option: StartIPMIPollers</span><br><span class="hljs-meta">#	Number of pre-forked instances of IPMI pollers.</span><br><span class="hljs-meta">#       The IPMI manager process is automatically started when at least one IPMI poller is started.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-1000</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartIPMIPollers=0 #IPMI收集数量，用的不是很多</span><br><br><span class="hljs-meta">### Option: StartPreprocessors</span><br><span class="hljs-meta">#	Number of pre-forked instances of preprocessing workers.</span><br><span class="hljs-meta">#       The preprocessing manager process is automatically started when preprocessor worker is started.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-1000</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartPreprocessors=3 #预启动多少个进程用于处理zabbix agent数据</span><br><br><span class="hljs-meta">### Option: StartPollersUnreachable</span><br><span class="hljs-meta">#	Number of pre-forked instances of pollers for unreachable hosts (including IPMI and Java).</span><br><span class="hljs-meta">#	At least one poller for unreachable hosts must be running if regular, IPMI or Java pollers</span><br><span class="hljs-meta">#	are started.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-1000</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartPollersUnreachable=1 #不可达主机的轮询进程的初始实例启动数量</span><br><br><span class="hljs-meta">### Option: StartTrappers</span><br><span class="hljs-meta">#	Number of pre-forked instances of trappers.</span><br><span class="hljs-meta">#	Trappers accept incoming connections from Zabbix sender, active agents and active proxies.</span><br><span class="hljs-meta">#	At least one trapper process must be running to display server availability and view queue</span><br><span class="hljs-meta">#	in the frontend.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-1000</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartTrappers=5 #预启动的Trappers进程数据</span><br><br><span class="hljs-meta">### Option: StartPingers</span><br><span class="hljs-meta">#	Number of pre-forked instances of ICMP pingers.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-1000</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartPingers=1 #ICMP ping进程的初始实例数量</span><br><br><span class="hljs-meta">### Option: StartDiscoverers</span><br><span class="hljs-meta">#	Number of pre-forked instances of discoverers.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-250</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartDiscoverers=1 #自动发现主机的进程数量,设定的数量不要超过宿主机的数量</span><br><br><span class="hljs-meta">### Option: StartHTTPPollers</span><br><span class="hljs-meta">#	Number of pre-forked instances of HTTP pollers.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-1000</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartHTTPPollers=1 #http 进程数量</span><br><br><span class="hljs-meta">### Option: StartTimers</span><br><span class="hljs-meta">#	Number of pre-forked instances of timers.</span><br><span class="hljs-meta">#	Timers process maintenance periods.</span><br><span class="hljs-meta">#	Only the first timer process handles host maintenance updates. Problem suppression updates are shared</span><br><span class="hljs-meta">#	between all timers.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-1000</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartTimers=1 #计时器实例数量，计时器用于计算问题的发生时间和步骤同步等</span><br><br><span class="hljs-meta">### Option: StartEscalators</span><br><span class="hljs-meta">#	Number of pre-forked instances of escalators.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-100</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartEscalators=1 #escalators进程的初始实例数量，用于处理动作中的自动步骤的进程的数量</span><br><br><span class="hljs-meta">### Option: StartAlerters</span><br><span class="hljs-meta">#	Number of pre-forked instances of alerters.</span><br><span class="hljs-meta">#	Alerters send the notifications created by action operations.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-100</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartAlerters=3 #报警实例预启动数量</span><br><br><span class="hljs-meta">### Option: JavaGateway</span><br><span class="hljs-meta">#	IP address (or hostname) of Zabbix Java gateway.</span><br><span class="hljs-meta">#	Only required if Java pollers are started.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br>JavaGateway=<span class="hljs-number">192.168</span><span class="hljs-number">.7</span><span class="hljs-number">.101</span> #javagateway服务器地址，java pollers必须设置<br><br><span class="hljs-meta">### Option: JavaGatewayPort</span><br><span class="hljs-meta">#	Port that Zabbix Java gateway listens on.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1024-32767</span><br><span class="hljs-meta"># Default:</span><br>JavaGatewayPort=<span class="hljs-number">10052</span> #javagateway端口<br><br><span class="hljs-meta">### Option: StartJavaPollers</span><br><span class="hljs-meta">#	Number of pre-forked instances of Java pollers.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-1000</span><br><span class="hljs-meta"># Default:</span><br>StartJavaPollers=<span class="hljs-number">20</span> #java轮训实例预启动数量<br><br><span class="hljs-meta">### Option: StartVMwareCollectors</span><br><span class="hljs-meta">#	Number of pre-forked vmware collector instances.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-250</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartVMwareCollectors=0 #用于设置监控VMWARE Esxi主机实例时使用，若为0则不启用，若要监控ESXI主机，此值最少为1，根据监控ESXI数量设置对应数值</span><br><br><span class="hljs-meta">### Option: VMwareFrequency</span><br><span class="hljs-meta">#	How often Zabbix will connect to VMware service to obtain a new data.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 10-86400</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># VMwareFrequency=60 #监控vmware获取最新数据间隔频率，单位为秒</span><br><br><span class="hljs-meta">### Option: VMwarePerfFrequency</span><br><span class="hljs-meta">#	How often Zabbix will connect to VMware service to obtain performance data.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 10-86400</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># VMwarePerfFrequency=60 #监控vmware获取性能数据间隔</span><br><br><span class="hljs-meta">### Option: VMwareCacheSize</span><br><span class="hljs-meta">#	Size of VMware cache, in bytes.</span><br><span class="hljs-meta">#	Shared memory size for storing VMware data.</span><br><span class="hljs-meta">#	Only used if VMware collectors are started.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 256K-2G</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># VMwareCacheSize=8M #vmware数据缓存大小，会占用zabbix server服务器内存</span><br><br><span class="hljs-meta">### Option: VMwareTimeout</span><br><span class="hljs-meta">#	Specifies how many seconds vmware collector waits for response from VMware service.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-300</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># VMwareTimeout=10 #超时时间</span><br><br><span class="hljs-meta">### Option: SNMPTrapperFile</span><br><span class="hljs-meta">#	Temporary file used for passing data from SNMP trap daemon to the server.</span><br><span class="hljs-meta">#	Must be the same as in zabbix_trap_receiver.pl or SNMPTT configuration file.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># SNMPTrapperFile=/tmp/zabbix_traps.tmp #snmp触发器临时文件路径</span><br><br><span class="hljs-meta">### Option: StartSNMPTrapper</span><br><span class="hljs-meta">#	If 1, SNMP trapper process is started.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-1</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartSNMPTrapper=0 #SNMP触发器预启动数量</span><br><br><span class="hljs-meta">### Option: ListenIP</span><br><span class="hljs-meta">#	List of comma delimited IP addresses that the trapper should listen on.</span><br><span class="hljs-meta">#	Trapper will listen on all network interfaces if this parameter is missing.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># ListenIP=0.0.0.0 #监听地址</span><br><br><span class="hljs-meta"># ListenIP=127.0.0.1</span><br><br><span class="hljs-meta">### Option: HousekeepingFrequency</span><br><span class="hljs-meta">#	How often Zabbix will perform housekeeping procedure (in hours).</span><br><span class="hljs-meta">#	Housekeeping is removing outdated information from the database.</span><br><span class="hljs-meta">#	To prevent Housekeeper from being overloaded, no more than 4 times HousekeepingFrequency</span><br><span class="hljs-meta">#	hours of outdated information are deleted in one housekeeping cycle, for each item.</span><br><span class="hljs-meta">#	To lower load on server startup housekeeping is postponed for 30 minutes after server start.</span><br><span class="hljs-meta">#	With HousekeepingFrequency=0 the housekeeper can be only executed using the runtime control option.</span><br><span class="hljs-meta">#	In this case the period of outdated information deleted in one housekeeping cycle is 4 times the</span><br><span class="hljs-meta">#	period since the last housekeeping cycle, but not less than 4 hours and not greater than 4 days.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-24</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># HousekeepingFrequency=1 #多少小时清理一次代理端数据库的 history数据</span><br><br><span class="hljs-meta">### Option: MaxHousekeeperDelete</span><br><span class="hljs-meta">#	The table &quot;housekeeper&quot; contains &quot;tasks&quot; for housekeeping procedure in the format:</span><br><span class="hljs-meta">#	[housekeeperid], [tablename], [field], [value].</span><br><span class="hljs-meta">#	No more than &#x27;MaxHousekeeperDelete&#x27; rows (corresponding to [tablename], [field], [value])</span><br><span class="hljs-meta">#	will be deleted per one task in one housekeeping cycle.</span><br><span class="hljs-meta">#	If set to 0 then no limit is used at all. In this case you must know what you are doing!</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-1000000</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># MaxHousekeeperDelete=5000 ##每次最多删除历史数据的行数</span><br><br><span class="hljs-meta">### Option: CacheSize</span><br><span class="hljs-meta">#	Size of configuration cache, in bytes.</span><br><span class="hljs-meta">#	Shared memory size for storing host, item and trigger data.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 128K-8G</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># CacheSize=8M  #配置信息缓存大小</span><br><br><span class="hljs-meta">### Option: CacheUpdateFrequency</span><br><span class="hljs-meta">#	How often Zabbix will perform update of configuration cache, in seconds.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-3600</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># CacheUpdateFrequency=60 #Zabbix更新缓存数据的频率，单位为秒，范围是1-3600</span><br><br><span class="hljs-meta">### Option: StartDBSyncers</span><br><span class="hljs-meta">#	Number of pre-forked instances of DB Syncers.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-100</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartDBSyncers=4  #zabbix和数据库同步数据的进程数量</span><br><br><span class="hljs-meta">### Option: HistoryCacheSize</span><br><span class="hljs-meta">#	Size of history cache, in bytes.</span><br><span class="hljs-meta">#	Shared memory size for storing history data.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 128K-2G</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># HistoryCacheSize=16M #历史数据的缓存大小</span><br><br><span class="hljs-meta">### Option: HistoryIndexCacheSize</span><br><span class="hljs-meta">#	Size of history index cache, in bytes.</span><br><span class="hljs-meta">#	Shared memory size for indexing history cache.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 128K-2G</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># HistoryIndexCacheSize=4M #历史数据索引缓存的大小</span><br><br><span class="hljs-meta">### Option: TrendCacheSize</span><br><span class="hljs-meta">#	Size of trend cache, in bytes.</span><br><span class="hljs-meta">#	Shared memory size for storing trends data.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 128K-2G</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># TrendCacheSize=4M #用于设置划分多少系统共享内存用于存储计算出来的趋势数据，此参数值从一定程度上可影响数据库读压力，范围是128K-2G</span><br><br><span class="hljs-meta">### Option: ValueCacheSize</span><br><span class="hljs-meta">#	Size of history value cache, in bytes.</span><br><span class="hljs-meta">#	Shared memory size for caching item history data requests.</span><br><span class="hljs-meta">#	Setting to 0 disables value cache.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0,128K-64G</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># ValueCacheSize=8M #历史值缓存的大小，用于缓存历史数据请求的共享内存大小。</span><br><br><span class="hljs-meta">### Option: Timeout</span><br><span class="hljs-meta">#	Specifies how long we wait for agent, SNMP device or external check (in seconds).</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-30</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># Timeout=3</span><br><br>Timeout=<span class="hljs-number">4</span> #数据获取等待超时时间<br><br><span class="hljs-meta">### Option: TrapperTimeout</span><br><span class="hljs-meta">#	Specifies how many seconds trapper may spend processing new data.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-300</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># TrapperTimeout=300 #触发器处理新数据的最长时间，单位是秒</span><br><br><span class="hljs-meta">### Option: UnreachablePeriod</span><br><span class="hljs-meta">#	After how many seconds of unreachability treat a host as unavailable.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-3600</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># UnreachablePeriod=45 #当主机不可达多少秒后，设置为主机不可用，单位是秒，范围是1-3600</span><br><br><span class="hljs-meta">### Option: UnavailableDelay</span><br><span class="hljs-meta">#	How often host is checked for availability during the unavailability period, in seconds.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-3600</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># UnavailableDelay=60 #当主机不可用了，多久检查一次该主机的可用性，单位为秒，范围是1-3600</span><br><br><span class="hljs-meta">### Option: UnreachableDelay</span><br><span class="hljs-meta">#	How often host is checked for availability during the unreachability period, in seconds.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-3600</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># UnreachableDelay=15 #当主机不可到达了，多久检查一次该主机的可用性，单位为秒，范围是1-3600</span><br><br><span class="hljs-meta">### Option: AlertScriptsPath</span><br><span class="hljs-meta">#	Full path to location of custom alert scripts.</span><br><span class="hljs-meta">#	Default depends on compilation options.</span><br><span class="hljs-meta">#	To see the default path run command &quot;zabbix_server --help&quot;.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># AlertScriptsPath=$&#123;datadir&#125;/zabbix/alertscripts #监控报警脚本路径,取决于编译时候的datadir参数</span><br><br><span class="hljs-meta">### Option: ExternalScripts</span><br><span class="hljs-meta">#	Full path to location of external scripts.</span><br><span class="hljs-meta">#	Default depends on compilation options.</span><br><span class="hljs-meta">#	To see the default path run command &quot;zabbix_server --help&quot;.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># ExternalScripts=$&#123;datadir&#125;/zabbix/externalscripts #自定义脚本存储路径</span><br><br><span class="hljs-meta">### Option: FpingLocation</span><br><span class="hljs-meta">#	Location of fping.</span><br><span class="hljs-meta">#	Make sure that fping binary has root ownership and SUID flag set.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># FpingLocation=/usr/sbin/fping #fping命令的位置</span><br><br><span class="hljs-meta">### Option: Fping6Location</span><br><span class="hljs-meta">#	Location of fping6.</span><br><span class="hljs-meta">#	Make sure that fping6 binary has root ownership and SUID flag set.</span><br><span class="hljs-meta">#	Make empty if your fping utility is capable to process IPv6 addresses.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># Fping6Location=/usr/sbin/fping6 #fping6的位置</span><br><br><span class="hljs-meta">### Option: SSHKeyLocation</span><br><span class="hljs-meta">#	Location of public and private keys for SSH checks and actions.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># SSHKeyLocation= #用于SSH检查和操作的公钥和私钥的位置。</span><br><br><span class="hljs-meta">### Option: LogSlowQueries</span><br><span class="hljs-meta">#	How long a database query may take before being logged (in milliseconds).</span><br><span class="hljs-meta">#	Only works if DebugLevel set to 3, 4 or 5.</span><br><span class="hljs-meta">#	0 - don&#x27;t log slow queries.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-3600000</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># LogSlowQueries=0 慢日志时间(以毫秒为单位),仅当DebugLevel设置为3,4或5时才可用,0 - 不记录慢查询,范围是1-3600000</span><br><br>LogSlowQueries=<span class="hljs-number">3000</span><br><br><span class="hljs-meta">### Option: TmpDir</span><br><span class="hljs-meta">#	Temporary directory.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># TmpDir=/tmp #临时文目录</span><br><br><span class="hljs-meta">### Option: StartProxyPollers</span><br><span class="hljs-meta">#	Number of pre-forked instances of pollers for passive proxies.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 0-250</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StartProxyPollers=1 #启用多少子进程与代理端通信，若代理较多可考虑加大此数值，范围是0-250</span><br><br><span class="hljs-meta">### Option: ProxyConfigFrequency</span><br><span class="hljs-meta">#	How often Zabbix Server sends configuration data to a Zabbix Proxy in seconds.</span><br><span class="hljs-meta">#	This parameter is used only for proxies in the passive mode.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-3600*24*7</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># ProxyConfigFrequency=3600 #proxy被动模式下，server多少秒同步配置文件至proxy，该参数仅用于被动模式下的代理，范围是1-3600*24*7</span><br><br><span class="hljs-meta">### Option: ProxyDataFrequency</span><br><span class="hljs-meta">#	How often Zabbix Server requests history data from a Zabbix Proxy in seconds.</span><br><span class="hljs-meta">#	This parameter is used only for proxies in the passive mode.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Range: 1-3600</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># ProxyDataFrequency=1 #被动模式下，zabbix server间隔多少秒向proxy请求历史数据</span><br><br><span class="hljs-meta">### Option: AllowRoot</span><br><span class="hljs-meta">#	Allow the server to run as &#x27;root&#x27;. If disabled and the server is started by &#x27;root&#x27;, the server</span><br><span class="hljs-meta">#	will try to switch to the user specified by the User configuration option instead.</span><br><span class="hljs-meta">#	Has no effect if started under a regular user.</span><br><span class="hljs-meta">#	0 - do not allow</span><br><span class="hljs-meta">#	1 - allow</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># AllowRoot=0 #是否允许root启动zabbix</span><br><br><span class="hljs-meta">### Option: User</span><br><span class="hljs-meta">#	Drop privileges to a specific, existing user on the system.</span><br><span class="hljs-meta">#	Only has effect if run as &#x27;root&#x27; and AllowRoot is disabled.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># User=zabbix #设置zabbix 启动用户</span><br><br><span class="hljs-meta">### Option: Include</span><br><span class="hljs-meta">#	You may include individual files or all files in a directory in the configuration file.</span><br><span class="hljs-meta">#	Installing Zabbix will create include directory in /usr/local/etc, unless modified during the compile time.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># Include=</span><br><br><span class="hljs-meta"># Include=/usr/local/etc/zabbix_server.general.conf #导入其他目录的配置文件</span><br><span class="hljs-meta"># Include=/usr/local/etc/zabbix_server.conf.d/</span><br><span class="hljs-meta"># Include=/usr/local/etc/zabbix_server.conf.d/*.conf</span><br><br><span class="hljs-meta">### Option: SSLCertLocation</span><br><span class="hljs-meta">#	Location of SSL client certificates.</span><br><span class="hljs-meta">#	This parameter is used only in web monitoring.</span><br><span class="hljs-meta">#	Default depends on compilation options.</span><br><span class="hljs-meta">#	To see the default path run command &quot;zabbix_server --help&quot;.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># SSLCertLocation=$&#123;datadir&#125;/zabbix/ssl/certs #SSL证书公钥的位置，用于web监控</span><br><br><span class="hljs-meta">### Option: SSLKeyLocation</span><br><span class="hljs-meta">#	Location of private keys for SSL client certificates.</span><br><span class="hljs-meta">#	This parameter is used only in web monitoring.</span><br><span class="hljs-meta">#	Default depends on compilation options.</span><br><span class="hljs-meta">#	To see the default path run command &quot;zabbix_server --help&quot;.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># SSLKeyLocation=$&#123;datadir&#125;/zabbix/ssl/keys #SSL客证书私钥位置，用于web监控</span><br><br><span class="hljs-meta">### Option: SSLCALocation</span><br><span class="hljs-meta">#	Override the location of certificate authority (CA) files for SSL server certificate verification.</span><br><span class="hljs-meta">#	If not set, system-wide directory will be used.</span><br><span class="hljs-meta">#	This parameter is used only in web monitoring and SMTP authentication.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># SSLCALocation= #SSL CA钥文件目录</span><br><br><span class="hljs-meta">### Option: StatsAllowedIP</span><br><span class="hljs-meta">#	List of comma delimited IP addresses, optionally in CIDR notation, or DNS names of external Zabbix instances.</span><br><span class="hljs-meta">#	Stats request will be accepted only from the addresses listed here. If this parameter is not set no stats requests</span><br><span class="hljs-meta">#	will be accepted.</span><br><span class="hljs-meta">#	If IPv6 support is enabled then &#x27;127.0.0.1&#x27;, &#x27;::127.0.0.1&#x27;, &#x27;::ffff:127.0.0.1&#x27; are treated equally</span><br><span class="hljs-meta">#	and &#x27;::/0&#x27; will allow any IPv4 or IPv6 address.</span><br><span class="hljs-meta">#	&#x27;0.0.0.0/0&#x27; can be used to allow any IPv4 address.</span><br><span class="hljs-meta">#	Example: StatsAllowedIP=127.0.0.1,192.168.1.0/24,::1,2001:db8::/32,zabbix.example.com</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># StatsAllowedIP=  #定义允许访问zabbix server的IP地址列表</span><br><br><span class="hljs-meta">####### LOADABLE MODULES #######可加载的模块</span><br><br><span class="hljs-meta">### Option: LoadModulePath</span><br><span class="hljs-meta">#	Full path to location of server modules.</span><br><span class="hljs-meta">#	Default depends on compilation options.</span><br><span class="hljs-meta">#	To see the default path run command &quot;zabbix_server --help&quot;.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># LoadModulePath=$&#123;libdir&#125;/modules #第三方模块目录路径</span><br><br><span class="hljs-meta">### Option: LoadModule</span><br><span class="hljs-meta">#	Module to load at server startup. Modules are used to extend functionality of the server.</span><br><span class="hljs-meta">#	Formats:</span><br><span class="hljs-meta">#		LoadModule=&lt;module.so&gt;</span><br><span class="hljs-meta">#		LoadModule=&lt;path/module.so&gt;</span><br><span class="hljs-meta">#		LoadModule=&lt;/abs_path/module.so&gt;</span><br><span class="hljs-meta">#	Either the module must be located in directory specified by LoadModulePath or the path must precede the module name.</span><br><span class="hljs-meta">#	If the preceding path is absolute (starts with &#x27;/&#x27;) then LoadModulePath is ignored.</span><br><span class="hljs-meta">#	It is allowed to include multiple LoadModule parameters.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># LoadModule= #第三方模块路径</span><br><br><span class="hljs-meta">####### TLS-RELATED PARAMETERS #######TLS相关参数</span><br><br><span class="hljs-meta">### Option: TLSCAFile</span><br><span class="hljs-meta">#	Full pathname of a file containing the top-level CA(s) certificates for</span><br><span class="hljs-meta">#	peer certificate verification.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># TLSCAFile= #CA文件</span><br><br><span class="hljs-meta">### Option: TLSCRLFile</span><br><span class="hljs-meta">#	Full pathname of a file containing revoked certificates.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># TLSCRLFile= #包含已吊销证书的文件的完整路径名。</span><br><br><span class="hljs-meta">### Option: TLSCertFile</span><br><span class="hljs-meta">#	Full pathname of a file containing the server certificate or certificate chain.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># TLSCertFile= #公钥文件路径</span><br><br><span class="hljs-meta">### Option: TLSKeyFile</span><br><span class="hljs-meta">#	Full pathname of a file containing the server private key.</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Mandatory: no</span><br><span class="hljs-meta"># Default:</span><br><span class="hljs-meta"># TLSKeyFile=  #私钥文件路径</span><br></code></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs routeros">视频上修改的部分：<br><br><span class="hljs-attribute">LogFile</span>=/var/log/zabbix/zabbix_server.log<br><br><span class="hljs-attribute">DebugLevel</span>=4<br><br><span class="hljs-attribute">SocketDir</span>=/apps/zabbix_server/run<br><br><span class="hljs-attribute">StartPollers</span>=6<br><br>StartPreprocessors= 6<br><br><span class="hljs-attribute">StartPingers</span>=6<br><br><span class="hljs-attribute">StartDiscoverers</span>=6<br><br><span class="hljs-attribute">StartHTTPPollers</span>=3<br><br><span class="hljs-attribute">StartTimers</span>=3<br><br><span class="hljs-attribute">StartEscalators</span>=3<br><br><span class="hljs-attribute">SNNPTrapperFile</span>=/apps/zabbix_server/run<br><br><span class="hljs-attribute">StartSNMPTrapper</span>=1<br><br><span class="hljs-attribute">MaxHouseKeeperDelete</span>=1000000<br><br><span class="hljs-attribute">CacheSize</span>=128M<br><br><span class="hljs-attribute">CacheUpdateFrequency</span>=300<br><br><span class="hljs-attribute">StartDBSyncers</span>=5<br><br><span class="hljs-attribute">HistroyCacheSize</span>=128M<br><br><span class="hljs-attribute">HistroyIndexCacheSize</span>=128M	<br><br><span class="hljs-attribute">TrendCacheSize</span>=16M<br><br><span class="hljs-attribute">ValueCacheSize</span>=16M<br><br><span class="hljs-attribute">Timeout</span>=30<br><br><span class="hljs-attribute">TrapperTimeout</span>=300<br><br><span class="hljs-attribute">UnerachablePeriod</span>=60<br><br><span class="hljs-attribute">UnavailableDelay</span>=60<br><br><span class="hljs-attribute">UnreachableDelay</span>=60<br><br><span class="hljs-attribute">LogSlowQueries</span>=3000<br><br><span class="hljs-attribute">TmpDir</span>=/apps/zabbix_server/run<br><br><span class="hljs-attribute">StartProxyPollers</span>=1<br><br><span class="hljs-attribute">ProxyConfigFrequency</span>=60<br><br><span class="hljs-attribute">ProxyDataFrequency</span>=60<br></code></pre></td></tr></table></figure>

<h1 id="三、Zabbix-监控入门基础"><a href="#三、Zabbix-监控入门基础" class="headerlink" title="三、Zabbix 监控入门基础"></a>三、Zabbix 监控入门基础</h1><p><strong>学习通过apt/yum安装zabbix agent、对tomcat进行监控。</strong></p>
<h2 id="3-1监控linux系统"><a href="#3-1监控linux系统" class="headerlink" title="3.1监控linux系统"></a>3.1监控linux系统</h2><p>在其他linux服务器安装zabbix agent，然后添加到zabbix server以对其进行资源监控。</p>
<h3 id="3-1-1-zabbix-agent安装"><a href="#3-1-1-zabbix-agent安装" class="headerlink" title="3.1.1 zabbix agent安装"></a>3.1.1 zabbix agent安装</h3><p>172.31.0.106 使用apt安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># wget https://repo.zabbix.com/zabbix/4.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_4.0-3+bionic_all.deb</span><br><span class="hljs-comment"># dpkg -i zabbix-release_4.0-3+bionic_all.deb</span><br><span class="hljs-comment"># apt update</span><br><span class="hljs-comment"># apt install -y zabbix-agent</span><br></code></pre></td></tr></table></figure>

<h3 id="3-1-2-zabbix-agent配置文件"><a href="#3-1-2-zabbix-agent配置文件" class="headerlink" title="3.1.2 zabbix agent配置文件"></a>3.1.2 zabbix agent配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="hljs-comment">### Option: EnableRemoteCommands</span><br>EnableRemoteCommands=1 <span class="hljs-comment">#允许zabbix服务远程执行命令，执行的命令需要在zabbix_server定义</span><br><br><span class="hljs-comment">##### Passive checks related #被动检查相关配置</span><br>Server=172.31.0.101 <span class="hljs-comment">#指向当前zabbix server（可以域名，ipv4地址，网段，ipv6地址，以上都可以指定多个）</span><br><br><span class="hljs-comment">### Option: ListenPort</span><br>ListenPort=10050 <span class="hljs-comment">#监听端口</span><br><br><span class="hljs-comment">### Option: StartAgents</span><br>StartAgents=3 <span class="hljs-comment">#被动状态时默认启动的实例数(进程数)，为0不监听任何端口</span><br><br><span class="hljs-comment">### Option: Hostname</span><br>Hostname=172.31.0.106 <span class="hljs-comment">#区分大小写且在zabbix server唯一的值（为本机地址）</span><br></code></pre></td></tr></table></figure>

<h3 id="3-1-3-重启zabbix-agent"><a href="#3-1-3-重启zabbix-agent" class="headerlink" title="3.1.3 重启zabbix agent"></a>3.1.3 重启zabbix agent</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># systemctl enable zabbix-agent</span><br><span class="hljs-comment"># systemctl restart zabbix-agent</span><br><span class="hljs-comment"># systemctl status zabbix-agent</span><br>● zabbix-agent.service - Zabbix Agent<br> Loaded: loaded (/lib/systemd/system/zabbix-agent.service; disabled; vendor preset:<br>enabled)<br> Active: active (running) since Sat 2019-12-14 12:06:17 CST; 5s ago<br>Process: 2247 ExecStop=/bin/<span class="hljs-built_in">kill</span> -SIGTERM <span class="hljs-variable">$MAINPID</span> (code=exited, status=0/SUCCESS)<br>Process: 2248 ExecStart=/usr/sbin/zabbix_agentd -c <span class="hljs-variable">$CONFFILE</span> (code=exited,<br>status=0/SUCCESS)<br>Main PID: 2250 (zabbix_agentd)<br> Tasks: 6 (<span class="hljs-built_in">limit</span>: 2290)<br> CGroup: /system.slice/zabbix-agent.service<br>     ├─2250 /usr/sbin/zabbix_agentd -c /etc/zabbix/zabbix_agentd.conf<br>     ├─2252 /usr/sbin/zabbix_agentd: collector [idle 1 sec]<br>     ├─2253 /usr/sbin/zabbix_agentd: listener <span class="hljs-comment">#1 [waiting for connection]</span><br>     ├─2254 /usr/sbin/zabbix_agentd: listener <span class="hljs-comment">#2 [waiting for connection]</span><br>     ├─2255 /usr/sbin/zabbix_agentd: listener <span class="hljs-comment">#3 [waiting for connection]</span><br>     └─2256 /usr/sbin/zabbix_agentd: active checks <span class="hljs-comment">#1 [idle 1 sec]</span><br></code></pre></td></tr></table></figure>

<h3 id="3-1-4-验证zabbix-agent"><a href="#3-1-4-验证zabbix-agent" class="headerlink" title="3.1.4 验证zabbix agent"></a>3.1.4 验证zabbix agent</h3><p>验证zabbix agent进程是否存在、端口是否监听以及日志是否有异常</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-node4:~<span class="hljs-comment"># ps -ef | grep zabbix</span><br>zabbix    17817      1  0 19:28 ?        00:00:00 /usr/sbin/zabbix_agentd -c /etc/zabbix/zabbix_agentd.conf<br>zabbix    17818  17817  0 19:28 ?        00:00:00 /usr/sbin/zabbix_agentd: collector [idle 1 sec]<br>zabbix    17819  17817  0 19:28 ?        00:00:00 /usr/sbin/zabbix_agentd: listener <span class="hljs-comment">#1 [waiting for connection]</span><br>zabbix    17820  17817  0 19:28 ?        00:00:00 /usr/sbin/zabbix_agentd: listener <span class="hljs-comment">#2 [waiting for connection]</span><br>zabbix    17821  17817  0 19:28 ?        00:00:00 /usr/sbin/zabbix_agentd: listener <span class="hljs-comment">#3 [waiting for connection]</span><br>zabbix    17822  17817  0 19:28 ?        00:00:00 /usr/sbin/zabbix_agentd: active checks <span class="hljs-comment">#1 [idle 1 sec]</span><br>root      17827   2481  0 19:28 pts/0    00:00:00 grep --color=auto zabbix<br><br>root@zabbix-node4:~<span class="hljs-comment"># pstree -p 17817</span><br>zabbix_agentd(17817)─┬─zabbix_agentd(17818)<br>                     ├─zabbix_agentd(17819)<br>                     ├─zabbix_agentd(17820)<br>                     ├─zabbix_agentd(17821)<br>                     └─zabbix_agentd(17822)<br>         <br>root@zabbix-node4:~<span class="hljs-comment"># ss -tnl | grep 10050</span><br>LISTEN   0         128                 0.0.0.0:10050            0.0.0.0:*       <br>LISTEN   0         128                    [::]:10050               [::]:*<br><br>root@zabbix-node4:~<span class="hljs-comment"># tail -n5 /var/log/zabbix/zabbix_agentd.log</span><br> 2253:20191214:120617.791 agent <span class="hljs-comment">#2 started [listener #1]</span><br> 2254:20191214:120617.792 agent <span class="hljs-comment">#3 started [listener #2]</span><br> 2256:20191214:120617.794 agent <span class="hljs-comment">#5 started [active checks #1]</span><br> 2255:20191214:120617.794 agent <span class="hljs-comment">#4 started [listener #3]</span><br></code></pre></td></tr></table></figure>

<h3 id="3-1-5-zabbix-web界面添加被监控主机："><a href="#3-1-5-zabbix-web界面添加被监控主机：" class="headerlink" title="3.1.5 zabbix web界面添加被监控主机："></a>3.1.5 zabbix web界面添加被监控主机：</h3><p>在zabbix web管理界面添加上一步安装了zabbix agent的linux主机。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix38.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-1-6-关联监控模板"><a href="#3-1-6-关联监控模板" class="headerlink" title="3.1.6 关联监控模板"></a>3.1.6 关联监控模板</h3><p>在zabbix对主机实现监控，可以通过添加模板或者添加监控项实现对指定的监控目标进行数据采集，通常采用先创建模板，然后再将模板关联至主机的方式，模板关联如下：</p>
<h4 id="3-1-6-1-选择模板"><a href="#3-1-6-1-选择模板" class="headerlink" title="3.1.6.1 选择模板"></a>3.1.6.1 选择模板</h4><p>选择符合当前主机监控项目的模板，如对linux系统监控可以关联zabbix 自带的Template OS Linux模板，如下在搜索框输入linux关键字后会自带匹配符合名称的模板，直接点击即可选择：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix39.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-1-6-2-确认模板选择"><a href="#3-1-6-2-确认模板选择" class="headerlink" title="3.1.6.2 确认模板选择"></a>3.1.6.2 确认模板选择</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix40.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-1-6-3-确认添加主机"><a href="#3-1-6-3-确认添加主机" class="headerlink" title="3.1.6.3 确认添加主机"></a>3.1.6.3 确认添加主机</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix41.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-1-6-4-主机添加完成"><a href="#3-1-6-4-主机添加完成" class="headerlink" title="3.1.6.4 主机添加完成"></a>3.1.6.4 主机添加完成</h4><p>需要等待几分钟(具体看模板中监控项的数据采集间隔时间)之后，主机的状态才会变成绿色或者红色，绿色表示zabbix server对zabbix agent有权限进行数据采集并且当前通信正常，红色则表示通信异常，通信异常会有多种原因，具体可以看相关日志或者到时候点击红色方框会有相关报错显示。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix131.png" srcset="/blog/img/loading.gif"></p>
<p>3.1.6.5 验证主机监控数据<br>经过一段时间的数据采集后，验证zabbix server是否有刚添加完成主机的监控数据和图形，图形显示如下：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix132.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-1-6-5-对一个主机进行监控的总结"><a href="#3-1-6-5-对一个主机进行监控的总结" class="headerlink" title="3.1.6.5 对一个主机进行监控的总结"></a>3.1.6.5 对一个主机进行监控的总结</h4><ol>
<li><p>在当前主机安装zabbix agent </p>
<p>apt/yum安装</p>
<p>编译安装</p>
</li>
<li><p>修改zabbix agent的配置文件</p>
<p>Server</p>
<p>Hostname</p>
</li>
<li><p>启动并将zabbix agent开机启动</p>
</li>
<li><p>在zabbix server添加被监控直接并关联模板（不建议单独添加监控相）</p>
</li>
</ol>
<h2 id="3-2-监控tomcat"><a href="#3-2-监控tomcat" class="headerlink" title="3.2 监控tomcat"></a>3.2 监控tomcat</h2><p>学习如何通过java gateway实现对tomcat的指标进行数据采集和图形展示，如堆栈内存利用率、当前会话连接数、繁忙线程等。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix42.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-2-1-准备JDK环境"><a href="#3-2-1-准备JDK环境" class="headerlink" title="3.2.1 准备JDK环境"></a>3.2.1 准备JDK环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># pwd</span><br>/usr/<span class="hljs-built_in">local</span>/src<br><span class="hljs-comment"># tar xf jdk-8u241-linux-x64.tar.gz</span><br><br><span class="hljs-comment"># ln -sv /usr/local/src/jdk1.8.0_241 /usr/local/jdk</span><br><span class="hljs-string">&#x27;/usr/local/jdk&#x27;</span> -&gt; <span class="hljs-string">&#x27;/usr/local/src/jdk1.8.0_241&#x27;</span><br><br><span class="hljs-comment"># vim /etc/profile</span><br><span class="hljs-built_in">export</span> JAVA_HOME=/usr/<span class="hljs-built_in">local</span>/jdk<br><span class="hljs-built_in">export</span> TOMCAT_HOME=/apps/tomcat<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$JAVA_HOME</span>/jre/bin:<span class="hljs-variable">$TOMCAT_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> CLASSPATH=.<span class="hljs-variable">$CLASSPATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/lib:<span class="hljs-variable">$JAVA_HOME</span>/jre/lib:<span class="hljs-variable">$JAVA_HOME</span>/lib/tools.jar<br><br><span class="hljs-comment"># source /etc/profile</span><br><span class="hljs-comment"># java -version</span><br>java version <span class="hljs-string">&quot;1.8.0_241&quot;</span><br>Java(TM) SE Runtime Environment (build 1.8.0_241-b07)<br>Java HotSpot(TM) 64-Bit Server VM (build 25.241-b07, mixed mode)<br></code></pre></td></tr></table></figure>

<h3 id="3-2-2-准备tomcat"><a href="#3-2-2-准备tomcat" class="headerlink" title="3.2.2 准备tomcat"></a>3.2.2 准备tomcat</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#解压tomcat压缩包</span><br><span class="hljs-comment"># mkdir /apps</span><br><span class="hljs-comment"># cd /apps/</span><br><span class="hljs-comment"># tar xf apache-tomcat-8.5.43.tar.gz</span><br><br><span class="hljs-comment">#创建测试app</span><br><span class="hljs-comment"># ln -sv /apps/apache-tomcat-8.5.43 /apps/tomcat</span><br><span class="hljs-string">&#x27;/apps/tomcat&#x27;</span> -&gt; <span class="hljs-string">&#x27;/apps/apache-tomcat-8.5.43&#x27;</span><br><span class="hljs-comment"># cd /apps/tomcat/</span><br><span class="hljs-comment"># mkdir webapps/rlin</span><br><span class="hljs-comment"># cat webapps/rlin/index.html</span><br>tomcat web1 page<br><br><span class="hljs-comment">#启动tomcat</span><br><span class="hljs-comment"># /apps/apache-tomcat-8.5.43/bin/catalina.sh start</span><br>Using CATALINA_BASE:   /apps/apache-tomcat-8.5.43<br>Using CATALINA_HOME:   /apps/apache-tomcat-8.5.43<br>Using CATALINA_TMPDIR: /apps/apache-tomcat-8.5.43/temp<br>Using JRE_HOME:        /usr/<span class="hljs-built_in">local</span>/jdk<br>Using CLASSPATH:       /apps/apache-tomcat-8.5.43/bin/bootstrap.jar:/apps/apache-tomcat-8.5.43/bin/tomcat-juli.jar<br>Tomcat started.<br></code></pre></td></tr></table></figure>

<h3 id="3-2-3-验证tomcat-web页面"><a href="#3-2-3-验证tomcat-web页面" class="headerlink" title="3.2.3 验证tomcat web页面"></a>3.2.3 验证tomcat web页面</h3><p>确认tomcat服务运行及访问正常</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix43.png" srcset="/blog/img/loading.gif" alt="确认tomcat服务器运行正常"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix44.png" srcset="/blog/img/loading.gif" alt="测试页面是否运行成功"></p>
<h3 id="3-2-4-部署java-gateway服务器"><a href="#3-2-4-部署java-gateway服务器" class="headerlink" title="3.2.4 部署java gateway服务器"></a>3.2.4 部署java gateway服务器</h3><p>java gateway是一个独立于zabbix server和zabbix agent的组件，也就是java gateway可以是单独的一台服务器，但是也可以和zabbix server或者zabbix agent公用一台服务器，前提是端口不要配置冲突了。</p>
<p>本次使用一台单独的服务器，IP地址为172.31.0.102</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># wget https://repo.zabbix.com/zabbix/4.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_4.0-3+bionic_all.deb</span><br><span class="hljs-comment"># dpkg -i zabbix-release_4.0-3+bionic_all.deb</span><br><span class="hljs-comment"># apt update</span><br><span class="hljs-comment"># apt install -y zabbix-java-gateway</span><br><br><span class="hljs-comment"># vim /etc/zabbix/zabbix_java_gateway.conf</span><br><span class="hljs-comment"># grep &quot;^[a-Z]&quot; /etc/zabbix/zabbix_java_gateway.conf</span><br>LISTEN_IP=<span class="hljs-string">&quot;0.0.0.0&quot;</span><br>LISTEN_PORT=10052<br>PID_FILE=<span class="hljs-string">&quot;/var/run/zabbix/zabbix_java_gateway.pid&quot;</span><br>START_POLLERS=20 <span class="hljs-comment">#根据服务器情况来设定</span><br>TIMEOUT=30<br><br><span class="hljs-comment"># systemctl restart zabbix-java-gateway</span><br><span class="hljs-comment"># systemctl enable zabbix-java-gateway</span><br><br><span class="hljs-comment"># lsof -i:10052 #验证java gateway端口</span><br>COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME<br>java    34222 zabbix   12u  IPv6 306383      0t0  TCP *:10052 (LISTEN)<br></code></pre></td></tr></table></figure>

<p>或者编译安装java gateway</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># yum install gcc libxml2-devel  net-snmp net-snmp-devel  curl curl-devel php php-bcmath php-mbstring mariadb-devel java-1.8.0-openjdk-devel -y</span><br><br><span class="hljs-comment"># ./configure --prefix=/usr/local/zabbix --enable-java --with-net-snmp --with-mysql --with-ssh2</span><br><span class="hljs-comment"># make &amp;&amp; make install</span><br><br><span class="hljs-comment">#/usr/local/zabbix/sbin/zabbix_java/startup.sh #编译安装的java gateway启动方式</span><br></code></pre></td></tr></table></figure>

<h3 id="3-2-5-配置zabbix-server调用java-gateway"><a href="#3-2-5-配置zabbix-server调用java-gateway" class="headerlink" title="3.2.5 配置zabbix server调用java gateway"></a>3.2.5 配置zabbix server调用java gateway</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /apps/zabbix_server/etc/zabbix_server.conf</span><br>JavaGateway=172.31.0.102 <span class="hljs-comment">#监听地址</span><br>JavaGatewayPort=10052 <span class="hljs-comment">#指定java gateway的服务器监听端口，如果是默认端口可以不写</span><br>StartJavaPollers=20 <span class="hljs-comment">#启动多少个进程去轮训 java gateway</span><br></code></pre></td></tr></table></figure>

<h3 id="3-2-6-验证Java-Pollers"><a href="#3-2-6-验证Java-Pollers" class="headerlink" title="3.2.6 验证Java Pollers"></a>3.2.6 验证Java Pollers</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># systemctl restart zabbix-server</span><br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix45.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-2-7-tomcat开启JMX监控"><a href="#3-2-7-tomcat开启JMX监控" class="headerlink" title="3.2.7 tomcat开启JMX监控"></a>3.2.7 tomcat开启JMX监控</h3><p>JMX在Java编程语言中定义了应用程序以及网络管理和监控的体系结构、设计模式、应用程序接口以及服务，通常使用JMX来监控系统的运行状态。</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8c5133cab858">https://www.jianshu.com/p/8c5133cab858</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /apps/apache-tomcat-8.5.43/bin/catalina.sh</span><br>CATALINA_OPTS=<span class="hljs-string">&quot;<span class="hljs-variable">$CATALINA_OPTS</span></span><br><span class="hljs-string">-Dcom.sun.management.jmxremote  #启用远程监控JMX</span><br><span class="hljs-string">-Dcom.sun.management.jmxremote.port=12345  #默认启动的JMX端口号，要和zabbix添加主机时候的端口一致即可</span><br><span class="hljs-string">-Dcom.sun.management.jmxremote.authenticate=false  #不使用用户名密码</span><br><span class="hljs-string">-Dcom.sun.management.jmxremote.ssl=false  #不使用ssl认证</span><br><span class="hljs-string">-Djava.rmi.server.hostname=x.x.x.x&quot;</span> <span class="hljs-comment">#tomcat主机自己的IP地址，不要写zabbix服务器的地址</span><br></code></pre></td></tr></table></figure>

<p>如服务器IP是172.31.0.106，则配置如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /apps/apache-tomcat-8.5.43/bin/catalina.sh</span><br><span class="hljs-comment">###########################</span><br>CATALINA_OPTS=<span class="hljs-string">&quot;<span class="hljs-variable">$CATALINA_OPTS</span></span><br><span class="hljs-string">-Dcom.sun.management.jmxremote</span><br><span class="hljs-string">-Dcom.sun.management.jmxremote.port=12345</span><br><span class="hljs-string">-Dcom.sun.management.jmxremote.authenticate=false</span><br><span class="hljs-string">-Dcom.sun.management.jmxremote.ssl=false</span><br><span class="hljs-string">-Djava.rmi.server.hostname=172.31.0.106&quot;</span><br><br><span class="hljs-comment"># /apps/tomcat/bin/catalina.sh stop</span><br><span class="hljs-comment"># /apps/tomcat/bin/catalina.sh start</span><br><span class="hljs-comment"># ss -tnl</span><br></code></pre></td></tr></table></figure>

<h3 id="3-2-8-通过jconsole验证JMX数据"><a href="#3-2-8-通过jconsole验证JMX数据" class="headerlink" title="3.2.8 通过jconsole验证JMX数据"></a>3.2.8 通过jconsole验证JMX数据</h3><p>在windows安装windows版本的JDK，安装过程略，安装完成之后点击安装目录的jconsole.exe，比如<strong>C:\ProgramFiles\Java\jdk1.8.0_301\bin\jconsole.exe</strong>，如下:</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix46.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-2-9-非安全连接"><a href="#3-2-9-非安全连接" class="headerlink" title="3.2.9 非安全连接"></a>3.2.9 非安全连接</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix47.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-2-10-验证连接"><a href="#3-2-10-验证连接" class="headerlink" title="3.2.10 验证连接"></a>3.2.10 验证连接</h3><p>连接成功后会显示当前JMX数据</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix48.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-2-11-zabbix-server添加JMX监控"><a href="#3-2-11-zabbix-server添加JMX监控" class="headerlink" title="3.2.11 zabbix server添加JMX监控"></a>3.2.11 zabbix server添加JMX监控</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix49.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-2-12-zabbix-server关联模板"><a href="#3-2-12-zabbix-server关联模板" class="headerlink" title="3.2.12 zabbix server关联模板"></a>3.2.12 zabbix server关联模板</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix50.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-2-13-验证当前JMX状态及数据"><a href="#3-2-13-验证当前JMX状态及数据" class="headerlink" title="3.2.13 验证当前JMX状态及数据"></a>3.2.13 验证当前JMX状态及数据</h3><p>验证JMX状态：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix51.png" srcset="/blog/img/loading.gif"></p>
<p>验证JMX数据：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix52.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-2-14-JMX监控生产模板使用"><a href="#3-2-14-JMX监控生产模板使用" class="headerlink" title="3.2.14 JMX监控生产模板使用"></a>3.2.14 JMX监控生产模板使用</h3><p>生产环境的JMX监控模板使用，主要添加了自定义监控项和阈值。</p>
<h4 id="3-2-14-1-选择并导入模板"><a href="#3-2-14-1-选择并导入模板" class="headerlink" title="3.2.14.1 选择并导入模板"></a>3.2.14.1 选择并导入模板</h4><p>配置–模板–导入</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix53.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix54.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-2-14-2-关联模板"><a href="#3-2-14-2-关联模板" class="headerlink" title="3.2.14.2 关联模板"></a>3.2.14.2 关联模板</h4><p>将上一步骤导入的模板关联至被监控的tomcat服务器，然后取消关联并清理之前的JMX模板，如下：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix55.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-2-14-3-验证当前模板JMX数据"><a href="#3-2-14-3-验证当前模板JMX数据" class="headerlink" title="3.2.14.3 验证当前模板JMX数据"></a>3.2.14.3 验证当前模板JMX数据</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix56.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-2-15-Linux测试监控JMX方式："><a href="#3-2-15-Linux测试监控JMX方式：" class="headerlink" title="3.2.15 Linux测试监控JMX方式："></a>3.2.15 Linux测试监控JMX方式：</h3><p>使用java客户端cmdline-jmxclient进行测试</p>
<p>测试能否获取到java 当前线程数和最大线程数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-server:~<span class="hljs-comment"># java -version</span><br><br>root@zabbix-server:~<span class="hljs-comment"># java -jar cmdline-jmxclient-0.10.3.jar - 172.31.0.106:12345 &#x27;Catalina:name=&quot;http-nio-8080&quot;,type=ThreadPool&#x27; currentThreadCount</span><br>12/14/2019 15:22:38 +0800 org.archive.jmx.Client currentThreadCount: 3<br><br><span class="hljs-comment"># java -jar cmdline-jmxclient-0.10.3.jar - 172.31.0.106:12345 &#x27;Catalina:name=&quot;http-nio-8080&quot;,type=ThreadPool&#x27; maxThreads</span><br>12/14/2019 15:23:48 +0800 org.archive.jmx.Client maxThreads: 200<br></code></pre></td></tr></table></figure>

<h3 id="3-2-16-zabbix监控linux系统的tomcat总结"><a href="#3-2-16-zabbix监控linux系统的tomcat总结" class="headerlink" title="3.2.16 zabbix监控linux系统的tomcat总结"></a>3.2.16 zabbix监控linux系统的tomcat总结</h3><ol>
<li>要在java成勋打开JMX监控（端口12345）</li>
<li>提前配置好java gateway服务器，并且配置zabbix server指向java gateway服务器</li>
<li>给主机或者给主机关联java的监控模板</li>
</ol>
<h2 id="3-3-zabbix-主动与被动监控模式"><a href="#3-3-zabbix-主动与被动监控模式" class="headerlink" title="3.3 zabbix 主动与被动监控模式"></a>3.3 zabbix 主动与被动监控模式</h2><p>学习主动模式与被动模式工作原理，主动模式模板制作，然后添加主机并关联主动模式模板，然后验证主动模式监控数据和图形。</p>
<h3 id="3-3-1-被动模式"><a href="#3-3-1-被动模式" class="headerlink" title="3.3.1 被动模式"></a>3.3.1 被动模式</h3><p>无论是模式还是被动模式，都是站在zabbix agent角度来说的工作模式，比如被动模式，是说zabbix agent被动的接受zabbix server周期性发送过来的数据收集指令，在被动模式之下，zabbix server会根据主机关联的模板中的监控项和数据采集间隔时间，周期性的打开随机端口并向zabbix agent服务器的10050发起tcp连接，然后发送获取监控项数据的指令，即zabbix server发送什么指令那么zabbix agent就收集什么数据，zabbix server什么时候发送zabbix agent就什么时候采集，zabbix server不发送zabbix agent就一直不响应，所以zabbix agent也不用关心其监控项和数据采集周期间隔时间。</p>
<p>被动模式的优点就是配置简单，安装后即可使用，因此也成为zabbix 的默认工作模式，但是被动模式的最大问题就是会加大zabbix server的工作量，在数百甚至数千台服务器的环境下会导致zabbix server需要轮训向每个zabbix agent发送数据采集指令，如果zabbix server负载很高还会导致不能及时获取到最新数据，但由于无需其他复杂配置，被设置为了默认的工作方式。</p>
<h4 id="3-3-1-1-被动模式端口状态"><a href="#3-3-1-1-被动模式端口状态" class="headerlink" title="3.3.1.1 被动模式端口状态"></a>3.3.1.1 被动模式端口状态</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix57.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-3-1-2-被动模式工作流程"><a href="#3-3-1-2-被动模式工作流程" class="headerlink" title="3.3.1.2 被动模式工作流程"></a>3.3.1.2 被动模式工作流程</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix58.png" srcset="/blog/img/loading.gif"></p>
<h3 id="3-3-2-主动模式"><a href="#3-3-2-主动模式" class="headerlink" title="3.3.2 主动模式"></a>3.3.2 主动模式</h3><p>主动模式是由zabbix agent主动向zabbix server的10051端口发起tcp连接请求，因此主动模式下必须在zabbix agent配置文件中指定zabbix server的IP或者主机名(必须可以被解析为IP地址)，在连接到zabbix server之前zabbix agent是不知道自己要采集那些数据以及间隔多久采集一次数据的，然后在连接到zabbix server以后获取到自己的监控项和数据采集间隔周期时间，然后再根据监控项采集数据并返回给zabbix server，在主动模式下不再需要zabbix serve向zabbix agent发起连接请求，因此主动模式在一定程度上可减轻zabbix server打开的本地随机端口和进程数，在一定程度就减轻看zabbix server的压力。</p>
<h4 id="3-3-2-1-主动模式工作流程"><a href="#3-3-2-1-主动模式工作流程" class="headerlink" title="3.3.2.1 主动模式工作流程"></a>3.3.2.1 主动模式工作流程</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix59.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-3-2-2-修改zabbix-agent为主动模式"><a href="#3-3-2-2-修改zabbix-agent为主动模式" class="headerlink" title="3.3.2.2 修改zabbix agent为主动模式"></a>3.3.2.2 修改zabbix agent为主动模式</h4><p>将172.31.0.107安装zabbix agent，并且设置为主动模式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#安装zabbix agent</span><br><span class="hljs-comment"># wget https://repo.zabbix.com/zabbix/4.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_4.0-3+bionic_all.deb</span><br><span class="hljs-comment"># dpkg -i zabbix-release_4.0-3+bionic_all.deb</span><br><span class="hljs-comment"># apt update</span><br><span class="hljs-comment"># apt install -y zabbix-agent</span><br><br><span class="hljs-comment"># grep &quot;^[a-Z]&quot; /etc/zabbix/zabbix_agentd.conf</span><br>PidFile=/var/run/zabbix/zabbix_agentd.pid<br>LogFile=/var/<span class="hljs-built_in">log</span>/zabbix/zabbix_agentd.log<br>LogFileSize=0<br>Server=172.31.0.101<br>ListenPort=10050<br>StartAgents=3<br>ServerActive=172.31.0.101 <span class="hljs-comment">#主动模式的zabbix server地址</span><br>Hostname=172.31.0.107<br>Include=/etc/zabbix/zabbix_agentd.d/*.conf<br><br><span class="hljs-comment"># systemctl restart zabbix-agent</span><br><span class="hljs-comment"># systemctl enable zabbix-agent</span><br></code></pre></td></tr></table></figure>

<h4 id="3-3-2-3-生成主动模式模板"><a href="#3-3-2-3-生成主动模式模板" class="headerlink" title="3.3.2.3 生成主动模式模板"></a>3.3.2.3 生成主动模式模板</h4><p>找到要设置为主动模式的模板</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix60.png" srcset="/blog/img/loading.gif"></p>
<p>选择全克隆</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix62.png" srcset="/blog/img/loading.gif"></p>
<p>生成主动模式模板</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix63.png" srcset="/blog/img/loading.gif"></p>
<p>进入新生成的模板监控项</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix64.png" srcset="/blog/img/loading.gif"></p>
<p>点击箭头的方向，全选所有监控项</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix65.png" srcset="/blog/img/loading.gif"></p>
<p>到网页尾部，选择批量更新</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix66.png" srcset="/blog/img/loading.gif"></p>
<p>修改监控项配置</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix67.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix68.png" srcset="/blog/img/loading.gif"></p>
<p>修改完成后点击更新</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix69.png" srcset="/blog/img/loading.gif"></p>
<p>将自动发现的被动模式同样也修改成主动模式</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix70.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix71.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix72.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-3-2-4-添加主动模式主机并关联主动模板"><a href="#3-3-2-4-添加主动模式主机并关联主动模板" class="headerlink" title="3.3.2.4 添加主动模式主机并关联主动模板"></a>3.3.2.4 添加主动模式主机并关联主动模板</h4><p>使用克隆正在监控的主机来添加新的主机</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix74.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix75.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix76.png" srcset="/blog/img/loading.gif" alt="修改资料"></p>
<p>取消原来的模板，更换成主动模式的模板</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix77.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix78.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-3-2-5-验证主动模式主机状态"><a href="#3-3-2-5-验证主动模式主机状态" class="headerlink" title="3.3.2.5 验证主动模式主机状态"></a>3.3.2.5 验证主动模式主机状态</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix79.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-3-2-6-验证主动模式主机数据"><a href="#3-3-2-6-验证主动模式主机数据" class="headerlink" title="3.3.2.6 验证主动模式主机数据"></a>3.3.2.6 验证主动模式主机数据</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix80.png" srcset="/blog/img/loading.gif"></p>
<h4 id="3-3-2-7-验证主动模式主机端口"><a href="#3-3-2-7-验证主动模式主机端口" class="headerlink" title="3.3.2.7 验证主动模式主机端口"></a>3.3.2.7 验证主动模式主机端口</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-server:~<span class="hljs-comment"># netstat -tanlp| grep 107</span><br>tcp        0      0 172.31.0.101:10051      172.31.0.107:57785      TIME_WAIT   -                   <br>tcp        0      0 172.31.0.101:10051      172.31.0.107:57783      TIME_WAIT   -                   <br>tcp        0      0 172.31.0.101:10051      172.31.0.107:57781      TIME_WAIT   -<br></code></pre></td></tr></table></figure>



<h1 id="四、zabbix-proxy"><a href="#四、zabbix-proxy" class="headerlink" title="四、zabbix proxy"></a>四、zabbix proxy</h1><p><a target="_blank" rel="noopener" href="https://www.zabbix.com/documentation/4.0/zh/manual/distributed_monitoring">https://www.zabbix.com/documentation/4.0/zh/manual/distributed_monitoring</a></p>
<p>zabbix 作为一个分布式监控系统(分布式监控解决方案)，支持通过代理(proxy)收集zabbix agent的监控数据然后由zabbix proxy再把数据发送给zabbix server，也就是zabbix proxy 可以代替 zabbix server 收集监控数据，然后把数据汇报给 zabbix server，所以zabbix proxy可以在一定程度上分担了zabbix server 的数据收集压力，从而降低了数据的采集时间、也相应的增加了zabbix server的监控能力。</p>
<p>另外zabbix proxy也区分主动模式和被动模式，通信方式与zabbix server主动模式和被动模式一样，区别是zabbixproxy由于没有zabbix agent的配置，所以zabbix proxy在主动模式下要向zabbix server周期性的向zabbix server申请获取zabbix agent的监控项信息，但是zabbix proxy在被动模式下也是等待zabbix server的连接并接受zabbix server发送的监控项指令，然后再有zabbix proxy向zabbix agent发起请求获取数据。</p>
<h2 id="4-1-zabbix-proxy架构"><a href="#4-1-zabbix-proxy架构" class="headerlink" title="4.1 zabbix proxy架构"></a>4.1 zabbix proxy架构</h2><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix81.png" srcset="/blog/img/loading.gif"></p>
<h2 id="4-2-zabbix-proxy对比zbbbix-server"><a href="#4-2-zabbix-proxy对比zbbbix-server" class="headerlink" title="4.2 zabbix proxy对比zbbbix server"></a>4.2 zabbix proxy对比zbbbix server</h2><table>
<thead>
<tr>
<th>功能</th>
<th>zabbxy proxy</th>
<th>zabbix server</th>
</tr>
</thead>
<tbody><tr>
<td>轻量级</td>
<td>是</td>
<td>相对重量级</td>
</tr>
<tr>
<td>图形</td>
<td>无</td>
<td>带图形控制界面</td>
</tr>
<tr>
<td>可以独立工作</td>
<td>是，可以独立采集数据并存储</td>
<td>是，即数据采集、存储、分析、展示于一体</td>
</tr>
<tr>
<td>易维护</td>
<td>是，配置完成后基本无需管理</td>
<td>维护也不难</td>
</tr>
<tr>
<td>独立数据库</td>
<td>保留少量最近数据</td>
<td>保留指定时间内的所有数据</td>
</tr>
<tr>
<td>报警通知</td>
<td>否，代理服务器不发送邮件通知</td>
<td>支持邮件、短信等告警机制</td>
</tr>
</tbody></table>
<h2 id="4-3zabbix-proxy部署与使用"><a href="#4-3zabbix-proxy部署与使用" class="headerlink" title="4.3zabbix proxy部署与使用"></a>4.3zabbix proxy部署与使用</h2><p>学习zabbix proxy工作原理</p>
<p>安装主动模式与被动模式的zabbix proxy服务器</p>
<p>配置zabbix gent工作模式为主动模式与被动模式</p>
<h3 id="4-3-1-zabbix-proxy版本选择"><a href="#4-3-1-zabbix-proxy版本选择" class="headerlink" title="4.3.1 zabbix proxy版本选择"></a>4.3.1 zabbix proxy版本选择</h3><p>zabbix proxy的大版本必须要和zabbix server版本一致，否则会导致出现zabbix server与zabbix proxy不兼容问题，如下：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix82.png" srcset="/blog/img/loading.gif"></p>
<h3 id="4-3-2-zabbix-proxy安装"><a href="#4-3-2-zabbix-proxy安装" class="headerlink" title="4.3.2 zabbix proxy安装"></a>4.3.2 zabbix proxy安装</h3><p><a target="_blank" rel="noopener" href="https://www.zabbix.com/documentation/4.0/zh/manual/installation/install">https://www.zabbix.com/documentation/4.0/zh/manual/installation/install</a></p>
<p>zabbix 的不同安装方式</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">zabbix</span> server：<span class="hljs-number">172.31.0.101</span><br>zabbix proxy 主动模式：<span class="hljs-number">172.31.0.102</span> <span class="hljs-comment">#采用apt或者yum安装</span><br>zabbix proxy 被动模式：<span class="hljs-number">172.31.0.103</span> <span class="hljs-comment">#采用编译安装</span><br></code></pre></td></tr></table></figure>

<h4 id="4-3-2-1-apt-yum安装zabbix-proxy"><a href="#4-3-2-1-apt-yum安装zabbix-proxy" class="headerlink" title="4.3.2.1 apt/yum安装zabbix proxy"></a>4.3.2.1 apt/yum安装zabbix proxy</h4><p><a target="_blank" rel="noopener" href="https://www.zabbix.com/documentation/4.0/zh/manual/installation/install_from_packages/debian_ubuntu">https://www.zabbix.com/documentation/4.0/zh/manual/installation/install_from_packages/debian_ubuntu</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># wget https://repo.zabbix.com/zabbix/4.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_4.0-3+bionic_all.deb</span><br><br><span class="hljs-comment"># dpkg -i zabbix-release_4.0-3+bionic_all.deb (可以在/etc/apt/sources.list.d/zabbix.list里将源修改为阿里源的zabbix)</span><br><br><span class="hljs-comment"># apt update</span><br><br><span class="hljs-comment">#安装zabbix proxy</span><br><span class="hljs-comment"># yum install gcc libxml2-devel  net-snmp net-snmp-devel  curl curl-devel php php-bcmath php-mbstring mariadb mariadb-devel java-1.8.0-openjdk-devel -y</span><br><br><span class="hljs-comment"># apt install libmysqld-dev libmysqlclient-dev libxml2-dev libxml2 snmp libsnmp-dev libevent-dev curl libcurl4-openssl-dev</span><br><br><span class="hljs-comment"># apt-cache madison zabbix-proxy-mysql</span><br>zabbix-proxy-mysql | 1:4.0.32-1+bionic | https://mirrors.aliyun.com/zabbix/zabbix/4.0/ubuntu bionic/main amd64 Packages<br>zabbix-proxy-mysql | 1:3.0.12+dfsg-1 | http://mirrors.aliyun.com/ubuntu bionic/universe amd64 Packages<br>    zabbix | 1:3.0.12+dfsg-1 | http://mirrors.aliyun.com/ubuntu bionic/universe Sources<br>    zabbix | 1:4.0.32-1+bionic | https://mirrors.aliyun.com/zabbix/zabbix/4.0/ubuntu bionic/main Sources<br><br><span class="hljs-comment"># apt install -y zabbix-proxy-mysql</span><br></code></pre></td></tr></table></figure>

<h4 id="4-3-2-2-编译安装zabbix-proxy"><a href="#4-3-2-2-编译安装zabbix-proxy" class="headerlink" title="4.3.2.2 编译安装zabbix proxy"></a>4.3.2.2 编译安装zabbix proxy</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># useradd zabbix -s /usr/sbin/nologin</span><br><br><span class="hljs-comment">#安装依赖关系</span><br><span class="hljs-comment"># apt install libmysqld-dev libmysqlclient-dev libxml2-dev libxml2 snmp libsnmp-dev libevent-dev curl libcurl4-openssl-dev</span><br><br><span class="hljs-comment">#如果要安装java的话就需要安装java环境</span><br><br><span class="hljs-comment"># cd /usr/local/src</span><br><span class="hljs-comment"># tar xf zabbix-4.0.32.tar.gz</span><br><span class="hljs-comment"># cd zabbix-4.0.32/</span><br><span class="hljs-comment"># pwd</span><br>/usr/<span class="hljs-built_in">local</span>/src/zabbix-4.0.32<br><span class="hljs-comment"># ./configure --prefix=/apps/zabbix_proxy --enable-proxy --enable-agent --enable-java(需要就加上) --with-mysql --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2</span><br><span class="hljs-comment"># make install</span><br><br><span class="hljs-comment"># chown zabbix.zabbix -R /apps/zabbix_proxy</span><br><br><span class="hljs-comment">#zabbix proxy启动service文件：</span><br><span class="hljs-comment"># cat /lib/systemd/system/zabbix-proxy.service</span><br>[Unit]<br>Description=Zabbix Proxy<br>After=syslog.target<br>After=network.target<br><br>[Service]<br>Environment=<span class="hljs-string">&quot;CONFFILE=/apps/zabbix_proxy/etc/zabbix_proxy.conf&quot;</span><br>EnvironmentFile=-/etc/default/zabbix-proxy<br>Type=forking<br>Restart=on-failure<br>PIDFile=/tmp/zabbix_proxy.pid<br>KillMode=control-group<br>ExecStart=/apps/zabbix_proxy/sbin/zabbix_proxy -c <span class="hljs-variable">$CONFFILE</span><br>ExecStop=/bin/<span class="hljs-built_in">kill</span> -SIGTERM <span class="hljs-variable">$MAINPID</span><br>RestartSec=10s<br>TimeoutSec=infinity<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure>

<h3 id="4-3-3-配置被动zabbix-proxy"><a href="#4-3-3-配置被动zabbix-proxy" class="headerlink" title="4.3.3 配置被动zabbix proxy"></a>4.3.3 配置被动zabbix proxy</h3><p>配置并使用被动模式(Passive Proxy Mode)的zabbix proxy收集zabbix agent监控数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">zabbix server：172.31.0.101<br>被动模式服务器IP：172.31.0.103<br>web服务器IP：172.31.0.107<br></code></pre></td></tr></table></figure>

<h4 id="4-3-3-1-zabbix-proxy被动配置"><a href="#4-3-3-1-zabbix-proxy被动配置" class="headerlink" title="4.3.3.1 zabbix proxy被动配置"></a>4.3.3.1 zabbix proxy被动配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /apps/zabbix_proxy/etc/zabbix_proxy.conf</span><br>ProxyMode=1 <span class="hljs-comment">#0为主动，1为被动</span><br>Server=172.31.0.101 <span class="hljs-comment">#zabbix server服务器的地址或主机名</span><br>Hostname=proxy-gz-qxg-rlin-passive  <span class="hljs-comment">#代理服务器名称，需要与zabbix server添加代理时候的proxyname是一致的！</span><br>ListenPort=10051 <span class="hljs-comment">#zabbix proxy监听端口</span><br>LogFile=/tmp/zabbix_proxy.log<br>EnableRemoteCommands=1 <span class="hljs-comment">#允许zabbix server执行远程命令</span><br>PIDfILE=/tmp/zabbix_proxy.pid<br>DBHost=172.31.0.104  <span class="hljs-comment">#数据库服务器地址</span><br>DBName=zabbix_passive <span class="hljs-comment">#使用的数据库名称</span><br>DBUser=zabbix_passive <span class="hljs-comment">#连接数据库的用户名称</span><br>DBPassword=123456 <span class="hljs-comment">#数据库用户密码</span><br>DBPort=3306 <span class="hljs-comment">#数据库端口</span><br>ProxyLocalBuffer=720  <span class="hljs-comment">#已经提交到zabbix server的数据保留时间</span><br>ProxyOfflineBuffer=720 <span class="hljs-comment">#未提交到zabbix server的时间保留时间</span><br>HeartbeatFrequency=60  <span class="hljs-comment">#心跳间隔检测时间，默认60秒，范围0-3600秒，被动模式不使用</span><br>ConfigFrequency=5  <span class="hljs-comment">#间隔多少秒从zabbix server获取监控项信息</span><br>DataSenderFrequency=5 <span class="hljs-comment">#数据发送时间间隔，默认为1秒，范围为1-3600秒，被动模式不使用</span><br>StartPollers=20  <span class="hljs-comment">#启动的数据采集器数量</span><br>JavaGateway=172.31.0.104 <span class="hljs-comment">#java gateway服务器地址,当需要监控java的时候必须配置否则监控不到数据</span><br>JavaGatewayPort=10052 <span class="hljs-comment">#Javagatewa服务端口</span><br>StartJavaPollers=20  <span class="hljs-comment">#启动多少个线程采集数据</span><br>CacheSize=16M <span class="hljs-comment">#保存监控项而占用的最大内存</span><br>HistoryCacheSize=128M <span class="hljs-comment">#保存监控历史数据占用的最大内存</span><br>HistoryIndexCacheSize=16M  <span class="hljs-comment">#历史索引缓存的大小</span><br>Timeout=30 <span class="hljs-comment">#监控项超时时间，单位为秒</span><br>LogSlowQueries=3000 <span class="hljs-comment">#毫秒，多久的数据库查询会被记录到日志</span><br></code></pre></td></tr></table></figure>

<h4 id="4-3-3-2-被动模式数据库操作"><a href="#4-3-3-2-被动模式数据库操作" class="headerlink" title="4.3.3.2 被动模式数据库操作"></a>4.3.3.2 被动模式数据库操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#172.31.0.104创建zabbix proxy数据库</span><br><span class="hljs-comment"># mysql</span><br>mysql&gt; create database zabbix_passive character <span class="hljs-built_in">set</span> utf8 collate utf8_bin;<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; grant all privileges on zabbix_passive.* to zabbix_passive@<span class="hljs-string">&#x27;172.31.0.%&#x27;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>;<br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br><span class="hljs-comment">#设置被动模式的服务器测试mysql</span><br><span class="hljs-comment"># apt install -y mysql-client</span><br><br><span class="hljs-comment"># mysql -uzabbix_passive -p123456 -h172.31.0.104</span><br>......<br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| zabbix_passive     |<br>+--------------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br><span class="hljs-comment">#被动模式数据库导入</span><br><span class="hljs-comment"># pwd</span><br>/usr/<span class="hljs-built_in">local</span>/src/zabbix-4.0.32<br><span class="hljs-comment"># mysql -uzabbix_passive -p123456 -h172.31.0.104 zabbix_passive &lt; database/mysql/schema.sql</span><br><br><span class="hljs-comment">#查看被导入的表</span><br><span class="hljs-comment"># mysql -uzabbix_passive -p123456 -h172.31.0.104</span><br>......<br>mysql&gt; use zabbix_passive;<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>mysql&gt; show tables;<br>+----------------------------+<br>| Tables_in_zabbix_passive   |<br>+----------------------------+<br>| acknowledges               |<br>| actions                    |<br>| alerts                     |<br>|......                      |<br>| widget                     |<br>| widget_field               |<br>+----------------------------+<br>144 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br></code></pre></td></tr></table></figure>

<h4 id="4-3-3-3-重启zabbix-proxy服务"><a href="#4-3-3-3-重启zabbix-proxy服务" class="headerlink" title="4.3.3.3 重启zabbix proxy服务"></a>4.3.3.3 重启zabbix proxy服务</h4><p>重启zabbix proxy服务并验证日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-proxy-passive:~<span class="hljs-comment"># systemctl daemon-reload</span><br>root@zabbix-proxy-passive:~<span class="hljs-comment"># systemctl start zabbix-proxy</span><br>root@zabbix-proxy-passive:~<span class="hljs-comment"># systemctl enable zabbix-proxy</span><br>root@zabbix-proxy-passive:~<span class="hljs-comment"># tail /tmp/zabbix_proxy.log</span><br> 1971:20191216:102255.620 proxy <span class="hljs-comment">#34 started [poller #5]</span><br> 1974:20191216:102255.623 proxy <span class="hljs-comment">#37 started [trapper #2]</span><br> 1972:20191216:102255.624 proxy <span class="hljs-comment">#35 started [unreachable poller #1]</span><br> 1973:20191216:102255.624 proxy <span class="hljs-comment">#36 started [trapper #1]</span><br> 1969:20191216:102255.628 proxy <span class="hljs-comment">#32 started [poller #3]</span><br> 1970:20191216:102255.630 proxy <span class="hljs-comment">#33 started [poller #4]</span><br> 1977:20191216:102255.631 proxy <span class="hljs-comment">#40 started [trapper #5]</span><br> 1978:20191216:102255.632 proxy <span class="hljs-comment">#41 started [icmp pinger #1]</span><br> 1975:20191216:102255.633 proxy <span class="hljs-comment">#38 started [trapper #3]</span><br> 1976:20191216:102255.634 proxy <span class="hljs-comment">#39 started [trapper #4]</span><br></code></pre></td></tr></table></figure>

<h4 id="4-3-3-4-zabbix-添加被动代理"><a href="#4-3-3-4-zabbix-添加被动代理" class="headerlink" title="4.3.3.4 zabbix 添加被动代理"></a>4.3.3.4 zabbix 添加被动代理</h4><p>管理–&gt;agent代理程序–&gt;创建代理：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix83.png" srcset="/blog/img/loading.gif"></p>
<h4 id="4-3-3-5-配置zabbix-agent使用被动代理"><a href="#4-3-3-5-配置zabbix-agent使用被动代理" class="headerlink" title="4.3.3.5 配置zabbix agent使用被动代理"></a>4.3.3.5 配置zabbix agent使用被动代理</h4><p>配置–&gt;主机–&gt;创建 主机：</p>
<h5 id="4-3-3-5-1-添加被动模式代理主机"><a href="#4-3-3-5-1-添加被动模式代理主机" class="headerlink" title="4.3.3.5.1 添加被动模式代理主机"></a>4.3.3.5.1 添加被动模式代理主机</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix84.png" srcset="/blog/img/loading.gif"></p>
<h5 id="4-3-3-5-2-关联被动模式模板"><a href="#4-3-3-5-2-关联被动模式模板" class="headerlink" title="4.3.3.5.2 关联被动模式模板"></a>4.3.3.5.2 关联被动模式模板</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix40.png" srcset="/blog/img/loading.gif"></p>
<h5 id="4-3-3-5-3-zabbix-server配置"><a href="#4-3-3-5-3-zabbix-server配置" class="headerlink" title="4.3.3.5.3 zabbix server配置"></a>4.3.3.5.3 zabbix server配置</h5><p>修改zabbix server向zabbix获取监控数据的频率等参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">### Option: StartProxyPollers</span><br><span class="hljs-comment">#    Number of pre-forked instances of pollers for passive proxies.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Mandatory: no</span><br><span class="hljs-comment"># Range: 0-250</span><br><span class="hljs-comment"># Default:</span><br>StartProxyPollers=20 <span class="hljs-comment">#启用多少子进程与代理端通信，若代理较多可考虑加大此数值，范围是0-250</span><br><br><span class="hljs-comment">### Option: ProxyConfigFrequency</span><br><span class="hljs-comment">#    How often Zabbix Server sends configuration data to a Zabbix Proxy in seconds.</span><br><span class="hljs-comment">#    This parameter is used only for proxies in the passive mode.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Mandatory: no</span><br><span class="hljs-comment"># Range: 1-3600*24*7</span><br><span class="hljs-comment"># Default:</span><br>ProxyConfigFrequency=60 <span class="hljs-comment">#proxy被动模式下，server多少秒同步配置文件至proxy，该参数仅用于被动模式下的代理，范围是1-3600*24*7</span><br><br><span class="hljs-comment">### Option: ProxyDataFrequency</span><br><span class="hljs-comment">#    How often Zabbix Server requests history data from a Zabbix Proxy in seconds.</span><br><span class="hljs-comment">#    This parameter is used only for proxies in the passive mode.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Mandatory: no</span><br><span class="hljs-comment"># Range: 1-3600</span><br><span class="hljs-comment"># Default:</span><br>ProxyDataFrequency=60  <span class="hljs-comment">#被动模式下，zabbix server间隔多少秒向proxy请求历史数据</span><br></code></pre></td></tr></table></figure>

<h4 id="4-3-3-6-zabbix-agent配置文件"><a href="#4-3-3-6-zabbix-agent配置文件" class="headerlink" title="4.3.3.6 zabbix agent配置文件"></a>4.3.3.6 zabbix agent配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@web-server2:~<span class="hljs-comment"># grep &quot;^[a-Z]&quot; /etc/zabbix/zabbix_agentd.conf</span><br>PidFile=/var/run/zabbix/zabbix_agentd.pid<br>LogFile=/var/<span class="hljs-built_in">log</span>/zabbix/zabbix_agentd.log<br>LogFileSize=0<br>Server=172.31.0.101,172.31.0.103<br>ListenPort=10050<br>ListenIP=0.0.0.0<br>StartAgents=5<br>ServerActive=127.0.0.1<br>Hostname=172.31.0.107<br>Timeout=30<br>Include=/etc/zabbix/zabbix_agentd.d/*.conf<br></code></pre></td></tr></table></figure>

<h4 id="4-3-3-7-zabbix-web验证当前主机状态"><a href="#4-3-3-7-zabbix-web验证当前主机状态" class="headerlink" title="4.3.3.7 zabbix web验证当前主机状态"></a>4.3.3.7 zabbix web验证当前主机状态</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix134.png" srcset="/blog/img/loading.gif"></p>
<h4 id="4-3-3-8-验证主机监控数据及图形"><a href="#4-3-3-8-验证主机监控数据及图形" class="headerlink" title="4.3.3.8 验证主机监控数据及图形"></a>4.3.3.8 验证主机监控数据及图形</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix135.png" srcset="/blog/img/loading.gif"></p>
<h3 id="4-3-4-配置主动模式zabbix-proxy"><a href="#4-3-4-配置主动模式zabbix-proxy" class="headerlink" title="4.3.4 配置主动模式zabbix proxy"></a>4.3.4 配置主动模式zabbix proxy</h3><p>配置并使用主动模式(Active Proxy Mode)的zabbix proxy收集zabbix agent监控数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">zabbix server：172.31.0.101<br>主动模式服务器IP：172.31.0.102<br>web服务器IP：172.31.0.106<br></code></pre></td></tr></table></figure>

<h4 id="4-3-4-1-zabbix-proxy主动配置"><a href="#4-3-4-1-zabbix-proxy主动配置" class="headerlink" title="4.3.4.1 zabbix proxy主动配置"></a>4.3.4.1 zabbix proxy主动配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /etc/zabbix/zabbix_proxy.conf</span><br>ProxyMode=0 <span class="hljs-comment">#0为主动，1为被动</span><br>Server=172.31.0.101 <span class="hljs-comment">#zabbix server服务器的地址或主机名</span><br>Hostname=proxy-gz-qxg-rlin-active  <span class="hljs-comment">#代理服务器名称，需要与zabbix server添加代理时候的proxyname是一致的！</span><br>ListenPort=10051 <span class="hljs-comment">#zabbix proxy监听端口</span><br>LogFile=/var/<span class="hljs-built_in">log</span>/zabbix/zabbix_proxy.log<br>EnableRemoteCommands=1 <span class="hljs-comment">#允许zabbix server执行远程命令</span><br>DBHost=172.31.0.104  <span class="hljs-comment">#数据库服务器地址</span><br>DBName=zabbix_active <span class="hljs-comment">#使用的数据库名称</span><br>DBUser=zabbix_active <span class="hljs-comment">#连接数据库的用户名称</span><br>DBPassword=123456 <span class="hljs-comment">#数据库用户密码</span><br>DBPort=3306 <span class="hljs-comment">#数据库端口</span><br>ProxyLocalBuffer=720  <span class="hljs-comment">#已经提交到zabbix server的数据保留时间</span><br>ProxyOfflineBuffer=720 <span class="hljs-comment">#未提交到zabbix server的时间保留时间</span><br>HeartbeatFrequency=60  <span class="hljs-comment">#心跳间隔检测时间，默认60秒，范围0-3600秒，被动模式不使用</span><br>ConfigFrequency=5  <span class="hljs-comment">#间隔多少秒从zabbix server获取监控项信息</span><br>DataSenderFrequency=5 <span class="hljs-comment">#数据发送时间间隔，默认为1秒，范围为1-3600秒，被动模式不使用</span><br>StartPollers=20  <span class="hljs-comment">#启动的数据采集器数量</span><br>JavaGateway=172.31.0.104 <span class="hljs-comment">#java gateway服务器地址,当需要监控java的时候必须配置否则监控不到数据</span><br>JavaGatewayPort=10052 <span class="hljs-comment">#Javagatewa服务端口</span><br>StartJavaPollers=20  <span class="hljs-comment">#启动多少个线程采集数据</span><br>CacheSize=16M <span class="hljs-comment">#保存监控项而占用的最大内存</span><br>HistoryCacheSize=128M <span class="hljs-comment">#保存监控历史数据占用的最大内存</span><br>HistoryIndexCacheSize=16M  <span class="hljs-comment">#历史索引缓存的大小</span><br>Timeout=30 <span class="hljs-comment">#监控项超时时间，单位为秒</span><br>LogSlowQueries=3000 <span class="hljs-comment">#毫秒，多久的数据库查询会被记录到日志</span><br></code></pre></td></tr></table></figure>

<h4 id="4-3-4-2-主动模式数据库操作"><a href="#4-3-4-2-主动模式数据库操作" class="headerlink" title="4.3.4.2 主动模式数据库操作"></a>4.3.4.2 主动模式数据库操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#172.31.0.104创建zabbix proxy数据库</span><br><span class="hljs-comment"># mysql</span><br>......<br>mysql&gt; create database zabbix_active character <span class="hljs-built_in">set</span> utf8 collate utf8_bin;<br>Query OK, 1 row affected (0.02 sec)<br><br>mysql&gt; grant all privileges on zabbix_active.* to zabbix_active@<span class="hljs-string">&#x27;172.31.0.%&#x27;</span> identified by <span class="hljs-string">&#x27;123456&#x27;</span>;<br>Query OK, 0 rows affected, 1 warning (0.00 sec)<br><br><span class="hljs-comment">#设置主动模式服务器测试mysql</span><br><span class="hljs-comment"># apt install -y mysql-client</span><br><br><span class="hljs-comment"># mysql -uzabbix_active -p123456 -h172.31.0.104</span><br>......<br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| zabbix_active      |<br>+--------------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br><span class="hljs-comment">#主动模式数据库导入：</span><br><span class="hljs-comment"># zcat /usr/share/doc/zabbix-proxy-mysql/schema.sql.gz | mysql -uzabbix_active -p123456 -h172.31.0.104 zabbix_active</span><br><br><span class="hljs-comment"># mysql -uzabbix_active -p123456 -h172.31.0.104</span><br>mysql&gt; use zabbix_active;<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>mysql&gt; show tables;<br>+----------------------------+<br>| Tables_in_zabbix_active    |<br>+----------------------------+<br>| acknowledges               |<br>| actions                    |<br>| alerts                     |<br>| ..........                 |<br>| widget                     |<br>| widget_field               |<br>+----------------------------+<br>144 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br></code></pre></td></tr></table></figure>

<h4 id="重启zabbix-proxy服务"><a href="#重启zabbix-proxy服务" class="headerlink" title="重启zabbix proxy服务"></a>重启zabbix proxy服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-proxy-active:~<span class="hljs-comment"># systemctl restart zabbix-proxy</span><br>root@zabbix-proxy-active:~<span class="hljs-comment"># systemctl enable zabbix-proxy</span><br></code></pre></td></tr></table></figure>

<h4 id="4-3-4-3-zabbix-web添加主动代理"><a href="#4-3-4-3-zabbix-web添加主动代理" class="headerlink" title="4.3.4.3 zabbix web添加主动代理"></a>4.3.4.3 zabbix web添加主动代理</h4><p>管理–&gt;agent代理程序–&gt;创建代理：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix85.png" srcset="/blog/img/loading.gif"></p>
<h4 id="4-3-4-4-zabbix-agent使用主动代理"><a href="#4-3-4-4-zabbix-agent使用主动代理" class="headerlink" title="4.3.4.4 zabbix agent使用主动代理"></a>4.3.4.4 zabbix agent使用主动代理</h4><p>修改或者新添加一台zabbix agent，并使用zabbix 主动模式代理服务器进行监控：</p>
<p><strong>使用主动模式proxy：</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix86.png" srcset="/blog/img/loading.gif"></p>
<p><strong>验证当前主机和主动模式proxy 状态：</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix87.png" srcset="/blog/img/loading.gif"></p>
<h4 id="4-3-4-5-zabbix-agent配置文件"><a href="#4-3-4-5-zabbix-agent配置文件" class="headerlink" title="4.3.4.5 zabbix agent配置文件"></a>4.3.4.5 zabbix agent配置文件</h4><p>需要修改zabbix agent中配置文件ServerActive的值为主动模式zabbix proxy。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># grep &quot;^[a-Z]&quot; /etc/zabbix/zabbix_agentd.conf</span><br>PidFile=/var/run/zabbix/zabbix_agentd.pid<br>LogFile=/var/<span class="hljs-built_in">log</span>/zabbix/zabbix_agentd.log<br>LogFileSize=0<br>Server=172.31.0.101,172.31.0.102 <span class="hljs-comment">#zabbix server与zabbix passive代理的地址</span><br>ServerActive=172.31.0.102<br>Hostname=172.31.0.106<br>Timeout=30<br>Include=/etc/zabbix/zabbix_agentd.d/*.conf<br><br><span class="hljs-comment"># systemctl restart zabbix-agent</span><br><span class="hljs-comment"># lsof -i:10050</span><br>COMMAND     PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME<br>zabbix_ag 21689 zabbix    4u  IPv4 108689      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21689 zabbix    5u  IPv6 108690      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21691 zabbix    4u  IPv4 108689      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21691 zabbix    5u  IPv6 108690      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21692 zabbix    4u  IPv4 108689      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21692 zabbix    5u  IPv6 108690      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21693 zabbix    4u  IPv4 108689      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21693 zabbix    5u  IPv6 108690      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21694 zabbix    4u  IPv4 108689      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21694 zabbix    5u  IPv6 108690      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21695 zabbix    4u  IPv4 108689      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21695 zabbix    5u  IPv6 108690      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21696 zabbix    4u  IPv4 108689      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21696 zabbix    5u  IPv6 108690      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21697 zabbix    4u  IPv4 108689      0t0  TCP *:zabbix-agent (LISTEN)<br>zabbix_ag 21697 zabbix    5u  IPv6 108690      0t0  TCP *:zabbix-agent (LISTEN)<br><span class="hljs-comment"># lsof -i:12345 #此为tomcat监控端口</span><br>COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME<br>java    1186 root   20u  IPv6  31381      0t0  TCP *:12345 (LISTEN)<br>java    1186 root   80u  IPv6  76042      0t0  TCP web-server1:12345-&gt;172.31.0.102:37401 (ESTABLISHED)<br></code></pre></td></tr></table></figure>

<h4 id="4-3-3-6-zabbix-web验证当前主机状态"><a href="#4-3-3-6-zabbix-web验证当前主机状态" class="headerlink" title="4.3.3.6 zabbix web验证当前主机状态"></a>4.3.3.6 zabbix web验证当前主机状态</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix88.png" srcset="/blog/img/loading.gif"></p>
<h4 id="4-3-3-7-验证主机监控数据及图形"><a href="#4-3-3-7-验证主机监控数据及图形" class="headerlink" title="4.3.3.7 验证主机监控数据及图形"></a>4.3.3.7 验证主机监控数据及图形</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#通过命令来判断zabbix server是否拿到数据</span><br><span class="hljs-comment">#编译安装</span><br><span class="hljs-comment"># /apps/zabbix_server/bin/zabbix_get -s agent主机 -p 10050 -l &quot;agent.ping&quot;</span><br><span class="hljs-comment">#apt安装的</span><br><span class="hljs-comment"># zabbix_get -s agent主机 -p 10050 -l &quot;agent.ping&quot;</span><br><span class="hljs-comment">#结果为1证明能取到数据</span><br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix89.png" srcset="/blog/img/loading.gif"></p>
<h4 id="4-3-3-8-交互过程"><a href="#4-3-3-8-交互过程" class="headerlink" title="4.3.3.8 交互过程"></a>4.3.3.8 交互过程</h4><p>zabbix agent与zabbix proxy与zabbix srver的交互过程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /var/log/zabbix/zabbix_proxy.log</span><br>zabbix agent向zabbix proxy申请监控项：<br> 2219:20191215:185229.406 sending [&#123;<span class="hljs-string">&quot;request&quot;</span>:<span class="hljs-string">&quot;active checks&quot;</span>,<span class="hljs-string">&quot;host&quot;</span>:<span class="hljs-string">&quot;172.31.0.107&quot;</span>&#125;]<br> 2219:20191215:185229.406 before <span class="hljs-built_in">read</span><br> 2219:20191215:185229.416 got [&#123;<span class="hljs-string">&quot;response&quot;</span>:<span class="hljs-string">&quot;failed&quot;</span>,<span class="hljs-string">&quot;info&quot;</span>:<span class="hljs-string">&quot;host [172.31.0.107] notfound&quot;</span>&#125;]<br> 2219:20191215:185229.416 In parse_list_of_checks(<br> <br> <span class="hljs-comment">#zabbix proxy向zabbix server发起请求获取主机监控项</span><br> 4697:20191215:185229.426 In is_ip4() ip:<span class="hljs-string">&#x27;172.31.0.107&#x27;</span><br> 4697:20191215:185229.426 In get_hostid_by_host() host:<span class="hljs-string">&#x27;172.31.0.107&#x27;</span> metadata:<span class="hljs-string">&#x27;&#x27;</span><br> 4697:20191215:185229.426 query [txnlev:0] [select<br>h.hostid,h.status,h.tls_accept,h.tls_issuer,h.tls_subject,h.tls_psk_identity,a.host_met<br>adata from hosts h left join autoreg_host a on a.proxy_hostid is null and a.host=h.host<br><span class="hljs-built_in">where</span> h.host=<span class="hljs-string">&#x27;172.31.0.107&#x27;</span> and h.status <span class="hljs-keyword">in</span> (0,1) and h.flags&lt;&gt;2 and h.proxy_hostid is null]<br> 4697:20191215:185229.431 query [txnlev:1] [insert into proxy_autoreg_host<br>(clock,host,listen_ip,listen_dns,listen_port,host_metadata) values<br>(1576407149,<span class="hljs-string">&#x27;172.31.0.107&#x27;</span>,<span class="hljs-string">&#x27;172.31.0.107&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,10050,<span class="hljs-string">&#x27;&#x27;</span>)]<br><br><span class="hljs-comment">#收到zabbix server返回的监控项 </span><br> 361:20191215:191141.647 Received [&#123;<span class="hljs-string">&quot;globalmacro&quot;</span>:&#123;<span class="hljs-string">&quot;fields&quot;</span>:<br>[<span class="hljs-string">&quot;globalmacroid&quot;</span>,<span class="hljs-string">&quot;macro&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>],<span class="hljs-string">&quot;data&quot;</span>:[[2,<span class="hljs-string">&quot;&#123;<span class="hljs-variable">$SNMP_COMMUNITY</span>&#125;&quot;</span>,<span class="hljs-string">&quot;public&quot;</span>]]&#125;,<span class="hljs-string">&quot;hosts&quot;</span>:<br>&#123;<span class="hljs-string">&quot;fields&quot;</span>:<br>[<span class="hljs-string">&quot;hostid&quot;</span>,<span class="hljs-string">&quot;host&quot;</span>,<span class="hljs-string">&quot;status&quot;</span>,<span class="hljs-string">&quot;available&quot;</span>,<span class="hljs-string">&quot;ipmi_authtype&quot;</span>,<span class="hljs-string">&quot;ipmi_privilege&quot;</span>,<span class="hljs-string">&quot;ipmi_username&quot;</span>,<br><span class="hljs-string">&quot;ipmi_password&quot;</span>,<span class="hljs-string">&quot;ipmi_available&quot;</span>,<span class="hljs-string">&quot;snmp_available&quot;</span>,<span class="hljs-string">&quot;jmx_available&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;tls_connect&quot;</span>,<br><span class="hljs-string">&quot;tls_accept&quot;</span>,<span class="hljs-string">&quot;tls_issuer&quot;</span>,<span class="hljs-string">&quot;tls_subject&quot;</span>,<span class="hljs-string">&quot;tls_psk_identity&quot;</span>,<span class="hljs-string">&quot;tls_psk&quot;</span>],<span class="hljs-string">&quot;data&quot;</span>:<br>[[10050,<span class="hljs-string">&quot;Template App Zabbix Agent&quot;</span>,3,0,-1,2,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,0,0,0,<span class="hljs-string">&quot;Template App Zabbix</span><br><span class="hljs-string">Agent&quot;</span>,1,1,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>],[10270,<span class="hljs-string">&quot;Template OS Linux-</span><br><span class="hljs-string">active&quot;</span>,3,0,-1,2,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,0,0,0,<span class="hljs-string">&quot;Template OS Linux-active&quot;</span>,1,1,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>],[10276,<span class="hljs-string">&quot;107-</span><br><span class="hljs-string">web2&quot;</span>,0,0,-1,2,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,0,0,0,<span class="hljs-string">&quot;172.31.0.107-web2&quot;</span>,1,1,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>]]&#125;,<span class="hljs-string">&quot;interface&quot;</span>:<br>&#123;<span class="hljs-string">&quot;fields&quot;</span>:<br>[<span class="hljs-string">&quot;interfaceid&quot;</span>,<span class="hljs-string">&quot;hostid&quot;</span>,<span class="hljs-string">&quot;main&quot;</span>,<span class="hljs-string">&quot;type&quot;</span>,<span class="hljs-string">&quot;useip&quot;</span>,<span class="hljs-string">&quot;ip&quot;</span>,<span class="hljs-string">&quot;dns&quot;</span>,<span class="hljs-string">&quot;port&quot;</span>,<span class="hljs-string">&quot;bulk&quot;</span>],<span class="hljs-string">&quot;data&quot;</span>:<br>[[7,10276,1,1,1,<span class="hljs-string">&quot;172.31.0.107&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;10050&quot;</span>,1]]&#125;,<span class="hljs-string">&quot;hosts_templates&quot;</span>:&#123;<span class="hljs-string">&quot;fields&quot;</span>:<br>[<span class="hljs-string">&quot;hosttemplateid&quot;</span>,<span class="hljs-string">&quot;hostid&quot;</span>,<span class="hljs-string">&quot;templateid&quot;</span>],<span class="hljs-string">&quot;data&quot;</span>:[[251,10270,10050],<br>[255,10276,10270]]&#125;,<span class="hljs-string">&quot;hostmacro&quot;</span>:&#123;<span class="hljs-string">&quot;fields&quot;</span>:<br>[<span class="hljs-string">&quot;hostmacroid&quot;</span>,<span class="hljs-string">&quot;hostid&quot;</span>,<span class="hljs-string">&quot;macro&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>],<span class="hljs-string">&quot;data&quot;</span>:[]&#125;<br><br><span class="hljs-comment">#收到zabbix agent返回的监控数据</span><br>1425:20191215:191315.963 trapper got <span class="hljs-string">&#x27;&#123;&quot;request&quot;:&quot;agent</span><br><span class="hljs-string">data&quot;,&quot;session&quot;:&quot;a62af26d487fd475d3f94d36c58880e5&quot;,&quot;data&quot;:</span><br><span class="hljs-string">[&#123;&quot;host&quot;:&quot;172.31.0.107&quot;,&quot;key&quot;:&quot;proc.num[]&quot;,&quot;value&quot;:&quot;180&quot;,&quot;id&quot;:42,&quot;clock&quot;:1576408390,&quot;ns&quot;:885729681&#125;,</span><br><span class="hljs-string">&#123;&quot;host&quot;:&quot;172.31.0.107&quot;,&quot;key&quot;:&quot;system.cpu.intr&quot;,&quot;value&quot;:&quot;164526&quot;,&quot;id&quot;:43,&quot;clock&quot;:1576408390,&quot;ns&quot;:886469760&#125;,</span><br><span class="hljs-string">&#123;&quot;host&quot;:&quot;172.31.0.107&quot;,&quot;key&quot;:&quot;system.cpu.load[percpu,avg15]&quot;,&quot;value&quot;:&quot;0.000000&quot;,&quot;id&quot;:44,&quot;clock&quot;:1576408390,&quot;ns&quot;:887003663&#125;,</span><br><span class="hljs-string">&#123;&quot;host&quot;:&quot;172.31.0.107&quot;,&quot;key&quot;:&quot;system.cpu.load[percpu,avg1]&quot;,&quot;value&quot;:&quot;0.010000&quot;,&quot;id&quot;:45,&quot;clock&quot;:1576408390,&quot;ns&quot;:887473903&#125;,</span><br><span class="hljs-string">&#123;&quot;host&quot;:&quot;172.31.0.107&quot;,&quot;key&quot;:&quot;system.cpu.load[percpu,avg5]&quot;,&quot;value&quot;:&quot;0.005000&quot;,&quot;id&quot;:46,&quot;clock&quot;:1576408390,&quot;ns&quot;:887917992&#125;,</span><br><span class="hljs-string">&#123;&quot;host&quot;:&quot;172.31.0.107&quot;,&quot;key&quot;:&quot;system.cpu.switches&quot;,&quot;value&quot;:&quot;218790&quot;,&quot;id&quot;:47,&quot;clock&quot;:1576408390,&quot;ns&quot;:889276519&#125;,</span><br></code></pre></td></tr></table></figure>



<h1 id="五、zabbix-监控案例实战"><a href="#五、zabbix-监控案例实战" class="headerlink" title="五、zabbix 监控案例实战"></a>五、zabbix 监控案例实战</h1><p>自定义监控项</p>
<p>通过脚本采集监控项数据</p>
<p>zabbix agent获取监控项数据</p>
<p>自定义模板和图形及触发器</p>
<p>验证数据</p>
<h2 id="5-1-监控Linux-TCP连接状态"><a href="#5-1-监控Linux-TCP连接状态" class="headerlink" title="5.1 监控Linux TCP连接状态"></a>5.1 监控Linux TCP连接状态</h2><p>TCP，全称Transfer Control Protocol，中文名为传输控制协议，它工作在OSI的传输层，提供面向连接的可靠传输服务，TCP的工作主要是建立连接，然后从应用层程序中接收数据并进行传输。TCP采用可靠连接方式进行工作，在发送数据前它需要在发送方和接收方建立一个连接，数据在发送出去后，发送方会等待接收方给出一个确认性的应答，否则发送方将认为此数据丢失，并重新发送此数据。</p>
<p>在建立连接的时候，所谓的客户端与服务端是相对应的，即要看是谁主动连接的谁，如果A主动连接B那么A就是客户端而B是服务端，如果返过来B主动连接A，那么B就是客户端而A就成了服务端。</p>
<h3 id="5-1-1-TCP端口的十一种连接状态"><a href="#5-1-1-TCP端口的十一种连接状态" class="headerlink" title="5.1.1 TCP端口的十一种连接状态"></a>5.1.1 TCP端口的十一种连接状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">CLOSED：端口默认是关闭状态。<br><br>LISTEN： 服务器程序开始监听一个端口，就是LISTEN状态。<br>SYN_RCVD：三次握手的第二次握手后的端口状态，是收到了客户端发送的SYN_SENT数据包之后的状态，这个状态很短暂，正常在服务器上是很少看到的，除非服务器故意不发送最后一次握手数据包，服务器返回给客户端SYN确认之后就会将在自己的端口置为SYN_RCVD。<br><br>SYN_SENT：SYN_SENT状态表示客户端已发送SYN=1的请求连接报文，发送之后客户端就会将自己的端口状态置为SYN_SENT。<br><br>ESTABLISHED：表示已经连接成功，客户端收到服务器的确认报文会回复服务器，然后就将端口置为ESTABLISHED，服务器第三次收到客户端的Ack确认就会将端口置为ESTABLISHED并开始传输数据。<br><br>FIN_WAIT_1：出现在主动关闭方，FIN_WAIT_1状态实际上是当SOCKET在ESTABLISHED状态时，当任意一方想主动关闭连接，向对方发送了FIN=1的断开连接请求报文，此时该SOCKET即 进入到FIN_WAIT_1状态。而当对方回应ACK报文后，则进入到FIN_WAIT_2状态，当然在实际的正常情况下，无论对方何种情况下，都应该马 上回应ACK报文，所以FIN_WAIT_1状态一般是比较难见到的，而FIN_WAIT_2状态还有时常常可以用netstat看到。<br><br>FIN_WAIT_2：出现在主动关闭方，当被动方回应FIN_WAIT_1的ACK报文后，则进入到FIN_WAIT_2状态<br>TIME_WAIT：出现在主动关闭方，表示收到了对方的FIN请求关闭报文，并发送出了ACK报文，就等2*MSL(Max Segment Lifetime)后即可回到CLOSED可用状态了。如果FIN_WAIT_1状态下，收到了对方同时带FIN标志和ACK标志的报文时，可以直接进入到TIME_WAIT状态，而无须经过FIN_WAIT_2状态。<br><br>CLOSING： 这种状态比较特殊，实际情况中应该是很少见，属于一种比较罕见的例外状态。正常情况下，当你发送FIN报文后，按理来说是应该先收到（或同时收到）对方的 ACK报文，再收到对方的FIN报文。但是CLOSING状态表示你发送FIN报文后，并没有收到对方的ACK报文，反而却也收到了对方的FIN报文。什 么情况下会出现此种情况呢？其实细想一下，也不难得出结论：那就是如果双方几乎在同时close一个SOCKET的话，那么就出现了双方同时发送FIN报 文的情况，也即会出现CLOSING状态，表示双方都正在关闭SOCKET连接。<br><br>CLOSE_WAIT： 表示在等待关闭端口，这种状态存在于被动关闭的一方。<br><br>LAST_ACK： 是被动关闭方在主动关闭一方在发送FIN报文后，最后等待对方的ACK报文，当再次收到ACK报文后，也即可以进入到CLOSED可用状态了。<br></code></pre></td></tr></table></figure>

<h3 id="5-1-2-端口转换状态"><a href="#5-1-2-端口转换状态" class="headerlink" title="5.1.2 端口转换状态"></a>5.1.2 端口转换状态</h3><p>安装服务端与客户端将端口状态区分：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">主动端口方：SYN_SENT、FIN_WAIT1、FIN_WAIT2、CLOSING、TIME_WAIT<br>被动断开方：LISTEN、SYN_RCVD、CLOSE_WAIT、LAST_ACK<br>都具有的：CLOSED 、ESTABLISHED<br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix90.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-1-3-TCP三次握手与四次断开"><a href="#5-1-3-TCP三次握手与四次断开" class="headerlink" title="5.1.3 TCP三次握手与四次断开"></a>5.1.3 TCP三次握手与四次断开</h3><h4 id="5-1-3-1-TCP三次握手"><a href="#5-1-3-1-TCP三次握手" class="headerlink" title="5.1.3.1 TCP三次握手"></a>5.1.3.1 TCP三次握手</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix91.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-1-3-2-TCP四次断开"><a href="#5-1-3-2-TCP四次断开" class="headerlink" title="5.1.3.2 TCP四次断开"></a>5.1.3.2 TCP四次断开</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix92.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-1-4-监控TCP连接数脚本"><a href="#5-1-4-监控TCP连接数脚本" class="headerlink" title="5.1.4 监控TCP连接数脚本"></a>5.1.4 监控TCP连接数脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cat /etc/zabbix/zabbix_agentd.d/tcp_conn_plugin.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#Author:Zhang ShiJie</span><br><span class="hljs-function"><span class="hljs-title">tcp_conn_status</span></span>()&#123;<br>TCP_STAT=<span class="hljs-variable">$1</span><br>ss -ant | awk <span class="hljs-string">&#x27;NR&gt;1 &#123;++s[$1]&#125; END &#123;for(k in s) print k,s[k]&#125;&#x27;</span> &gt; /tmp/tcp_conn.txt<br>TCP_NUM=$(grep <span class="hljs-string">&quot;<span class="hljs-variable">$TCP_STAT</span>&quot;</span> /tmp/tcp_conn.txt | cut -d <span class="hljs-string">&#x27; &#x27;</span> -f2)<br><span class="hljs-keyword">if</span> [ -z <span class="hljs-variable">$TCP_NUM</span> ];<span class="hljs-keyword">then</span><br>    TCP_NUM=0<br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$TCP_NUM</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">main</span></span>()&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span><br>tcp_status)<br>    tcp_conn_status <span class="hljs-variable">$2</span>;<br>    ;;<br><span class="hljs-keyword">esac</span><br>&#125;<br>main <span class="hljs-variable">$1</span> <span class="hljs-variable">$2</span><br></code></pre></td></tr></table></figure>

<h3 id="5-1-5-zabbix-agent添加自定义监控项"><a href="#5-1-5-zabbix-agent添加自定义监控项" class="headerlink" title="5.1.5 zabbix agent添加自定义监控项"></a>5.1.5 zabbix agent添加自定义监控项</h3><p>zabbix agent添加自定义监控项并调用脚本获取到监控项数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /etc/zabbix/zabbix_agentd.conf</span><br>...............<br>297 UserParameter=linux_status[*],/bin/bash /etc/zabbix/zabbix_agentd.d/tcp_conn_plugin.sh <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span><br><span class="hljs-comment"># chmod a+x /etc/zabbix/zabbix_agentd.d/tcp_conn_plugin.sh</span><br><span class="hljs-comment"># systemctl restart zabbix-agent #重启zabbix agent</span><br></code></pre></td></tr></table></figure>

<h3 id="5-1-6-zabbix-server测试监控项数据"><a href="#5-1-6-zabbix-server测试监控项数据" class="headerlink" title="5.1.6 zabbix server测试监控项数据"></a>5.1.6 zabbix server测试监控项数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-server:~<span class="hljs-comment"># /apps/zabbix_server/bin/zabbix_get -s 172.31.0.106 -p 10050 -k &quot;linux_status[&quot;tcp_status&quot;,&quot;LISTEN&quot;]&quot;</span><br>19<br></code></pre></td></tr></table></figure>

<h3 id="5-1-7-zabbix-web导入模板"><a href="#5-1-7-zabbix-web导入模板" class="headerlink" title="5.1.7 zabbix web导入模板"></a>5.1.7 zabbix web导入模板</h3><p>配置-模板-导入：</p>
<h4 id="5-1-7-1-导入模板"><a href="#5-1-7-1-导入模板" class="headerlink" title="5.1.7.1 导入模板"></a>5.1.7.1 导入模板</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix93.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-1-7-2-模板导入成功"><a href="#5-1-7-2-模板导入成功" class="headerlink" title="5.1.7.2 模板导入成功"></a>5.1.7.2 模板导入成功</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix94.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-1-8-将TCP监控模板关联至主机"><a href="#5-1-8-将TCP监控模板关联至主机" class="headerlink" title="5.1.8 将TCP监控模板关联至主机"></a>5.1.8 将TCP监控模板关联至主机</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix96.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-1-9-验证监控数据"><a href="#5-1-9-验证监控数据" class="headerlink" title="5.1.9 验证监控数据"></a>5.1.9 验证监控数据</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix95.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-1-10-自定义模板总结"><a href="#5-1-10-自定义模板总结" class="headerlink" title="5.1.10 自定义模板总结"></a>5.1.10 自定义模板总结</h3><ol>
<li>通过shell命令或甲苯，能够获取到指定被监控数据</li>
<li>将脚本或者命令添加到zabbix agent的配置文件，也就是创建一个自定义监控项</li>
<li>重启zabbix agent斌在zabbix server端测试获取数据</li>
<li>在zabbix网页添加监控项</li>
<li>创建图形</li>
</ol>
<h2 id="5-2-监控memcache"><a href="#5-2-监控memcache" class="headerlink" title="5.2 监控memcache"></a>5.2 监控memcache</h2><p>通过自定义监控模板对memcache进行监控</p>
<h3 id="5-2-1-安装memcache服务"><a href="#5-2-1-安装memcache服务" class="headerlink" title="5.2.1 安装memcache服务"></a>5.2.1 安装memcache服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># apt-get install -y memcached nmap #ubuntu</span><br><span class="hljs-comment"># yum install memcached nmap #centos</span><br><br><span class="hljs-comment"># grep -v &quot;#&quot; /etc/memcached.conf | grep -v &quot;^$&quot;</span><br>-d<br>logfile /var/<span class="hljs-built_in">log</span>/memcached.log<br>-m 512<br>-p 11211<br>-u memcache<br>-l 0.0.0.0<br>-P /var/run/memcached/memcached.pid<br><br>root@zabbix-node4:~<span class="hljs-comment"># systemctl start memcached</span><br>root@zabbix-node4:~<span class="hljs-comment"># systemctl enable memcached</span><br></code></pre></td></tr></table></figure>

<h3 id="5-2-2-监控脚本"><a href="#5-2-2-监控脚本" class="headerlink" title="5.2.2 监控脚本"></a>5.2.2 监控脚本</h3><p>传递不同参数传递给脚本，并通过脚本获取监控项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># pwd</span><br>/etc/zabbix/zabbix_agentd.d<br><br><span class="hljs-comment"># cat memcache_monitor.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#Author:Zhang ShiJie</span><br><span class="hljs-function"><span class="hljs-title">memcached_status</span></span>()&#123;<br>M_PORT=<span class="hljs-variable">$1</span><br>M_COMMAND=<span class="hljs-variable">$2</span><br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;stats\nquit&quot;</span> | ncat 127.0.0.1 <span class="hljs-string">&quot;<span class="hljs-variable">$M_PORT</span>&quot;</span> | grep -w <span class="hljs-string">&quot;STAT <span class="hljs-variable">$M_COMMAND</span>&quot;</span> | awk <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span>  <span class="hljs-comment">#ubuntu使用ncat, 安装nmap</span><br>&#125;<br><span class="hljs-function"><span class="hljs-title">main</span></span>()&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span><br>memcached_status)<br>    memcached_status <span class="hljs-variable">$2</span> <span class="hljs-variable">$3</span><br>    ;;<br><span class="hljs-keyword">esac</span><br>&#125;<br><br>main <span class="hljs-variable">$1</span> <span class="hljs-variable">$2</span> <span class="hljs-variable">$3</span><br><br><span class="hljs-comment"># chmod a+x /etc/zabbix/zabbix_agentd.d/memcache_monitor.sh</span><br><span class="hljs-comment"># bash memcache_monitor.sh memcached_status 11211 curr_connections</span><br>1<br></code></pre></td></tr></table></figure>

<h3 id="5-2-3-zabbix-agent添加自定义监控项"><a href="#5-2-3-zabbix-agent添加自定义监控项" class="headerlink" title="5.2.3 zabbix agent添加自定义监控项"></a>5.2.3 zabbix agent添加自定义监控项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /etc/zabbix/zabbix_agentd.conf</span><br>298 UserParameter=memcache_status[*],/bin/bash /etc/zabbix/zabbix_agentd.d/memcache_monitor.sh <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$3</span>&quot;</span><br><br><span class="hljs-comment"># systemctl restart zabbix-agent</span><br></code></pre></td></tr></table></figure>

<h3 id="5-2-4-zabbix-server测试监控项数据"><a href="#5-2-4-zabbix-server测试监控项数据" class="headerlink" title="5.2.4 zabbix server测试监控项数据"></a>5.2.4 zabbix server测试监控项数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#当前连接数</span><br>root@zabbix-server:~<span class="hljs-comment"># /apps/zabbix_server/bin/zabbix_get -s 172.31.0.107 -p 10050 -k &quot;memcache_status[&quot;memcached_status&quot;,&quot;11211&quot;,&quot;curr_connections&quot;]&quot;</span><br>1<br><span class="hljs-comment">#线程数</span><br>root@zabbix-server:~<span class="hljs-comment"># /apps/zabbix_server/bin/zabbix_get -s 172.31.0.107 -p 10050 -k &quot;memcache_status[&quot;memcached_status&quot;,&quot;11211&quot;,&quot;threads&quot;]&quot;</span><br>4<br></code></pre></td></tr></table></figure>

<h3 id="5-2-5-zabbix-web制作模板"><a href="#5-2-5-zabbix-web制作模板" class="headerlink" title="5.2.5 zabbix web制作模板"></a>5.2.5 zabbix web制作模板</h3><p>配置-模板-创建模板</p>
<h4 id="5-2-5-1-创建模板"><a href="#5-2-5-1-创建模板" class="headerlink" title="5.2.5.1 创建模板"></a>5.2.5.1 创建模板</h4><p>名称叫Template memcached，群组是Templates</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix96.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-2-5-2-创建应用集"><a href="#5-2-5-2-创建应用集" class="headerlink" title="5.2.5.2 创建应用集"></a>5.2.5.2 创建应用集</h4><p>所有模板–Template memcached–应用集–创建应用集</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix97.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-2-5-3-创建监控项"><a href="#5-2-5-3-创建监控项" class="headerlink" title="5.2.5.3 创建监控项"></a>5.2.5.3 创建监控项</h4><p>配置-模板-Template memcached-监控项-创建监控项</p>
<p>单位：个</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix98.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-2-5-4-创建触发器"><a href="#5-2-5-4-创建触发器" class="headerlink" title="5.2.5.4 创建触发器"></a>5.2.5.4 创建触发器</h4><p>配置-模板-Template memcache-触发器-创建触发器：</p>
<p>点击表达式方框右侧的添加按钮，选择要对那个监控项设置触发器以及触发方式和值的大小，一个模板中可以有多个触发器，一个触发器是根据一个监控项的返回值对比预先设置的阈值，触发器就是监控项返回了不符合预定义的值范围后就进行触发下一步操作的警戒线。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix99.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix100.png" srcset="/blog/img/loading.gif" alt="添加表达式"></p>
<h4 id="5-2-5-5-创建图形"><a href="#5-2-5-5-创建图形" class="headerlink" title="5.2.5.5 创建图形"></a>5.2.5.5 创建图形</h4><p>配置-模板-Template memcache-图形-创建图形</p>
<p>在图形里面关联监控项，一个图形可以用多个监控项，不同的监控项会自动使用不同的颜色进行区分，也可以手动调整各监控项的颜色和图形类型。</p>
<p>名称：memchached 监控图线程数和当前连接数</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix101.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-2-6-模板关联主机"><a href="#5-2-6-模板关联主机" class="headerlink" title="5.2.6 模板关联主机"></a>5.2.6 模板关联主机</h3><p>配置-主机-选择主机-模板：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix102.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-2-7-验证监控项数据"><a href="#5-2-7-验证监控项数据" class="headerlink" title="5.2.7 验证监控项数据"></a>5.2.7 验证监控项数据</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix103.png" srcset="/blog/img/loading.gif"></p>
<h2 id="5-3-监控Redis"><a href="#5-3-监控Redis" class="headerlink" title="5.3 监控Redis"></a>5.3 监控Redis</h2><p>学习一个模板中创建多个监控项、多个触发器和多个图形</p>
<h3 id="5-3-1-安装Redis服务"><a href="#5-3-1-安装Redis服务" class="headerlink" title="5.3.1 安装Redis服务"></a>5.3.1 安装Redis服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># apt install redis -y</span><br><span class="hljs-comment"># vim /etc/redis/redis.conf</span><br><span class="hljs-built_in">bind</span> 0.0.0.0<br><span class="hljs-comment"># systemctl restart redis-server</span><br><span class="hljs-comment"># systemctl enable redis-server</span><br></code></pre></td></tr></table></figure>

<h3 id="5-3-2-监控脚本"><a href="#5-3-2-监控脚本" class="headerlink" title="5.3.2 监控脚本"></a>5.3.2 监控脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># pwd</span><br>/etc/zabbix/zabbix_agentd.d<br><br><span class="hljs-comment"># cat redis_monitor.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#Author:Zhang ShiJie</span><br><span class="hljs-function"><span class="hljs-title">redis_status</span></span>()&#123;<br>R_PORT=<span class="hljs-variable">$1</span><br>R_COMMAND=<span class="hljs-variable">$2</span><br>(<span class="hljs-built_in">echo</span> -en <span class="hljs-string">&quot;INFO \r\n&quot;</span>;sleep 1;) | ncat 127.0.0.1 <span class="hljs-string">&quot;<span class="hljs-variable">$R_PORT</span>&quot;</span> &gt; /tmp/redis_<span class="hljs-string">&quot;<span class="hljs-variable">$R_PORT</span>&quot;</span>.tmp<br>REDIS_STAT_VALUE=$(grep <span class="hljs-string">&quot;&quot;</span><span class="hljs-variable">$R_COMMAND</span><span class="hljs-string">&quot;:&quot;</span> /tmp/redis_<span class="hljs-string">&quot;<span class="hljs-variable">$R_PORT</span>&quot;</span>.tmp | cut -d <span class="hljs-string">&#x27;:&#x27;</span> -f2)<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$REDIS_STAT_VALUE</span> <br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">help</span></span>()&#123;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;0&#125;</span> + redis_status + PORT + COMMAND&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">main</span></span>()&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span><br>redis_status)<br>    redis_status <span class="hljs-variable">$2</span> <span class="hljs-variable">$3</span><br>    ;;<br>*)<br>    <span class="hljs-built_in">help</span><br>    ;;<br><span class="hljs-keyword">esac</span><br>&#125;<br>main <span class="hljs-variable">$1</span> <span class="hljs-variable">$2</span> <span class="hljs-variable">$3</span><br><br><span class="hljs-comment"># chmod a+x redis_monitor.sh</span><br><span class="hljs-comment"># bash redis_monitor.sh redis_status 6379 used_memory</span><br>841272<br></code></pre></td></tr></table></figure>

<h3 id="5-3-3-zabbix-agent添加自定义监控项"><a href="#5-3-3-zabbix-agent添加自定义监控项" class="headerlink" title="5.3.3 zabbix agent添加自定义监控项"></a>5.3.3 zabbix agent添加自定义监控项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">299 UserParameter=redis_status[*],/bin/bash /etc/zabbix/zabbix_agentd.d/redis_monitor.sh <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$3</span>&quot;</span><br><span class="hljs-comment"># systemctl restart zabbix-agent</span><br></code></pre></td></tr></table></figure>

<h3 id="5-3-4-zabbix-server测试监控项数据"><a href="#5-3-4-zabbix-server测试监控项数据" class="headerlink" title="5.3.4 zabbix server测试监控项数据"></a>5.3.4 zabbix server测试监控项数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># /apps/zabbix_server/bin/zabbix_get -s 172.31.0.107 -p 10050 -k &quot;redis_status[&quot;redis_status&quot;,&quot;6379&quot;,&quot;used_memory&quot;]&quot;</span><br>841272<br>root@zabbix-server:~<span class="hljs-comment"># /apps/zabbix_server/bin/zabbix_get -s 172.31.0.107 -p 10050 -k &quot;redis_status[&quot;redis_status&quot;,&quot;6379&quot;,&quot;connected_clients&quot;]&quot;</span><br>1<br>root@zabbix-server:~<span class="hljs-comment"># /apps/zabbix_server/bin/zabbix_get -s 172.31.0.107 -p 10050 -k &quot;redis_status[&quot;redis_status&quot;,&quot;6379&quot;,&quot;used_cpu_user&quot;]&quot;</span><br>0.67<br></code></pre></td></tr></table></figure>

<h3 id="5-3-5-zabbix-模板制作"><a href="#5-3-5-zabbix-模板制作" class="headerlink" title="5.3.5 zabbix 模板制作"></a>5.3.5 zabbix 模板制作</h3><h4 id="5-3-5-1-创建模板"><a href="#5-3-5-1-创建模板" class="headerlink" title="5.3.5.1 创建模板"></a>5.3.5.1 创建模板</h4><p>配置-模板-创建模板</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix104.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-3-5-2-创建触监控项"><a href="#5-3-5-2-创建触监控项" class="headerlink" title="5.3.5.2 创建触监控项"></a>5.3.5.2 创建触监控项</h4><p>配置-模板-Template Redis-监控项-创建监控项：</p>
<h5 id="5-3-5-2-1-当前连接数监控项"><a href="#5-3-5-2-1-当前连接数监控项" class="headerlink" title="5.3.5.2.1 当前连接数监控项"></a>5.3.5.2.1 当前连接数监控项</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix105.png" srcset="/blog/img/loading.gif"></p>
<h5 id="5-3-5-2-2-已用内存监控项"><a href="#5-3-5-2-2-已用内存监控项" class="headerlink" title="5.3.5.2.2 已用内存监控项"></a>5.3.5.2.2 已用内存监控项</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix106.png" srcset="/blog/img/loading.gif"></p>
<h5 id="5-3-5-2-3-用户空间CPU利用率"><a href="#5-3-5-2-3-用户空间CPU利用率" class="headerlink" title="5.3.5.2.3 用户空间CPU利用率"></a>5.3.5.2.3 用户空间CPU利用率</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix107.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-3-5-3-创建触发器"><a href="#5-3-5-3-创建触发器" class="headerlink" title="5.3.5.3 创建触发器"></a>5.3.5.3 创建触发器</h4><p>配置-模板-Template Redis-触发器-创建触发器：</p>
<h5 id="5-3-5-3-1-当前连接数触发器："><a href="#5-3-5-3-1-当前连接数触发器：" class="headerlink" title="5.3.5.3.1 当前连接数触发器："></a>5.3.5.3.1 当前连接数触发器：</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix108.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix109.png" srcset="/blog/img/loading.gif"></p>
<h5 id="5-3-5-3-2-已用内存触发器"><a href="#5-3-5-3-2-已用内存触发器" class="headerlink" title="5.3.5.3.2 已用内存触发器"></a>5.3.5.3.2 已用内存触发器</h5><p>需要将已用内存单位转换，从G转换为字节，例如当内存使用达2G时就进行触发，则换算方式如下：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span><br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix110.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix111.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-3-5-4-创建图形"><a href="#5-3-5-4-创建图形" class="headerlink" title="5.3.5.4 创建图形"></a>5.3.5.4 创建图形</h4><p>配置-模板-Template Redis-图形-创建图形：</p>
<h5 id="5-3-5-4-1-Redis当前连接数图形"><a href="#5-3-5-4-1-Redis当前连接数图形" class="headerlink" title="5.3.5.4.1 Redis当前连接数图形"></a>5.3.5.4.1 Redis当前连接数图形</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix112.png" srcset="/blog/img/loading.gif"></p>
<h5 id="5-3-5-4-2-Redis已用内存图形"><a href="#5-3-5-4-2-Redis已用内存图形" class="headerlink" title="5.3.5.4.2 Redis已用内存图形"></a>5.3.5.4.2 Redis已用内存图形</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix113.png" srcset="/blog/img/loading.gif"></p>
<h5 id="5-3-5-4-3-Redis用户空间CPU利用率"><a href="#5-3-5-4-3-Redis用户空间CPU利用率" class="headerlink" title="5.3.5.4.3 Redis用户空间CPU利用率"></a>5.3.5.4.3 Redis用户空间CPU利用率</h5><h3 id="5-3-6-模板关联主机"><a href="#5-3-6-模板关联主机" class="headerlink" title="5.3.6 模板关联主机"></a>5.3.6 模板关联主机</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix114.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-3-7-验证监控项数据"><a href="#5-3-7-验证监控项数据" class="headerlink" title="5.3.7 验证监控项数据"></a>5.3.7 验证监控项数据</h3><h4 id="5-3-7-1-redis-当前连接数图形"><a href="#5-3-7-1-redis-当前连接数图形" class="headerlink" title="5.3.7.1 redis 当前连接数图形"></a>5.3.7.1 redis 当前连接数图形</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix115.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-3-7-2-redis已用内存连接数"><a href="#5-3-7-2-redis已用内存连接数" class="headerlink" title="5.3.7.2 redis已用内存连接数"></a>5.3.7.2 redis已用内存连接数</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix116.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-3-7-3-redis用户空间CPU利用率"><a href="#5-3-7-3-redis用户空间CPU利用率" class="headerlink" title="5.3.7.3 redis用户空间CPU利用率"></a>5.3.7.3 redis用户空间CPU利用率</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix117.png" srcset="/blog/img/loading.gif"></p>
<h2 id="5-4-监控Nginx"><a href="#5-4-监控Nginx" class="headerlink" title="5.4 监控Nginx"></a>5.4 监控Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">脚本：nginx_status.sh<br>模板：nginx_status.yml<br></code></pre></td></tr></table></figure>

<p>对nginx的活动连接和当前状态等运行状态进行监控</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment">#配置示例：</span><br><span class="hljs-keyword">location</span> <span class="hljs-title">/nginx_status</span> &#123;<br> stub_status;<br> allow <span class="hljs-number">172.31</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">16</span>;<br> allow <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>;<br> <span class="hljs-keyword">deny</span> all;<br>&#125;<br><br>状态页用于输出nginx的基本状态信息：<br> 输出信息示例：<br>Active connections: <span class="hljs-number">291</span><br>server accepts handled requests<br><span class="hljs-number">16630948</span> <span class="hljs-number">16630948</span> <span class="hljs-number">31070465</span><br>上面三个数字分别对应accepts,handled,requests三个值<br>Reading: <span class="hljs-number">6</span> Writing: <span class="hljs-number">179</span> Waiting: <span class="hljs-number">106</span><br><br>Active connections： 当前处于活动状态的客户端连接数，包括连接等待空闲连接数。<br>accepts：统计总值，Nginx自启动后已经接受的客户端请求的总数。<br>handled：统计总值，Nginx自启动后已经处理完成的客户端请求的总数，通常等于accepts，除非有因<br>worker_connections限制等被拒绝的连接。<br>requests：统计总值，Nginx自启动后客户端发来的总的请求数。<br>Reading：当前状态，正在读取客户端请求报文首部的连接的连接数。<br>Writing：当前状态，正在向客户端发送响应报文过程中的连接数。<br>Waiting：当前状态，正在等待客户端发出请求的空闲连接数，开启 keep-alive的情况下,这个值等于 active –(reading+writing),<br></code></pre></td></tr></table></figure>

<h3 id="5-4-1-部署Nginx服务："><a href="#5-4-1-部署Nginx服务：" class="headerlink" title="5.4.1 部署Nginx服务："></a>5.4.1 部署Nginx服务：</h3><p>如果是编译安装需要添加编译参数–with-http_stub_status_module</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># pwd</span><br>/usr/<span class="hljs-built_in">local</span>/src<br><span class="hljs-comment"># wget http://nginx.org/download/nginx-1.16.1.tar.gz</span><br><span class="hljs-comment"># tar xf nginx-1.16.1.tar.gz</span><br><span class="hljs-comment"># cd nginx-1.16.1/</span><br><span class="hljs-comment"># ./configure --prefix=/apps/nginx --with-http_stub_status_module</span><br><span class="hljs-comment"># make &amp;&amp; make install</span><br><br><span class="hljs-comment"># vim /apps/nginx/conf/nginx.conf</span><br>   location / &#123;<br>     root  html;<br>     index index.html index.htm;<br>   &#125;<br>   <br>   location /nginx_status &#123;<br>    stub_status;<br>    allow 172.31.0.0/16;<br>    allow 127.0.0.1;<br>    &#125;<br>    <br><span class="hljs-comment"># /apps/nginx/sbin/nginx -t</span><br>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok<br>nginx: configuration file /apps/nginx/conf/nginx.conf <span class="hljs-built_in">test</span> is successful<br><span class="hljs-comment"># /apps/nginx/sbin/nginx</span><br><br><span class="hljs-comment"># curl http://127.0.0.1/nginx_status</span><br>Active connections: 1<br>server accepts handled requests<br>1 1 1<br>Reading: 0 Writing: 1 Waiting: 0<br></code></pre></td></tr></table></figure>

<h3 id="5-4-2-监控项脚本"><a href="#5-4-2-监控项脚本" class="headerlink" title="5.4.2 监控项脚本"></a>5.4.2 监控项脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># pwd</span><br>/etc/zabbix/zabbix_agentd.d<br><br><span class="hljs-comment"># cat nginx_status.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#Date:2016/11/11</span><br><span class="hljs-comment">#Author: Zhangshijie</span><br><br><span class="hljs-function"><span class="hljs-title">nginx_status_fun</span></span>()&#123; <span class="hljs-comment">#函数内容</span><br>NGINX_PORT=<span class="hljs-variable">$1</span> <span class="hljs-comment">#端口，函数的第一个参数是脚本的第二个参数，即脚本的第二个参数是段端口号</span><br>NGINX_COMMAND=<span class="hljs-variable">$2</span> <span class="hljs-comment">#命令，函数的第二个参数是脚本的第三个参数，即脚本的第三个参数是命令</span><br><span class="hljs-function"><span class="hljs-title">nginx_active</span></span>()&#123; <span class="hljs-comment">#获取nginx_active数量，以下相同，这是开启了nginx状态但是只能从本机看到</span><br>/usr/bin/curl <span class="hljs-string">&quot;http://127.0.0.1:&quot;</span><span class="hljs-variable">$NGINX_PORT</span><span class="hljs-string">&quot;/nginx_status/&quot;</span> 2&gt;/dev/null| grep <span class="hljs-string">&#x27;Active&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $NF&#125;&#x27;</span><br>&#125;<br><span class="hljs-function"><span class="hljs-title">nginx_reading</span></span>()&#123; <span class="hljs-comment">#获取nginx_reading状态的数量</span><br>   /usr/bin/curl <span class="hljs-string">&quot;http://127.0.0.1:&quot;</span><span class="hljs-variable">$NGINX_PORT</span><span class="hljs-string">&quot;/nginx_status/&quot;</span> 2&gt;/dev/null| grep <span class="hljs-string">&#x27;Reading&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>   &#125;<br><span class="hljs-function"><span class="hljs-title">nginx_writing</span></span>()&#123;<br>   /usr/bin/curl <span class="hljs-string">&quot;http://127.0.0.1:&quot;</span><span class="hljs-variable">$NGINX_PORT</span><span class="hljs-string">&quot;/nginx_status/&quot;</span> 2&gt;/dev/null| grep <span class="hljs-string">&#x27;Writing&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span><br>   &#125;<br><span class="hljs-function"><span class="hljs-title">nginx_waiting</span></span>()&#123;<br>   /usr/bin/curl <span class="hljs-string">&quot;http://127.0.0.1:&quot;</span><span class="hljs-variable">$NGINX_PORT</span><span class="hljs-string">&quot;/nginx_status/&quot;</span> 2&gt;/dev/null| grep <span class="hljs-string">&#x27;Waiting&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $6&#125;&#x27;</span><br>   &#125;<br><span class="hljs-function"><span class="hljs-title">nginx_accepts</span></span>()&#123;<br>   /usr/bin/curl <span class="hljs-string">&quot;http://127.0.0.1:&quot;</span><span class="hljs-variable">$NGINX_PORT</span><span class="hljs-string">&quot;/nginx_status/&quot;</span> 2&gt;/dev/null| awk NR==3 | awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span><br>   &#125;<br><span class="hljs-function"><span class="hljs-title">nginx_handled</span></span>()&#123;<br>   /usr/bin/curl <span class="hljs-string">&quot;http://127.0.0.1:&quot;</span><span class="hljs-variable">$NGINX_PORT</span><span class="hljs-string">&quot;/nginx_status/&quot;</span> 2&gt;/dev/null| awk NR==3 | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br>   &#125;<br><span class="hljs-function"><span class="hljs-title">nginx_requests</span></span>()&#123;<br>   /usr/bin/curl <span class="hljs-string">&quot;http://127.0.0.1:&quot;</span><span class="hljs-variable">$NGINX_PORT</span><span class="hljs-string">&quot;/nginx_status/&quot;</span> 2&gt;/dev/null| awk NR==3 | awk <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span><br>   &#125;<br><span class="hljs-keyword">case</span> <span class="hljs-variable">$NGINX_COMMAND</span> <span class="hljs-keyword">in</span><br>active)<br>nginx_active;<br>;;<br>reading)<br>nginx_reading;<br>;;<br>writing)<br>nginx_writing;<br>;;<br>waiting)<br>nginx_waiting;<br>;;<br>accepts)<br>nginx_accepts;<br>;;<br>handled)<br>nginx_handled;<br>;;<br>requests)<br>nginx_requests;<br><span class="hljs-keyword">esac</span><br>&#125;<br><span class="hljs-function"><span class="hljs-title">main</span></span>()&#123; <span class="hljs-comment">#主函数内容</span><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span> <span class="hljs-comment">#分支结构，用于判断用户的输入而进行响应的操作</span><br>nginx_status) <span class="hljs-comment">#当输入nginx_status就调用nginx_status_fun，并传递第二和第三个参数</span><br>nginx_status_fun <span class="hljs-variable">$2</span> <span class="hljs-variable">$3</span>;<br>;;<br>*) <span class="hljs-comment">#其他的输入打印帮助信息</span><br><span class="hljs-built_in">echo</span> $<span class="hljs-string">&quot;Usage: <span class="hljs-variable">$0</span> &#123;nginx_status key&#125;&quot;</span><br><span class="hljs-keyword">esac</span> <span class="hljs-comment">#分支结束符</span><br>&#125;<br>main <span class="hljs-variable">$1</span> <span class="hljs-variable">$2</span> <span class="hljs-variable">$3</span><br><br><span class="hljs-comment"># chmod a+x nginx_status.sh</span><br><span class="hljs-comment"># bash nginx_status.sh nginx_status 80 active</span><br>1<br></code></pre></td></tr></table></figure>

<h3 id="5-4-3-zabbix-agent添加自定义监控项"><a href="#5-4-3-zabbix-agent添加自定义监控项" class="headerlink" title="5.4.3 zabbix agent添加自定义监控项"></a>5.4.3 zabbix agent添加自定义监控项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /etc/zabbix/zabbix_agentd.conf</span><br>300 UserParameter=nginx.status[*],/etc/zabbix/zabbix_agentd.d/nginx_status.sh <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$2</span>&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$3</span>&quot;</span><br><span class="hljs-comment"># systemctl restart zabbix-agent</span><br></code></pre></td></tr></table></figure>

<h3 id="5-4-4-zabbix-server测试监控项数据"><a href="#5-4-4-zabbix-server测试监控项数据" class="headerlink" title="5.4.4 zabbix server测试监控项数据"></a>5.4.4 zabbix server测试监控项数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># /apps/zabbix_server/bin/zabbix_get -s 172.31.0.107 -p 10050 -k &quot;nginx.status[&quot;nginx_status&quot;,80,&quot;active&quot;]&quot;</span><br>1<br></code></pre></td></tr></table></figure>

<h3 id="5-4-5-导入Nginx监控模板"><a href="#5-4-5-导入Nginx监控模板" class="headerlink" title="5.4.5 导入Nginx监控模板"></a>5.4.5 导入Nginx监控模板</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix118.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-4-6-模板关联主机"><a href="#5-4-6-模板关联主机" class="headerlink" title="5.4.6 模板关联主机"></a>5.4.6 模板关联主机</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix119.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix120.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-4-7-验证监控数据"><a href="#5-4-7-验证监控数据" class="headerlink" title="5.4.7 验证监控数据"></a>5.4.7 验证监控数据</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix121.png" srcset="/blog/img/loading.gif"></p>
<h2 id="5-5-SNMP监控"><a href="#5-5-SNMP监控" class="headerlink" title="5.5 SNMP监控"></a>5.5 SNMP监控</h2><p>SNMP是英文”Simple Network Management Protocol”的缩写，中文意思是“简单网络管理协议，SNMP是一种简单网络管理协议，它属于TCP/IP五层协议中的应用层协议，用于网络管理的协议，SNMP主要用于网络设备的管理。</p>
<p>SNMP的基本思想：为不同种类的设备、不同厂家生产的设备、不同型号的设备，定义为一个统一的接口和协议，使得管理员可以是使用统一的外观面对这些需要管理的网络设备进行管理。通过网络，管理员可以管理位于不同物理空间的设备，从而大大提高网络管理的效率，简化网络管理员的工作。</p>
<p>SNMP协议是TCP/IP协议簇的一个应用层协议，在1988年被制定，并被Internet体系结构委员会（IAB，Internet Architecture Board）采纳作为一个短期的网络管理解决方案，由于SNMP的简单性，在Internet时代得到了蓬勃的发展，1992年发布了SNMPv2版本，以增强SNMPv1的安全性和功能，SNMP的协议版本目前有SNMP v1、SNMP v2c和SNMP v3三种版本，其具体差别如下：</p>
<ul>
<li><p>SNMP v1采用团体名（Community Name）认证，团体名用来定义SNMP NMS和SNMP Agent的关系，如果SNMP报文携带的团体名没有得到设备的认可，该报文将被丢弃，团体名起到了类似于密码的作用，用来限制SNMP NMS对SNMP Agent的访问。</p>
</li>
<li><p>SNMP v2c也采用团体名认证，它在兼容SNMP v1的同时又扩充了SNMP v1的功能，它提供了更多的操作类型（批量获取GetBulk和通知请求InformRequest）、支持更多的数据类型（Counter64等）、提供了更丰富的错误代码且能够更细致地区分错误。</p>
</li>
<li><p>SNMP v3提供了基于用户的安全模型（USM，User-Based Security Model）的认证机制，用户可以设置认证和加密功能，认证用于验证报文发送方的合法性，避免非法用户的访问，加密则是对NMS和Agent之间的传输报文进行加密，以免被窃听。通过有无认证和有无加密等功能组合，可以为SNMP NMS和SNMP Agent之间的通信提供更高的安全性。</p>
</li>
</ul>
<h3 id="5-5-1-SNMP组织机构"><a href="#5-5-1-SNMP组织机构" class="headerlink" title="5.5.1 SNMP组织机构"></a>5.5.1 SNMP组织机构</h3><p>SNMP网络元素分为NMS和Agent两种：</p>
<ul>
<li><p>NMS（Network Management Station，网络管理站）是运行SNMP客户端管理程序的工作站，能够提供非常友好的人机交互界面，方便网络管理员完成绝大多数的网络管理工作。</p>
</li>
<li><p>Agent是驻留在设备上的一个进程，负责接收、处理来自NMS的请求报文。在一些紧急情况下，如接口状态发生改变等，Agent也会主动通知NMS。</p>
</li>
<li><p>NMS是SNMP网络的管理者，Agent是SNMP网络的被管理者。NMS和Agent之间通过SNMP协议来交互管理信息。</p>
</li>
</ul>
<p>5.5.2 SNMP数据交互</p>
<p>SNMP管理进程与代理进程之前为了交互信息，定义了5种报文:</p>
<ul>
<li>get-request操作：从代理进程处提取一个或多个参数值。</li>
<li>get-response操作：返回的一个或多个参数值。这个操作是由代理进程发出的。</li>
<li>trap操作：代理进程主动发出的报文，通知管理进程有某些事情发生。</li>
<li>get-next-request操作：从代理进程处提取一个或多个参数的下一个参数值。</li>
<li>set-request操作：设置代理进程的一个或多个参数值。</li>
</ul>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix122.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-5-3-SNMP组织结构"><a href="#5-5-3-SNMP组织结构" class="headerlink" title="5.5.3 SNMP组织结构"></a>5.5.3 SNMP组织结构</h3><p>一套完整的SNMP系统主要包括以下几个方面：</p>
<ul>
<li><p>SNMP报文协议。</p>
</li>
<li><p>管理信息结构（SMI， Structure of Management Information），一套公用的结构和表示符号。</p>
</li>
<li><p>管理信息库（MIB，Management Information Base），管理信息库包含所有代理进程的所有可被查询和修改的参数。</p>
</li>
<li><p>OID（Object Identifiers），一个OID是一个唯一的键值对，用于标识具体某一个设备的某个具体信息(对象标识)，如端口信息、设备名称等。</p>
</li>
</ul>
<h3 id="5-5-4-SNMP-MIB"><a href="#5-5-4-SNMP-MIB" class="headerlink" title="5.5.4 SNMP MIB"></a>5.5.4 SNMP MIB</h3><p>所谓(MIB)管理信息库，就是所有代理进程包含的、并且能够被管理进程进行查询和设置的信息的集合。MIB是基于对象标识树的，对象标识是一个整数序列，中间以”.”分割，这些整数构成一个树型结构，类似于 DNS或Unix的文件系统，MIB被划分为若干个组，如system、 interfaces、 a t（地址转换）和ip组等。iso . org . dod . internet .private . enterprises（1.3 .6 .1.4.1）这个标识，是给厂家自定义而预留的，比如华为的为1.3.6.1.4.1.2011，华三的为1.3.6.1.4.1.25506。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix123.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-5-5-基于Centos的SNMP"><a href="#5-5-5-基于Centos的SNMP" class="headerlink" title="5.5.5 基于Centos的SNMP"></a>5.5.5 基于Centos的SNMP</h3><p>Centos 7.x服务器安装配置SNMP：</p>
<p>172.31.0.7</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@s6 ~]<span class="hljs-comment"># yum install -y net-snmp / # apt-get install snmpd</span><br>[root@s6 ~]<span class="hljs-comment"># vim /etc/snmp/snmpd.conf</span><br><span class="hljs-comment">#    sec.name source     community</span><br>com2sec notConfigUser default    123456  <span class="hljs-comment">#第一步：设置团体认密码，默认为public</span><br><br>group  notConfigGroup v1      notConfigUser<br>group  notConfigGroup v2c      notConfigUser <span class="hljs-comment">#第二步：将团体名称notConfigUser 关联至组notConfigGroup</span><br><br>view  systemview  included  .1.3.6.1.2.1.1<br>view  systemview  included  .1.3.6.1.2.1.25.1.1 <span class="hljs-comment">#创建一个view，并对其授权可访问的OID范围</span><br>view  systemview  included  .1.  <span class="hljs-comment">#自定义授权，否则zabbix server无法获取数据</span><br>access notConfigGroup “”   any    noauth  exact systemview none none <span class="hljs-comment">#将组notConfigGroup关联至systemview 从而完成对组的授权</span><br>[root@s6 ~]<span class="hljs-comment"># systemctl restart snmpd</span><br></code></pre></td></tr></table></figure>

<h3 id="5-5-6-SNMP-OID"><a href="#5-5-6-SNMP-OID" class="headerlink" title="5.5.6 SNMP OID"></a>5.5.6 SNMP OID</h3><p>如何测试OID：</p>
<p>snmpwalk是SNMP的一个工具，它使用SNMP的GET请求查询指定OID（SNMP协议中的对象标识）入口的所有OID树信息，并显示给用户。通过snmpwalk也可以查看支持SNMP协议（可网管）的设备的一些其他信息，比如cisco交换机或路由器IP地址、内存使用率等，也可用来协助开发SNMP功能。</p>
<p>要使用snmpwalk需要先按照net-snmp软件包中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@s1 ~]<span class="hljs-comment"># yum -y install net-snmp-utils</span><br>[root@s1 ~]<span class="hljs-comment"># snmpwalk -h</span><br>USAGE: snmpwalk [OPTIONS] AGENT [OID]<br>–h：显示帮助。<br>–v：指定snmp的版本, 1或者2c或者3。<br>–c：指定连接设备SNMP密码。<br>–V：显示当前snmpwalk命令行版本。<br>–r：指定重试次数，默认为0次。<br>–t：指定每次请求的等待超时时间，单为秒，默认为3秒。<br>–l：指定安全级别：noAuthNoPriv|authNoPriv|authPriv。<br>–a：验证协议：MD5|SHA。只有-l指定为authNoPriv或authPriv时才需要。<br>–A：验证字符串。只有-l指定为authNoPriv或authPriv时才需要。<br>–x：加密协议：DES。只有-l指定为authPriv时才需要。<br>–X：加密字符串。只有-l指定为authPriv时才需要。<br></code></pre></td></tr></table></figure>

<h3 id="5-5-7-测试SNMP数据采集"><a href="#5-5-7-测试SNMP数据采集" class="headerlink" title="5.5.7 测试SNMP数据采集"></a>5.5.7 测试SNMP数据采集</h3><p>测试能否通过SNMOP采集数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@s1 ~]<span class="hljs-comment"># snmpwalk -v 2c -c 123456 172.31.0.7 .1.3.6.1.4.1.2021.10.1.3.1</span><br>UCD-SNMP-MIB::laLoad.1 = STRING: 0.00<br>[root@s1 ~]<span class="hljs-comment"># snmpwalk -v 2c -c 123456 172.31.0.7 .1.3.6.1.4.1.2021.4.3.0</span><br>UCD-SNMP-MIB::memTotalSwap.0 = INTEGER: 1048572 kB<br></code></pre></td></tr></table></figure>

<p>5.5.8 Centos SNMP</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs dns">CPU 负载：<br><span class="hljs-number">1</span> minute Load: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">10.1.3.1</span><br><span class="hljs-number">5</span> minute Load: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">10.1.3.2</span><br><span class="hljs-number">15</span> minute Load: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">10.1.3.3</span><br><br>内存使用：<br>Total Swap Size: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">4</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span><br>Available Swap Space: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">4</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span><br>Total RAM in machine: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">4</span>.<span class="hljs-number">5</span>.<span class="hljs-number">0</span><br>Total RAM used: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">4</span>.<span class="hljs-number">6</span>.<span class="hljs-number">0</span><br>Total RAM Free: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">4</span>.<span class="hljs-number">11</span>.<span class="hljs-number">0</span><br>Total RAM Shared: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">4</span>.<span class="hljs-number">13</span>.<span class="hljs-number">0</span><br>Total RAM Buffered: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">4</span>.<span class="hljs-number">14</span>.<span class="hljs-number">0</span><br>Total Cached Memory: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">4</span>.<span class="hljs-number">15</span>.<span class="hljs-number">0</span><br><br>硬盘使用：<br>Path where the disk is mounted: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">9.1.2.1</span><br>Path of the device for the partition: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">9.1.3.1</span><br>Total size of the disk/partion (kBytes): .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">9.1.6.1</span><br>Available space on the disk: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">9.1.7.1</span><br>Used space on the disk: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">9.1.8.1</span><br>Percentage of space used on disk: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">9.1.9.1</span><br>Percentage of inodes used on disk: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">9.1.10.1</span><br><br>系统信息：<br>sysDescr <span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">2.1.1.1</span><br>sysObjectID <span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">2.1.1.2</span><br>sysUpTime <span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">2.1.1.3</span><br>sysContact <span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">2.1.1.4</span><br>sysName <span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">2.1.1.5</span><br><br>CPU 信息：<br>percentage of user CPU time: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">11</span>.<span class="hljs-number">9</span>.<span class="hljs-number">0</span><br>raw user cpu time: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">11</span>.<span class="hljs-number">50</span>.<span class="hljs-number">0</span><br>percentages of system CPU time: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">11</span>.<span class="hljs-number">10</span>.<span class="hljs-number">0</span><br>raw system cpu time: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">11</span>.<span class="hljs-number">52</span>.<span class="hljs-number">0</span><br>percentages of idle CPU time: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">11</span>.<span class="hljs-number">11</span>.<span class="hljs-number">0</span><br>raw idle cpu time: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">11</span>.<span class="hljs-number">53</span>.<span class="hljs-number">0</span><br>raw nice cpu time: .<span class="hljs-number">1.3.6.1</span>.<span class="hljs-number">4.1.2021</span>.<span class="hljs-number">11</span>.<span class="hljs-number">51</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>

<h3 id="5-5-9-添加SNMP监控主机"><a href="#5-5-9-添加SNMP监控主机" class="headerlink" title="5.5.9 添加SNMP监控主机"></a>5.5.9 添加SNMP监控主机</h3><p>使用zabbix 自带的SNMP</p>
<h4 id="5-5-9-1-添加SNMP主机"><a href="#5-5-9-1-添加SNMP主机" class="headerlink" title="5.5.9.1 添加SNMP主机"></a>5.5.9.1 添加SNMP主机</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix124.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-5-9-2-关联SNMP模板"><a href="#5-5-9-2-关联SNMP模板" class="headerlink" title="5.5.9.2 关联SNMP模板"></a>5.5.9.2 关联SNMP模板</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix125.png" srcset="/blog/img/loading.gif" alt="修改Linux SNMPv2宏"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix126.png" srcset="/blog/img/loading.gif" alt="点击更改，更改内容为设置的密码"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix127.png" srcset="/blog/img/loading.gif" alt="返回该模板的宏，查看是否有更改"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix128.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-5-10-验证主机当前状态"><a href="#5-5-10-验证主机当前状态" class="headerlink" title="5.5.10 验证主机当前状态"></a>5.5.10 验证主机当前状态</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix129.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-5-11-验证SNMP监控数据"><a href="#5-5-11-验证SNMP监控数据" class="headerlink" title="5.5.11 验证SNMP监控数据"></a>5.5.11 验证SNMP监控数据</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix130.png" srcset="/blog/img/loading.gif"></p>
<h2 id="5-6-监控MySQL"><a href="#5-6-监控MySQL" class="headerlink" title="5.6 监控MySQL"></a>5.6 监控MySQL</h2><p>监控MySQL连接数、主从同步、同步延迟等。</p>
<h3 id="5-6-1-实现MySQL主从"><a href="#5-6-1-实现MySQL主从" class="headerlink" title="5.6.1 实现MySQL主从"></a>5.6.1 实现MySQL主从</h3><p>部署mysql 主从同步，需要配置不同的server id并开启binlog</p>
<h4 id="5-6-1-1-MySQL-Master"><a href="#5-6-1-1-MySQL-Master" class="headerlink" title="5.6.1.1 MySQL Master"></a>5.6.1.1 MySQL Master</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># apt install mysql-server #注意版本一致</span><br>MySQL 5.7.x:<br><span class="hljs-comment"># vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br>bind-address       = 0.0.0.0<br>server-id = 104 <span class="hljs-comment">#此行与下一行直接在bind-address后添加</span><br>log_bin = /var/lib/mysql/master-log <br><br>MySQL 5.6.x：<br><span class="hljs-comment"># cat /etc/my.cnf</span><br>[mysqld]<br>socket=/var/lib/mysql/mysql.sock<br>user=mysql<br>symbolic-links=0<br>datadir=/data/mysql<br>innodb_file_per_table=1<br>server-id=104<br>log-bin=/data/mysql/master-log<br><br>[client]<br>port=3306<br>socket=/var/lib/mysql/mysql.sock<br><br>[mysqld_safe]<br>log-error=/var/<span class="hljs-built_in">log</span>/mysqld.log<br>pid-file=/tmp/mysql.sock<br><br><span class="hljs-comment"># systemctl restart mysql</span><br></code></pre></td></tr></table></figure>

<h4 id="5-6-1-2-MySQL-Slave"><a href="#5-6-1-2-MySQL-Slave" class="headerlink" title="5.6.1.2 MySQL Slave"></a>5.6.1.2 MySQL Slave</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># apt install -y mysql-server #注意版本一致</span><br><br>MySQL 5.7.x：<br><span class="hljs-comment"># vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br>bind-address       = 0.0.0.0<br>server-id = 105 <span class="hljs-comment">#一般根据服务器最后一位来设定</span><br>relay_log = /var/lib/mysql/relay-log<br><br>MySQL 5.6.x：<br><span class="hljs-comment"># cat /etc/my.cnf</span><br>[mysqld]<br>socket=/var/lib/mysql/mysql.sock<br>user=mysql<br>symbolic-links=0<br>datadir=/data/mysql<br>innodb_file_per_table=1<br>relay-log = /data/mysql<br>server-id=104<br><br>[client]<br>port=3306<br>socket=/var/lib/mysql/mysql.sock<br><br>[mysqld_safe]<br>log-error=/var/<span class="hljs-built_in">log</span>/mysqld.log<br>pid-file=/tmp/mysql.sock<br><br><span class="hljs-comment"># systemctl restart mysql</span><br></code></pre></td></tr></table></figure>

<h4 id="5-6-1-3-MySQL-Master授权账户"><a href="#5-6-1-3-MySQL-Master授权账户" class="headerlink" title="5.6.1.3 MySQL Master授权账户"></a>5.6.1.3 MySQL Master授权账户</h4><p>在mysql master服务器授权账户并导出数据，然后scp到mysql backup服务器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">MySQL Master授权账户：<br>root@zabbix-mysql-master:~<span class="hljs-comment"># mysql</span><br>mysql&gt; GRANT REPLICATION SLAVE,REPLICATION CLIENT ON *.* TO <span class="hljs-string">&#x27;mysql&#x27;</span>@<span class="hljs-string">&#x27;172.31.0.%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;123456&#x27;</span>;<br>Query OK, 0 rows affected, 1 warning (0.00 sec<br><span class="hljs-built_in">exit</span><br><br>root@zabbix-mysql-master:~<span class="hljs-comment"># mysqldump --all-databases --single_transaction --flush-logs --master-data=2 --lock-tables &gt; /opt/backup.sql</span><br><br><span class="hljs-comment"># scp /opt/backup.sql 172.31.0.105:/opt/</span><br></code></pre></td></tr></table></figure>

<h4 id="5-6-1-4-MySQL-slave导入数据"><a href="#5-6-1-4-MySQL-slave导入数据" class="headerlink" title="5.6.1.4 MySQL slave导入数据"></a>5.6.1.4 MySQL slave导入数据</h4><p>在MySQL Slave服务器导入数据开始同步数据，Position位置在sql文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-mysql-slave:~<span class="hljs-comment"># mysql &lt; /opt/backup.sql</span><br><span class="hljs-comment"># head -n30 /opt/backup.sql #查看master信息，最好在mysql里查看</span><br>......<br>-- CHANGE MASTER TO MASTER_LOG_FILE=<span class="hljs-string">&#x27;master-log.000002&#x27;</span>, MASTER_LOG_POS=154;<br><br>root@zabbix-mysql-slave:~<span class="hljs-comment"># mysql</span><br>mysql&gt; CHANGE MASTER TO MASTER_HOST=<span class="hljs-string">&#x27;172.31.0.104&#x27;</span>,MASTER_USER=<span class="hljs-string">&#x27;mysql&#x27;</span>,MASTER_PASSWORD=<span class="hljs-string">&#x27;123456&#x27;</span>,MASTER_LOG_FILE=<span class="hljs-string">&#x27;master-log.000002&#x27;</span>,MASTER_LOG_POS=154;<br>Query OK, 0 rows affected, 2 warnings (0.01 sec)<br><br>mysql&gt; start slave;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; show slave status\G;<br>*************************** 1. row ***************************<br>               Slave_IO_State: Waiting <span class="hljs-keyword">for</span> master to send event<br>                  Master_Host: 172.31.0.104<br>                  Master_User: mysql<br>                  Master_Port: 3306<br>                Connect_Retry: 60<br>              Master_Log_File: master-log.000003<br>          Read_Master_Log_Pos: 57740<br>               Relay_Log_File: relay-log.000006<br>                Relay_Log_Pos: 8811<br>        Relay_Master_Log_File: master-log.000003<br>        <span class="hljs-comment">#如没有出现两个yes，就重新在主库导出数据库再导入到从库</span><br>             Slave_IO_Running: Yes <br>            Slave_SQL_Running: Yes<br></code></pre></td></tr></table></figure>

<h3 id="5-6-2-Procona监控MySQL"><a href="#5-6-2-Procona监控MySQL" class="headerlink" title="5.6.2 Procona监控MySQL"></a>5.6.2 Procona监控MySQL</h3><p>官方文档及下载地址：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#插件使用帮助文档地址</span><br>https://www.percona.com/doc/percona-monitoring-plugins/LATEST/zabbix/index.html <span class="hljs-comment">#安装包下载地址</span><br>https://www.percona.com/downloads/  <span class="hljs-comment">#新版已经用Percona Monitoring and Management代替</span><br>https://www.percona.com/downloads/percona-monitoring-plugins/LATEST/<br><span class="hljs-comment">#installation-instructions #安装教程</span><br>https://www.percona.com/doc/percona-monitoring-plugins/LATEST/zabbix/index.html<br></code></pre></td></tr></table></figure>

<h4 id="5-6-2-1-MySQL-Master安装zabbix-agent"><a href="#5-6-2-1-MySQL-Master安装zabbix-agent" class="headerlink" title="5.6.2.1 MySQL Master安装zabbix-agent"></a>5.6.2.1 MySQL Master安装zabbix-agent</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-mysql-master:~<span class="hljs-comment"># apt install zabbix-agent</span><br>root@zabbix-mysql-master:~<span class="hljs-comment"># grep &quot;^[a-Z]&quot; /etc/zabbix/zabbix_agentd.conf</span><br>PidFile=/var/run/zabbix/zabbix_agentd.pid<br>LogFile=/var/<span class="hljs-built_in">log</span>/zabbix/zabbix_agentd.log<br>LogFileSize=0<br>Server=172.31.0.101,172.31.0.102<br>StartAgents=5<br>ServerActive=172.31.0.102<br>Hostname=172.31.0.104<br>Include=/etc/zabbix/zabbix_agentd.d/*.conf<br><br>root@zabbix-mysql-master:~<span class="hljs-comment"># systemctl restart zabbix-agent</span><br>root@zabbix-mysql-master:~<span class="hljs-comment"># systemctl enable zabbix-agent</span><br></code></pre></td></tr></table></figure>

<h4 id="5-6-2-2-MySQL-Master安装Percona"><a href="#5-6-2-2-MySQL-Master安装Percona" class="headerlink" title="5.6.2.2 MySQL Master安装Percona"></a>5.6.2.2 MySQL Master安装Percona</h4><p>修改zabbix agent启动用户为root，包括zabbix agent配置文件和服务启动文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">安装Percona软件包：<br><span class="hljs-comment"># dpkg -i percona-zabbix-templates_1.1.8-1.artful_all.deb</span><br><span class="hljs-comment"># cp /var/lib/zabbix/percona/templates/userparameter_percona_mysql.conf /etc/zabbix/zabbix_agentd.d/</span><br><span class="hljs-comment"># systemctl restart zabbix-agent</span><br><br>安装php环境： 目前Percona与ubuntu自带的php 7.2不兼容，需要安装php 5.6版本<br><span class="hljs-comment"># add-apt-repository ppa:ondrej/php</span><br><span class="hljs-comment"># apt-get -y update</span><br><span class="hljs-comment"># apt install -y php5.6 php5.6-mysql</span><br><span class="hljs-comment"># php -v</span><br>PHP 5.6.40-52+ubuntu18.04.1+deb.sury.org+1 (cli) <br>Copyright (c) 1997-2016 The PHP Group<br>Zend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies<br>    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2016, by Zend Technologies<br><span class="hljs-comment"># ll /etc/zabbix/zabbix_agentd.d/*.conf</span><br><br>创建mysql认证文件：<br><span class="hljs-comment"># cat /var/lib/zabbix/percona/scripts/ss_get_mysql_stats.php.cnf</span><br>&lt;?php<br><span class="hljs-variable">$mysql_user</span> = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$mysql_pass</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><br>测试脚本能否获取数据：<br><span class="hljs-comment"># /var/lib/zabbix/percona/scripts/get_mysql_stats_wrapper.sh gg</span><br>22<br><br><span class="hljs-comment">#更改权限</span><br><span class="hljs-comment"># chown zabbix.zabbix /tmp/localhost-mysql_cacti_stats.txt</span><br><br><span class="hljs-comment">#zabbix server测试能否获得数据</span><br>root@zabbix-server:~<span class="hljs-comment"># /apps/zabbix_server/bin/zabbix_get -s 172.31.0.104 -p 10050 -k MySQL.Key-read-requests</span><br><br><span class="hljs-comment"># zabbix agent如果不使用root账户启动，会有权限问题导致监控无法采集数据</span><br><span class="hljs-comment">#修改权限，方法一：将zabbix授权，方法二：将zabbix由root启动</span><br><span class="hljs-comment">#方法一</span><br><span class="hljs-comment"># vim /etc/sudoers</span><br>55 <span class="hljs-comment"># Defaults  !visiblepw #不强制使用tty</span><br>93 zabbix ALL = NOPASSWD: ALL <span class="hljs-comment">#授权指定用户执行特殊命令不再需要密码，比如sudo等</span><br><span class="hljs-comment">#方法二</span><br><span class="hljs-comment"># vim /etc/zabbix/zabbix_agentd.conf</span><br>ALLowRoot=1<br>User=root<br><span class="hljs-comment"># vim /lib/systemd/system/zabbix-agent.service</span><br>User=root<br>Group=root<br><span class="hljs-comment"># systemctl daemon-reload</span><br><span class="hljs-comment"># systemctl restart zabbix-agent</span><br><span class="hljs-comment"># ps -ef | grep zabbix</span><br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix136.png" srcset="/blog/img/loading.gif"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 将Percona模板导出到windows里</span><br><span class="hljs-comment"># sz /var/lib/zabbix/percona/templates/zabbix_Agent_template_percona_mysql_Server_ht_2.0.9-sver1.1.8.xml</span><br></code></pre></td></tr></table></figure>

<h4 id="5-6-2-3-zabbix-web导入Percona模板"><a href="#5-6-2-3-zabbix-web导入Percona模板" class="headerlink" title="5.6.2.3 zabbix web导入Percona模板"></a>5.6.2.3 zabbix web导入Percona模板</h4><p>实验将模板的时间改为60s（修改了时间后，监控mysql的脚本也要修改时间），将模式改为主动模式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim /var/lib/zabbix/percona/scripts/get_mysql_stats_wrapper.sh</span><br><span class="hljs-keyword">if</span> [ `expr <span class="hljs-variable">$TIMENOW</span> - <span class="hljs-variable">$TIMEFLM</span>` -gt 300 ];<span class="hljs-keyword">then</span> <span class="hljs-comment">#修改前</span><br><span class="hljs-keyword">if</span> [ `expr <span class="hljs-variable">$TIMENOW</span> - <span class="hljs-variable">$TIMEFLM</span>` -gt 60 ];<span class="hljs-keyword">then</span> <span class="hljs-comment">#修改后</span><br><span class="hljs-comment"># systemctl restart zabbix-agent</span><br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix137.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-6-2-4-zabbbix-web添加主机"><a href="#5-6-2-4-zabbbix-web添加主机" class="headerlink" title="5.6.2.4 zabbbix web添加主机"></a>5.6.2.4 zabbbix web添加主机</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix138.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-6-2-5-zabbix-web对主机关联模板"><a href="#5-6-2-5-zabbix-web对主机关联模板" class="headerlink" title="5.6.2.5 zabbix web对主机关联模板"></a>5.6.2.5 zabbix web对主机关联模板</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix139.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-6-2-6-验证MySQL监控数据"><a href="#5-6-2-6-验证MySQL监控数据" class="headerlink" title="5.6.2.6 验证MySQL监控数据"></a>5.6.2.6 验证MySQL监控数据</h4><p>Percona模板中的监控项默认是五分钟收集一次监控项数据，会结合脚本检查agent上报错数据的文件的时间戳是否超过五分钟，脚本位在/var/lib/zabbix/percona/scripts/get_mysql_stats_wrapper.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-server:~<span class="hljs-comment"># /apps/zabbix_server/bin/zabbix_get -s 172.31.0.104 -p 10050 -k &quot;MySQL.Key-read-requests&quot;</span><br>22<br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix140.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-6-3-自定义脚本监控MySQL"><a href="#5-6-3-自定义脚本监控MySQL" class="headerlink" title="5.6.3 自定义脚本监控MySQL"></a>5.6.3 自定义脚本监控MySQL</h3><p>编写脚本监控脚本MySQL主从同步及延迟</p>
<h4 id="5-6-3-1-MySQL-slave安装zabbix-agent"><a href="#5-6-3-1-MySQL-slave安装zabbix-agent" class="headerlink" title="5.6.3.1 MySQL slave安装zabbix agent"></a>5.6.3.1 MySQL slave安装zabbix agent</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># dpkg -i zabbix-release_4.0-3+bionic_all.deb</span><br><span class="hljs-comment"># apt update</span><br><span class="hljs-comment"># apt install -y zabbix-agent</span><br><span class="hljs-comment"># grep &quot;^[a-Z]&quot; /etc/zabbix/zabbix_agentd.conf</span><br>PidFile=/var/run/zabbix/zabbix_agentd.pid<br>LogFile=/var/<span class="hljs-built_in">log</span>/zabbix/zabbix_agentd.log<br>LogFileSize=0<br>Server=172.31.0.101,172.31.0.102<br>StartAgents=5<br>ServerActive=172.31.0.102<br>Hostname=172.31.0.105<br>Include=/etc/zabbix/zabbix_agentd.d/*.conf<br></code></pre></td></tr></table></figure>

<h4 id="5-6-3-1-脚本内容"><a href="#5-6-3-1-脚本内容" class="headerlink" title="5.6.3.1 脚本内容"></a>5.6.3.1 脚本内容</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql_monitor.sh<br><span class="hljs-comment"># cat mysql_monitor.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#Date:2016/11/11</span><br><span class="hljs-comment">#Author: Zhangshijie</span><br><span class="hljs-function"><span class="hljs-title">Seconds_Behind_Master</span></span>()&#123;<br>NUM=`mysql -uroot -e <span class="hljs-string">&quot;show slave status\G;&quot;</span> | grep <span class="hljs-string">&quot;Seconds_Behind_Master:&quot;</span> | awk -F: <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$NUM</span><br>&#125;<br><span class="hljs-function"><span class="hljs-title">master_slave_check</span></span>()&#123;<br>NUM1=`mysql -uroot -e <span class="hljs-string">&quot;show slave status\G;&quot;</span> | grep <span class="hljs-string">&quot;Slave_IO_Running&quot;</span> | awk -F: <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | sed <span class="hljs-string">&#x27;s/^[ \t]*//g&#x27;</span>`<br><span class="hljs-comment">#echo $NUM1</span><br>NUM2=`mysql -uroot -e <span class="hljs-string">&quot;show slave status\G;&quot;</span> | grep <span class="hljs-string">&quot;Slave_SQL_Running:&quot;</span> | awk -F: <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | sed <span class="hljs-string">&#x27;s/^[ \t]*//g&#x27;</span>`<br><br><span class="hljs-comment">#echo $NUM2</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-variable">$NUM1</span> == <span class="hljs-string">&quot;Yes&quot;</span> &amp;&amp; <span class="hljs-built_in">test</span> <span class="hljs-variable">$NUM2</span> == <span class="hljs-string">&quot;Yes&quot;</span>;<span class="hljs-keyword">then</span><br>   <span class="hljs-built_in">echo</span> 50<br><span class="hljs-keyword">else</span><br>   <span class="hljs-built_in">echo</span> 100<br><span class="hljs-keyword">fi</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">main</span></span>()&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span><br>Seconds_Behind_Master)<br>    Seconds_Behind_Master;<br>    ;;<br>master_slave_check)<br>    master_slave_check<br>    ;;<br><span class="hljs-keyword">esac</span><br>&#125;<br>main <span class="hljs-variable">$1</span><br><br><span class="hljs-comment"># chmod a+x mysql_monitor.sh</span><br><span class="hljs-comment"># bash mysql_monitor.sh master_slave_check</span><br>50<br></code></pre></td></tr></table></figure>

<h4 id="5-6-3-2-自定义监控项配置"><a href="#5-6-3-2-自定义监控项配置" class="headerlink" title="5.6.3.2 自定义监控项配置"></a>5.6.3.2 自定义监控项配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># pwd</span><br>/etc/zabbix/zabbix_agentd.d/<br><span class="hljs-comment"># cat all.conf</span><br>UserParameter=mysql_monitor[*],/etc/zabbix/zabbix_agentd.d/mysql_monitor.sh <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br><span class="hljs-comment"># systemctl restart zabbix-agent</span><br><span class="hljs-comment"># 这里同样也要注意权限问题，最好先将zabbix agent改为由root启动</span><br>root@zabbix-server:~<span class="hljs-comment"># /apps/zabbix_server/bin/zabbix_get -s 172.31.0.105 -p 10050 -k &quot;mysql_monitor[master_slave_check]&quot; #zabbix server测试获取数据</span><br>50<br></code></pre></td></tr></table></figure>

<h4 id="5-6-3-3-自定义模板"><a href="#5-6-3-3-自定义模板" class="headerlink" title="5.6.3.3 自定义模板"></a>5.6.3.3 自定义模板</h4><p>创建模板和MySQL主从同步的监控项、触发器和图形添加过程，其他监控项省略。</p>
<h5 id="5-6-3-3-1-创建模板"><a href="#5-6-3-3-1-创建模板" class="headerlink" title="5.6.3.3.1 创建模板"></a>5.6.3.3.1 创建模板</h5><p>name:MySQL Monitor-linux</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix141.png" srcset="/blog/img/loading.gif"></p>
<h5 id="5-6-3-3-2-添加监控项"><a href="#5-6-3-3-2-添加监控项" class="headerlink" title="5.6.3.3.2 添加监控项"></a>5.6.3.3.2 添加监控项</h5><p>添加监控项 1</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix142.png" srcset="/blog/img/loading.gif"></p>
<p>添加监控项 2</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix143.png" srcset="/blog/img/loading.gif"></p>
<h5 id="5-6-3-3-3-添加触发器"><a href="#5-6-3-3-3-添加触发器" class="headerlink" title="5.6.3.3.3 添加触发器"></a>5.6.3.3.3 添加触发器</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix144.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix145.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix146.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix147.png" srcset="/blog/img/loading.gif"></p>
<h5 id="5-6-3-3-4-添加图形"><a href="#5-6-3-3-4-添加图形" class="headerlink" title="5.6.3.3.4 添加图形"></a>5.6.3.3.4 添加图形</h5><p>name    MySQL主从同步检查</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix148.png" srcset="/blog/img/loading.gif"></p>
<p>name MySQL主从同步延迟监控</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix149.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-6-3-4-模板关联至主机"><a href="#5-6-3-4-模板关联至主机" class="headerlink" title="5.6.3.4 模板关联至主机"></a>5.6.3.4 模板关联至主机</h4><h5 id="5-6-3-4-1-添加主机"><a href="#5-6-3-4-1-添加主机" class="headerlink" title="5.6.3.4.1 添加主机"></a>5.6.3.4.1 添加主机</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix150.png" srcset="/blog/img/loading.gif"></p>
<h5 id="5-6-3-4-2-关联模板"><a href="#5-6-3-4-2-关联模板" class="headerlink" title="5.6.3.4.2 关联模板"></a>5.6.3.4.2 关联模板</h5><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix151.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-6-3-5-验证监控数据"><a href="#5-6-3-5-验证监控数据" class="headerlink" title="5.6.3.5 验证监控数据"></a>5.6.3.5 验证监控数据</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix152.png" srcset="/blog/img/loading.gif"></p>
<h2 id="5-7-自定义端口和进程监控"><a href="#5-7-自定义端口和进程监控" class="headerlink" title="5.7 自定义端口和进程监控"></a>5.7 自定义端口和进程监控</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">net.tcp.listen[80]<br></code></pre></td></tr></table></figure>

<h2 id="5-8-故障自治愈功能"><a href="#5-8-故障自治愈功能" class="headerlink" title="5.8 故障自治愈功能"></a>5.8 故障自治愈功能</h2><p>当zabbix 监控到指定的监控项异常的时候，通过指定的操作使故障自动恢复，通常是重启服务等一些简单的操作，也可以调用脚本执行比较复杂的操作。</p>
<p>设置监控项和触发器，新建动作，在触发条件里面添加操作，在远程主机通过zabbix 客户端执行命令</p>
<ol>
<li>开启zabbix sudo权限</li>
<li>配置允许允许特殊字符</li>
<li>配置远程命令</li>
<li>验证和测试</li>
</ol>
<h3 id="5-8-1-zabbix-agent需要开启远程命令执行"><a href="#5-8-1-zabbix-agent需要开启远程命令执行" class="headerlink" title="5.8.1 zabbix agent需要开启远程命令执行"></a>5.8.1 zabbix agent需要开启远程命令执行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-node4:~<span class="hljs-comment"># vim /etc/zabbix/zabbix_agentd.conf</span><br>73 EnableRemoteCommands=1 <span class="hljs-comment">#开启远程执行命令</span><br>287 UnsafeUserParameters=1 <span class="hljs-comment">#允许远程执行命令的时候使用不安全的参数(特殊字符串)</span><br>root@zabbix-node4:~<span class="hljs-comment"># systemctl restart zabbix-agent</span><br></code></pre></td></tr></table></figure>

<h3 id="5-8-2-zabbix用户授权"><a href="#5-8-2-zabbix用户授权" class="headerlink" title="5.8.2 zabbix用户授权"></a>5.8.2 zabbix用户授权</h3><p>如果zabbix agent是使用zabbix用户启动的，那么要在zabbix 用户授权使用特权命令，负责有些命令zabbix没有权限执行，会导致定义好的自治愈策略因为权限拒绝为执行失败。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@zabbix-node4:~<span class="hljs-comment"># vim /etc/sudoers</span><br>55 <span class="hljs-comment"># Defaults  !visiblepw #不强制使用tty</span><br>93 zabbix ALL = NOPASSWD: ALL <span class="hljs-comment">#授权指定用户执行特殊命令不再需要密码，比如sudo等</span><br></code></pre></td></tr></table></figure>

<h3 id="5-8-3-创建动作"><a href="#5-8-3-创建动作" class="headerlink" title="5.8.3 创建动作"></a>5.8.3 创建动作</h3><p>配置–动作–创建动作：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix153.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-8-4-执行远程操作"><a href="#5-8-4-执行远程操作" class="headerlink" title="5.8.4 执行远程操作"></a>5.8.4 执行远程操作</h3><p>执行命令或者执行脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo /path/to/<span class="hljs-built_in">command</span><br>sudo /path/to/script.sh<br>sudo /apps/nginx/sbin/nginx<br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix154.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix155.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix156.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-8-5-验证自治愈功能"><a href="#5-8-5-验证自治愈功能" class="headerlink" title="5.8.5 验证自治愈功能"></a>5.8.5 验证自治愈功能</h3><p>将被测试的服务手动停止运行，验证能否自动启动或重启，更多操作可以远程执行脚本。如下：</p>
<p>手动将Nginx、Tomcat等web服务停止后，验证zabbix agent能否自动启动或重启：</p>
<h4 id="5-8-5-1-验证自治愈"><a href="#5-8-5-1-验证自治愈" class="headerlink" title="5.8.5.1 验证自治愈"></a>5.8.5.1 验证自治愈</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix157.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-8-5-2-zabbix-自治愈日志"><a href="#5-8-5-2-zabbix-自治愈日志" class="headerlink" title="5.8.5.2 zabbix 自治愈日志"></a>5.8.5.2 zabbix 自治愈日志</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix158.png" srcset="/blog/img/loading.gif"></p>
<h2 id="5-9-grafana图形展示"><a href="#5-9-grafana图形展示" class="headerlink" title="5.9 grafana图形展示"></a>5.9 grafana图形展示</h2><h3 id="5-9-1-安装grafana服务"><a href="#5-9-1-安装grafana服务" class="headerlink" title="5.9.1 安装grafana服务"></a>5.9.1 安装grafana服务</h3><p>grafana可以不跟zabbix server同一个服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># sudo apt-get install -y adduser libfontconfig1</span><br><span class="hljs-comment"># wget https://dl.grafana.com/oss/release/grafana_6.6.2_amd64.deb</span><br><span class="hljs-comment"># sudo dpkg -i grafana_6.6.2_amd64.deb</span><br><span class="hljs-comment"># /bin/systemctl daemon-reload</span><br><span class="hljs-comment"># vim /etc/grafana/grafana.ini</span><br>protocol = http<br>http_port = 3000<br><span class="hljs-comment"># systemctl restart grafana-server</span><br><span class="hljs-comment"># systemctl enable grafana-server</span><br><span class="hljs-comment"># ss -tnl</span><br></code></pre></td></tr></table></figure>

<p>浏览器访问：本机ip:3000</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix159.png" srcset="/blog/img/loading.gif" alt="账号密码都是admin"></p>
<h3 id="5-9-2-grafana安装并启用zabbix插件"><a href="#5-9-2-grafana安装并启用zabbix插件" class="headerlink" title="5.9.2 grafana安装并启用zabbix插件"></a>5.9.2 grafana安装并启用zabbix插件</h3><h4 id="5-9-2-1-安装zabbix插件"><a href="#5-9-2-1-安装zabbix插件" class="headerlink" title="5.9.2.1 安装zabbix插件"></a>5.9.2.1 安装zabbix插件</h4><p><a target="_blank" rel="noopener" href="https://grafana.com/grafana/plugins/alexanderzobnin-zabbix-app/">https://grafana.com/grafana/plugins/alexanderzobnin-zabbix-app/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># grafana-cli plugins install alexanderzobnin-zabbix-app #注意版本问题，这是安装最新版的</span><br><span class="hljs-comment"># grafana-cli plugins install alexanderzobnin-zabbix-app 3.10.5 #这是安装对应的版本</span><br>installing alexanderzobnin-zabbix-app @ 3.10.5<br>from: https://grafana.com/api/plugins/alexanderzobnin-zabbix-app/versions/3.10.5/download<br>into: /var/lib/grafana/plugins<br><br>✔ Installed alexanderzobnin-zabbix-app successfully <br><br>Restart grafana after installing plugins . &lt;service grafana-server restart&gt;<br><br><span class="hljs-comment"># systemctl restart grafana-server</span><br><br><span class="hljs-comment"># 如出现“Cannot read property &#x27;FormField&#x27; of undefined Evaluating”即为版本不对应</span><br><span class="hljs-comment"># grafana-cli的帮助文档：https://grafana.com/docs/grafana/latest/administration/cli/#plugins-commands</span><br></code></pre></td></tr></table></figure>

<h4 id="5-9-2-2-启动zabbix插件"><a href="#5-9-2-2-启动zabbix插件" class="headerlink" title="5.9.2.2 启动zabbix插件"></a>5.9.2.2 启动zabbix插件</h4><p>Configuration–Plugins–找到zabbix–点击enable</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix160.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix161.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix162.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix163.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-9-2-3-添加MySQL数据源"><a href="#5-9-2-3-添加MySQL数据源" class="headerlink" title="5.9.2.3 添加MySQL数据源"></a>5.9.2.3 添加MySQL数据源</h4><p>Configuration–Data Sources–</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix164.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix165.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix166.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix167.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-9-2-4-测试MySQL数据源并保存"><a href="#5-9-2-4-测试MySQL数据源并保存" class="headerlink" title="5.9.2.4 测试MySQL数据源并保存"></a>5.9.2.4 测试MySQL数据源并保存</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix168.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix169.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-9-2-5-添加zabbix-数据源"><a href="#5-9-2-5-添加zabbix-数据源" class="headerlink" title="5.9.2.5 添加zabbix 数据源"></a>5.9.2.5 添加zabbix 数据源</h4><p>设置–data source–add data source</p>
<p>在Others点击zabbix，即添加一个zabbix类型的数据源：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://172.31.0.101/zabbix/api_jsonrpc.php<br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix170.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix171.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix172.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-2-9-6-保存并添加数据源"><a href="#5-2-9-6-保存并添加数据源" class="headerlink" title="5.2.9.6 保存并添加数据源"></a>5.2.9.6 保存并添加数据源</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix173.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix174.png" srcset="/blog/img/loading.gif" alt="测试并保存"></p>
<h5 id="5-2-5-9-7-添加Dashboard"><a href="#5-2-5-9-7-添加Dashboard" class="headerlink" title="5.2.5.9.7 添加Dashboard"></a>5.2.5.9.7 添加Dashboard</h5><p>Home-New dashboard</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix175.png" srcset="/blog/img/loading.gif"></p>
<h6 id="5-2-5-9-7-1-单独添加图形"><a href="#5-2-5-9-7-1-单独添加图形" class="headerlink" title="5.2.5.9.7.1 单独添加图形"></a>5.2.5.9.7.1 单独添加图形</h6><p>略</p>
<h6 id="5-2-5-9-7-2-导入模板"><a href="#5-2-5-9-7-2-导入模板" class="headerlink" title="5.2.5.9.7.2 导入模板"></a>5.2.5.9.7.2 导入模板</h6><p>模板官方：<a target="_blank" rel="noopener" href="https://grafana.com/grafana/dashboards">Grafana Dashboards - discover and share dashboards for Grafana. | Grafana Labs</a></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix176.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix177.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix178.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix179.png" srcset="/blog/img/loading.gif"></p>
<h6 id="5-2-5-9-7-3-导入模板后"><a href="#5-2-5-9-7-3-导入模板后" class="headerlink" title="5.2.5.9.7.3 导入模板后"></a>5.2.5.9.7.3 导入模板后</h6><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix180.png" srcset="/blog/img/loading.gif"></p>
<h2 id="5-10-自定义基础监控模板"><a href="#5-10-自定义基础监控模板" class="headerlink" title="5.10 自定义基础监控模板"></a>5.10 自定义基础监控模板</h2><h2 id="5-11-结合pyhton脚本监控案例："><a href="#5-11-结合pyhton脚本监控案例：" class="headerlink" title="5.11 结合pyhton脚本监控案例："></a>5.11 结合pyhton脚本监控案例：</h2><h3 id="5-11-1-kubernetes-集群状态监控脚本"><a href="#5-11-1-kubernetes-集群状态监控脚本" class="headerlink" title="5.11.1 kubernetes 集群状态监控脚本"></a>5.11.1 kubernetes 集群状态监控脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@kubernetes-master1 ~]<span class="hljs-comment"># cat /etc/zabbix/zabbix_agentd.d/k8s_monitor.py</span><br><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#coding:utf-8</span><br><span class="hljs-comment">#Author ZhangShiJie</span><br><br>import  subprocess<br>success_list = []<br>error_list= []<br>def get_status():<br>  obj = subprocess.Popen((<span class="hljs-string">&quot;curl -sXGET</span><br><span class="hljs-string">http://10.20.15.209:8080/api/v1/nodes&quot;</span>),shell=True, stdout=subprocess.PIPE)<br>  data =  obj.stdout.read()<br>  data1 = <span class="hljs-built_in">eval</span>(data)<br>  data2 = data1.get(<span class="hljs-string">&#x27;items&#x27;</span>)<br>  <span class="hljs-comment">#print data2</span><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data2:<br>    data3 = i.get(<span class="hljs-string">&#x27;status&#x27;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data3.get(<span class="hljs-string">&#x27;conditions&#x27;</span>):<br>      <span class="hljs-keyword">if</span> i.get(<span class="hljs-string">&#x27;reason&#x27;</span>) == <span class="hljs-string">&#x27;KubeletReady&#x27;</span>:<br>        <span class="hljs-keyword">if</span> i.get(<span class="hljs-string">&#x27;type&#x27;</span>) == <span class="hljs-string">&quot;Ready&quot;</span>:<br>          <span class="hljs-keyword">if</span> i.get(<span class="hljs-string">&#x27;status&#x27;</span>) == <span class="hljs-string">&#x27;True&#x27;</span>:<br>            success_list.append(i.get(<span class="hljs-string">&#x27;status&#x27;</span>))<br>          <span class="hljs-keyword">elif</span> i.get(<span class="hljs-string">&#x27;status&#x27;</span>) == <span class="hljs-string">&#x27;False&#x27;</span>:<br>            error_list.append(i.get(<span class="hljs-string">&#x27;status&#x27;</span>))<br>          <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">break</span><br>        <span class="hljs-keyword">else</span>:<br>          error_list.append(i.get(<span class="hljs-string">&#x27;status&#x27;</span>))<br>          <span class="hljs-comment">#pass</span><br>      <span class="hljs-keyword">else</span>:<br>        error_list.append(i.get(<span class="hljs-string">&#x27;status&#x27;</span>))<br>def count_status():<br>  <span class="hljs-keyword">if</span> len(error_list) == 0:<br>    <span class="hljs-built_in">print</span> 50<br>  <span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span> 100<br>    <br>def main():<br>  get_status()<br>  count_status()<br>  <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>  main()<br>  <br><span class="hljs-comment"># chmod a+x /etc/zabbix/zabbix_agentd.d/k8s_monitor.py  </span><br></code></pre></td></tr></table></figure>

<h3 id="5-11-2-监控MongodbDB复制集状态"><a href="#5-11-2-监控MongodbDB复制集状态" class="headerlink" title="5.11.2 监控MongodbDB复制集状态"></a>5.11.2 监控MongodbDB复制集状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#cat /etc/zabbix/zabbix_agentd.d/mongodb_cluster_monitor.py</span><br><span class="hljs-comment">#!/bin/env python</span><br><span class="hljs-comment">#coding:utf-8</span><br><span class="hljs-comment">#Author: ZhangShiJie</span><br><br>import subprocess<br>success_list = []<br>error_list= []<br><br>def get_mongodb_status():<br> obj = subprocess.Popen((<span class="hljs-string">&quot;echo &#x27;rs.status()&#x27; | /usr/local/mongodb/bin/mongo -u user</span><br><span class="hljs-string">-p wswd --authenticationDatabase admin \</span><br><span class="hljs-string">| grep health | awk -F&#x27;:&#x27; &#x27;&#123;print <span class="hljs-variable">$2</span>&#125;&#x27; | awk -F&#x27;,&#x27; &#x27;&#123;print <span class="hljs-variable">$1</span>&#125;&#x27;&quot;</span>),shell=True,<br>stdout=subprocess.PIPE)<br> restful = obj.stdout.read()<br> data = restful.split()<br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data:<br>  <span class="hljs-keyword">if</span> i == <span class="hljs-string">&quot;1&quot;</span>:<br>     success_list.append(i)<br>    <span class="hljs-keyword">else</span>:<br>     error_list.append(i)<br>     <br>def count_status():<br>  <span class="hljs-keyword">if</span> len(error_list) &gt; 0:<br>   <span class="hljs-built_in">print</span> 100<br>  <span class="hljs-keyword">else</span>:<br>   <span class="hljs-built_in">print</span> 50<br>   <br>def main():<br> get_mongodb_status()<br> count_status()<br> <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br> main()<br> <br><span class="hljs-comment">#chmod a+x /etc/zabbix/zabbix_agentd.d/redis_llen.py</span><br></code></pre></td></tr></table></figure>

<h3 id="5-11-3-监控Redis列表长度"><a href="#5-11-3-监控Redis列表长度" class="headerlink" title="5.11.3 监控Redis列表长度"></a>5.11.3 监控Redis列表长度</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@redis ~]<span class="hljs-comment">#cat /etc/zabbix/zabbix_agentd.d/redis_llen.py</span><br><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#coding:utf-8</span><br><span class="hljs-comment">#Author ZhangShijie</span><br>import redis<br>def redis_conn():<br>  pool=redis.ConnectionPool(host=<span class="hljs-string">&quot;10.20.0.252&quot;</span>,port=6379,db=0)<br> conn = redis.Redis(connection_pool=pool)<br> data = conn.llen(<span class="hljs-string">&#x27;api4-nginx-accesslog&#x27;</span>)<br> <span class="hljs-built_in">print</span>(data)<br>redis_conn()<br><br>[root@redis ~]<span class="hljs-comment"># chmod a+x /etc/zabbix/zabbix_agentd.d/redis_llen.py</span><br></code></pre></td></tr></table></figure>

<h3 id="5-11-4-监控ELK集群状态"><a href="#5-11-4-监控ELK集群状态" class="headerlink" title="5.11.4 监控ELK集群状态"></a>5.11.4 监控ELK集群状态</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">[root@elk-s1 ~]<span class="hljs-comment"># vim /etc/zabbix/zabbix_agentd.d/els_status.py</span><br><br><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#coding:utf-8</span><br><span class="hljs-comment">#Author ZhangShijie</span><br><br><span class="hljs-keyword">import</span> subprocess<br>false=<span class="hljs-string">&quot;false&quot;</span><br>obj = subprocess.Popen((<span class="hljs-string">&quot;curl -sXGET http://10.20.3.128:9200/_cluster/health?</span><br><span class="hljs-string">pretty=true&quot;</span>),shell=<span class="hljs-literal">True</span>, stdout=subprocess.PIPE)<br>data =  obj.stdout.read()<br>data1 = <span class="hljs-built_in">eval</span>(data)<br>status = data1.get(<span class="hljs-string">&quot;status&quot;</span>)<br><span class="hljs-keyword">if</span> status == <span class="hljs-string">&quot;green&quot;</span>:<br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;100&quot;</span><br><span class="hljs-keyword">else</span>:<br>  <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;50&quot;</span><br>                        <br>[root@elk-s1 ~]<span class="hljs-comment"># chmod a+x /etc/zabbix/zabbix_agentd.d/els_status.py</span><br></code></pre></td></tr></table></figure>

<h3 id="5-11-5-监控RabbitMQ集群节点状态"><a href="#5-11-5-监控RabbitMQ集群节点状态" class="headerlink" title="5.11.5 监控RabbitMQ集群节点状态"></a>5.11.5 监控RabbitMQ集群节点状态</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#cat /etc/zabbix/zabbix_agentd.d/rabbit_cluster_monitor.py</span><br><span class="hljs-comment">#!/bin/env python</span><br><span class="hljs-comment">#coding:utf-8</span><br><span class="hljs-comment">#Author: ZhangShiJie</span><br><br><span class="hljs-keyword">import</span>  subprocess<br>running_list = []<br>error_list = []<br>false=<span class="hljs-string">&quot;false&quot;</span><br>true=<span class="hljs-string">&quot;true&quot;</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_status</span>():</span><br>  obj = subprocess.Popen((<span class="hljs-string">&quot;curl -sXGET -u guest:guest</span><br><span class="hljs-string">http://10.20.3.171:15671/api/nodes&quot;</span>),shell=<span class="hljs-literal">True</span>, stdout=subprocess.PIPE)<br>  data =  obj.stdout.read()<br>  data1 = <span class="hljs-built_in">eval</span>(data)<br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data1:<br>    <span class="hljs-keyword">if</span> i.get(<span class="hljs-string">&quot;running&quot;</span>) == <span class="hljs-string">&quot;true&quot;</span>:<br>      running_list.append(i.get(<span class="hljs-string">&quot;name&quot;</span>))<br>    <span class="hljs-keyword">else</span>:<br>      error_list.append(i.get(<span class="hljs-string">&quot;name&quot;</span>))<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">count_server</span>():</span><br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(running_list) &lt; <span class="hljs-number">3</span>: <span class="hljs-comment">#可以判断错误列表大于0或者运行列表小于3，3未总计的节点数量</span><br>    <span class="hljs-built_in">print</span> <span class="hljs-number">100</span> <span class="hljs-comment">#100就是集群内有节点运行不正常了</span><br>  <span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-number">50</span>  <span class="hljs-comment">#50为所有节点全部运行正常</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>  get_status()<br>  count_server()<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>  main()<br>                          <br><span class="hljs-comment">#chmoa a+x /etc/zabbix/zabbix_agentd.d/rabbit_cluster_monitor.py</span><br></code></pre></td></tr></table></figure>

<h2 id="5-12-web监控"><a href="#5-12-web监控" class="headerlink" title="5.12 web监控"></a>5.12 web监控</h2><h3 id="5-12-1-添加web监控"><a href="#5-12-1-添加web监控" class="headerlink" title="5.12.1 添加web监控"></a>5.12.1 添加web监控</h3><p><strong>zabbix的web监控多用于对官网的象征性监控和内部网络web服务器可用状态的监控，一般都是委托第三方公司监管</strong></p>
<p>配置–主机–web监控</p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<p>创建web场景</p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<p>" srcset="/blog/img/loading.gif<img src="" alt="场景"></p>
<p>" srcset="/blog/img/loading.gif<img src="" alt="步骤"></p>
<p>" srcset="/blog/img/loading.gif<img src="" alt="添加步骤"></p>
<p>" srcset="/blog/img/loading.gif<img src=""></p>
<h3 id="5-12-2-添加监控项"><a href="#5-12-2-添加监控项" class="headerlink" title="5.12.2 添加监控项"></a>5.12.2 添加监控项</h3><p>配置–主机–zabbix server–触发器–创建触发器</p>
<p>" srcset="/blog/img/loading.gif<img src="" alt="条件：监控项response code 结果=200"></p>
<h1 id="六、Zabbix-事件通知机制："><a href="#六、Zabbix-事件通知机制：" class="headerlink" title="六、Zabbix 事件通知机制："></a>六、Zabbix 事件通知机制：</h1><p>出现故障报警的时候，可以通过不同方式通知管理员进行故障处理，尽快恢复业务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@s1 ~]<span class="hljs-comment"># vim /etc/zabbix/zabbix_server.conf</span><br>AlertScriptsPath=/usr/lib/zabbix/alertscripts <span class="hljs-comment">#报警脚本路径</span><br>ExternalScripts=/usr/lib/zabbix/externalscripts <span class="hljs-comment">#外部脚本路径</span><br><span class="hljs-comment">#编译安装zabbix脚本路径</span><br>vim /apps/zabbix_server/share/zabbix/alertscripts<br></code></pre></td></tr></table></figure>

<h2 id="6-1-邮件通知"><a href="#6-1-邮件通知" class="headerlink" title="6.1 邮件通知"></a>6.1 邮件通知</h2><p>通过企业邮箱、第三方服务商邮箱发送报警邮件通知运维工程师。</p>
<h3 id="6-1-1-邮箱开启SMTP"><a href="#6-1-1-邮箱开启SMTP" class="headerlink" title="6.1.1 邮箱开启SMTP"></a>6.1.1 邮箱开启SMTP</h3><p>如果是QQ邮箱需要单独开启SMTP，其他邮箱具体联系服务商。</p>
<p>确认是已经打开状态，如果是未开启状态只要点击开启并根据提示进行相关验证即可。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix181.png" srcset="/blog/img/loading.gif"></p>
<h3 id="6-1-2-生成授权码"><a href="#6-1-2-生成授权码" class="headerlink" title="6.1.2 生成授权码"></a>6.1.2 生成授权码</h3><p>QQ邮箱在第三方平台发送邮件不能直接使用QQ邮箱的登录密码，需要使用单独提供的授权码才可以登录，具体生成方式如下：</p>
<h4 id="6-1-2-1-生成授权码"><a href="#6-1-2-1-生成授权码" class="headerlink" title="6.1.2.1 生成授权码"></a>6.1.2.1 生成授权码</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix182.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-2-2-发送验证码"><a href="#6-1-2-2-发送验证码" class="headerlink" title="6.1.2.2 发送验证码"></a>6.1.2.2 发送验证码</h4><p>安装提示使用绑定的手机发送配置邮件客户端到1069070069，然后点击我已发送。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix183.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-2-3-保存授权码"><a href="#6-1-2-3-保存授权码" class="headerlink" title="6.1.2.3 保存授权码"></a>6.1.2.3 保存授权码</h4><p>将页面生成后返回的授权码妥善保存好，后期会使用此授权码进行登录验证。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix184.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-2-4-Zabbix-Web创建报警媒介类型"><a href="#6-1-2-4-Zabbix-Web创建报警媒介类型" class="headerlink" title="6.1.2.4 Zabbix Web创建报警媒介类型"></a>6.1.2.4 Zabbix Web创建报警媒介类型</h4><p>报警媒介类型是一种给运维工程师发送消息通知的渠道，即当zabbix 的触发器触发一个事件后，怎么才能把这个事件通过某些方式通知给运维工程师呢？那么媒介类型就起到这样的作用，媒介类型创建好之后，需要在每个账户里面添加相应的收件配置，比如邮件类型的媒介类型要给zabbix账户添加邮箱，如果是微信类型的媒介类型那么就要在zabbix账户设置微信号，同样的到来，短信类型的媒介类型那就得给zabbix账户设置手机号用于接收报警消息内容。</p>
<p>管理–&gt;报警媒介类型–&gt;创建报警媒介类型：</p>
<p><a target="_blank" rel="noopener" href="https://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=371">https://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=371</a> #设置参考</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix185.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix206.png" srcset="/blog/img/loading.gif" alt="outlook配置"></p>
<h4 id="6-1-2-5-给用户添加报警报警媒介"><a href="#6-1-2-5-给用户添加报警报警媒介" class="headerlink" title="6.1.2.5 给用户添加报警报警媒介"></a>6.1.2.5 给用户添加报警报警媒介</h4><p>管理–用户–用户（选择需要收到信息的用户）–报警媒介</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix186.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix187.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix188.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix189.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-2-6-更新报警媒介"><a href="#6-1-2-6-更新报警媒介" class="headerlink" title="6.1.2.6 更新报警媒介"></a>6.1.2.6 更新报警媒介</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix190.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-2-7-创建动作"><a href="#6-1-2-7-创建动作" class="headerlink" title="6.1.2.7 创建动作"></a>6.1.2.7 创建动作</h4><p>动作是对zabbix 触发器触发后生成的事件的具体处理操作，可以是远程执行命令，也可以是发送通知给指定的管理员进行故障处理，发送命令是调用的上一步骤创建好的报警媒介类型。</p>
<p>配置–&gt;动作–&gt;创建动作：</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix191.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix192.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-2-8-配置动作信息"><a href="#6-1-2-8-配置动作信息" class="headerlink" title="6.1.2.8 配置动作信息"></a>6.1.2.8 配置动作信息</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix193.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-2-9-验证动作当前状态："><a href="#6-1-2-9-验证动作当前状态：" class="headerlink" title="6.1.2.9 验证动作当前状态："></a>6.1.2.9 验证动作当前状态：</h4><p>验证当前动作信息，并点击恢复操作，配置故障恢复的具体动作内容</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix194.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-2-10-配置故障恢复信息"><a href="#6-1-2-10-配置故障恢复信息" class="headerlink" title="6.1.2.10 配置故障恢复信息"></a>6.1.2.10 配置故障恢复信息</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix195.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-2-11-添加动作"><a href="#6-1-2-11-添加动作" class="headerlink" title="6.1.2.11 添加动作"></a>6.1.2.11 添加动作</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix196.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-2-12-验证动作"><a href="#6-1-2-12-验证动作" class="headerlink" title="6.1.2.12 验证动作"></a>6.1.2.12 验证动作</h4><p>将某个被监控的服务手动停止，验证能否收到zabbix 发送的报警通知。</p>
<h5 id="6-1-2-12-1-验证事件状态"><a href="#6-1-2-12-1-验证事件状态" class="headerlink" title="6.1.2.12.1 验证事件状态"></a>6.1.2.12.1 验证事件状态</h5><p>在zabbix web界面，验证当事件触发后邮件通知也没有发送成功。</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix197.png" srcset="/blog/img/loading.gif" alt="没恢复服务器前"></p>
<h5 id="6-1-2-12-2-邮箱验证是否收到邮件："><a href="#6-1-2-12-2-邮箱验证是否收到邮件：" class="headerlink" title="6.1.2.12.2 邮箱验证是否收到邮件："></a>6.1.2.12.2 邮箱验证是否收到邮件：</h5><p>到收件箱验证是否收到zabbix 发送的通知邮件</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix198.png" srcset="/blog/img/loading.gif"></p>
<h3 id="6-1-3-分层递归报警"><a href="#6-1-3-分层递归报警" class="headerlink" title="6.1.3 分层递归报警"></a>6.1.3 分层递归报警</h3><p>在报警过两次之后，运维还没有解决的情况下，就再将报警发送给更高一层的领导（比如：业务运维，高级运维，运维经理等）</p>
<h4 id="6-1-3-1-zabbix-创建新用户"><a href="#6-1-3-1-zabbix-创建新用户" class="headerlink" title="6.1.3.1 zabbix 创建新用户"></a>6.1.3.1 zabbix 创建新用户</h4><p>管理–用户–创建用户</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix199.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-3-2-给新用户添加报警媒介"><a href="#6-1-3-2-给新用户添加报警媒介" class="headerlink" title="6.1.3.2 给新用户添加报警媒介"></a>6.1.3.2 给新用户添加报警媒介</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix200.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix201.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-1-3-3-给新用户添加权限"><a href="#6-1-3-3-给新用户添加权限" class="headerlink" title="6.1.3.3 给新用户添加权限"></a>6.1.3.3 给新用户添加权限</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix202.png" srcset="/blog/img/loading.gif" alt="202"></p>
<h4 id="6-1-3-4-在发送邮件的动作里添加新用户"><a href="#6-1-3-4-在发送邮件的动作里添加新用户" class="headerlink" title="6.1.3.4 在发送邮件的动作里添加新用户"></a>6.1.3.4 在发送邮件的动作里添加新用户</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix203.png" srcset="/blog/img/loading.gif"><br><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix204.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix205.png" srcset="/blog/img/loading.gif"></p>
<h3 id="6-1-4-通知分类"><a href="#6-1-4-通知分类" class="headerlink" title="6.1.4 通知分类"></a>6.1.4 通知分类</h3><p>在动作中给公司业务分类，然后根据哪个人负责哪一个业务就将通知发送到哪个人中，当业务的灾难级别为严重或灾难时，就分层递归到该业务的负责人或更高级别的人</p>
<h2 id="6-2-短信通知"><a href="#6-2-短信通知" class="headerlink" title="6.2 短信通知"></a>6.2 短信通知</h2><p>通知脚本见 api及通知脚本/send_sms_sh.sh</p>
<p>服务端配置略，不同厂商配置不一样</p>
<h3 id="6-2-1-添加短信报警媒介类型"><a href="#6-2-1-添加短信报警媒介类型" class="headerlink" title="6.2.1 添加短信报警媒介类型"></a>6.2.1 添加短信报警媒介类型</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;ALERT.SENDTO&#125;--收件人媒介<br>&#123;ALERT.SUBJECT&#125;--通知主题<br>&#123;ALERT.MESSAGE&#125;--通知内容<br><br>名称：门户业务报警<br>默认接收人：业务报警&#123;TRIGGER.STATUS&#125;<br>默认信息：北京业务报警服务器:&#123;HOST.NAME&#125;,IP:&#123;HOSTNAME1&#125;,详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;<br><br>启用恢复信息：<br>恢复主题：业务恢复<br>恢复信息：北京业务恢复服务器:&#123;HOST.NAME&#125;,IP:&#123;HOSTNAME1&#125;,详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;<br><br><span class="hljs-comment">#zabbix 宏变量使用及场景</span><br>https://www.zabbix.com/documentation/4.0/zh/manual/appendix/macros/supported_by_location<br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix207.png" srcset="/blog/img/loading.gif"></p>
<h3 id="6-2-2-添加联系人报警媒介"><a href="#6-2-2-添加联系人报警媒介" class="headerlink" title="6.2.2 添加联系人报警媒介"></a>6.2.2 添加联系人报警媒介</h3><p>设置收件人的指定收件类型内容</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix208.png" srcset="/blog/img/loading.gif"></p>
<h3 id="6-2-3-创建短信通知动作"><a href="#6-2-3-创建短信通知动作" class="headerlink" title="6.2.3 创建短信通知动作"></a>6.2.3 创建短信通知动作</h3><p>定义动作细节</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix209.png" srcset="/blog/img/loading.gif">01</p>
<h3 id="6-2-4-配置短信发送具体内容"><a href="#6-2-4-配置短信发送具体内容" class="headerlink" title="6.2.4 配置短信发送具体内容"></a>6.2.4 配置短信发送具体内容</h3><p>定义消息内容细节和收件人及发送方式</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix210.png" srcset="/blog/img/loading.gif"></p>
<h3 id="6-2-5-配置恢复操作"><a href="#6-2-5-配置恢复操作" class="headerlink" title="6.2.5 配置恢复操作"></a>6.2.5 配置恢复操作</h3><p>配置恢复操作</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix211.png" srcset="/blog/img/loading.gif"></p>
<h3 id="6-2-6-验证动作状态"><a href="#6-2-6-验证动作状态" class="headerlink" title="6.2.6 验证动作状态"></a>6.2.6 验证动作状态</h3><p>验证内容</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix212.png" srcset="/blog/img/loading.gif"></p>
<h3 id="6-2-8-测试短信报警"><a href="#6-2-8-测试短信报警" class="headerlink" title="6.2.8 测试短信报警"></a>6.2.8 测试短信报警</h3><p>讲监控项手动停止，测试能否在出现故障后发送短信报警</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix213.png" srcset="/blog/img/loading.gif"></p>
<h3 id="6-2-9-总结"><a href="#6-2-9-总结" class="headerlink" title="6.2.9 总结"></a>6.2.9 总结</h3><ol>
<li>创建报警媒介类型</li>
<li>编写脚本，测定单挑</li>
<li>给用户添加报警媒介</li>
<li>通过zabbix调用脚本</li>
<li>配置动作</li>
<li>测试</li>
</ol>
<h2 id="6-3-微信通知"><a href="#6-3-微信通知" class="headerlink" title="6.3 微信通知"></a>6.3 微信通知</h2><p>微信企业账号注册见 api 及通知脚本/weixin.py及文档微信报警</p>
<h3 id="6-3-1-企业微信注册及配置"><a href="#6-3-1-企业微信注册及配置" class="headerlink" title="6.3.1 企业微信注册及配置"></a>6.3.1 企业微信注册及配置</h3><p><a target="_blank" rel="noopener" href="https://work.weixin.qq.com/">https://work.weixin.qq.com/</a></p>
<p>打开企业微信官网注册账号，使用自己的手机号进行注册。</p>
<h4 id="6-3-1-1-企业微信账号注册"><a href="#6-3-1-1-企业微信账号注册" class="headerlink" title="6.3.1.1 企业微信账号注册"></a>6.3.1.1 企业微信账号注册</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix214.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-2-登录PC版"><a href="#6-3-1-2-登录PC版" class="headerlink" title="6.3.1.2 登录PC版"></a>6.3.1.2 登录PC版</h4><p>注册完成账号之后就可以扫码登录PC版web界面了，如下：</p>
<h4 id="6-3-1-3-创建应用"><a href="#6-3-1-3-创建应用" class="headerlink" title="6.3.1.3 创建应用"></a>6.3.1.3 创建应用</h4><p>在web界面创建一个应用，用于微信报警通知</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix215.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-4-填写应用信息"><a href="#6-3-1-4-填写应用信息" class="headerlink" title="6.3.1.4 填写应用信息"></a>6.3.1.4 填写应用信息</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix216.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-5-注册完成"><a href="#6-3-1-5-注册完成" class="headerlink" title="6.3.1.5 注册完成"></a>6.3.1.5 注册完成</h4><p>AgentID和Secret会在发送微信报警信息的时候调用</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix217.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-6-创建微信账号"><a href="#6-3-1-6-创建微信账号" class="headerlink" title="6.3.1.6 创建微信账号"></a>6.3.1.6 创建微信账号</h4><p>用户账户名称必须唯一，在发送微信报警信息的时候会调用</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix218.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-7-验证通讯录"><a href="#6-3-1-7-验证通讯录" class="headerlink" title="6.3.1.7 验证通讯录"></a>6.3.1.7 验证通讯录</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix219.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-8-查看企业信息"><a href="#6-3-1-8-查看企业信息" class="headerlink" title="6.3.1.8 查看企业信息"></a>6.3.1.8 查看企业信息</h4><p>企业ID在发送微信报警信息的时候会调用</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix220.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-9-测试发送信息"><a href="#6-3-1-9-测试发送信息" class="headerlink" title="6.3.1.9 测试发送信息"></a>6.3.1.9 测试发送信息</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix221.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-10-选择消息接收人"><a href="#6-3-1-10-选择消息接收人" class="headerlink" title="6.3.1.10 选择消息接收人"></a>6.3.1.10 选择消息接收人</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix222.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-11-确认消息接收人"><a href="#6-3-1-11-确认消息接收人" class="headerlink" title="6.3.1.11 确认消息接收人"></a>6.3.1.11 确认消息接收人</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix223.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-12-开始发送信息"><a href="#6-3-1-12-开始发送信息" class="headerlink" title="6.3.1.12 开始发送信息"></a>6.3.1.12 开始发送信息</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix224.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-13-确认发送"><a href="#6-3-1-13-确认发送" class="headerlink" title="6.3.1.13 确认发送"></a>6.3.1.13 确认发送</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix225.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-1-14-手机验证消息"><a href="#6-3-1-14-手机验证消息" class="headerlink" title="6.3.1.14 手机验证消息"></a>6.3.1.14 手机验证消息</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix226.png" srcset="/blog/img/loading.gif"></p>
<h3 id="6-3-2-zabbix-server配置："><a href="#6-3-2-zabbix-server配置：" class="headerlink" title="6.3.2 zabbix server配置："></a>6.3.2 zabbix server配置：</h3><p>zabbix server实现微信通知基于python调用脚本实现且需要安装requests模块：</p>
<p><a target="_blank" rel="noopener" href="https://work.weixin.qq.com/api/doc#90000/90003/90487">https://work.weixin.qq.com/api/doc#90000/90003/90487</a> #简易教程</p>
<p>先获取token，token是通过corpid(企业ID)和corpsecret(应用 Secret)获取到的，然后通过API发送消息，根据官方文档可以看到，发送的消息其实就是一个post请求，请求方式如下：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">请求方式：POST（HTTPS）<br>请求地址： https:<span class="hljs-regexp">//</span>qyapi.weixin.qq.com<span class="hljs-regexp">/cgi-bin/m</span>essage/send&gt;?access_token=ACCESS_TOKEN<br><br>post 参数为 access_token 和 消息体。<br></code></pre></td></tr></table></figure>

<p>服务端API调用：</p>
<p><a target="_blank" rel="noopener" href="https://work.weixin.qq.com/api/doc#90000/90135/90664">https://work.weixin.qq.com/api/doc#90000/90135/90664</a></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix227.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-2-1-编写python脚本"><a href="#6-3-2-1-编写python脚本" class="headerlink" title="6.3.2.1 编写python脚本"></a>6.3.2.1 编写python脚本</h4><p>在zabbix server安装基础模块并编写pyhton脚本，python脚本通过调用企业微信的API实现自动发送通知消息，具体内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># apt install python-pip</span><br><span class="hljs-comment"># pip install requests</span><br><br><span class="hljs-comment"># pwd</span><br>/apps/zabbix_server/share/zabbix/alertscripts<br><br><span class="hljs-comment"># cat wx.py</span><br><br><span class="hljs-comment">#!/usr/bin/python3.6</span><br><span class="hljs-comment">#coding:utf-8</span><br><span class="hljs-comment">#Author:Zhang ShiJie</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> logging<br><br>logging.basicConfig(level = logging.DEBUG, <span class="hljs-built_in">format</span> = <span class="hljs-string">&#x27;%(asctime)s, %(filename)s, %(levelname)s, %(message)s&#x27;</span>,<br>    datefmt = <span class="hljs-string">&#x27;%a, %d %b %Y %H:%M:%S&#x27;</span>,<br>    filename = os.path.join(<span class="hljs-string">&#x27;/tmp&#x27;</span>,<span class="hljs-string">&#x27;weixin.log&#x27;</span>),<br>    filemode = <span class="hljs-string">&#x27;a&#x27;</span>)<br><br>corpid=<span class="hljs-string">&#x27;企业ID&#x27;</span><br>appsecret=<span class="hljs-string">&quot;秘钥&quot;</span><br>agentid=<span class="hljs-string">&quot;AgentID&quot;</span><br>token_url=<span class="hljs-string">&#x27;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=&#x27;</span> + corpid +<br><span class="hljs-string">&#x27;&amp;corpsecret=&#x27;</span> + appsecret<br>req=requests.get(token_url)<br>accesstoken=req.json()[<span class="hljs-string">&#x27;access_token&#x27;</span>]<br><br>msgsend_url=<span class="hljs-string">&#x27;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&#x27;</span> +<br>accesstoken<br>touser=sys.argv[<span class="hljs-number">1</span>]<br>subject=sys.argv[<span class="hljs-number">2</span>]<br>message=sys.argv[<span class="hljs-number">2</span>] + <span class="hljs-string">&quot;\n\n&quot;</span> +sys.argv[<span class="hljs-number">3</span>]<br><br>params=&#123;<br>    <span class="hljs-string">&quot;touser&quot;</span>: touser,<br>    <span class="hljs-string">&quot;msgtype&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>    <span class="hljs-string">&quot;agentid&quot;</span>: agentid,<br>    <span class="hljs-string">&quot;text&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content&quot;</span>: message<br>     &#125;,<br>    <span class="hljs-string">&quot;safe&quot;</span>:<span class="hljs-number">0</span><br>   &#125;<br><br>req=requests.post(msgsend_url, data=json.dumps(params))<br>logging.info(<span class="hljs-string">&#x27;sendto:&#x27;</span> + touser + <span class="hljs-string">&#x27;;;subject:&#x27;</span> + subject + <span class="hljs-string">&#x27;;;message:&#x27;</span> + message)<br><br><span class="hljs-comment"># python wx.py ZhangShiJie &quot;这是主题&quot; &quot;这是内容&quot;</span><br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix228.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-2-2-添加微信报警媒介类型"><a href="#6-3-2-2-添加微信报警媒介类型" class="headerlink" title="6.3.2.2 添加微信报警媒介类型"></a>6.3.2.2 添加微信报警媒介类型</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix229.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-2-3-添加联系人报警媒介"><a href="#6-3-2-3-添加联系人报警媒介" class="headerlink" title="6.3.2.3 添加联系人报警媒介"></a>6.3.2.3 添加联系人报警媒介</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix230.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-2-4-更新报警媒介"><a href="#6-3-2-4-更新报警媒介" class="headerlink" title="6.3.2.4 更新报警媒介"></a>6.3.2.4 更新报警媒介</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix231.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-2-5-添加微信报警动作"><a href="#6-3-2-5-添加微信报警动作" class="headerlink" title="6.3.2.5 添加微信报警动作"></a>6.3.2.5 添加微信报警动作</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix232.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-2-6-配置故障操作"><a href="#6-3-2-6-配置故障操作" class="headerlink" title="6.3.2.6 配置故障操作"></a>6.3.2.6 配置故障操作</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix233.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-2-7-配置恢复操作"><a href="#6-3-2-7-配置恢复操作" class="headerlink" title="6.3.2.7 配置恢复操作"></a>6.3.2.7 配置恢复操作</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix234.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-2-8-验证动作状态"><a href="#6-3-2-8-验证动作状态" class="headerlink" title="6.3.2.8 验证动作状态"></a>6.3.2.8 验证动作状态</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix235.png" srcset="/blog/img/loading.gif"></p>
<h4 id="6-3-2-9-测试微信报警"><a href="#6-3-2-9-测试微信报警" class="headerlink" title="6.3.2.9 测试微信报警"></a>6.3.2.9 测试微信报警</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix236.png" srcset="/blog/img/loading.gif"></p>
<h2 id="6-4-事件通知总结图"><a href="#6-4-事件通知总结图" class="headerlink" title="6.4 事件通知总结图"></a>6.4 事件通知总结图</h2><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/zabbix/zabbix237.png" srcset="/blog/img/loading.gif"></p>
<h1 id="七、Zabbix-自动化运维："><a href="#七、Zabbix-自动化运维：" class="headerlink" title="七、Zabbix 自动化运维："></a>七、Zabbix 自动化运维：</h1><p>通过脚本批量部署zabbix agent、通过API批量自动添加主机或者自动发现监控主机</p>
<h2 id="7-1-Zabbix-Agent批量部署"><a href="#7-1-Zabbix-Agent批量部署" class="headerlink" title="7.1 Zabbix Agent批量部署"></a>7.1 Zabbix Agent批量部署</h2><p>通过脚本，实现数十上百台agent的自动化批量安装，可以通过源码或apt等方式安装。</p>
<h3 id="7-1-1-源码编译安装"><a href="#7-1-1-源码编译安装" class="headerlink" title="7.1.1 源码编译安装"></a>7.1.1 源码编译安装</h3><p>官网下载源码包，通过自定义编译参数、自定义配置文件和监控脚本实现安装</p>
<p>见 <strong>zabbix-agent-onekey-install-4.0.X</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cat zabbix-agent-onekey-install-4.0.X</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#Date:2016/08/20</span><br><span class="hljs-comment">#Author: Zhangshijie</span><br><br>DIR=`<span class="hljs-built_in">pwd</span>`<br>grep <span class="hljs-string">&quot;Ubuntu&quot;</span> /etc/issue &amp;&gt; /dev/null<br><span class="hljs-keyword">if</span> [ $? -eq 0 ];<span class="hljs-keyword">then</span><br>apt update<br>apt-get -y install iproute2 ntpdate tcpdump telnet traceroute nfs-kernel-server nfs-common lrzsz tree  openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute  gcc openssh-server lrzsz tree  openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute iotop unzip zip make<br><span class="hljs-keyword">fi</span><br><br>grep <span class="hljs-string">&quot;Kernel&quot;</span> /etc/issue &amp;&gt; /dev/null<br><span class="hljs-keyword">if</span> [ $? -eq 0 ];<span class="hljs-keyword">then</span><br>yum install -y vim iotop bc gcc gcc-c++ glibc glibc-devel pcre pcre-devel openssl openssl-devel zip unzip zlib-devel net-tools lrzsz tree ntpdate telnet lsof tcpdump wget libevent libevent-devel bc systemd-devel bash-completion traceroute<br><span class="hljs-keyword">fi</span><br><br>tar xvf zabbix-4.0.X.tar.gz &amp;&amp; <span class="hljs-built_in">cd</span> zabbix-4.0.X &amp;&amp; ./configure --prefix=/apps/zabbix_agent --enable-agent &amp;&amp; make &amp;&amp; make install<br>useradd zabbix<br>mkdir /apps/zabbix_agent/pid<br>mkdir /apps/zabbix_agent/logs<br><br>\cp <span class="hljs-variable">$&#123;DIR&#125;</span>/zabbix-agent.service /lib/systemd/system/zabbix-agent.service<br>\cp <span class="hljs-variable">$&#123;DIR&#125;</span>/zabbix_agentd.conf /apps/zabbix_agent/etc/zabbix_agentd.conf<br>\cp <span class="hljs-variable">$&#123;DIR&#125;</span>/zabbix_agentd.conf.d/* /apps/zabbix_agent/etc/zabbix_agentd.conf.d/<br><br>HOST_IP=`ifconfig eth0 | grep -w inet | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br>sed -i <span class="hljs-string">&quot;s/Hostname=/Hostname=<span class="hljs-variable">$&#123;HOST_IP&#125;</span>/g&quot;</span> /apps/zabbix_agent/etc/zabbix_agentd.conf<br>chown zabbix.zabbix -R /apps/zabbix_agent/<br><br>systemctl daemon-reload &amp;&amp; systemctl <span class="hljs-built_in">enable</span> zabbix-agent &amp;&amp; systemctl restart zabbix-agent<br><br><span class="hljs-comment">#同时还要准备zabbix-agent.service zabbix_agentd.conf zabbix-agentd.conf.d的文件</span><br></code></pre></td></tr></table></figure>

<h3 id="7-1-2-apt-yum在线安装"><a href="#7-1-2-apt-yum在线安装" class="headerlink" title="7.1.2 apt/yum在线安装"></a>7.1.2 apt/yum在线安装</h3><p>略</p>
<h2 id="7-2-Zabbix-API添加主机"><a href="#7-2-Zabbix-API添加主机" class="headerlink" title="7.2 Zabbix API添加主机"></a>7.2 Zabbix API添加主机</h2><p><a target="_blank" rel="noopener" href="https://www.zabbix.com/documentation/4.0/zh/manual/api">https://www.zabbix.com/documentation/4.0/zh/manual/api</a></p>
<p>通过API，实现完全自动化添加删除agent、关联模板等操作</p>
<h3 id="7-2-1-API使用基础"><a href="#7-2-1-API使用基础" class="headerlink" title="7.2.1 API使用基础"></a>7.2.1 API使用基础</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><code class="hljs bash">见文本文档 Zabbix-API使用<br>1.获取token：<br>需要指定用的账户名 密码和id<br><br><span class="hljs-comment"># curl -s -X POST -H &#x27;Content-Type:application/json&#x27; -d &#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;jsonrpc&quot;</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>  <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;user.login&quot;</span>,<br>  <span class="hljs-string">&quot;params&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;USER&quot;</span>,<br>    <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;PASSWD&quot;</span><br>    &#125;,<br>  <span class="hljs-string">&quot;id&quot;</span>: 1<br>&#125;<span class="hljs-string">&#x27; http://172.31.0.101/zabbix/api_jsonrpc.php | python3 -m json.tool</span><br><span class="hljs-string"></span><br><span class="hljs-string">#返回的数据</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="hljs-string">  &quot;result&quot;: &quot;8b20c44282bc5ba5d70d24ffe2c0e467&quot;,</span><br><span class="hljs-string">  &quot;id&quot;: 1</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">2.查看指定主机信息：</span><br><span class="hljs-string"># curl -s -X POST -H &#x27;</span>Content-Type:application/json<span class="hljs-string">&#x27; -d &#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;jsonrpc&quot;</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>  <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;host.get&quot;</span>,<br>  <span class="hljs-string">&quot;params&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;host&quot;</span>: [<br>        <span class="hljs-string">&quot;172.31.0.107&quot;</span><br>     ]<br>   &#125;<br> &#125;,<br>  <span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;8b20c44282bc5ba5d70d24ffe2c0e467&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span>: 1<br>&#125;<span class="hljs-string">&#x27; http://172.31.0.101/zabbix/api_jsonrpc.php | python3 -m json.tool</span><br><span class="hljs-string"></span><br><span class="hljs-string">3.获取所有主机列表：</span><br><span class="hljs-string"># curl -s -X POST -H &#x27;</span>Content-Type:application/json<span class="hljs-string">&#x27; -d &#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;jsonrpc&quot;</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>  <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;host.get&quot;</span>,<br>  <span class="hljs-string">&quot;params&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;output&quot;</span>: [<span class="hljs-string">&quot;host&quot;</span>]<br> &#125;,<br>  <span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;8b20c44282bc5ba5d70d24ffe2c0e467&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span>: 1<br>&#125;<span class="hljs-string">&#x27; http://172.31.0.101/zabbix/api_jsonrpc.php | python3 -m json.tool</span><br><span class="hljs-string"></span><br><span class="hljs-string">4.获取所有用户：</span><br><span class="hljs-string"># curl -s -X POST -H &#x27;</span>Content-Type:application/json<span class="hljs-string">&#x27; -d &#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;jsonrpc&quot;</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>  <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;user.get&quot;</span>,<br>  <span class="hljs-string">&quot;params&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;output&quot;</span>: <span class="hljs-string">&quot;extend&quot;</span><br> &#125;,<br>  <span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;8b20c44282bc5ba5d70d24ffe2c0e467&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span>: 1<br>&#125;<span class="hljs-string">&#x27; http://172.31.0.101/zabbix/api_jsonrpc.php | python3 -m json.tool</span><br><span class="hljs-string"></span><br><span class="hljs-string">5.获取单个模板信息:</span><br><span class="hljs-string"># curl -s -X POST -H &#x27;</span>Content-Type:application/json<span class="hljs-string">&#x27; -d &#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;jsonrpc&quot;</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>  <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;template.get&quot;</span>,<br>  <span class="hljs-string">&quot;params&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;output&quot;</span>: <span class="hljs-string">&quot;extend&quot;</span>,<br>    <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;host&quot;</span>: [<br>        <span class="hljs-string">&quot;NGINX_Check_Statuc&quot;</span><br>     ]<br>   &#125;<br> &#125;,                    <br>  <span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;178bb976840186b6412461ca30d249d5&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span>: 1                             <br>&#125;<span class="hljs-string">&#x27;  http://192.168.7.101/zabbix/api_jsonrpc.php | python -m json.tool</span><br><span class="hljs-string"></span><br><span class="hljs-string">6.获取多个模板信息：</span><br><span class="hljs-string"># curl -s -X POST -H &#x27;</span>Content-Type:application/json<span class="hljs-string">&#x27; -d &#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;jsonrpc&quot;</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>  <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;template.get&quot;</span>,<br>  <span class="hljs-string">&quot;params&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;output&quot;</span>: <span class="hljs-string">&quot;extend&quot;</span>,<br>    <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;host&quot;</span>: [<br>        <span class="hljs-string">&quot;tomcat-template-magedu-jiege&quot;</span>,<br>        <span class="hljs-string">&quot;mysql-magedu-jiege&quot;</span><br>     ]<br>   &#125;<br> &#125;,<br>  <span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;8b20c44282bc5ba5d70d24ffe2c0e467&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span>: 1<br>&#125;<span class="hljs-string">&#x27; http://172.31.0.101/zabbix/api_jsonrpc.php | python3 -m json.tool</span><br><span class="hljs-string"></span><br><span class="hljs-string">7.基于脚本获取token</span><br><span class="hljs-string"># cat token.py</span><br><span class="hljs-string">#!/usr/bin/env python</span><br><span class="hljs-string">#Author: Zhangshijie</span><br><span class="hljs-string"># -*- coding:utf-8 -*-</span><br><span class="hljs-string"></span><br><span class="hljs-string">import requests</span><br><span class="hljs-string">import json</span><br><span class="hljs-string"></span><br><span class="hljs-string">url = &#x27;</span>http://172.31.0.101/zabbix/api_jsonrpc.php<span class="hljs-string">&#x27;</span><br><span class="hljs-string">post_data = &#123;</span><br><span class="hljs-string">  &quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="hljs-string">  &quot;method&quot;: &quot;user.login&quot;,</span><br><span class="hljs-string">  &quot;params&quot;: &#123;</span><br><span class="hljs-string">    &quot;user&quot;: &quot;Admin&quot;,</span><br><span class="hljs-string">     &quot;password&quot;: &quot;zabbix&quot;</span><br><span class="hljs-string"> &#125;,</span><br><span class="hljs-string">  &quot;id&quot;: 1</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">post_header = &#123;&#x27;</span>Content-Type<span class="hljs-string">&#x27;: &#x27;</span>application/json<span class="hljs-string">&#x27;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">ret = requests.post(url, data=json.dumps(post_data), headers=post_header)</span><br><span class="hljs-string"></span><br><span class="hljs-string">zabbix_ret = json.loads(ret.text)</span><br><span class="hljs-string">if not zabbix_ret.has_key(&#x27;</span>result<span class="hljs-string">&#x27;):</span><br><span class="hljs-string"> print &#x27;</span>login error<span class="hljs-string">&#x27;</span><br><span class="hljs-string">else:</span><br><span class="hljs-string"> print zabbix_ret.get(&#x27;</span>result<span class="hljs-string">&#x27;)</span><br><span class="hljs-string"> </span><br><span class="hljs-string">8.通过API添加主机命令格式：</span><br><span class="hljs-string">API添加主机为预先知道要添加的主机IP、预先安装并配置好zabbix agent、预先知道要关联的模板ID/组ID等信息，然后同API提交请求添加</span><br><span class="hljs-string"># curl -s -X POST -H &#x27;</span>Content-Type:application/json<span class="hljs-string">&#x27; -d &#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;jsonrpc&quot;</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>  <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;host.create&quot;</span>, <span class="hljs-comment">#定义方法，N多钟</span><br>  <span class="hljs-string">&quot;params&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;API Add Host Test&quot;</span>, <span class="hljs-comment">#自定义添加后的agent的名称</span><br>    <span class="hljs-string">&quot;interfaces&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: 1, <span class="hljs-comment">#类型为1表示agent，2是SNMP，3是IMPI,4是JMX</span><br>        <span class="hljs-string">&quot;main&quot;</span>: 1, <span class="hljs-comment">#主要接口</span><br>        <span class="hljs-string">&quot;useip&quot;</span>: 1, <span class="hljs-comment">#0是使用DNS，1是使用IP地址</span><br>        <span class="hljs-string">&quot;ip&quot;</span>: <span class="hljs-string">&quot;172.31.0.24&quot;</span>, <span class="hljs-comment">#添加的zabbix agent的IP地址</span><br>        <span class="hljs-string">&quot;dns&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-string">&quot;10050&quot;</span> <span class="hljs-comment">#agent端口</span><br>      &#125;<br>    ],<br>    <span class="hljs-string">&quot;groups&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;groupid&quot;</span>: <span class="hljs-string">&quot;2&quot;</span> <span class="hljs-comment">#添加到的组的ID</span><br>      &#125;<br>    ],<br>    <span class="hljs-string">&quot;templates&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;templateid&quot;</span>: <span class="hljs-string">&quot;10001&quot;</span> <span class="hljs-comment">#关联的模板的ID</span><br>      &#125;<br>    ]<br>  &#125;,<br>  <span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;977781251d1222ebead6f05da1a9ec4d&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span>: 1<br>&#125;<span class="hljs-string">&#x27; http://172.31.0.101/zabbix/api_jsonrpc.php | python3 -m json.tool</span><br><span class="hljs-string"></span><br><span class="hljs-string">8.1：通过API添加单台不带proxy的agent示例：</span><br><span class="hljs-string"># curl -s -X POST -H &#x27;</span>Content-Type:application/json<span class="hljs-string">&#x27; -d &#x27;</span><br>&#123;<br><span class="hljs-string">&quot;jsonrpc&quot;</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>  <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;host.create&quot;</span>,<br>  <span class="hljs-string">&quot;params&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;API Add Host Test&quot;</span>,<br>    <span class="hljs-string">&quot;interfaces&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: 1,<br>        <span class="hljs-string">&quot;main&quot;</span>: 1,<br>        <span class="hljs-string">&quot;useip&quot;</span>: 1,<br>        <span class="hljs-string">&quot;ip&quot;</span>: <span class="hljs-string">&quot;172.31.0.24&quot;</span>,<br>        <span class="hljs-string">&quot;dns&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-string">&quot;10050&quot;</span><br>      &#125;<br>    ],<br>    <span class="hljs-string">&quot;groups&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;groupid&quot;</span>: <span class="hljs-string">&quot;15&quot;</span><br>      &#125;<br>    ],<br>    <span class="hljs-string">&quot;templates&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;templateid&quot;</span>: <span class="hljs-string">&quot;10001&quot;</span><br>      &#125;<br>    ]<br>  &#125;,<br>  <span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;8b20c44282bc5ba5d70d24ffe2c0e467&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span>: 1<br>&#125;<span class="hljs-string">&#x27; http://172.31.0.101/zabbix/api_jsonrpc.php | python3 -m json.tool</span><br><span class="hljs-string"></span><br><span class="hljs-string">8.2 通过API添加主机-带proxy模式：</span><br><span class="hljs-string"># curl -s -X POST -H &#x27;</span>Content-Type:application/json<span class="hljs-string">&#x27; -d &#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;jsonrpc&quot;</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>  <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;host.create&quot;</span>,<br>  <span class="hljs-string">&quot;params&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;172.18.0.109&quot;</span>,<br>    <span class="hljs-string">&quot;proxy_hostid&quot;</span>: <span class="hljs-string">&quot;10274&quot;</span>,<br>    <span class="hljs-string">&quot;interfaces&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: 1,<br>        <span class="hljs-string">&quot;main&quot;</span>: 1,<br>        <span class="hljs-string">&quot;useip&quot;</span>: 1,<br>        <span class="hljs-string">&quot;ip&quot;</span>: <span class="hljs-string">&quot;172.31.0.109&quot;</span>,<br>        <span class="hljs-string">&quot;dns&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-string">&quot;10050&quot;</span><br>      &#125;<br>    ],<br>    <span class="hljs-string">&quot;groups&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;groupid&quot;</span>: <span class="hljs-string">&quot;15&quot;</span><br>      &#125;<br>    ],<br>    <span class="hljs-string">&quot;templates&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;templateid&quot;</span>: <span class="hljs-string">&quot;10270&quot;</span><br>      &#125;<br>    ]<br>  &#125;,<br>  <span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;8b20c44282bc5ba5d70d24ffe2c0e467&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span>: 1<br>&#125;<span class="hljs-string">&#x27; http://172.31.0.101/zabbix/api_jsonrpc.php | python3 -m json.tool</span><br><span class="hljs-string"></span><br><span class="hljs-string">9.验证主机信息：</span><br><span class="hljs-string"># curl -s -X POST -H &#x27;</span>Content-Type:application/json<span class="hljs-string">&#x27; -d &#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;jsonrpc&quot;</span>: <span class="hljs-string">&quot;2.0&quot;</span>,<br>  <span class="hljs-string">&quot;method&quot;</span>: <span class="hljs-string">&quot;host.get&quot;</span>,<br>  <span class="hljs-string">&quot;params&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;host&quot;</span>: [<br>        <span class="hljs-string">&quot;172.18.0.109&quot;</span><br>     ]<br>   &#125;<br> &#125;,<br>  <span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;8b20c44282bc5ba5d70d24ffe2c0e467&quot;</span>,<br>  <span class="hljs-string">&quot;id&quot;</span>: 1<br>&#125;<span class="hljs-string">&#x27; http://172.31.0.101/zabbix/api_jsonrpc.php | python3 -m json.tool</span><br></code></pre></td></tr></table></figure>

<h3 id="7-2-2-API批量添加主机"><a href="#7-2-2-API批量添加主机" class="headerlink" title="7.2.2 API批量添加主机"></a>7.2.2 API批量添加主机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.通过脚本调用API快速添加：<br>root@zabbix-server:~<span class="hljs-comment"># cat zabbix-add-host.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><br>IP=<span class="hljs-string">&quot;</span><br><span class="hljs-string">172.31.100.105</span><br><span class="hljs-string">172.31.100.106</span><br><span class="hljs-string">172.31.100.107</span><br><span class="hljs-string">172.31.100.108</span><br><span class="hljs-string">&quot;</span><br><br><span class="hljs-keyword">for</span> node_ip <span class="hljs-keyword">in</span> <span class="hljs-variable">$&#123;IP&#125;</span>;<span class="hljs-keyword">do</span><br>curl -s -X POST -H <span class="hljs-string">&#x27;Content-Type:application/json&#x27;</span> -d <span class="hljs-string">&#x27;</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="hljs-string">  &quot;method&quot;: &quot;host.create&quot;,</span><br><span class="hljs-string">  &quot;params&quot;: &#123;</span><br><span class="hljs-string">     &quot;host&quot;: &quot;&#x27;</span><span class="hljs-variable">$&#123;node_ip&#125;</span><span class="hljs-string">&#x27;&quot;,</span><br><span class="hljs-string">     &quot;name&quot;: &quot;magedu-jiege-tomcat_&#x27;</span><span class="hljs-variable">$&#123;node_ip&#125;</span><span class="hljs-string">&#x27;&quot;,</span><br><span class="hljs-string">     &quot;proxy_hostid&quot;: &quot;10274&quot;,</span><br><span class="hljs-string">    &quot;interfaces&quot;: [</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">      &quot;type&quot;: 1,</span><br><span class="hljs-string">        &quot;main&quot;: 1,</span><br><span class="hljs-string">        &quot;useip&quot;: 1,</span><br><span class="hljs-string">        &quot;ip&quot;: &quot;&#x27;</span><span class="hljs-variable">$&#123;node_ip&#125;</span><span class="hljs-string">&#x27;&quot;,</span><br><span class="hljs-string">        &quot;dns&quot;: &quot;&quot;,</span><br><span class="hljs-string">        &quot;port&quot;: &quot;10050&quot;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    ],</span><br><span class="hljs-string">    &quot;groups&quot;: [</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        &quot;groupid&quot;: &quot;15&quot;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    ],</span><br><span class="hljs-string">    &quot;templates&quot;: [</span><br><span class="hljs-string">      &#123;</span><br><span class="hljs-string">        &quot;templateid&quot;: &quot;10270&quot;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">  &#125;,</span><br><span class="hljs-string">  &quot;auth&quot;: &quot;8b20c44282bc5ba5d70d24ffe2c0e467&quot;,</span><br><span class="hljs-string">  &quot;id&quot;: 1</span><br><span class="hljs-string">&#125;&#x27;</span> http://172.31.0.101/zabbix/api_jsonrpc.php | python3 -m json.tool<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>

<h2 id="7-3-Zabbix-动态发现主机"><a href="#7-3-Zabbix-动态发现主机" class="headerlink" title="7.3 Zabbix 动态发现主机"></a>7.3 Zabbix 动态发现主机</h2><p><a target="_blank" rel="noopener" href="http://blogs.studylinux.net/?p=705">http://blogs.studylinux.net/?p=705</a></p>
<p><strong>使用zabbix动态发现主机会比较消耗该主机的资源，所以不推荐</strong></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/linux-zabbix/">linux zabbix</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2021/09/02/%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AFdocker%EF%BC%88%E4%B8%80%EF%BC%89docker%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%9F%BA%E7%A1%80/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">企业级容器技术docker（一）docker介绍和基础</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2021/09/02/%E4%BC%81%E4%B8%9A%E7%BA%A7Web%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8TOMCAT/">
                        <span class="hidden-mobile">企业级Web应用服务器TOMCAT</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/blog/js/debouncer.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/blog/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/blog/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/blog/js/boot.js" ></script>



</body>
</html>
