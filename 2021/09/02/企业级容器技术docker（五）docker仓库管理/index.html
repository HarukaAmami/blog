

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="rlin">
  <meta name="keywords" content="">
  <title>企业级容器技术docker（五）docker仓库管理 - rlin的运维笔记</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/blog/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/blog/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"rintime.gitee.io","root":"/blog/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>rlin的运维笔记</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="企业级容器技术docker（五）docker仓库管理">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-09-02 14:27" pubdate>
        2021年9月2日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      10.6k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      176
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">企业级容器技术docker（五）docker仓库管理</h1>
            
            <div class="markdown-body">
              <h1 id="企业级容器技术docker"><a href="#企业级容器技术docker" class="headerlink" title="企业级容器技术docker"></a>企业级容器技术docker</h1><h1 id="五、-Docker-仓库管理"><a href="#五、-Docker-仓库管理" class="headerlink" title="五、 Docker 仓库管理"></a>五、 Docker 仓库管理</h1><p>Docker仓库，类似于yum仓库，是用来保存镜像的仓库。为了方便的管理和使用docker镜像,可以将镜像集中保存至Docker仓库中，将制作好的镜像push到仓库集中保存，在需要镜像时，从仓库中pull镜像即可。</p>
<p>Docker 仓库分为公有云仓库和私有云仓库</p>
<p>公有云仓库: 由互联网公司对外公开的仓库</p>
<ul>
<li>官方</li>
<li>阿里云等第三方仓库</li>
</ul>
<p>私有云仓库: 组织内部搭建的仓库，一般只为组织内部使用，常使用下面软件搭建仓库</p>
<ul>
<li>docker registory</li>
<li>docker harbor</li>
</ul>
<h2 id="5-1-官方-docker-仓库"><a href="#5-1-官方-docker-仓库" class="headerlink" title="5.1 官方 docker 仓库"></a>5.1 官方 docker 仓库</h2><p>将自制的镜像上传至docker仓库；</p>
<p><a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<h3 id="5-1-1-注册账户"><a href="#5-1-1-注册账户" class="headerlink" title="5.1.1 注册账户"></a>5.1.1 注册账户</h3><p>访问hub.docker.com注册账户，并登录</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker85.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker86.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker87.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker88.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker89.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-1-2-使用用户仓库管理镜像"><a href="#5-1-2-使用用户仓库管理镜像" class="headerlink" title="5.1.2 使用用户仓库管理镜像"></a>5.1.2 使用用户仓库管理镜像</h3><p>每个注册用户都可以上传和管理自已的镜像</p>
<h4 id="5-1-2-1-用户登录"><a href="#5-1-2-1-用户登录" class="headerlink" title="5.1.2.1 用户登录"></a>5.1.2.1 用户登录</h4><p>上传镜像前需要执行docker login命令登录，登录后生成~/.docker/config.json文件保存验证信息<br>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker login [OPTIONS] [SERVER]<br>选项: <br>-p, --password string  Password<br>  --password-stdin  Take the password from stdin<br>-u, --username string  Username<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#登录docker官方仓库方法1</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker login -u wangxiaochun -pP@ssw0rd! docker.io</span><br>WARNING! Using --password via the CLI is insecure. Use --password-stdin.<br>WARNING! Your password will be stored unencrypted <span class="hljs-keyword">in</span> /root/.docker/config.json.<br>Configure a credential helper to remove this warning. See<br>https://docs.docker.com/engine/reference/commandline/login/<span class="hljs-comment">#credentials-store</span><br>Login Succeeded<br><br><span class="hljs-comment">#登录docker官方仓库方法2</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker login</span><br>Login with your Docker ID to push and pull images from Docker Hub. If you don<span class="hljs-string">&#x27;t</span><br><span class="hljs-string">have a Docker ID, head over to https://hub.docker.com to create one.</span><br><span class="hljs-string">Username: wangxiaochun</span><br><span class="hljs-string">Password:</span><br><span class="hljs-string">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="hljs-string">Configure a credential helper to remove this warning. See</span><br><span class="hljs-string">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="hljs-string"></span><br><span class="hljs-string">Login Succeeded</span><br><span class="hljs-string">[root@ubuntu1804 ~]#</span><br><span class="hljs-string"></span><br><span class="hljs-string">#登录成功后,自动生成验证信息,下次会自动登录,而无需手动登录</span><br><span class="hljs-string">[root@ubuntu1804 ~]#cat .docker/config.json</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">	&quot;auths&quot;: &#123;</span><br><span class="hljs-string">		&quot;https://index.docker.io/v1/&quot;: &#123;</span><br><span class="hljs-string">			&quot;auth&quot;: &quot;YW5uYW1vY2h6dWtpOnpoYW5neGlhb2Zlbmc=&quot;</span><br><span class="hljs-string">		&#125;</span><br><span class="hljs-string">	&#125;,</span><br><span class="hljs-string">	&quot;HttpHeaders&quot;: &#123;</span><br><span class="hljs-string">		&quot;User-Agent&quot;: &quot;Docker-Client/19.03.10 (linux)&quot;</span><br><span class="hljs-string">	&#125;</span><br><span class="hljs-string">&#125;[root@ubuntu1804 ~]#</span><br></code></pre></td></tr></table></figure>

<h4 id="5-1-2-2-给本地镜像打标签"><a href="#5-1-2-2-给本地镜像打标签" class="headerlink" title="5.1.2.2 给本地镜像打标签"></a>5.1.2.2 给本地镜像打标签</h4><p>上传本地镜像前必须先给上传的镜像用docker tag 命令打标签</p>
<p>标签格式: docker.io/用户帐号/镜像名:TAG</p>
<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag alpine:3.11 docker.io/wangxiaochun/alpine:3.11-v1</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE<br>tomcat-web                      app1                55bbd45c9acd        3 days ago          871MB<br>tomcat-base                     v8.5.50             6d732ea15e7c        3 days ago          856MB<br>centos7-jdk                     8u212               de4845cfcae9        3 days ago          841MB<br>10.0.0.100:5000/centos7.7base   v1.0                6bbbcd079819        3 days ago          435MB<br>centos7.7base                   v1.0                6bbbcd079819        3 days ago          435MB<br>nginx-alpine                    1.16.1              d1c168824d23        3 days ago          212MB<br>nginx-ubuntu1804                1.16.1              f5d4e8278be8        4 days ago          386MB<br>alpine-base                     3.11                56909ecc9056        4 days ago          183MB<br>nginx                           latest              4f380adfc10f        11 days ago         133MB<br>ubuntu                          latest              9873176a8ff5        2 weeks ago         72.7MB<br>ubuntu                          18.04               7d0d8fa37224        2 weeks ago         63.1MB<br>alpine                          latest              d4ff818577bc        2 weeks ago         5.6MB<br>busybox                         latest              69593048aa3a        3 weeks ago         1.24MB<br>annamochzuki/alpine             3.11-v1             e389ae589224        2 months ago        5.62MB<br>alpine                          3.11                e389ae589224        2 months ago        5.62MB<br>centos                          latest              300e315adb2f        6 months ago        209MB<br>mysql                           5.7.30              9cfcce23593a        13 months ago       448MB<br>redis                           5.0.9-alpine3.11    3661c84ee9d0        14 months ago       29.8MB<br>centos                          centos7.7.1908      08d05d1d5859        20 months ago       204MB<br></code></pre></td></tr></table></figure>

<h4 id="5-1-2-3-上传本地镜像至官网"><a href="#5-1-2-3-上传本地镜像至官网" class="headerlink" title="5.1.2.3 上传本地镜像至官网"></a>5.1.2.3 上传本地镜像至官网</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#如tag省略,将上传指定REPOSITORY的所有版本,如下示例</span><br><span class="hljs-comment">#[root@ubuntu1804 ~]#docker push docker.io/wangxiaochun/alpine</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker push docker.io/wangxiaochun/alpine:3.11-v1</span><br>The push refers to repository [docker.io/wangxiaochun/alpine]<br>5216338b40a7: Mounted from wanglinux/alpine-base<br>3.11-v1: digest:sha256:ddba4d27a7ffc3f86dd6c2f92041af252a1f23a8e742c90e6e1297bfa1bc0c45 size:528<br></code></pre></td></tr></table></figure>

<h4 id="5-1-2-4-在官网验证上传的镜像"><a href="#5-1-2-4-在官网验证上传的镜像" class="headerlink" title="5.1.2.4 在官网验证上传的镜像"></a>5.1.2.4 在官网验证上传的镜像</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker90.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker91.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker92.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-1-2-5-下载上传的镜像并创建容器"><a href="#5-1-2-5-下载上传的镜像并创建容器" class="headerlink" title="5.1.2.5 下载上传的镜像并创建容器"></a>5.1.2.5 下载上传的镜像并创建容器</h4><p>在另一台主机上下载镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#docker pull wangxiaochun/alpine:3.11-v1</span><br>3.11-v1: Pulling from wangxiaochun/alpine<br>c9b1b535fdd9: Already exists<br>Digest: sha256:ddba4d27a7ffc3f86dd6c2f92041af252a1f23a8e742c90e6e1297bfa1bc0c45<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> wangxiaochun/alpine:3.11-v1<br>docker.io/wangxiaochun/alpine:3.11-v1<br>[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY       TAG         IMAGE ID      CREATED    <br>  SIZE<br>wangxiaochun/alpine   3.11-v1       e7d92cdc71fe     12 days ago  <br>  5.59MB<br>[root@centos7 ~]<span class="hljs-comment">#docker run -it --rm wangxiaochun/alpine:3.11-v1 sh</span><br>/ <span class="hljs-comment"># cat /etc/issue</span><br>Welcome to Alpine Linux 3.11<br>Kernel \r on an \m (\l)<br>/ <span class="hljs-comment"># du -sh /</span><br>5.6M /<br>/ <span class="hljs-comment"># exit</span><br>[root@centos7 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h3 id="5-1-3-使用组织管理镜像"><a href="#5-1-3-使用组织管理镜像" class="headerlink" title="5.1.3 使用组织管理镜像"></a>5.1.3 使用组织管理镜像</h3><p>组织类似于名称空间，每个组织的名称全网站唯一，一个组织可以有多个用户帐户使用，并且可以指定不同用户对组织内的仓库不同的权限</p>
<p>三种不同权限</p>
<ul>
<li>Read-only: Pull and view repository details and builds</li>
<li>Read &amp;Write: Pull, push, and view a repository; view, cancel, retry or trigger builds</li>
<li>Admin: Pull, push, view, edit, and delete a repository; edit build settings; update the repository description</li>
</ul>
<h4 id="5-1-3-1-创建组织"><a href="#5-1-3-1-创建组织" class="headerlink" title="5.1.3.1 创建组织"></a>5.1.3.1 创建组织</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker93.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker94.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker95.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-1-3-2-创建组织内的团队，并分配权限"><a href="#5-1-3-2-创建组织内的团队，并分配权限" class="headerlink" title="5.1.3.2 创建组织内的团队，并分配权限"></a>5.1.3.2 创建组织内的团队，并分配权限</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker96.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker97.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker98.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-1-3-3-上传镜像前登录帐号"><a href="#5-1-3-3-上传镜像前登录帐号" class="headerlink" title="5.1.3.3 上传镜像前登录帐号"></a>5.1.3.3 上传镜像前登录帐号</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker login docker.io</span><br>Login with your Docker ID to push and pull images from Docker Hub. If you don<span class="hljs-string">&#x27;t</span><br><span class="hljs-string">have a Docker ID, head over to https://hub.docker.com to create one.</span><br><span class="hljs-string">Username: wangxiaochun</span><br><span class="hljs-string">Password:</span><br><span class="hljs-string">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="hljs-string">Configure a credential helper to remove this warning. See</span><br><span class="hljs-string">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="hljs-string"></span><br><span class="hljs-string">Login Succeeded</span><br><span class="hljs-string">[root@ubuntu1804 ~]#cat .docker/config.json</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">&quot;auths&quot;: &#123;</span><br><span class="hljs-string">&quot;https://index.docker.io/v1/&quot;: &#123;</span><br><span class="hljs-string">&quot;auth&quot;: &quot;d2FuZ3hpYW9jaHVuOmxidG9vdGgwNjE4&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;,</span><br><span class="hljs-string">&quot;HttpHeaders&quot;: &#123;</span><br><span class="hljs-string">&quot;User-Agent&quot;: &quot;Docker-Client/19.03.5 (linux)&quot;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;[root@ubuntu1804 ~]#</span><br></code></pre></td></tr></table></figure>

<h4 id="5-1-3-4-给本地镜像打标签"><a href="#5-1-3-4-给本地镜像打标签" class="headerlink" title="5.1.3.4 给本地镜像打标签"></a>5.1.3.4 给本地镜像打标签</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag alpine-base:3.11 docker.io/wanglinux/alpine-base:3.11</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY       TAG         IMAGE ID      CREATED    <br>  SIZE<br>haproxy-centos7     2.1.2        5eccdb29a058     4 hours ago  <br>  428MB<br>nginx-ubuntu1804     1.16.1       19efdd23ac87     18 hours ago  <br> 378MB<br>nginx-alpine       1.16.1       978a43bbb61d     19 hours ago  <br> 211MB<br>alpine-base       3.11        b162eecf4da9     20 hours ago  <br> 182MB<br> wanglinux/alpine-base  3.11        b162eecf4da9     20 hours ago  <br> 182MB<br>tomcat-web       app2        0e1760fe79a6     40 hours ago  <br> 838MB<br>tomcat-web       app1        76016219a0ca     40 hours ago  <br> 838MB<br>tomcat-base       v8.5.50       8d5395cb72c4     41 hours ago  <br> 824MB<br>centos7-jdk       8u212        e0fe770a7ccd     42 hours ago  <br> 809MB<br>centos7-base      v1         34ab3afcd3b3     43 hours ago  <br> 403MB<br>alpine          3.11        e7d92cdc71fe     12 days ago  <br>  5.59MB<br>alpine         latest       e7d92cdc71fe     12 days ago  <br>  5.59MB<br>wangxiaochun/alpine   3.11-v1       e7d92cdc71fe     12 days ago  <br>  5.59MB<br>ubuntu          18.04        ccc6e87d482b     2 weeks ago  <br>  64.2MB<br>ubuntu         bionic       ccc6e87d482b     2 weeks ago  <br>  64.2MB<br>centos         centos7.7.1908   08d05d1d5859     2 months ago  <br> 204MB<br></code></pre></td></tr></table></figure>

<h4 id="5-1-3-5-上传镜像到指定的组织"><a href="#5-1-3-5-上传镜像到指定的组织" class="headerlink" title="5.1.3.5 上传镜像到指定的组织"></a>5.1.3.5 上传镜像到指定的组织</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker push docker.io/wanglinux/alpine-base:3.11</span><br>The push refers to repository [docker.io/wanglinux/alpine-base]<br>1783f0912dfb: Pushed<br>1e5e8d5ab333: Pushed<br>5216338b40a7: Mounted from library/alpine<br>3.11: digest:<br>sha256:7931fed46d377698dacb194d46017c53bc24f2e9ee41e893e6900c07d1153536 size:<br>947<br></code></pre></td></tr></table></figure>

<h4 id="5-1-3-6-在网站看查看上传的镜像"><a href="#5-1-3-6-在网站看查看上传的镜像" class="headerlink" title="5.1.3.6 在网站看查看上传的镜像"></a>5.1.3.6 在网站看查看上传的镜像</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker99.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker100.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker101.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-1-3-7-下载上传的镜像并运行容器"><a href="#5-1-3-7-下载上传的镜像并运行容器" class="headerlink" title="5.1.3.7 下载上传的镜像并运行容器"></a>5.1.3.7 下载上传的镜像并运行容器</h4><p>在另一台主机上下载镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>[root@centos7 ~]<span class="hljs-comment">#docker pull wanglinux/alpine-base:3.11</span><br>3.11: Pulling from wanglinux/alpine-base<br>c9b1b535fdd9: Pull complete<br>327af1e87fd8: Pull complete<br>d88818b49372: Pull complete<br>Digest: sha256:7931fed46d377698dacb194d46017c53bc24f2e9ee41e893e6900c07d1153536<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> wanglinux/alpine-base:3.11<br>docker.io/wanglinux/alpine-base:3.11<br><br>[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY       TAG         IMAGE ID      CREATED    <br>  SIZE<br>wanglinux/alpine-base  3.11        b162eecf4da9     20 hours ago  <br> 182MB<br>[root@centos7 ~]<span class="hljs-comment">#docker run -it --rm wanglinux/alpine-base:3.11 sh</span><br>/ <span class="hljs-comment"># cat /etc/issue</span><br>Welcome to Alpine Linux 3.11<br>Kernel \r on an \m (\l)<br>/ <span class="hljs-comment"># du -sh /</span><br>190.1M /<br>/ <span class="hljs-comment"># exit</span><br></code></pre></td></tr></table></figure>

<h2 id="5-2-阿里云Docker仓库"><a href="#5-2-阿里云Docker仓库" class="headerlink" title="5.2 阿里云Docker仓库"></a>5.2 阿里云Docker仓库</h2><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker102.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-2-1-注册和登录阿里云仓库"><a href="#5-2-1-注册和登录阿里云仓库" class="headerlink" title="5.2.1 注册和登录阿里云仓库"></a>5.2.1 注册和登录阿里云仓库</h3><p>用浏览器访问<a target="_blank" rel="noopener" href="http://cr.console.aliyun.com,输入注册的用户信息登录网站/">http://cr.console.aliyun.com，输入注册的用户信息登录网站</a></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker103.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker104.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-2-2-设置仓库专用管理密码"><a href="#5-2-2-设置仓库专用管理密码" class="headerlink" title="5.2.2 设置仓库专用管理密码"></a>5.2.2 设置仓库专用管理密码</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker105.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker106.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker107.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-2-3-创建仓库"><a href="#5-2-3-创建仓库" class="headerlink" title="5.2.3 创建仓库"></a>5.2.3 创建仓库</h3><p><strong>此步可不事先执行，docker push 时可以自动创建私有仓库</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker108.png" srcset="/blog/img/loading.gif" alt="docker"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker109.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker110.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker111.png" srcset="/blog/img/loading.gif"></p>
<p><strong>查看仓库的路径用于上传镜像使用</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker112.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-2-4-上传镜像前先登录阿里云"><a href="#5-2-4-上传镜像前先登录阿里云" class="headerlink" title="5.2.4 上传镜像前先登录阿里云"></a>5.2.4 上传镜像前先登录阿里云</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#用前面设置的专用仓库管理密码登录</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker login --username=29308620@qq.com registry.cn-beijing.aliyuncs.com</span><br>Password:<br>WARNING! Your password will be stored unencrypted <span class="hljs-keyword">in</span> /root/.docker/config.json.<br>Configure a credential helper to remove this warning. See<br>https://docs.docker.com/engine/reference/commandline/login/<span class="hljs-comment">#credentials-store</span><br>Login Succeeded<br><br><span class="hljs-comment">#登录密码保存在~/.docker/config.json文件中，下次将不会需要再输入密码登录</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat .docker/config.json</span><br>&#123;<br><span class="hljs-string">&quot;auths&quot;</span>: &#123;<br><span class="hljs-string">&quot;https://index.docker.io/v1/&quot;</span>: &#123;<br><span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;d2FuZ3hpYW9jaHVuOmxidG9vdGgwNjE4&quot;</span><br>&#125;,<br><span class="hljs-string">&quot;registry.cn-beijing.aliyuncs.com&quot;</span>: &#123;<br><span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;MjkzMDg2MjBAcXEuY29tOmxidG9vdGgwNjE4&quot;</span><br>&#125;<br>&#125;,<br><span class="hljs-string">&quot;HttpHeaders&quot;</span>: &#123;<br><span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Docker-Client/19.03.5 (linux)&quot;</span><br>&#125;<br>&#125;[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h3 id="5-2-5-给上传的镜像打标签"><a href="#5-2-5-给上传的镜像打标签" class="headerlink" title="5.2.5 给上传的镜像打标签"></a>5.2.5 给上传的镜像打标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag alpine-base:3.11 registry.cn-beijing.aliyuncs.com/wangxiaochun/alpine:3.11-v1</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag centos7-base:v1 registry.cn-beijing.aliyuncs.com/wangxiaochun/centos7-base:v1</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY                          TAG        <br>IMAGE ID      CREATED       SIZE<br>haproxy-centos7                        2.1.2       <br>5eccdb29a058     6 hours ago     428MB<br>nginx-ubuntu1804                       1.16.1      <br>19efdd23ac87     21 hours ago    378MB<br>nginx-alpine                         1.16.1      <br>978a43bbb61d     22 hours ago    211MB<br>alpine-base                          3.11       <br>b162eecf4da9     23 hours ago    182MB<br>wanglinux/alpine-base                     3.11       <br>b162eecf4da9     23 hours ago    182MB<br>registry.cn-beijing.aliyuncs.com/wangxiaochun/alpine     3.11-v1      <br>b162eecf4da9     23 hours ago    182MB<br>tomcat-web                          app2       <br>0e1760fe79a6     43 hours ago    838MB<br>tomcat-web                          app1       <br>76016219a0ca     43 hours ago    838MB<br>tomcat-base                         v8.5.50      <br>8d5395cb72c4     44 hours ago    824MB<br>centos7-jdk                         8u212       <br>e0fe770a7ccd     45 hours ago    809MB<br>centos7-base                         v1        <br>34ab3afcd3b3     46 hours ago    403MB<br>registry.cn-beijing.aliyuncs.com/wangxiaochun/centos7-base  v1        <br>34ab3afcd3b3     46 hours ago    403MB<br>alpine                            3.11       <br>e7d92cdc71fe     12 days ago     5.59MB<br>alpine                            latest      <br>e7d92cdc71fe     12 days ago     5.59MB<br>wangxiaochun/alpine                      3.11-v1      <br>e7d92cdc71fe     12 days ago     5.59MB<br>ubuntu                            18.04       <br>ccc6e87d482b     2 weeks ago     64.2MB<br>ubuntu                            bionic      <br>ccc6e87d482b     2 weeks ago     64.2MB<br>centos                            centos7.7.1908  <br>08d05d1d5859     2 months ago    204MB<br></code></pre></td></tr></table></figure>

<h3 id="5-2-6-上传镜像至阿里云"><a href="#5-2-6-上传镜像至阿里云" class="headerlink" title="5.2.6 上传镜像至阿里云"></a>5.2.6 上传镜像至阿里云</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment"># docker push registry.cn-</span><br>beijing.aliyuncs.com/wangxiaochun/alpine:3.11-v1<br>The push refers to repository [registry.cn-<br>beijing.aliyuncs.com/wangxiaochun/alpine]<br>1783f0912dfb: Pushed<br>1e5e8d5ab333: Pushed<br>5216338b40a7: Pushed<br>3.11-v1: digest:<br>sha256:7931fed46d377698dacb194d46017c53bc24f2e9ee41e893e6900c07d1153536 size:<br>947<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker push registry.cn-beijing.aliyuncs.com/wangxiaochun/centos7-base:v1</span><br>The push refers to repository [registry.cn-<br>beijing.aliyuncs.com/wangxiaochun/centos7-base]<br>2073413aebd6: Pushed<br>6ec9af97c369: Pushed<br>034f282942cd: Pushed<br>v1: digest:<br>sha256:02cd943f2569c7c55f08a979fd9661f1fd7893c424bca7b343188654ba63d98d size:<br>949<br></code></pre></td></tr></table></figure>

<h3 id="5-2-7-在网站查看上传的镜像"><a href="#5-2-7-在网站查看上传的镜像" class="headerlink" title="5.2.7 在网站查看上传的镜像"></a>5.2.7 在网站查看上传的镜像</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker176.png" srcset="/blog/img/loading.gif" alt="docker"></p>
<h3 id="5-2-8-从另一台主机上下载刚上传的镜像并运行容器"><a href="#5-2-8-从另一台主机上下载刚上传的镜像并运行容器" class="headerlink" title="5.2.8 从另一台主机上下载刚上传的镜像并运行容器"></a>5.2.8 从另一台主机上下载刚上传的镜像并运行容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>[root@centos7 ~]<span class="hljs-comment"># docker pull registry.cn-beijing.aliyuncs.com/wangxiaochun/alpine:3.11-v1</span><br>3.11-v1: Pulling from wangxiaochun/alpine<br>c9b1b535fdd9: Pull complete<br>327af1e87fd8: Pull complete<br>88818b49372: Pull complete<br>Digest: sha256:7931fed46d377698dacb194d46017c53bc24f2e9ee41e893e6900c07d1153536<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> registry.cn-<br>beijing.aliyuncs.com/wangxiaochun/alpine:3.11-v1<br>registry.cn-beijing.aliyuncs.com/wangxiaochun/alpine:3.11-v1<br>[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY                       TAG         IMAGE<br>ID      CREATED       SIZE<br>registry.cn-beijing.aliyuncs.com/wangxiaochun/alpine  3.11-v1      <br>b162eecf4da9     22 hours ago    182MB<br>[root@centos7 ~]<span class="hljs-comment">#docker run -it --rm b162eecf4da9 sh</span><br>/ <span class="hljs-comment"># cat /etc/issue</span><br>Welcome to Alpine Linux 3.11<br>Kernel \r on an \m (\l)<br><br>/ <span class="hljs-comment"># du -sh /</span><br>190.1M /<br>/ <span class="hljs-comment"># exit</span><br>[root@centos7 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED      <br>STATUS       PORTS        NAMES<br>[root@centos7 ~]<span class="hljs-comment">#</span><br><br><span class="hljs-comment">#上传的centos7-base:v1为私有镜像，需要登录才能下载</span><br>[root@centos7 ~]<span class="hljs-comment">#docker pull registry.cn-</span><br>beijing.aliyuncs.com/wangxiaochun/centos7-base:v1<br>Error response from daemon: pull access denied <span class="hljs-keyword">for</span> registry.cn-<br>beijing.aliyuncs.com/wangxiaochun/centos7-base, repository does not exist or may<br>require <span class="hljs-string">&#x27;docker login&#x27;</span>: denied: requested access to the resource is denied<br>[root@centos7 ~]<span class="hljs-comment">#docker login registry.cn-beijing.aliyuncs.com</span><br>Username: lbtooth<br>Password:<br>WARNING! Your password will be stored unencrypted <span class="hljs-keyword">in</span> /root/.docker/config.json.<br>Configure a credential helper to remove this warning. See<br>https://docs.docker.com/engine/reference/commandline/login/<span class="hljs-comment">#credentials-store</span><br><br>Login Succeeded<br>[root@centos7 ~]<span class="hljs-comment">#cat .docker/config.json</span><br>&#123;<br><span class="hljs-string">&quot;auths&quot;</span>: &#123;<br><span class="hljs-string">&quot;registry.cn-beijing.aliyuncs.com&quot;</span>: &#123;<br><span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;bGJ0b290aDpsYnRvb3RoMDYxOA==&quot;</span><br>&#125;<br>&#125;,<br><span class="hljs-string">&quot;HttpHeaders&quot;</span>: &#123;<br><span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Docker-Client/19.03.5 (linux)&quot;</span><br>&#125;<br>&#125;[root@centos7 ~]<span class="hljs-comment">#</span><br><br>[root@centos7 ~]<span class="hljs-comment">#docker pull registry.cn-</span><br>beijing.aliyuncs.com/wangxiaochun/centos7-base:v1<br>v1: Pulling from wangxiaochun/centos7-base<br>f34b00c7da20: Pull complete<br>544476d462f7: Pull complete<br>39345915aa1b: Pull complete<br>Digest: sha256:02cd943f2569c7c55f08a979fd9661f1fd7893c424bca7b343188654ba63d98d<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> registry.cn-<br>beijing.aliyuncs.com/wangxiaochun/centos7-base:v1<br>registry.cn-beijing.aliyuncs.com/wangxiaochun/centos7-base:v1<br>[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY                          TAG        <br>IMAGE ID      CREATED       SIZE<br>registry.cn-beijing.aliyuncs.com/wangxiaochun/alpine     3.11-v1      <br>b162eecf4da9     23 hours ago    182MB<br>registry.cn-beijing.aliyuncs.com/wangxiaochun/centos7-base  v1        <br>34ab3afcd3b3     46 hours ago    403MB<br>[root@centos7 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h2 id="5-3-私有云单机仓库Docker-Registry（工作中不用）"><a href="#5-3-私有云单机仓库Docker-Registry（工作中不用）" class="headerlink" title="5.3 私有云单机仓库Docker Registry（工作中不用）"></a>5.3 私有云单机仓库Docker Registry（工作中不用）</h2><h3 id="5-3-1-Docker-Registry-介绍"><a href="#5-3-1-Docker-Registry-介绍" class="headerlink" title="5.3.1 Docker Registry 介绍"></a>5.3.1 Docker Registry 介绍</h3><p>Docker Registry作为Docker的核心组件之一负责单主机的镜像内容的存储与分发，客户端的docker pull以及push命令都将直接与registry进行交互,最初版本的registry 由Python实现，由于设计初期在安全性，性能以及API的设计上有着诸多的缺陷，该版本在0.9之后停止了开发，由新项目distribution（新的docker register被称为Distribution）来重新设计并开发下一代registry，新的项目由go语言开发，所有的API，底层存储方式，系统架构都进行了全面的重新设计已解决上一代registry中存在的问题，2016年4月份registry 2.0正式发布，docker 1.6版本开始支持registry 2.0，而八月份随着docker 1.8 发布，docker hub正式启用2.1版本registry全面替代之前版本 registry，新版registry对镜像存储格式进行了重新设计并和旧版不兼容，docker 1.5和之前的版本无法读取2.0的镜像，另外，Registry 2.4版本之后支持了回收站机制，也就是可以删除镜像了，在2.4版本之前是无法支持删除镜像的，所以如果你要使用最好是大于Registry 2.4版本的</p>
<p>官方文档地址: <a target="_blank" rel="noopener" href="https://docs.docker.com/registry/">https://docs.docker.com/registry/</a></p>
<p>官方github 地址: <a target="_blank" rel="noopener" href="https://github.com/docker/distribution">https://github.com/docker/distribution</a></p>
<p>官方部署文档: <a target="_blank" rel="noopener" href="https://github.com/docker/docker.github.io/blob/master/registry/deploying.md">https://github.com/docker/docker.github.io/blob/master/registry/deploying.md</a></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker113.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker114.png" srcset="/blog/img/loading.gif"></p>
<p>以下介绍通过官方提供的docker registry 镜像来简单搭建本地私有仓库环境</p>
<p>环境: 三台主机</p>
<p>10.0.0.100: 充当registry仓库服务器</p>
<p>10.0.0.101: 上传镜像</p>
<p>10.0.0.102: 下载镜像</p>
<h3 id="5-3-2-下载-docker-registry-镜像"><a href="#5-3-2-下载-docker-registry-镜像" class="headerlink" title="5.3.2 下载 docker registry 镜像"></a>5.3.2 下载 docker registry 镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull registry:2.7.1</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br>registry            2.7.1               1fd8e1b0bb7e        2 months ago        26.2MB<br></code></pre></td></tr></table></figure>

<h3 id="5-3-3-搭建单机仓库"><a href="#5-3-3-搭建单机仓库" class="headerlink" title="5.3.3 搭建单机仓库"></a>5.3.3 搭建单机仓库</h3><h4 id="5-3-2-1-创建授权用户密码使用目录"><a href="#5-3-2-1-创建授权用户密码使用目录" class="headerlink" title="5.3.2.1 创建授权用户密码使用目录"></a>5.3.2.1 创建授权用户密码使用目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#mkdir -p /etc/docker/auth</span><br></code></pre></td></tr></table></figure>

<h4 id="5-3-2-2-创建授权的registry用户和密码"><a href="#5-3-2-2-创建授权的registry用户和密码" class="headerlink" title="5.3.2.2 创建授权的registry用户和密码"></a>5.3.2.2 创建授权的registry用户和密码</h4><p>创建registry用户，用于上传和下载镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#apt -y install apache2</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#htpasswd -Bbn rlin 123456 &gt; /etc/docker/auth/registry</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat /etc/docker/auth/registry</span><br>rlin:$2y$05<span class="hljs-variable">$nlRIIYEUBTSLdN2PkzodUue4ry7X</span>/UyscpkkEufTDhEdI8nsyJMR6<br><br><span class="hljs-comment">#[root@ubuntu1804 ~]#docker run --entrypoint htpasswd registry:2.7.1 -Bbn wang 123456 &gt; /etc/docker/auth/registry</span><br></code></pre></td></tr></table></figure>

<h4 id="5-3-2-3-启动docker-registry-容器"><a href="#5-3-2-3-启动docker-registry-容器" class="headerlink" title="5.3.2.3 启动docker registry 容器"></a>5.3.2.3 启动docker registry 容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment"># docker run -d -p 5000:5000 --restart=always --name registry -v /etc/docker/auth:/auth -e &quot;REGISTRY_AUTH=htpasswd&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot; -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/registry registry:2.7.1</span><br>998f970dd8ca6b98002f20ae27330fe607ca78f35bedcc8a6180688e48a907a7<br></code></pre></td></tr></table></figure>

<h4 id="5-3-2-4-验证端口和容器"><a href="#5-3-2-4-验证端口和容器" class="headerlink" title="5.3.2.4 验证端口和容器"></a>5.3.2.4 验证端口和容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES<br>e29731e4f39d        registry:2.7.1      <span class="hljs-string">&quot;/entrypoint.sh /etc…&quot;</span>   10 seconds ago      Up 7 seconds        0.0.0.0:5000-&gt;5000/tcp   registry<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ss -ntl</span><br>State  Recv-Q  Send-Q   Local Address:Port   Peer Address:Port     <br>LISTEN  0     64         0.0.0.0:2049      0.0.0.0:*      <br>LISTEN  0     128        0.0.0.0:48131     0.0.0.0:*      <br>LISTEN  0     128        0.0.0.0:33835     0.0.0.0:*      <br>LISTEN  0     128        0.0.0.0:58029     0.0.0.0:*      <br>LISTEN  0     128        0.0.0.0:111      0.0.0.0:*      <br>LISTEN  0     128     127.0.0.53%lo:53       0.0.0.0:*      <br>LISTEN  0     128        0.0.0.0:22       0.0.0.0:*      <br>LISTEN  0     64         0.0.0.0:46429     0.0.0.0:*      <br>LISTEN  0     128       127.0.0.1:6014      0.0.0.0:*      <br>LISTEN  0     64          [::]:2049       [::]:*      <br>LISTEN  0     128           *:5000        *:*      <br>LISTEN  0     128         [::]:39471      [::]:*      <br>LISTEN  0     128         [::]:111       [::]:*      <br>LISTEN  0     64          [::]:43601      [::]:*      <br>LISTEN  0     128         [::]:56725      [::]:*      <br>LISTEN  0     128         [::]:22        [::]:*      <br>LISTEN  0     128         [::]:57881      [::]:*      <br>LISTEN  0     128         [::1]:6014       [::]:* <br></code></pre></td></tr></table></figure>

<h3 id="5-3-4-登录仓库"><a href="#5-3-4-登录仓库" class="headerlink" title="5.3.4 登录仓库"></a>5.3.4 登录仓库</h3><h4 id="5-3-4-1-直接登录报错"><a href="#5-3-4-1-直接登录报错" class="headerlink" title="5.3.4.1 直接登录报错"></a>5.3.4.1 直接登录报错</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#docker login 默认使用https登录,而docker registry为http,所以默认登录失败</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker login 10.0.0.100:5000</span><br>Username: rlin<br>Password:<br>Error response from daemon: Get https://10.0.0.100:500/v2/: dial tcp<br>10.0.0.100:500: connect: connection refused<br></code></pre></td></tr></table></figure>

<h4 id="5-3-4-2-将registry仓库服务器地址加入service-单元文件"><a href="#5-3-4-2-将registry仓库服务器地址加入service-单元文件" class="headerlink" title="5.3.4.2 将registry仓库服务器地址加入service 单元文件"></a>5.3.4.2 将registry仓库服务器地址加入service 单元文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#修改配置让docker login支持http协议（在哪里登录就在那里修改）</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /lib/systemd/system/docker.service</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#grep ExecStart /lib/systemd/system/docker.service</span><br>ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --insecure-registry 10.0.0.100:5000<br><br><span class="hljs-comment">#或者修改下面文件，这种方法或许没用</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /etc/docker/daemon.json</span><br>&#123;<br> <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://si7y70hh.mirror.aliyuncs.com&quot;</span>],<br> <span class="hljs-string">&quot;insecure-registry&quot;</span>: [<span class="hljs-string">&quot;10.0.0.100:5000&quot;</span>]<br>&#125;<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl daemon-reload</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl restart docker</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ps aux|grep dockerd</span><br>root    2092  1.3  8.4 757088 83056 ?    Ssl  19:19  0:00<br>/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --insecure-registry 10.0.0.100:5000<br>root    2233  0.0  0.1  14428  1012 pts/0  S+  19:20  0:00 grep --color=auto dockerd<br></code></pre></td></tr></table></figure>

<h4 id="5-3-4-3-再次登录验证成功"><a href="#5-3-4-3-再次登录验证成功" class="headerlink" title="5.3.4.3 再次登录验证成功"></a>5.3.4.3 再次登录验证成功</h4><p>在10.0.0.101主机上执行下面登录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker login 10.0.0.100:5000</span><br>Username: rlin<br>Password:<br>WARNING! Your password will be stored unencrypted <span class="hljs-keyword">in</span> /root/.docker/config.json.<br>Configure a credential helper to remove this warning. See<br>https://docs.docker.com/engine/reference/commandline/login/<span class="hljs-comment">#credentials-store</span><br><br>Login Succeeded<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h3 id="5-3-5-打标签并上传镜像"><a href="#5-3-5-打标签并上传镜像" class="headerlink" title="5.3.5 打标签并上传镜像"></a>5.3.5 打标签并上传镜像</h3><p>在10.0.0.101主机上执行打标签上传</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag centos7.7base:v1.0 10.0.0.100:5000/centos7.7base:v1.0</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker push 10.0.0.100:5000/centos7.7base:v1.0</span><br>The push refers to repository [10.0.0.100:5000/centos7.7base]<br>184547f446ed: Pushed <br>50653e822bee: Pushed <br>034f282942cd: Pushed <br>v1.0: digest: sha256:172901f3d55b51c6ee62869221ccfe4299f67199302318446e9e9721175aaeb0 size: 949<br></code></pre></td></tr></table></figure>

<h3 id="5-3-6-下载镜像并启动容器"><a href="#5-3-6-下载镜像并启动容器" class="headerlink" title="5.3.6 下载镜像并启动容器"></a>5.3.6 下载镜像并启动容器</h3><p>在10.0.0.102主机上下载镜像并启动容器</p>
<h4 id="5-3-6-1-先修改docker的service-文件"><a href="#5-3-6-1-先修改docker的service-文件" class="headerlink" title="5.3.6.1 先修改docker的service 文件"></a>5.3.6.1 先修改docker的service 文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#vim /lib/systemd/system/docker.service</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#grep ExecStart /lib/systemd/system/docker.service</span><br>ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --insecure-registry 10.0.0.100:5000<br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl daemon-reload</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl restart docker</span><br></code></pre></td></tr></table></figure>

<h4 id="5-3-6-2-登录registry仓库服务器"><a href="#5-3-6-2-登录registry仓库服务器" class="headerlink" title="5.3.6.2 登录registry仓库服务器"></a>5.3.6.2 登录registry仓库服务器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker login 10.0.0.100:5000</span><br>Username: rlin<br>Password: <br>WARNING! Your password will be stored unencrypted <span class="hljs-keyword">in</span> /root/.docker/config.json.<br>Configure a credential helper to remove this warning. See<br>https://docs.docker.com/engine/reference/commandline/login/<span class="hljs-comment">#credentials-store</span><br><br>Login Succeeded<br></code></pre></td></tr></table></figure>

<h4 id="5-3-6-3-下载镜像并启动容器"><a href="#5-3-6-3-下载镜像并启动容器" class="headerlink" title="5.3.6.3 下载镜像并启动容器"></a>5.3.6.3 下载镜像并启动容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker pull 10.0.0.100:5000/centos7.7base:v1.0</span><br>v1.0: Pulling from centos7.7base<br>f34b00c7da20: Pull complete <br>b84a771c640b: Pull complete <br>f70812951fbe: Pull complete <br>Digest: sha256:172901f3d55b51c6ee62869221ccfe4299f67199302318446e9e9721175aaeb0<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> 10.0.0.100:5000/centos7.7base:v1.0<br>10.0.0.100:5000/centos7.7base:v1.0<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE<br>10.0.0.100:5000/centos7.7base   v1.0                6bbbcd079819        3 days ago          435MB<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker run -it --rm 6bbbcd079819 bash</span><br>[root@2bcb26b1b568 /]<span class="hljs-comment"># cat /etc/redhat-release</span><br>CentOS Linux release 7.7.1908 (Core)<br>[root@2bcb26b1b568 /]<span class="hljs-comment"># exit</span><br><span class="hljs-built_in">exit</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID    IMAGE        COMMAND       CREATED      STATUS       PORTS        NAMES<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h2 id="5-4-Docker-之分布式仓库-Harbor"><a href="#5-4-Docker-之分布式仓库-Harbor" class="headerlink" title="5.4 Docker 之分布式仓库 Harbor"></a>5.4 Docker 之分布式仓库 Harbor</h2><h3 id="5-4-1-Harbor-介绍和架构"><a href="#5-4-1-Harbor-介绍和架构" class="headerlink" title="5.4.1 Harbor 介绍和架构"></a>5.4.1 Harbor 介绍和架构</h3><h4 id="5-4-1-1-Harbor-介绍"><a href="#5-4-1-1-Harbor-介绍" class="headerlink" title="5.4.1.1 Harbor 介绍"></a>5.4.1.1 Harbor 介绍</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker115.png" srcset="/blog/img/loading.gif"></p>
<p>Harbor是一个用于存储和分发Docker镜像的企业级Registry服务器，由VMware开源，其通过添加一些企业必需的功能特性，例如安全、标识和管理等，扩展了开源 Docker Distribution。作为一个企业级私有Registry服务器，Harbor 提供了更好的性能和安全。提升用户使用Registry构建和运行环境传输镜像的效率。</p>
<p>Harbor支持安装在多个Registry节点的镜像资源复制，镜像全部保存在私有 Registry 中，确保数据和知识产权在公司内部网络中管控，另外，Harbor也提供了高级的安全特性，诸如用户管理，访问控制和活动审计等</p>
<p>vmware 官方开源服务: <a target="_blank" rel="noopener" href="https://vmware.github.io/">https://vmware.github.io/</a></p>
<p>harbor 官方github 地址: <a target="_blank" rel="noopener" href="https://github.com/vmware/harbor">https://github.com/vmware/harbor</a></p>
<p>harbor 官方网址: <a target="_blank" rel="noopener" href="https://goharbor.io/">https://goharbor.io/</a></p>
<p>harbor 官方文档: <a target="_blank" rel="noopener" href="https://goharbor.io/docs/">https://goharbor.io/docs/</a></p>
<p>github文档: <a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/tree/master/docs">https://github.com/goharbor/harbor/tree/master/docs</a></p>
<h4 id="5-4-1-2-Harbor功能官方介绍"><a href="#5-4-1-2-Harbor功能官方介绍" class="headerlink" title="5.4.1.2 Harbor功能官方介绍"></a>5.4.1.2 Harbor功能官方介绍</h4><ul>
<li>基于角色的访问控制: 用户与Docker镜像仓库通过“项目”进行组织管理，一个用户可以对多个镜像仓库在同一命名空间（project）里有不同的权限</li>
<li>镜像复制: 镜像可在多个Registry实例中复制（同步）。尤其适合于负载均衡，高可用，混合云和多云的场景</li>
<li>图形化用户界面: 用户可以通过浏览器来浏览，检索当前Docker镜像仓库，管理项目和命名空间</li>
<li>AD/LDAP 支: Harbor可以集成企业内部已有的AD/LDAP，用于鉴权认证管理</li>
<li>审计管理: 所有针对镜像仓库的操作都可以被记录追溯，用于审计管理</li>
<li>国际化: 已拥有英文、中文、德文、日文和俄文的本地化版本。更多的语言将会添加进来</li>
<li>RESTful API: 提供给管理员对于Harbor更多的操控, 使得与其它管理软件集成变得更容易</li>
<li>部署简单: 提供在线和离线两种安装工具， 也可以安装到vSphere平台(OVA方式)虚拟设备</li>
</ul>
<h4 id="5-4-1-3-Harbor-组成"><a href="#5-4-1-3-Harbor-组成" class="headerlink" title="5.4.1.3 Harbor 组成"></a>5.4.1.3 Harbor 组成</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker116.png" srcset="/blog/img/loading.gif"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#harbor是由很多容器组成实现完整功能</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID        IMAGE                                    COMMAND                  CREATED             STATUS                   PORTS                                                              NAMES<br>051c87710632        goharbor/nginx-photon:v1.7.6             <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>   7 minutes ago       Up 7 minutes (healthy)   0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp   nginx<br>053f3acb093d        goharbor/harbor-portal:v1.7.6            <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>   7 minutes ago       Up 7 minutes (healthy)   80/tcp                                                             harbor-portal<br>b7bfd2a0cf0d        goharbor/harbor-jobservice:v1.7.6        <span class="hljs-string">&quot;/harbor/start.sh&quot;</span>       7 minutes ago       Up 7 minutes                                                                                harbor-jobservice<br>46e1d9040990        goharbor/harbor-core:v1.7.6              <span class="hljs-string">&quot;/harbor/start.sh&quot;</span>       8 minutes ago       Up 7 minutes (healthy)                                                                      harbor-core<br>75df361ce425        goharbor/harbor-db:v1.7.6                <span class="hljs-string">&quot;/entrypoint.sh post…&quot;</span>   8 minutes ago       Up 8 minutes (healthy)   5432/tcp                                                           harbor-db<br>e5cab1dc440d        goharbor/registry-photon:v2.6.2-v1.7.6   <span class="hljs-string">&quot;/entrypoint.sh /etc…&quot;</span>   8 minutes ago       Up 8 minutes (healthy)   5000/tcp                                                           registry<br>9cb40071fef8        goharbor/harbor-registryctl:v1.7.6       <span class="hljs-string">&quot;/harbor/start.sh&quot;</span>       8 minutes ago       Up 8 minutes (healthy)                                                                      registryctl<br>b8edf3f2f55a        goharbor/harbor-adminserver:v1.7.6       <span class="hljs-string">&quot;/harbor/start.sh&quot;</span>       8 minutes ago       Up 8 minutes (healthy)                                                                      harbor-adminserver<br>4b6334e93784        goharbor/redis-photon:v1.7.6             <span class="hljs-string">&quot;docker-entrypoint.s…&quot;</span>   8 minutes ago       Up 8 minutes             6379/tcp                                                           redis<br>7cccae63edbd        goharbor/harbor-log:v1.7.6               <span class="hljs-string">&quot;/bin/sh -c /usr/loc…&quot;</span>   8 minutes ago       Up 8 minutes (healthy)   127.0.0.1:1514-&gt;10514/tcp                                          harbor-log<br></code></pre></td></tr></table></figure>

<ul>
<li>Proxy: 对应启动组件nginx。它是一个nginx反向代理，代理Notary client（镜像认证）、Docker client（镜像上传下载等）和浏览器的访问请求（Core Service）给后端的各服务</li>
<li>UI（Core Service）: 对应启动组件harbor-ui。底层数据存储使用mysql数据库，主要提供了四个子功能:<ul>
<li>UI: 一个web管理页面ui</li>
<li>API: Harbor暴露的API服务</li>
<li>Auth: 用户认证服务，decode后的token中的用户信息在这里进行认证；auth后端可以接db、ldap、uaa三种认证实现</li>
<li>Token服务（上图中未体现）: 负责根据用户在每个project中的role来为每一个docker push/pull命令发布一个token，如果从docker client发送给registry的请求没有带token，registry会重定向请求到token服务创建token</li>
</ul>
</li>
<li>Registry: 对应启动组件registry。负责存储镜像文件，和处理镜像的pull/push命令。Harbor对镜像进行强制的访问控制，Registry会将客户端的每个pull、push请求转发到token服务来获取有效的token</li>
<li>Admin Service: 对应启动组件harbor-adminserver。是系统的配置管理中心附带检查存储用量，ui和jobserver启动时候需要加载adminserver的配置</li>
<li>Job Sevice: 对应启动组件harbor-jobservice。负责镜像复制工作的，他和registry通信，从一个registry pull镜像然后push到另一个registry，并记录job_log</li>
<li>Log Collector: 对应启动组件harbor-log。日志汇总组件，通过docker的log-driver把日志汇总到一起</li>
<li>DB: 对应启动组件harbor-db，负责存储project、 user、 role、replication、image_scan、access等的metadata数据</li>
</ul>
<h3 id="5-4-2-安装Harbor"><a href="#5-4-2-安装Harbor" class="headerlink" title="5.4.2 安装Harbor"></a>5.4.2 安装Harbor</h3><p>下载地址: <a target="_blank" rel="noopener" href="https://github.com/vmware/harbor/releases">https://github.com/vmware/harbor/releases</a></p>
<p>安装文档: <a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/blob/master/docs/install-config/_index.md">https://github.com/goharbor/harbor/blob/master/docs/install-config/_index.md</a></p>
<p>环境准备: 共四台主机</p>
<ul>
<li>两台主机harbor服务器，地址: 10.0.0.101|102</li>
<li>两台主机harbor客户端上传和下载镜像，地址：10.0.0.103|104</li>
</ul>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker117.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-2-1-安装-docker"><a href="#5-4-2-1-安装-docker" class="headerlink" title="5.4.2.1 安装 docker"></a>5.4.2.1 安装 docker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#cat install_docker_for_ubuntu1804.sh</span><br>COLOR=<span class="hljs-string">&quot;echo -e \\033[1;31m&quot;</span><br>END=<span class="hljs-string">&quot;\033[m&quot;</span><br>DOCKER_VERSION=<span class="hljs-string">&quot;5:19.03.5~3-0~ubuntu-bionic&quot;</span><br><br><span class="hljs-function"><span class="hljs-title">install_docker</span></span>()&#123;<br>apt update<br>apt  -y install apt-transport-https ca-certificates curl software-properties-<br>common<br>curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key<br>add -<br>add-apt-repository <span class="hljs-string">&quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-</span><br><span class="hljs-string">ce/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable&quot;</span><br>apt update<br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker有以下版本&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>apt-cache madison docker-ce<br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;5秒后即将安装: docker-&quot;</span><span class="hljs-variable">$&#123;DOCKER_VERSION&#125;</span><span class="hljs-string">&quot; 版本.....&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;如果想安装其它Docker版本，请按ctrl+c键退出，修改版本再执行&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>sleep 5<br><br>apt -y install docker-ce=<span class="hljs-variable">$&#123;DOCKER_VERSION&#125;</span> docker-ce-cli=<span class="hljs-variable">$&#123;DOCKER_VERSION&#125;</span><br><br>mkdir -p /etc/docker<br>tee /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>&#123;<br> <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://si7y70hh.mirror.aliyuncs.com&quot;</span>]<br>&#125;<br>EOF<br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> --now docker<br>docker version &amp;&amp; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker 安装成功&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> ||  <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker 安装失败&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>&#125;<br>dpkg -s docker-ce &amp;&gt; /dev/null &amp;&amp; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker已安装&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> || install_docker<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#bash install_docker_for_ubuntu1804.sh</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker version</span><br>Client: Docker Engine - Community<br>Version:      19.03.5<br>API version:    1.40<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:       Wed Nov 13 07:29:52 2019<br>OS/Arch:      linux/amd64<br>Experimental:    <span class="hljs-literal">false</span><br><br>Server: Docker Engine - Community<br>Engine:<br>Version:      19.03.5<br>API version:    1.40 (minimum version 1.12)<br>Go version:    go1.12.12<br>Git commit:    633a0ea838<br>Built:      Wed Nov 13 07:28:22 2019<br>OS/Arch:     linux/amd64<br>Experimental:   <span class="hljs-literal">false</span><br>containerd:<br>Version:      1.2.10<br>GitCommit:    b34a5c8af56e510852c35414db4c1f4fa6172339<br>runc:<br>Version:      1.0.0-rc8+dev<br>GitCommit:    3e425f80a8c931f88e6d94a8c831b9d5aa481657<br>docker-init:<br>Version:      0.18.0<br>GitCommit:    fec3683<br></code></pre></td></tr></table></figure>

<h4 id="5-4-2-2-先安装docker-compose"><a href="#5-4-2-2-先安装docker-compose" class="headerlink" title="5.4.2.2 先安装docker compose"></a>5.4.2.2 先安装docker compose</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#docker compose 必须先于harbor安装，否则会报以下错误</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#/apps/harbor/install.sh</span><br><br>[Step 0]: checking installation environment ...<br><br>Note: docker version: 19.03.5<br>✖ Need to install docker-compose(1.7.1+) by yourself first and run this script<br>again<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p><strong>安装docker compose</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#方法1: 通过pip安装，版本较新docker_compose，推荐使用</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#apt -y install python3-pip</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#pip3 install --upgrade pip</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#pip3 install docker-compose</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker-compose --version</span><br>docker-compose version 1.25.3, build unknown<br><br><span class="hljs-comment">#方法2: 直接从github下载安装对应版本，如果有翻墙，使用第二个更快</span><br><span class="hljs-comment">#参看说明: https://github.com/docker/compose/releases</span><br>curl -L https://github.com/docker/compose/releases/download/1.25.3/docker-compose-`uname -s`-`uname -m` -o /usr/bin/docker-compose<br>chmod +x /usr/bin/docker-compose<br><span class="hljs-comment">#或</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cp docker-compose-Linux-x86_64 /usr/bin</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ln -sv docker-compose-Linux-x86_64 docker-compose</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#chmod +x /usr/bin/docker-compose</span><br><br><span class="hljs-comment">#方法3: 直接安装，版本较旧docker-compose-1.17.1-2，不推荐使用</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#apt -y install docker-compose</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker-compose --version</span><br>docker-compose version 1.17.1, build unknown<br><br></code></pre></td></tr></table></figure>

<h4 id="5-4-2-3-下载Harbor安装包并解压缩"><a href="#5-4-2-3-下载Harbor安装包并解压缩" class="headerlink" title="5.4.2.3 下载Harbor安装包并解压缩"></a>5.4.2.3 下载Harbor安装包并解压缩</h4><p>以下使用 harbor 稳定版本1.7.6 安装包</p>
<p>方法1: 下载离线完整安装包,推荐使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#wget https://storage.googleapis.com/harbor-releases/release-1.7.0/harbor-offline-installer-v1.7.6.tgz</span><br></code></pre></td></tr></table></figure>

<p>方法2: 下载在线安装包 ,比较慢，不是很推荐</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#wget https://storage.googleapis.com/harbor-releases/release-1.7.0/harbor-online-installer-v1.7.6.tgz</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#ls -lh harbor-o*</span><br>-rw-r--r-- 1 root root 568M Sep 18 13:24 harbor-offline-installer-v1.7.6.tgz<br>-rw-r--r-- 1 root root 275K Sep 18 13:37 harbor-online-installer-v1.7.6.tgz<br></code></pre></td></tr></table></figure>

<p><strong>解压缩离线包</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#mkdir /apps</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#tar xvf harbor-offline-installer-v1.7.6.tgz -C /apps/</span><br></code></pre></td></tr></table></figure>

<h4 id="5-4-2-4-编辑配置文件-harbor-cfg"><a href="#5-4-2-4-编辑配置文件-harbor-cfg" class="headerlink" title="5.4.2.4 编辑配置文件 harbor.cfg"></a>5.4.2.4 编辑配置文件 harbor.cfg</h4><p>最新文档: <a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/blob/master/docs/install-config/configure-yml-file.md">https://github.com/goharbor/harbor/blob/master/docs/install-config/configure-yml-file.md</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#vim /apps/harbor/harbor.cfg</span><br><span class="hljs-comment">#只需要修改下面两行</span><br>hostname = 10.0.0.101  <span class="hljs-comment">#修改此行,指向当前主机IP 或 FQDN</span><br>harbor_admin_password = 123456 <span class="hljs-comment">#修改此行指定harbor登录用户admin的密码,默认用户/密码:admin/Harbor12345</span><br><br><span class="hljs-comment">#可选项</span><br>ui_url_protocol = http <span class="hljs-comment">#默认即可,如果修改为https,需要指定下面证书路径</span><br>ssl_cert = /data/cert/server.crt <span class="hljs-comment">#默认即可,https时，需指定下面证书文件路径</span><br>ss_cert_key = /data/cert/server.key  <span class="hljs-comment">#默认即可,https时，需指定下面私钥文件路径</span><br></code></pre></td></tr></table></figure>

<h4 id="5-4-2-5-运行-harbor-安装脚本"><a href="#5-4-2-5-运行-harbor-安装脚本" class="headerlink" title="5.4.2.5 运行 harbor 安装脚本"></a>5.4.2.5 运行 harbor 安装脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#先安装python</span><br>root@ubuntu1804 ~]<span class="hljs-comment">#apt -y install python</span><br><span class="hljs-comment">#安装docker harbor</span><br>root@ubuntu1804 ~]<span class="hljs-comment">#/apps/harbor/install.sh</span><br><br>[Step 0]: checking installation environment ...<br><br>Note: docker version: 19.03.5<br><br>Note: docker-compose version: 1.25.3<br><br>[Step 1]: loading Harbor images ...<br>......<br>[Step 4]: starting Harbor ...<br>Creating network <span class="hljs-string">&quot;harbor_harbor&quot;</span> with the default driver<br>Creating harbor-log ... <span class="hljs-keyword">done</span><br>Creating registryctl    ... <span class="hljs-keyword">done</span><br>Creating harbor-db     ... <span class="hljs-keyword">done</span><br>Creating redis       ... <span class="hljs-keyword">done</span><br>Creating registry      ... <span class="hljs-keyword">done</span><br>Creating harbor-adminserver ... <span class="hljs-keyword">done</span><br>Creating harbor-core    ... <span class="hljs-keyword">done</span><br>Creating harbor-jobservice ... <span class="hljs-keyword">done</span><br>Creating harbor-portal   ... <span class="hljs-keyword">done</span><br>Creating nginx       ... <span class="hljs-keyword">done</span><br><br>✔ ----Harbor has been installed and started successfully.----<br><br>Now you should be able to visit the admin portal at http://10.0.0.101.<br>For more details, please visit https://github.com/goharbor/harbor .<br><br><span class="hljs-comment">#安装harbor后会自动开启很多相关容器</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID        IMAGE                                    COMMAND                  CREATED             STATUS                   PORTS                                                              NAMES<br>051c87710632        goharbor/nginx-photon:v1.7.6             <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>   7 minutes ago       Up 7 minutes (healthy)   0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp   nginx<br>053f3acb093d        goharbor/harbor-portal:v1.7.6            <span class="hljs-string">&quot;nginx -g &#x27;daemon of…&quot;</span>   7 minutes ago       Up 7 minutes (healthy)   80/tcp                                                             harbor-portal<br>b7bfd2a0cf0d        goharbor/harbor-jobservice:v1.7.6        <span class="hljs-string">&quot;/harbor/start.sh&quot;</span>       7 minutes ago       Up 7 minutes                                                                                harbor-jobservice<br>46e1d9040990        goharbor/harbor-core:v1.7.6              <span class="hljs-string">&quot;/harbor/start.sh&quot;</span>       8 minutes ago       Up 7 minutes (healthy)                                                                      harbor-core<br>75df361ce425        goharbor/harbor-db:v1.7.6                <span class="hljs-string">&quot;/entrypoint.sh post…&quot;</span>   8 minutes ago       Up 8 minutes (healthy)   5432/tcp                                                           harbor-db<br>e5cab1dc440d        goharbor/registry-photon:v2.6.2-v1.7.6   <span class="hljs-string">&quot;/entrypoint.sh /etc…&quot;</span>   8 minutes ago       Up 8 minutes (healthy)   5000/tcp                                                           registry<br>9cb40071fef8        goharbor/harbor-registryctl:v1.7.6       <span class="hljs-string">&quot;/harbor/start.sh&quot;</span>       8 minutes ago       Up 8 minutes (healthy)                                                                      registryctl<br>b8edf3f2f55a        goharbor/harbor-adminserver:v1.7.6       <span class="hljs-string">&quot;/harbor/start.sh&quot;</span>       8 minutes ago       Up 8 minutes (healthy)                                                                      harbor-adminserver<br>4b6334e93784        goharbor/redis-photon:v1.7.6             <span class="hljs-string">&quot;docker-entrypoint.s…&quot;</span>   8 minutes ago       Up 8 minutes             6379/tcp                                                           redis<br>7cccae63edbd        goharbor/harbor-log:v1.7.6               <span class="hljs-string">&quot;/bin/sh -c /usr/loc…&quot;</span>   8 minutes ago       Up 8 minutes (healthy)   127.0.0.1:1514-&gt;10514/tcp                                          harbor-log<br>[root@ubuntu1804 ~]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<h4 id="5-4-2-5-实现开机自动启动-harbor"><a href="#5-4-2-5-实现开机自动启动-harbor" class="headerlink" title="5.4.2.5 实现开机自动启动 harbor"></a>5.4.2.5 实现开机自动启动 harbor</h4><h5 id="5-4-2-5-1-方法1-通过service文件实现"><a href="#5-4-2-5-1-方法1-通过service文件实现" class="headerlink" title="5.4.2.5.1 方法1: 通过service文件实现"></a>5.4.2.5.1 方法1: 通过service文件实现</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@harbor ~]<span class="hljs-comment">#vim /lib/systemd/system/harbor.service</span><br>[Unit]<br>Description=Harbor<br>After=docker.service systemd-networkd.service systemd-resolved.service<br>Requires=docker.service<br>Documentation=http://github.com/vmware/harbor<br>[Service]<br>Type=simple<br>Restart=on-failure<br>RestartSec=5<br>ExecStart=/usr/bin/docker-compose -f /apps/harbor/docker-compose.yml up<br>ExecStop=/usr/bin/docker-compose -f /apps/harbor/docker-compose.yml down<br><br>[Install]<br>WantedBy=multi-user.target<br><br>[root@harbor ~]<span class="hljs-comment">#systemctl daemon-reload</span><br>[root@harbor ~]<span class="hljs-comment">#systemctl enable harbor</span><br></code></pre></td></tr></table></figure>

<h5 id="5-4-2-5-2-方法2-通过-rc-local实现"><a href="#5-4-2-5-2-方法2-通过-rc-local实现" class="headerlink" title="5.4.2.5.2 方法2: 通过 rc.local实现"></a>5.4.2.5.2 方法2: 通过 rc.local实现</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@harbor ~]<span class="hljs-comment">#cat /etc/rc.local</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">cd</span> /apps/harbor<br>/usr/bin/docker-compose up<br><br>[root@harbor ~]<span class="hljs-comment">#chmod +x /etc/rc.local</span><br></code></pre></td></tr></table></figure>

<h4 id="5-4-2-6-登录-harbor-主机网站"><a href="#5-4-2-6-登录-harbor-主机网站" class="headerlink" title="5.4.2.6 登录 harbor 主机网站"></a>5.4.2.6 登录 harbor 主机网站</h4><p>用浏览器访问: <a target="_blank" rel="noopener" href="http://10.0.0.101/">http://10.0.0.101/</a></p>
<ul>
<li>用户名: admin</li>
<li>密码: 即前面harbor.cfg中指定的密码</li>
</ul>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker118.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker119.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-2-7-实战案例-一键安装Harbor脚本"><a href="#5-4-2-7-实战案例-一键安装Harbor脚本" class="headerlink" title="5.4.2.7 实战案例: 一键安装Harbor脚本"></a>5.4.2.7 实战案例: 一键安装Harbor脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#cat install_harbor_for_ubuntu1804.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#Description: Install harbor on ubuntu1804</span><br><span class="hljs-comment">#Author: laowang</span><br><br>COLOR=<span class="hljs-string">&quot;echo -e \E[1;31m&quot;</span><br>END=<span class="hljs-string">&quot;\E[m&quot;</span><br>DOCKER_VERSION=<span class="hljs-string">&quot;5:19.03.5~3-0~ubuntu-bionic&quot;</span><br>HARBOR_VERSION=1.7.6<br>IPADDR=`hostname -I|awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>`<br>HARBOR_ADMIN_PASSWORD=123456<br><br><span class="hljs-function"><span class="hljs-title">install_docker</span></span>()&#123;<br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;开始安装 Docker.....&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>sleep 1<br><br>apt update<br><br>apt  -y install apt-transport-https ca-certificates curl software-properties-common<br><br>curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -<br><br>add-apt-repository <span class="hljs-string">&quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable&quot;</span><br><br>apt update<br><br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker有以下版本:&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>sleep 2<br>apt-cache madison docker-ce<br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;5秒后即将安装: docker-&quot;</span><span class="hljs-variable">$&#123;DOCKER_VERSION&#125;</span><span class="hljs-string">&quot; 版本.....&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;如果想安装其它Docker版本，请按ctrl+c键退出，修改版本再执行&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>sleep 5<br><br>apt -y install docker-ce=<span class="hljs-variable">$&#123;DOCKER_VERSION&#125;</span> docker-ce-cli=<span class="hljs-variable">$&#123;DOCKER_VERSION&#125;</span><br><br>mkdir -p /etc/docker<br>tee /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>&#123;<br> <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://si7y70hh.mirror.aliyuncs.com&quot;</span>]<br>&#125;<br>EOF<br>systemctl daemon-reload<br>systemctl restart docker<br>docker version &amp;&amp; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker 安装完成&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> ||  <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker 安装失败&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">install_docker_compose</span></span>()&#123;<br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;开始安装 Docker compose.....&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>sleep 1<br><br>curl -L https://github.com/docker/compose/releases/download/1.25.3/docker-compose-`uname -s`-`uname -m` -o /usr/bin/docker-compose<br>chmod +x /usr/bin/docker-compose<br><br>docker-compose --version &amp;&amp;  <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker Compose 安装完成&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> || <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker compose 安装失败&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">install_harbor</span></span>()&#123;<br><span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;开始安装 Harbor.....&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>sleep 1<br><br>wget https://storage.googleapis.com/harbor-releases/release-1.7.0/harbor-offline-installer-v<span class="hljs-variable">$&#123;HARBOR_VERSION&#125;</span>.tgz<br>mkdir /apps<br>tar xvf harbor-offline-installer-v<span class="hljs-variable">$&#123;HARBOR_VERSION&#125;</span>.tgz  -C /apps/<br><br>sed -i.bak -e <span class="hljs-string">&#x27;s/^hostname =.*/hostname = &#x27;</span><span class="hljs-string">&#x27;&#x27;</span><span class="hljs-variable">$IPADDR</span><span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;/&#x27;</span> -e <span class="hljs-string">&#x27;s/^harbor_admin_password =.*/harbor_admin_password =&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><span class="hljs-variable">$HARBOR_ADMIN_PASSWORD</span><span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;/&#x27;</span> /apps/harbor/harbor.cfg<br><br>apt -y install python<br><br>/apps/harbor/install.sh &amp;&amp; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Harbor 安装完成&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> ||  <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Harbor 安装失败&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br>&#125;<br><span class="hljs-function"><span class="hljs-title">harbor_service</span></span> ()&#123;<br>cat &gt; /lib/systemd/system/harbor.service &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[Unit]</span><br><span class="hljs-string">Description=Harbor</span><br><span class="hljs-string">After=docker.service systemd-networkd.service systemd-resolved.service</span><br><span class="hljs-string">Requires=docker.service</span><br><span class="hljs-string">Documentation=http://github.com/vmware/harbor</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">Type=simple</span><br><span class="hljs-string">Restart=on-failure</span><br><span class="hljs-string">RestartSec=5</span><br><span class="hljs-string">ExecStart=/usr/bin/docker-compose -f /apps/harbor/docker-compose.yml up</span><br><span class="hljs-string">ExecStop=/usr/bin/docker-compose -f /apps/harbor/docker-compose.yml down</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Install]WantedBy=multi-user.target</span><br><span class="hljs-string">EOF</span><br><br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> harbor &amp;&gt;/dev/null ||  <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Harbor已配置为开机自动启动&quot;</span><span class="hljs-variable">$&#123;END&#125;</span><br><br>&#125;<br>dpkg -s docker-ce &amp;&gt; /dev/null &amp;&amp; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker已安装&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> || install_docker<br><br>docker-compose --version &amp;&gt; /dev/null &amp;&amp; <span class="hljs-variable">$&#123;COLOR&#125;</span><span class="hljs-string">&quot;Docker Compose已安装&quot;</span><span class="hljs-variable">$&#123;END&#125;</span> || install_docker_compose<br><br>install_harbor<br><br>sharbor_service<br></code></pre></td></tr></table></figure>

<h3 id="5-4-3-使用单主机-harbor"><a href="#5-4-3-使用单主机-harbor" class="headerlink" title="5.4.3 使用单主机 harbor"></a>5.4.3 使用单主机 harbor</h3><h4 id="5-4-3-1-建立项目"><a href="#5-4-3-1-建立项目" class="headerlink" title="5.4.3.1 建立项目"></a>5.4.3.1 建立项目</h4><p><strong>harbor上必须先建立项目，才能上传镜像</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker120.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker121.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker122.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-3-2-命令行登录-harbor"><a href="#5-4-3-2-命令行登录-harbor" class="headerlink" title="5.4.3.2 命令行登录 harbor"></a>5.4.3.2 命令行登录 harbor</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#vim /lib/systemd/system/docker.service</span><br>ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --insecure-registry 10.0.0.101 --insecure-registry 10.0.0.102<br> <br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl daemon-reload</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#systemctl restart docker</span><br><br><span class="hljs-comment">#查看进程是否添加上面设置</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#ps aux|grep dockerd</span><br>root    17347  7.8  9.6 839272 94784 ?    Ssl  22:54  0:15<br>/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --insecure-registry 10.0.0.101 --insecure-registry 10.0.0.102<br>root    17630  0.0  0.1  14428  1008 pts/4  S+  22:57  0:00 grep --color=auto dockerd<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cat .docker/config.json</span><br>&#123;<br><span class="hljs-string">&quot;auths&quot;</span>: &#123;<br><span class="hljs-string">&quot;10.0.0.101&quot;</span>: &#123;<br><span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;YWRtaW46MTIzNDU2&quot;</span><br>&#125;,<br><span class="hljs-string">&quot;https://index.docker.io/v1/&quot;</span>: &#123;<br><span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;d2FuZ3hpYW9jaHVuOmxidG9vdGgwNjE4&quot;</span><br>&#125;,<br><span class="hljs-string">&quot;registry.cn-beijing.aliyuncs.com&quot;</span>: &#123;<br><span class="hljs-string">&quot;auth&quot;</span>: <span class="hljs-string">&quot;MjkzMDg2MjBAcXEuY29tOmxidG9vdGgwNjE4&quot;</span><br>&#125;<br>&#125;,<br><span class="hljs-string">&quot;HttpHeaders&quot;</span>: &#123;<br><span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Docker-Client/19.03.5 (linux)&quot;</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="5-4-3-3-给本地镜像打标签并上传到harbor"><a href="#5-4-3-3-给本地镜像打标签并上传到harbor" class="headerlink" title="5.4.3.3 给本地镜像打标签并上传到harbor"></a>5.4.3.3 给本地镜像打标签并上传到harbor</h4><p>修改 images 的名称，不修改成指定格式无法将镜像上传到 harbor 仓库</p>
<p>格式为:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">Harbor主机IP/项目名/image名字:版本<br></code></pre></td></tr></table></figure>

<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#上传镜像前，必须先登录harbor</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker login 10.0.0.101</span><br>Username: admin<br>Password:<br>WARNING! Your password will be stored unencrypted <span class="hljs-keyword">in</span> /root/.docker/config.json.<br>Configure a credential helper to remove this warning. See<br>https://docs.docker.com/engine/reference/commandline/login/<span class="hljs-comment">#credentials-store</span><br><br>Login Succeeded<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag alpine-base:3.11 10.0.0.101/example/alpine-base:3.11</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker push 10.0.0.101/example/alpine-base:3.11</span><br></code></pre></td></tr></table></figure>

<p>访问harbor网站验证上传镜像成功</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker123.png" srcset="/blog/img/loading.gif"></p>
<p>范例: 如果不事先建立项目，上传镜像失败</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag centos7.7base:v1.0 10.0.0.101/example2/centos7.7base:v1.0</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker push 10.0.0.101/example2/centos7-base:v1</span><br>The push refers to repository [10.0.0.101/example2/centos7-base]<br>2073413aebd6: Preparing<br>6ec9af97c369: Preparing<br>034f282942cd: Preparing<br>denied: requested access to the resource is denied<br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag centos7.7base:v1.0 10.0.0.101/example/centos7-base:v1</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker push 10.0.0.101/example/centos7.7base:v1.0</span><br>The push refers to repository [10.0.0.101/example/centos7-base]<br>2073413aebd6: Pushed<br>6ec9af97c369: Pushed<br>034f282942cd: Pushed<br>v1: digest:<br>sha256:02cd943f2569c7c55f08a979fd9661f1fd7893c424bca7b343188654ba63d98d size:<br>949<br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker124.png" srcset="/blog/img/loading.gif"></p>
<p><strong>可以看到操作的日志记录</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker125.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-3-4-下载harbor的镜像"><a href="#5-4-3-4-下载harbor的镜像" class="headerlink" title="5.4.3.4 下载harbor的镜像"></a>5.4.3.4 下载harbor的镜像</h4><p><strong>在10.0.0.103的CentOS 7 的主机上无需登录，即可下载镜像</strong></p>
<p>下载前必须修改docker的service 文件，加入harbor服务器的地址才可以下载</p>
<p><strong>范例: 修改docker的service文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#docker pull 10.0.0.101/example/centos7-base:v1</span><br>Error response from daemon: Get https://10.0.0.101/v2/: dial tcp 10.0.0.101:443:<br>connect: connection refused<br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /lib/systemd/system/docker.service</span><br>ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --insecure-registry 10.0.0.101 --insecure-registry 10.0.0.102<br>[root@centos7 ~]<span class="hljs-comment">#systemctl daemon-reload</span><br>[root@centos7 ~]<span class="hljs-comment">#systemctl restart docker</span><br>[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      SIZE<br></code></pre></td></tr></table></figure>

<p><strong>范例: 从harbor下载镜像</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#docker pull 10.0.0.101/example/centos7.7base:v1.0</span><br>v1.0: Pulling from example/centos7.7base<br>f34b00c7da20: Pull complete <br>1e9d54579f55: Pull complete <br>Digest: sha256:3479a85d488f0a526acabfab30ba3613c2fb061963653aecbb8c4e4e7861c6bf<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> 10.0.0.101/example/centos7.7base:v1.0<br>10.0.0.101/example/centos7.7base:v1.0<br>[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY                         TAG                 IMAGE ID            CREATED             SIZE<br>10.0.0.101/example/centos7.7base   v1.0                970717fd061c        21 minutes ago      435MB<br></code></pre></td></tr></table></figure>

<p><strong>5.4.3.5 创建自动打标签上传镜像脚本</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#在10.0.0.100上修改以前的build.sh脚本</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cd /data/dockerfile/web/nginx/1.16.1-alpine/</span><br>[root@ubuntu1804 1.16.1-alpine]<span class="hljs-comment">#vim build.sh</span><br>[root@ubuntu1804 1.16.1-alpine]<span class="hljs-comment">#cat build.sh</span><br><span class="hljs-comment">#!/bin/bash</span><br>TAG=<span class="hljs-variable">$1</span><br>docker build -t 10.0.0.101/example/nginx-alpine:1.16.1-<span class="hljs-variable">$&#123;TAG&#125;</span> .<br>docker push 10.0.0.101/example/nginx-alpine:1.16.1-<span class="hljs-variable">$&#123;TAG&#125;</span><br>docker rmi -f 10.0.0.101/example/nginx-alpine:1.16.1-<span class="hljs-variable">$&#123;TAG&#125;</span><br>[root@ubuntu1804 1.16.1-alpine]<span class="hljs-comment">#bash build.sh v1</span><br></code></pre></td></tr></table></figure>

<p>登录harbor网站验证脚本上传镜像成功</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker126.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-3-6-修改-harbor-配置"><a href="#5-4-3-6-修改-harbor-配置" class="headerlink" title="5.4.3.6 修改 harbor 配置"></a>5.4.3.6 修改 harbor 配置</h4><p>后期如果修改harbor配置，比如: 修改IP地址等，可执行以下步骤生效</p>
<p>方法1:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#cd /apps/harbor/</span><br>[root@ubuntu1804 harbor]<span class="hljs-comment">#docker-compose stop</span><br>Stopping nginx       ... <span class="hljs-keyword">done</span><br>Stopping harbor-portal   ... <span class="hljs-keyword">done</span><br>Stopping harbor-jobservice ... <span class="hljs-keyword">done</span><br>Stopping harbor-core    ... <span class="hljs-keyword">done</span><br>Stopping harbor-adminserver ... <span class="hljs-keyword">done</span><br>Stopping harbor-db     ... <span class="hljs-keyword">done</span><br>Stopping registryctl    ... <span class="hljs-keyword">done</span><br>Stopping registry      ... <span class="hljs-keyword">done</span><br>Stopping redis       ... <span class="hljs-keyword">done</span><br>Stopping harbor-log     ...<br><span class="hljs-comment">#所有相关容器都退出</span><br>[root@ubuntu1804 harbor]<span class="hljs-comment">#docker ps -a</span><br>CONTAINER ID    IMAGE                  COMMAND      <br>  CREATED       STATUS            PORTS        NAMES<br>4ec3c3885407    goharbor/nginx-photon:v1.7.6       <span class="hljs-string">&quot;nginx -g &#x27;daemon</span><br><span class="hljs-string">of…&quot;</span>  32 minutes ago   Exited (0) 51 seconds ago            <br>nginx<br>5707b4ac41d8    goharbor/harbor-portal:v1.7.6       <span class="hljs-string">&quot;nginx -g &#x27;daemon</span><br><span class="hljs-string">of…&quot;</span>  32 minutes ago   Exited (0) 50 seconds ago            <br>harbor-portal<br>0ed230b9b714    goharbor/harbor-jobservice:v1.7.6     <span class="hljs-string">&quot;/harbor/start.sh&quot;</span><br>   32 minutes ago   Exited (137) 41 seconds ago           <br>harbor-jobservice<br>fec659188349    goharbor/harbor-core:v1.7.6        <span class="hljs-string">&quot;/harbor/start.sh&quot;</span><br>   32 minutes ago   Exited (137) 30 seconds ago           <br>harbor-core<br>910d14c1d7f7    goharbor/harbor-adminserver:v1.7.6    <span class="hljs-string">&quot;/harbor/start.sh&quot;</span><br>   32 minutes ago   Exited (137) 20 seconds ago           <br>harbor-adminserver<br>4348f503aa0e    goharbor/harbor-db:v1.7.6         <span class="hljs-string">&quot;/entrypoint.sh</span><br><span class="hljs-string">post…&quot;</span>  32 minutes ago   Exited (255) 48 seconds ago           <br>harbor-db<br>beff6886f0f1    goharbor/harbor-registryctl:v1.7.6    <span class="hljs-string">&quot;/harbor/start.sh&quot;</span><br>   32 minutes ago   Exited (137) 41 seconds ago           <br>registryctl<br>428c99d274bf    goharbor/registry-photon:v2.6.2-v1.7.6  <span class="hljs-string">&quot;/entrypoint.sh</span><br><span class="hljs-string">/etc…&quot;</span>  32 minutes ago   Exited (137) 20 seconds ago           <br>registry<br>775b4026fa4e    goharbor/redis-photon:v1.7.6       <span class="hljs-string">&quot;docker-</span><br><span class="hljs-string">entrypoint.s…&quot;</span>  32 minutes ago   Exited (137) 30 seconds ago        <br>   redis<br>c6f44e2034c6    goharbor/harbor-log:v1.7.6        <span class="hljs-string">&quot;/bin/sh -c</span><br><span class="hljs-string">/usr/loc…&quot;</span>  32 minutes ago   Exited (137) 9 seconds ago          <br> harbor-log<br> <br> <span class="hljs-comment">#修改harbor配置</span><br>[root@ubuntu1804 harbor]<span class="hljs-comment">#vim harbor.cfg</span><br><br><span class="hljs-comment">#更新配置</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#/apps/harbor/prepare</span><br>Clearing the configuration file: /apps/harbor/common/config/db/env<br>Clearing the configuration file: /apps/harbor/common/config/core/private_key.pem<br>Clearing the configuration file: /apps/harbor/common/config/core/env<br>Clearing the configuration file: /apps/harbor/common/config/core/app.conf<br>Clearing the configuration file: /apps/harbor/common/config/adminserver/env<br>Clearing the configuration file: /apps/harbor/common/config/registryctl/env<br>Clearing the configuration file:<br>/apps/harbor/common/config/registryctl/config.yml<br>Clearing the configuration file: /apps/harbor/common/config/registry/root.crt<br>Clearing the configuration file: /apps/harbor/common/config/registry/config.yml<br>Clearing the configuration file: /apps/harbor/common/config/<span class="hljs-built_in">log</span>/logrotate.conf<br>Clearing the configuration file: /apps/harbor/common/config/nginx/nginx.conf<br>Clearing the configuration file: /apps/harbor/common/config/jobservice/env<br>Clearing the configuration file:<br>/apps/harbor/common/config/jobservice/config.yml<br>loaded secret from file: /data/secretkey<br>Generated configuration file: /apps/harbor/common/config/nginx/nginx.conf<br>Generated configuration file: /apps/harbor/common/config/adminserver/env<br>Generated configuration file: /apps/harbor/common/config/core/env<br>Generated configuration file: /apps/harbor/common/config/registry/config.yml<br>Generated configuration file: /apps/harbor/common/config/db/env<br>Generated configuration file: /apps/harbor/common/config/jobservice/env<br>Generated configuration file: /apps/harbor/common/config/jobservice/config.yml<br>Generated configuration file: /apps/harbor/common/config/<span class="hljs-built_in">log</span>/logrotate.conf<br>Generated configuration file: /apps/harbor/common/config/registryctl/env<br>Generated configuration file: /apps/harbor/common/config/core/app.conf<br>Generated certificate, key file:<br>/apps/harbor/common/config/core/private_key.pem, cert file:<br>/apps/harbor/common/config/registry/root.crt<br>The configuration files are ready, please use docker-compose to start the<br>service.<br><br><span class="hljs-comment">#重新启动docker compose</span><br>[root@ubuntu1804 harbor]<span class="hljs-comment">#docker-compose start</span><br>Starting <span class="hljs-built_in">log</span>     ... <span class="hljs-keyword">done</span><br>Starting postgresql ... <span class="hljs-keyword">done</span><br>Starting redis    ... <span class="hljs-keyword">done</span><br>Starting adminserver ... <span class="hljs-keyword">done</span><br>Starting registry  ... <span class="hljs-keyword">done</span><br>Starting core    ... <span class="hljs-keyword">done</span><br>Starting jobservice ... <span class="hljs-keyword">done</span><br>Starting portal   ... <span class="hljs-keyword">done</span><br>Starting proxy    ... <span class="hljs-keyword">done</span><br>Starting registryctl ... <span class="hljs-keyword">done</span><br><br><span class="hljs-comment">#相关容器自动启动</span><br>[root@ubuntu1804 harbor]<span class="hljs-comment">#docker ps</span><br>CONTAINER ID    IMAGE                  COMMAND      <br>  CREATED       STATUS               PORTS       <br>                       NAMES<br>4ec3c3885407    goharbor/nginx-photon:v1.7.6       <span class="hljs-string">&quot;nginx -g &#x27;daemon</span><br><span class="hljs-string">of…&quot;</span>  34 minutes ago   Up 9 seconds (health: starting)   0.0.0.0:80-<br>&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp  nginx<br>5707b4ac41d8    goharbor/harbor-portal:v1.7.6       <span class="hljs-string">&quot;nginx -g &#x27;daemon</span><br><span class="hljs-string">of…&quot;</span>  34 minutes ago   Up 9 seconds (health: starting)   80/tcp      <br>                        harbor-portal<br>0ed230b9b714    goharbor/harbor-jobservice:v1.7.6     <span class="hljs-string">&quot;/harbor/start.sh&quot;</span><br>   34 minutes ago   Up 10 seconds                    <br>                        harbor-jobservice<br>fec659188349    goharbor/harbor-core:v1.7.6        <span class="hljs-string">&quot;/harbor/start.sh&quot;</span><br>   34 minutes ago   Up 11 seconds (health: starting)           <br>                       harbor-core<br>910d14c1d7f7    goharbor/harbor-adminserver:v1.7.6    <span class="hljs-string">&quot;/harbor/start.sh&quot;</span><br>   34 minutes ago   Up 14 seconds (health: starting)           <br>                       harbor-adminserver<br>4348f503aa0e    goharbor/harbor-db:v1.7.6         <span class="hljs-string">&quot;/entrypoint.sh</span><br><span class="hljs-string">post…&quot;</span>  34 minutes ago   Up 13 seconds (health: starting)  5432/tcp    <br>                         harbor-db<br>beff6886f0f1    goharbor/harbor-registryctl:v1.7.6    <span class="hljs-string">&quot;/harbor/start.sh&quot;</span><br>   34 minutes ago   Up 12 seconds (health: starting)           <br>                       registryctl<br>428c99d274bf    goharbor/registry-photon:v2.6.2-v1.7.6  <span class="hljs-string">&quot;/entrypoint.sh</span><br><span class="hljs-string">/etc…&quot;</span>  34 minutes ago   Up 13 seconds (health: starting)  5000/tcp    <br>                         registry<br>775b4026fa4e    goharbor/redis-photon:v1.7.6       <span class="hljs-string">&quot;docker-</span><br><span class="hljs-string">entrypoint.s…&quot;</span>  34 minutes ago   Up 11 seconds            6379/tcp<br>                             redis<br>c6f44e2034c6    goharbor/harbor-log:v1.7.6        <span class="hljs-string">&quot;/bin/sh -c</span><br><span class="hljs-string">/usr/loc…&quot;</span>  34 minutes ago   Up 16 seconds (health: starting) <br>127.0.0.1:1514-&gt;10514/tcp  <br></code></pre></td></tr></table></figure>

<p>方法2:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#/apps/harbor/install.sh</span><br></code></pre></td></tr></table></figure>

<h3 id="5-4-4-实现-harbor-高可用"><a href="#5-4-4-实现-harbor-高可用" class="headerlink" title="5.4.4 实现 harbor 高可用"></a>5.4.4 实现 harbor 高可用</h3><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker127.png" srcset="/blog/img/loading.gif"></p>
<p>Harbor支持基于策略的Docker镜像复制功能，这类似于MySQL的主从同步，其可以实现不同的数据中心、不同的运行环境之间同步镜像，并提供友好的管理界面，大大简化了实际运维中的镜像管理工作，已经有用很多互联网公司使用harbor搭建内网docker仓库的案例，并且还有实现了双向复制功能</p>
<p>harbor高可用可以基于共享存储，比如NAS。或者可以通过harbor的镜像复制功能通过负载均衡实现高可用。</p>
<h4 id="5-4-4-1-安装第二台-harbor主机"><a href="#5-4-4-1-安装第二台-harbor主机" class="headerlink" title="5.4.4.1 安装第二台 harbor主机"></a>5.4.4.1 安装第二台 harbor主机</h4><p>参考5.4.2的过程，在第二台主机上安装部署好harbor，并登录系统</p>
<p><strong>注意: harbor.cfg中配置 hostname = 10.0.0.102</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker128.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-4-2-第二台harbor上新建项目"><a href="#5-4-4-2-第二台harbor上新建项目" class="headerlink" title="5.4.4.2 第二台harbor上新建项目"></a>5.4.4.2 第二台harbor上新建项目</h4><p>参考第一台harbor服务器的项目名称，在第二台harbor服务器上新建与之同名的项目</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker128.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-4-3-第二台harbor上仓库管理中新建目标"><a href="#5-4-4-3-第二台harbor上仓库管理中新建目标" class="headerlink" title="5.4.4.3 第二台harbor上仓库管理中新建目标"></a>5.4.4.3 第二台harbor上仓库管理中新建目标</h4><p>参考第一台主机信息,新建复制（同步）目标信息,将第一台主机设为复制的目标</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker129.png" srcset="/blog/img/loading.gif"></p>
<p><strong>输入第一台harbor服务器上的主机和用户信息</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker130.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker131.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-4-4-第二台harbor上新建复制规则实现到第一台harbor的单向复制"><a href="#5-4-4-4-第二台harbor上新建复制规则实现到第一台harbor的单向复制" class="headerlink" title="5.4.4.4 第二台harbor上新建复制规则实现到第一台harbor的单向复制"></a>5.4.4.4 第二台harbor上新建复制规则实现到第一台harbor的单向复制</h4><p>在第二台harbor上建立复制的目标主机,即第一台harbor主机,将第二台harbor上面的镜像复制到第一台harbor上</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker132.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker133.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-4-5-在第一台harbor主机上重复上面操作"><a href="#5-4-4-5-在第一台harbor主机上重复上面操作" class="headerlink" title="5.4.4.5 在第一台harbor主机上重复上面操作"></a>5.4.4.5 在第一台harbor主机上重复上面操作</h4><p>以上操作，只是实现了从第二台harbor主机10.0.0.102到第一台harbor主机10.0.101的单向同步</p>
<p>同样要在在第一台harbor上再执行下面操作，才实现双向同步</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker134.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker135.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-4-6-确认同步成功"><a href="#5-4-4-6-确认同步成功" class="headerlink" title="5.4.4.6 确认同步成功"></a>5.4.4.6 确认同步成功</h4><p>在第二台harbor主机上可以查看到从第一台主机同步过来的镜像</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker136.png" srcset="/blog/img/loading.gif"></p>
<p>也可以查看到同步日志</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker137.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-4-7-上传镜像观察是否可以双高同步"><a href="#5-4-4-7-上传镜像观察是否可以双高同步" class="headerlink" title="5.4.4.7 上传镜像观察是否可以双高同步"></a>5.4.4.7 上传镜像观察是否可以双高同步</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag tomcat-web:app1 10.0.0.101/example/tomcat-web:app1</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker push 10.0.0.101/example/tomcat-web:app1</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag tomcat-web:app2 10.0.0.102/example/tomcat-web:app2</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker push 10.0.0.102/example/tomcat-web:app2</span><br></code></pre></td></tr></table></figure>

<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker138.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker139.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-4-8-删除镜像观察是否可自动同步"><a href="#5-4-4-8-删除镜像观察是否可自动同步" class="headerlink" title="5.4.4.8 删除镜像观察是否可自动同步"></a>5.4.4.8 删除镜像观察是否可自动同步</h4><p>!(<a target="_blank" rel="noopener" href="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker140.png">https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker140.png</a>)</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker141.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker142.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker143.png" srcset="/blog/img/loading.gif"></p>
<h3 id="5-4-5-harbor-安全-https-配置"><a href="#5-4-5-harbor-安全-https-配置" class="headerlink" title="5.4.5 harbor 安全 https 配置"></a>5.4.5 harbor 安全 https 配置</h3><p>harbor默认使用http,为了安全，可以使用https</p>
<h4 id="5-4-5-1-实现Harbor的-https-认证"><a href="#5-4-5-1-实现Harbor的-https-认证" class="headerlink" title="5.4.5.1 实现Harbor的 https 认证"></a>5.4.5.1 实现Harbor的 https 认证</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#安装docker</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#bash install_docker_for_ubuntu1804.sh</span><br><br><span class="hljs-comment">#安装docker compose</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#curl -L https://github.com/docker/compose/releases/download/1.25.3/docker-compose-`uname-s`-`uname -m` -o /usr/local/bin/docker-compose</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#chmod +x /usr/local/bin/docker-compose</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker-compose --version</span><br>docker-compose version 1.25.3, build d4d1b42b<br><br><span class="hljs-comment">#下载harbor离线安装包且解压缩</span><br>root@ubuntu1804 ~]<span class="hljs-comment">#wget https://storage.googleapis.com/harbor-releases/release-1.7.0/harbor-offline-installer-v1.7.6.tgz</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#mkdir /apps</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#tar xvf harbor-offline-installer-v1.7.6.tgz -C /apps/</span><br><br><span class="hljs-comment">#生成私钥和证书</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#touch /root/.rnd</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#mkdir /apps/harbor/certs/</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#cd /apps/harbor/certs/</span><br><br><span class="hljs-comment">#生成CA证书</span><br>[root@ubuntu1804 certs]<span class="hljs-comment">#openssl req -newkey rsa:4096 -nodes -sha256 -keyout ca.key -x509 -subj &quot;/CN=ca.magedu.org&quot; -days 365 -out ca.crt</span><br><br><span class="hljs-comment">#生成harbor主机的证书申请</span><br>[root@ubuntu1804 certs]<span class="hljs-comment">#openssl req -newkey rsa:4096 -nodes -sha256 -subj &quot;/CN=harbor.magedu.org&quot; -keyout harbor.magedu.org.key -out harbor.magedu.org.csr</span><br><br><span class="hljs-comment">#给harbor主机颁发证书</span><br>[root@ubuntu1804 certs]<span class="hljs-comment">#openssl x509 -req -in harbor.magedu.org.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out harbor.magedu.org.crt</span><br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#tree /apps/harbor/certs</span><br>/apps/harbor/certs<br>├── ca.crt<br>├── ca.key<br>├── ca.srl<br>├── harbor.magedu.org.crt<br>├── harbor.magedu.org.csr<br>└── harbor.magedu.org.key<br><br>0 directories, 6 files<br>[root@ubuntu1804 ~]<span class="hljs-comment">#vim /apps/harbor/harbor.cfg</span><br>hostname = harbor.magedu.org<br>ui_url_protocol = https<br>ssl_cert = /apps/harbor/certs/harbor.magedu.org.crt<br>ssl_cert_key = /apps/harbor/certs/harbor.magedu.org.key<br>harbor_admin_password = 123456 <br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#apt -y install python</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#/apps/harbor/install.sh</span><br></code></pre></td></tr></table></figure>

<h4 id="5-4-5-2-用https方式访问harbor网站"><a href="#5-4-5-2-用https方式访问harbor网站" class="headerlink" title="5.4.5.2 用https方式访问harbor网站"></a>5.4.5.2 用https方式访问harbor网站</h4><p>修改/etc/hosts文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.0.0.103 harbor.magedu.org<br></code></pre></td></tr></table></figure>

<p>打开浏览器，访问<a target="_blank" rel="noopener" href="http://harbor.magedu.org/">http://harbor.magedu.org</a> ,可以看到以下界面</p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker144.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker145.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker146.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker147.png" srcset="/blog/img/loading.gif"></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker148.png" srcset="/blog/img/loading.gif"></p>
<p><strong>查看证书</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker149.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-4-5-3-在harbor网站新建项目"><a href="#5-4-5-3-在harbor网站新建项目" class="headerlink" title="5.4.5.3 在harbor网站新建项目"></a>5.4.5.3 在harbor网站新建项目</h4><p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker150.png" srcset="/blog/img/loading.gif"></p>
<h4 id="5-2-5-4-在客户端下载CA的证书"><a href="#5-2-5-4-在客户端下载CA的证书" class="headerlink" title="5.2.5.4 在客户端下载CA的证书"></a>5.2.5.4 在客户端下载CA的证书</h4><p><strong>直接登录和上传下载镜像会报错</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#vim /etc/hosts</span><br>10.0.0.103 harbor.magedu.org<br><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker login harbor.magedu.org</span><br>Username: admin<br>Password:<br>Error response from daemon: Get https://harbor.magedu.org/v2/: x509: certificate<br>signed by unknown authority<br></code></pre></td></tr></table></figure>

<p><strong>在客户端下载ca的证书</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#mkdir -pv /etc/docker/certs.d/harbor.magedu.org/</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#scp -r harbor.magedu.org:/apps/harbor/certs/ca.crt</span><br>/etc/docker/certs.d/harbor.magedu.org/<br>[root@ubuntu1804 ~]<span class="hljs-comment">#tree /etc/docker/certs.d/</span><br>/etc/docker/certs.d/<br>└── harbor.magedu.org<br> └── ca.crt<br><br>1 directory, 1 file<br></code></pre></td></tr></table></figure>

<h4 id="5-2-5-5-从客户端上传镜像"><a href="#5-2-5-5-从客户端上传镜像" class="headerlink" title="5.2.5.5 从客户端上传镜像"></a>5.2.5.5 从客户端上传镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ubuntu1804 ~]<span class="hljs-comment">#docker tag alpine:3.11 harbor.magedu.org/example/alpine:3.11</span><br>[root@ubuntu1804 ~]<span class="hljs-comment">#docker push harbor.magedu.org/example/alpine:3.11</span><br>The push refers to repository [harbor.magedu.org/example/alpine]<br>5216338b40a7: Pushed<br>3.11: digest:<br>sha256:ddba4d27a7ffc3f86dd6c2f92041af252a1f23a8e742c90e6e1297bfa1bc0c45 size:<br>528<br></code></pre></td></tr></table></figure>

<p><strong>在harbor网站上验证上传的镜像</strong></p>
<p><img src="https://lwx-1304975851.cos.ap-guangzhou.myqcloud.com/myblog/docker/docker151.png" srcset="/blog/img/loading.gif" alt="docker"></p>
<h4 id="5-4-5-6-在客户端下载镜像"><a href="#5-4-5-6-在客户端下载镜像" class="headerlink" title="5.4.5.6 在客户端下载镜像"></a>5.4.5.6 在客户端下载镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment">#vim /etc/hosts</span><br>10.0.0.103 harbor.magedu.org<br>[root@centos7 ~]<span class="hljs-comment">#docker pull harbor.magedu.org/example/alpine:3.11</span><br>Error response from daemon: Get https://harbor.magedu.org/v2/: x509: certificate<br>signed by unknown authority<br><br>[root@centos7 ~]<span class="hljs-comment">#mkdir -pv /etc/docker/certs.d/harbor.magedu.org/</span><br>[root@centos7 ~]<span class="hljs-comment">#scp -r harbor.magedu.org:/apps/harbor/certs/ca.crt /etc/docker/certs.d/harbor.magedu.org/</span><br><br>[root@centos7 ~]<span class="hljs-comment">#tree /etc/docker/certs.d/</span><br>/etc/docker/certs.d/<br>└── harbor.magedu.org<br> └── ca.crt<br><br>1 directory, 1 file<br><br>[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY     TAG         IMAGE ID      CREATED      <br>SIZE<br>[root@centos7 ~]<span class="hljs-comment">#docker pull harbor.magedu.org/example/alpine:3.11</span><br>3.11: Pulling from example/alpine<br>c9b1b535fdd9: Pull complete<br>Digest: sha256:ddba4d27a7ffc3f86dd6c2f92041af252a1f23a8e742c90e6e1297bfa1bc0c45<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> harbor.magedu.org/example/alpine:3.11<br>harbor.magedu.org/example/alpine:3.11<br>[root@centos7 ~]<span class="hljs-comment">#docker images</span><br>REPOSITORY             TAG         IMAGE ID     <br>CREATED       SIZE<br>harbor.magedu.org/example/alpine  3.11        e7d92cdc71fe     13<br>days ago     5.59MB<br></code></pre></td></tr></table></figure>





<p>创建分区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">fdisk /dev/sdb<br><br>mkfs.ext4 /dev/sdb<br><br>vim /etc/fstab<br><br>mount -a<br></code></pre></td></tr></table></figure>



<h1 id="haproxy实现harbor的负载均衡"><a href="#haproxy实现harbor的负载均衡" class="headerlink" title="haproxy实现harbor的负载均衡"></a>haproxy实现harbor的负载均衡</h1><p>可以看视频</p>
<p>harbor.yml地址测试写域名和写ip</p>
<p>haproxy配置文件测试写域名和ip</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/linux-docker/">linux docker</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2021/09/02/%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AFdocker%EF%BC%88%E5%9B%9B%EF%BC%89docker%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">企业级容器技术docker（四）docker网络管理</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2021/09/02/%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AFdocker%EF%BC%88%E4%B8%80%EF%BC%89docker%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%9F%BA%E7%A1%80/">
                        <span class="hidden-mobile">企业级容器技术docker（一）docker介绍和基础</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/blog/js/debouncer.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/blog/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/blog/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/blog/js/boot.js" ></script>



</body>
</html>
